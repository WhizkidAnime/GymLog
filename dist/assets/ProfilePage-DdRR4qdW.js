import{s as ne,g as f,a as re,j as e,u as Ne}from"./index-BtV5doUL.js";import{r as s,c as ge,e as ve}from"./vendor-BVca5W6X.js";import{C as fe}from"./confirm-dialog-BcWcSFSI.js";import{T as De}from"./template-saved-dialog-Dhidh0Lo.js";import{u as We}from"./usePageState-6XNG0ilq.js";import{u as Ce}from"./use-profile-settings-_EsJTNvx.js";import{R as Te,L as _e,C as Se,X as Ee,Y as Ae,a as Ie}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function Oe(){const t=ne,{error:i}=await t.rpc("delete_user_account");if(i)throw i}const ue="body-weights-data",Le=600*1e3;function Me({userId:t}){const i=ne,r=s.useRef(!1),[o,n]=s.useState(!1),[u,w]=We({key:t?`${ue}-${t}`:ue,initialState:[],ttl:Le}),[c,N]=s.useState(u),[v,m]=s.useState(!1),[b,C]=s.useState(""),[z,d]=s.useState(()=>{const k=new Date,T=String(k.getDate()).padStart(2,"0"),O=String(k.getMonth()+1).padStart(2,"0"),$=k.getFullYear();return`${T}.${O}.${$}`}),[I,j]=s.useState(!1),[E,g]=s.useState(null),[J,S]=s.useState(!1),[Q,M]=s.useState(null);s.useEffect(()=>{u.length>0&&c.length===0&&(N(u),r.current=!0)},[]);const K=s.useCallback(async(k=!1)=>{if(t){if(!k&&r.current&&u.length>0){N(u);return}if(!k&&u.length>0){N(u),r.current=!0;return}m(!0);try{const{data:T,error:O}=await i.from("user_body_weights").select("*").eq("user_id",t).order("recorded_at",{ascending:!1}).limit(100);if(O)throw O;const $=T||[];N($),w($),r.current=!0}catch(T){console.error("Error loading body weights:",T)}finally{m(!1)}}},[t,i,u,w]),B=s.useCallback(k=>{const T=k.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!T)return null;const[,O,$,p]=T,W=parseInt(O,10),l=parseInt($,10),h=parseInt(p,10);if(l<1||l>12||W<1||W>31||h<1900||h>2100)return null;const q=new Date(h,l,0).getDate();if(W>q)return null;const Z=new Date(h,l-1,W),x=new Date;if(x.setHours(23,59,59,999),Z>x)return null;const a=String(W).padStart(2,"0"),L=String(l).padStart(2,"0");return`${h}-${L}-${a}`},[]),A=s.useCallback(()=>{const k=new Date,T=String(k.getDate()).padStart(2,"0"),O=String(k.getMonth()+1).padStart(2,"0"),$=k.getFullYear();return`${T}.${O}.${$}`},[]),y=s.useCallback(async()=>{if(!t||!b||I)return;const k=parseFloat(b.replace(",","."));if(isNaN(k)||k<=0||k>500){alert(f().hooks.enterValidWeight);return}const T=B(z);if(!T){alert(f().hooks.enterValidDate);return}j(!0);try{const{data:O,error:$}=await i.from("user_body_weights").upsert({user_id:t,weight:k,recorded_at:T},{onConflict:"user_id,recorded_at"}).select().single();if($)throw $;const p=(()=>{const W=c.filter(l=>l.recorded_at!==T);return[O,...W].sort((l,h)=>new Date(h.recorded_at).getTime()-new Date(l.recorded_at).getTime())})();N(p),w(p),C(""),d(A())}catch(O){console.error("Error saving weight:",O),alert(f().hooks.failedToSaveWeight)}finally{j(!1)}},[t,b,z,I,i,B,A,c,w]),U=s.useCallback(async k=>{if(!(!t||E)){g(k);try{const{error:T}=await i.from("user_body_weights").delete().eq("id",k);if(T)throw T;const O=c.filter($=>$.id!==k);N(O),w(O),S(!1),M(null)}catch(T){console.error("Error deleting weight:",T),alert(f().hooks.failedToDeleteWeight)}finally{g(null)}}},[t,E,i,c,w]),F=s.useCallback(k=>{M(k),S(!0)},[]),Y=s.useMemo(()=>[...c].sort((k,T)=>new Date(k.recorded_at).getTime()-new Date(T.recorded_at).getTime()).slice(-30).map(k=>({date:new Date(k.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short"}),weight:Number(k.weight),fullDate:k.recorded_at})),[c]),X=s.useMemo(()=>{if(c.length===0)return null;const k=c.map(W=>Number(W.weight)),T=k[0],O=Math.min(...k),$=Math.max(...k),p=c.length>1?T-k[k.length-1]:0;return{current:T,min:O,max:$,change:p}},[c]);return{isWeightTrackerOpen:o,bodyWeights:c,loadingWeights:v,newWeight:b,newWeightDate:z,savingWeight:I,deletingWeightId:E,isDeleteWeightConfirmOpen:J,weightToDelete:Q,weightChartData:Y,weightStats:X,setIsWeightTrackerOpen:n,setNewWeight:C,setNewWeightDate:d,setIsDeleteWeightConfirmOpen:S,loadBodyWeights:K,handleAddWeight:y,handleDeleteWeight:U,handleOpenDeleteWeightConfirm:F}}const Fe=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function me(t){if(typeof t!="string")return null;const i=t.trim();return Fe.includes(i)?i:null}function xe(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"){const i=t.trim();if(i.length===0)return null;const r=Number(i.replace(",","."));return Number.isFinite(r)?r:null}return null}function te(t){const i=xe(t);if(i===null)return null;const r=Math.trunc(i);return r!==i?null:r}function pe(t){if(typeof t!="string")return null;const i=t.trim();return i.length>0?i:null}function $e({userId:t,userEmail:i}){const r=ne,[o,n]=s.useState(!1),[u,w]=s.useState(!1),[c,N]=s.useState(!1),[v,m]=s.useState(null),[b,C]=s.useState(null),[z,d]=s.useState([]),[I,j]=s.useState([]),[E,g]=s.useState("none"),[J,S]=s.useState(!1),[Q,M]=s.useState(null),[K,B]=s.useState("success"),A=s.useRef(null),y=s.useCallback(async p=>{if(!t)return;const W=Array.isArray(p.workouts)?p.workouts:[];if(W.length===0){B("error"),M(f().hooks.noWorkoutsToImport),S(!0);return}const{data:l,error:h}=await r.from("workouts").select("id, workout_date").eq("user_id",t);if(h)throw h;const q=new Set;W.forEach(a=>{const L=typeof a.date=="string"&&a.date?a.date:typeof a.workout_date=="string"&&a.workout_date?a.workout_date:"";L&&q.add(L)});const x=(l||[]).filter(a=>q.has(a.workout_date)).map(a=>a.id);if(x.length>0){const{data:a,error:L}=await r.from("workout_exercises").select("id, workout_id").in("workout_id",x);if(L)throw L;const H=(a||[]).map(_=>_.id);if(H.length>0){const{error:_}=await r.from("workout_sets").delete().in("workout_exercise_id",H);if(_)throw _}if(x.length>0){const{error:_}=await r.from("workout_exercises").delete().in("workout_id",x);if(_)throw _;const{error:P}=await r.from("workouts").delete().in("id",x);if(P)throw P}}for(const a of W){const L=typeof a.name=="string"&&a.name.trim().length>0?a.name.trim():f().hooks.importedWorkout,H=typeof a.date=="string"&&a.date?a.date:typeof a.workout_date=="string"&&a.workout_date?a.workout_date:new Date().toISOString().slice(0,10),_=typeof a.isCardio=="boolean"?a.isCardio:typeof a.is_cardio=="boolean"?a.is_cardio:!1,P=pe(a.notes)??pe(a.workoutNotes)??null,{data:V,error:le}=await r.from("workouts").insert({user_id:t,name:L,icon:me(a.icon),workout_date:H,is_cardio:_,template_id:null,notes:P}).select().single();if(le||!V)throw le||new Error(f().hooks.failedToCreateWorkout);const R=Array.isArray(a.exercises)?a.exercises:[];if(R.length===0)continue;const ee=R.map((D,se)=>({workout_id:V.id,name:typeof D.name=="string"?D.name:"",position:te(D.position)??se+1,reps:typeof D.reps=="string"?D.reps:typeof D.reps=="number"?String(D.reps):"",rest_seconds:typeof D.restSeconds=="number"?D.restSeconds:typeof D.restSeconds=="string"?te(D.restSeconds)??150:typeof D.rest_seconds=="number"?D.rest_seconds:typeof D.rest_seconds=="string"?te(D.rest_seconds)??150:150,sets:typeof D.setsPlanned=="number"?D.setsPlanned:typeof D.setsPlanned=="string"?te(D.setsPlanned)??1:typeof D.sets=="number"?D.sets:typeof D.sets=="string"?te(D.sets)??1:Array.isArray(D.sets)?D.sets.length:Array.isArray(D.workout_sets)?D.workout_sets.length:Array.isArray(D.workoutSets)?D.workoutSets.length:1})),{data:ae,error:de}=await r.from("workout_exercises").insert(ee).select();if(de||!ae)throw de||new Error(f().hooks.failedToCreateExercises);const ce=[],we=[...R].sort((D,se)=>{const oe=typeof D.position=="number"?D.position:0,ie=typeof se.position=="number"?se.position:0;return oe-ie}),be=[...ae].sort((D,se)=>{const oe=typeof D.position=="number"?D.position:0,ie=typeof se.position=="number"?se.position:0;return oe-ie});if(we.forEach((D,se)=>{const oe=be[se];if(!oe)return;(Array.isArray(D.sets)?D.sets:Array.isArray(D.workout_sets)?D.workout_sets:Array.isArray(D.workoutSets)?D.workoutSets:[]).forEach(G=>{const ke=te(G.index)??te(G.set_index)??te(G.setIndex)??1,ye=typeof G.isDropset=="boolean"?G.isDropset:typeof G.is_dropset=="boolean"?G.is_dropset:!1,je=te(G.parentSetIndex)??te(G.parent_set_index)??null;ce.push({workout_exercise_id:oe.id,set_index:ke,weight:xe(G.weight),reps:G.reps==null?null:String(G.reps),is_done:typeof G.isDone=="boolean"?G.isDone:typeof G.is_done=="boolean"?G.is_done:!1,is_dropset:ye,parent_set_index:je,updated_at:typeof G.updatedAt=="string"&&G.updatedAt?G.updatedAt:typeof G.updated_at=="string"&&G.updated_at?G.updated_at:new Date().toISOString()})})}),ce.length>0){const{error:D}=await r.from("workout_sets").insert(ce);if(D)throw D}}},[t,r]),U=s.useCallback(async()=>{if(t){n(!0);try{const{data:p,error:W}=await r.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          notes,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              is_dropset,
              parent_set_index,
              updated_at
            )
          )
        `).eq("user_id",t).order("workout_date",{ascending:!1});if(W){console.error("Error exporting workouts:",W),alert(f().hooks.failedToLoadWorkouts);return}const l=(p||[]).map(H=>({id:H.id,name:H.name,icon:me(H.icon),date:H.workout_date,isCardio:!!H.is_cardio,templateId:H.template_id,notes:H.notes??null,exercises:(H.workout_exercises||[]).map(_=>({id:_.id,name:_.name,position:_.position,reps:_.reps,restSeconds:_.rest_seconds,setsPlanned:_.sets,sets:(_.workout_sets||[]).map(P=>({id:P.id,index:P.set_index,weight:P.weight,reps:P.reps,isDone:P.is_done,isDropset:!!P.is_dropset,parentSetIndex:P.parent_set_index??null,updatedAt:P.updated_at}))}))})),h={schemaVersion:2,exportedAt:new Date().toISOString(),user:{id:t,email:i},workouts:l},q=JSON.stringify(h,null,2),Z=new Blob([q],{type:"application/json;charset=utf-8;"}),x=URL.createObjectURL(Z),a=document.createElement("a"),L=new Date().toISOString().slice(0,10);a.href=x,a.download=`gymlog-workouts-${L}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(x)}catch(p){console.error("Unexpected error while exporting workouts:",p),alert(f().hooks.unexpectedExportError)}finally{n(!1)}}},[t,i,r]),F=s.useCallback(()=>{!t||u||A.current&&(A.current.value="",A.current.click())},[t,u]),Y=s.useCallback(async p=>{const W=p.target.files&&p.target.files[0];if(W)try{d([]),j([]);const l=await W.text();let h;try{h=JSON.parse(l)}catch{B("error"),M(f().hooks.invalidJsonFile),S(!0);return}if(!h||!Array.isArray(h.workouts)){B("error"),M(f().hooks.notGymLogExport),S(!0);return}if(!t)return;const q=Array.isArray(h.workouts)?h.workouts:[],Z=new Set;q.forEach(R=>{const ee=typeof R.date=="string"&&R.date?R.date:typeof R.workout_date=="string"&&R.workout_date?R.workout_date:"";ee&&Z.add(ee)});const{data:x,error:a}=await r.from("workouts").select("workout_date").eq("user_id",t);if(a){console.error("Error checking existing workouts before import:",a),B("error"),M(f().hooks.failedToCheckExisting),S(!0);return}const L=new Set((x||[]).map(R=>R.workout_date)),H=L.size>0,_=new Map;q.forEach(R=>{const ee=typeof R.date=="string"&&R.date?R.date:typeof R.workout_date=="string"&&R.workout_date?R.workout_date:"";ee&&_.set(ee,(_.get(ee)||0)+1)});const P=[],V=[];Z.forEach(R=>{L.has(R)?P.push(R):V.push(R)});const le=P.length>0;if(!H||!le){B("success"),w(!0);try{await y(h),M(f().hooks.importComplete),S(!0)}catch(R){console.error("Error importing workouts:",R),alert(f().hooks.failedToImport+((R==null?void 0:R.message)||String(R)))}finally{w(!1)}return}if(V.length===0){B("error"),M(f().hooks.allWorkoutsExist),S(!0);return}if(m(h),C(W.name),V.length>0){const R=V.map(ee=>({date:ee,count:_.get(ee)||0})).sort((ee,ae)=>ae.date.localeCompare(ee.date));d(V),j(R)}else d([]),j([]);N(!0)}catch(l){console.error("Error reading workouts import file:",l),alert(f().hooks.failedToReadFile)}finally{p.target.value=""}},[t,r,y]),X=s.useCallback(async()=>{if(v){g("import"),w(!0);try{await y(v),m(null),C(null),d([]),j([]),N(!1),B("success"),M(f().hooks.importComplete),S(!0)}catch(p){console.error("Error importing workouts:",p),alert(f().hooks.failedToImport+((p==null?void 0:p.message)||String(p)))}finally{w(!1),g("none")}}},[v,y]),k=s.useCallback(async()=>{if(!v)return;const p=Array.isArray(v.workouts)?v.workouts:[];if(p.length===0){B("error"),M(f().hooks.noWorkoutsToImport),S(!0);return}const W=new Set(z);if(W.size===0){B("error"),M(f().hooks.noNewWorkoutsInFile),S(!0);return}const l=p.filter(h=>{const q=typeof h.date=="string"&&h.date?h.date:typeof h.workout_date=="string"&&h.workout_date?h.workout_date:"";return!!q&&W.has(q)});if(l.length===0){B("error"),M(f().hooks.failedToDetermineNew),S(!0);return}g("onlyNew"),w(!0);try{await y({workouts:l}),m(null),C(null),d([]),j([]),N(!1),B("success"),M(f().hooks.newWorkoutsImportComplete),S(!0)}catch(h){console.error("Error importing only new workouts:",h),B("error"),M(f().hooks.failedToImportNew),S(!0)}finally{w(!1),g("none")}},[v,z,y]),T=s.useCallback(async()=>{if(v){g("exportThenImport"),w(!0);try{await U(),await y(v),m(null),C(null),N(!1),B("success"),M(f().hooks.exportThenImportComplete),S(!0)}catch(p){console.error("Error exporting and importing workouts:",p),B("error"),M(f().hooks.failedExportThenImport),S(!0)}finally{w(!1),g("none")}}},[v,U,y]),O=s.useCallback(()=>{N(!1),m(null),C(null),d([]),j([])},[]),$=s.useCallback(()=>{S(!1),M(null)},[]);return{isExporting:o,isImportingWorkouts:u,isWorkoutsImportDialogOpen:c,pendingWorkoutsImport:v,pendingWorkoutsFileName:b,pendingWorkoutsNewDates:z,pendingWorkoutsNewDatesSummary:I,importAction:E,isImportSuccessOpen:J,importSuccessMessage:Q,toastVariant:K,workoutsFileInputRef:A,handleExportWorkouts:U,handleStartImportWorkouts:F,handleWorkoutsFileChange:Y,handleConfirmImportWorkoutsOnly:X,handleImportOnlyNewWorkouts:k,handleExportThenImportWorkouts:T,closeWorkoutsImportDialog:O,closeImportSuccessToast:$,setIsImportSuccessOpen:S,setImportSuccessMessage:M,setToastVariant:B}}const Pe=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function he(t){if(typeof t!="string")return null;const i=t.trim();return Pe.includes(i)?i:null}function Re({userId:t,userEmail:i,setToastVariant:r,setImportSuccessMessage:o,setIsImportSuccessOpen:n}){const u=ne,[w,c]=s.useState(!1),[N,v]=s.useState(!1),[m,b]=s.useState(!1),[C,z]=s.useState([]),[d,I]=s.useState([]),[j,E]=s.useState("none"),g=s.useRef(null),J=s.useCallback(async y=>{if(!t)return;const U=Array.isArray(y.templates)?y.templates:[];if(U.length===0){r("error"),o(f().hooks.noTemplatesToImport),n(!0);return}for(const F of U){const Y=typeof F.name=="string"&&F.name.trim().length>0?F.name.trim():f().hooks.importedTemplate,{data:X,error:k}=await u.from("workout_templates").insert({user_id:t,name:Y,icon:he(F.icon)}).select().single();if(k||!X)throw k||new Error(f().hooks.failedToCreateTemplate);const T=Array.isArray(F.exercises)?F.exercises:[];if(T.length===0)continue;const O=T.map((p,W)=>({template_id:X.id,name:typeof p.name=="string"?p.name:"",sets:typeof p.sets=="number"?p.sets:1,reps:typeof p.reps=="string"?p.reps:"",rest_seconds:typeof p.restSeconds=="number"?p.restSeconds:typeof p.rest_seconds=="number"?p.rest_seconds:150,position:typeof p.position=="number"?p.position:W+1})),{error:$}=await u.from("template_exercises").insert(O);if($)throw $}},[t,u,r,o,n]),S=s.useCallback(async()=>{if(t){c(!0);try{const{data:y,error:U}=await u.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",t).order("created_at",{ascending:!1});if(U){console.error("Error exporting templates:",U),alert(f().hooks.failedToLoadTemplates);return}const F=(y||[]).map(p=>({id:p.id,name:p.name,icon:he(p.icon),createdAt:p.created_at,exercises:(p.template_exercises||[]).map(W=>({id:W.id,name:W.name,sets:W.sets,reps:W.reps,restSeconds:W.rest_seconds,position:W.position}))})),Y={exportedAt:new Date().toISOString(),user:{id:t,email:i},templates:F},X=JSON.stringify(Y,null,2),k=new Blob([X],{type:"application/json;charset=utf-8;"}),T=URL.createObjectURL(k),O=document.createElement("a"),$=new Date().toISOString().slice(0,10);O.href=T,O.download=`gymlog-templates-${$}.json`,document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(T)}catch(y){console.error("Unexpected error while exporting templates:",y),alert(f().hooks.unexpectedTemplatesExportError)}finally{c(!1)}}},[t,i,u]),Q=s.useCallback(()=>{!t||N||g.current&&(g.current.value="",g.current.click())},[t,N]),M=s.useCallback(async y=>{const U=y.target.files&&y.target.files[0];if(U)try{const F=await U.text();let Y;try{Y=JSON.parse(F)}catch{r("error"),o(f().hooks.invalidJsonFile),n(!0);return}if(!Y||!Array.isArray(Y.templates)){r("error"),o(f().hooks.notGymLogTemplatesExport),n(!0);return}if(!t)return;const X=Array.isArray(Y.templates)?Y.templates:[];if(X.length===0){r("error"),o(f().hooks.noTemplatesToImport),n(!0);return}const{data:k,error:T}=await u.from("workout_templates").select("id, name").eq("user_id",t);if(T){console.error("Error checking existing templates before import:",T),r("error"),o(f().hooks.failedToCheckExistingTemplates),n(!0);return}const O=l=>typeof l=="string"?l.trim().toLowerCase():"",$=new Map;(k||[]).forEach(l=>{const h=O(l.name);h&&($.has(h)||$.set(h,{id:l.id,name:l.name||""}))});const p=[],W=[];if(X.forEach(l=>{const h=O(l==null?void 0:l.name);if(!h||!$.has(h))p.push(l);else{const q=$.get(h);W.push({existingId:q.id,existingName:q.name||"",template:l})}}),p.length===0&&W.length>0){r("error"),o(f().hooks.allTemplatesExist),n(!0);return}if(W.length===0){v(!0);try{await J({templates:X}),r("success"),o(f().hooks.templatesImportComplete),n(!0)}catch(l){console.error("Error importing templates:",l),r("error"),o(f().hooks.failedToImportTemplates),n(!0)}finally{v(!1)}return}z(p),I(W),b(!0)}catch(F){console.error("Error importing templates:",F),r("error"),o(f().hooks.failedToImportTemplates),n(!0)}finally{v(!1),y.target.value=""}},[t,u,J,r,o,n]),K=s.useCallback(async()=>{if(C.length===0){b(!1),I([]),z([]),r("error"),o(f().hooks.allTemplatesExist),n(!0);return}E("onlyNew"),v(!0);try{await J({templates:C}),z([]),I([]),b(!1),r("success"),o(f().hooks.newTemplatesImportComplete),n(!0)}catch(y){console.error("Error importing only new templates:",y),r("error"),o(f().hooks.failedToImportNewTemplates),n(!0)}finally{v(!1),E("none")}},[C,J,r,o,n]),B=s.useCallback(async()=>{if(d.length===0&&C.length===0){b(!1);return}E("overwrite"),v(!0);try{const y=Array.from(new Set(d.map(F=>F.existingId)));if(y.length>0){const{error:F}=await u.from("template_exercises").delete().in("template_id",y);if(F)throw F;const{error:Y}=await u.from("workout_templates").delete().in("id",y);if(Y)throw Y}const U=[...C,...d.map(F=>F.template)];await J({templates:U}),z([]),I([]),b(!1),r("success"),o(f().hooks.templatesOverwriteComplete),n(!0)}catch(y){console.error("Error overwriting templates:",y),alert(f().hooks.failedToOverwriteTemplates+((y==null?void 0:y.message)||String(y)))}finally{v(!1),E("none")}},[d,C,u,J,r,o,n]),A=s.useCallback(()=>{b(!1),z([]),I([])},[]);return{isExportingTemplates:w,handleExportTemplates:S,isImportingTemplates:N,isTemplatesImportDialogOpen:m,pendingTemplatesNew:C,pendingTemplatesDuplicates:d,templatesImportAction:j,templatesFileInputRef:g,handleStartImportTemplates:Q,handleTemplatesFileChange:M,handleImportTemplatesOnlyNew:K,handleImportTemplatesOverwrite:B,closeTemplatesImportDialog:A}}function Be({userId:t,setToastVariant:i,setImportSuccessMessage:r,setIsImportSuccessOpen:o}){const n=ne,[u,w]=s.useState(!1),[c,N]=s.useState(!1),[v,m]=s.useState(!1),[b,C]=s.useState([]),[z,d]=s.useState([]),[I,j]=s.useState(!1),[E,g]=s.useState(!1),[J,S]=s.useState(!1),[Q,M]=s.useState([]),[K,B]=s.useState([]),[A,y]=s.useState(!1),U=b.length>0&&z.length===b.length,F=Q.length>0&&K.length===Q.length,Y=s.useCallback(async()=>{if(!(!t||v)){m(!0),d([]);try{const{data:x,error:a}=await n.from("workouts").select("id, workout_date").eq("user_id",t).order("workout_date",{ascending:!1});if(a){console.error("Error loading workouts for deletion:",a),alert(f().hooks.failedToLoadWorkoutsForDeletion);return}const L=new Map;(x||[]).forEach(_=>{const P=_.workout_date,V=_.id;!P||!V||(L.has(P)||L.set(P,[]),L.get(P).push(V))});const H=Array.from(L.entries()).map(([_,P])=>({date:_,workoutIds:P,count:P.length})).sort((_,P)=>P.date.localeCompare(_.date));if(H.length===0){i("error"),r(f().hooks.noWorkoutsToDelete),o(!0);return}C(H),w(!1),N(!0)}catch(x){console.error("Unexpected error while loading workouts for deletion:",x),alert(f().hooks.errorLoadingWorkoutsForDeletion)}finally{m(!1)}}},[t,v,n,i,r,o]),X=s.useCallback(async()=>{if(!(!t||J)){S(!0),B([]);try{const{data:x,error:a}=await n.from("workout_templates").select("id, name").eq("user_id",t).order("created_at",{ascending:!1});if(a){console.error("Error loading templates for deletion:",a),alert(f().hooks.failedToLoadTemplatesForDeletion);return}const L=(x||[]).map(H=>({id:H.id,name:H.name||f().hooks.noName}));if(L.length===0){i("error"),r(f().hooks.noTemplatesToDelete),o(!0);return}M(L),w(!1),g(!0)}catch(x){console.error("Unexpected error while loading templates for deletion:",x),alert(f().hooks.errorLoadingTemplatesForDeletion)}finally{S(!1)}}},[t,J,n,i,r,o]),k=s.useCallback(x=>{d(a=>a.includes(x)?a.filter(L=>L!==x):[...a,x])},[]),T=s.useCallback(()=>{if(b.length===0)return;const x=z.length===b.length;d(x?[]:b.map(a=>a.date))},[b,z.length]),O=s.useCallback(()=>{d([])},[]),$=s.useCallback(x=>{B(a=>a.includes(x)?a.filter(L=>L!==x):[...a,x])},[]),p=s.useCallback(()=>{if(Q.length===0)return;const x=K.length===Q.length;B(x?[]:Q.map(a=>a.id))},[Q,K.length]),W=s.useCallback(()=>{B([])},[]),l=s.useCallback(async()=>{if(!t||z.length===0)return;const x=b.filter(a=>z.includes(a.date)).flatMap(a=>a.workoutIds);if(x.length!==0){j(!0);try{const{data:a,error:L}=await n.from("workout_exercises").select("id, workout_id").in("workout_id",x);if(L)throw L;const H=(a||[]).map(_=>_.id);if(H.length>0){const{error:_}=await n.from("workout_sets").delete().in("workout_exercise_id",H);if(_)throw _}if(x.length>0){const{error:_}=await n.from("workout_exercises").delete().in("workout_id",x);if(_)throw _;const{error:P}=await n.from("workouts").delete().in("id",x);if(P)throw P}N(!1),C([]),d([]),i("success"),r(f().hooks.workoutsDeletedSuccess),o(!0)}catch(a){console.error("Error deleting workouts:",a),i("error"),r(f().hooks.failedToDeleteWorkouts),o(!0)}finally{j(!1)}}},[t,z,b,n,i,r,o]),h=s.useCallback(async()=>{if(t&&K.length!==0){y(!0);try{const x=K;if(x.length>0){const{error:a}=await n.from("template_exercises").delete().in("template_id",x);if(a)throw a;const{error:L}=await n.from("workout_templates").delete().in("id",x);if(L)throw L}g(!1),M([]),B([]),i("success"),r(f().hooks.templatesDeletedSuccess),o(!0)}catch(x){console.error("Error deleting templates:",x),i("error"),r(f().hooks.failedToDeleteTemplates),o(!0)}finally{y(!1)}}},[t,K,n,i,r,o]),q=s.useCallback(()=>{I||N(!1)},[I]),Z=s.useCallback(()=>{A||g(!1)},[A]);return{isCleanDataDialogOpen:u,setIsCleanDataDialogOpen:w,isDeleteWorkoutsDialogOpen:c,isLoadingWorkoutsForDeletion:v,workoutDateGroups:b,selectedWorkoutDates:z,isDeletingWorkouts:I,areAllWorkoutDatesSelected:U,isDeleteTemplatesDialogOpen:E,isLoadingTemplatesForDeletion:J,templatesForDeletion:Q,selectedTemplateIds:K,isDeletingTemplates:A,areAllTemplatesSelected:F,openDeleteWorkoutsDialog:Y,toggleWorkoutDateSelection:k,selectAllWorkoutDates:T,clearWorkoutSelection:O,handleDeleteSelectedWorkouts:l,closeDeleteWorkoutsDialog:q,openDeleteTemplatesDialog:X,toggleTemplateSelection:$,selectAllTemplates:p,clearTemplateSelection:W,handleDeleteSelectedTemplates:h,closeDeleteTemplatesDialog:Z}}function ze(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,o,n]=i;if(r&&o&&n)return`${n}.${o}.${r}`}return t}function Ue(t,i){const r=t.replace(/[^0-9.]/g,""),o=r.split(".");let n=o[0]||"",u=o[1]||"",w=o[2]||"";n=n.slice(0,2),u=u.slice(0,2),w=w.slice(0,4);const c=r.length>i.replace(/[^0-9.]/g,"").length;return o.length===1&&n.length===2&&c?`${n}.`:o.length===2&&u.length===2&&c?`${n}.${u}.`:o.length===1?n:o.length===2?`${n}.${u}`:`${n}.${u}.${w}`}function He({isOpen:t,onClose:i,bodyWeights:r,loadingWeights:o,weightChartData:n,weightStats:u,newWeight:w,newWeightDate:c,savingWeight:N,deletingWeightId:v,isDeleteWeightConfirmOpen:m,weightToDelete:b,setNewWeight:C,setNewWeightDate:z,setIsDeleteWeightConfirmOpen:d,handleAddWeight:I,handleDeleteWeight:j,handleOpenDeleteWeightConfirm:E}){const{t:g,language:J}=re(),[S,Q]=s.useState(null),[M,K]=s.useState(0),[B,A]=s.useState(!1),y=7,U=s.useRef(null),F=144,Y=8,X=s.useCallback(l=>{try{const h=J==="ru"?"ru-RU":"en-US";return new Date(l).toLocaleDateString(h,{day:"numeric",month:"short"})}catch{return l}},[J]);s.useEffect(()=>(t?(document.body.style.overflow="hidden",document.body.style.touchAction="none"):(document.body.style.overflow="",document.body.style.touchAction=""),()=>{document.body.style.overflow="",document.body.style.touchAction=""}),[t]),s.useEffect(()=>{const l=()=>{try{A(document.documentElement.classList.contains("light-theme"))}catch{A(!1)}};l();try{const h=new MutationObserver(l);return h.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>h.disconnect()}catch{return}},[]),s.useEffect(()=>{K(0)},[r.length]);const k=s.useCallback((l,h)=>{var V;if((V=l==null?void 0:l.stopPropagation)==null||V.call(l),!h)return;const q=U.current,Z=l==null?void 0:l.currentTarget;if(!q||!Z||typeof Z.getBoundingClientRect!="function")return;const x=q.getBoundingClientRect(),a=Z.getBoundingClientRect(),L=a.left+a.width/2-x.left,H=a.top+a.height/2-x.top,_=F/2,P=Math.max(_+Y,Math.min(L,x.width-_-Y));Q({date:h.fullDate,weight:h.weight,x:P,y:H})},[Y,F]),T=s.useCallback(()=>{Q(null)},[]),O=s.useCallback(l=>{const{cx:h,cy:q,payload:Z,index:x}=l;return e.jsx("circle",{cx:h,cy:q,r:4,fill:"#3b82f6",stroke:"none",style:{cursor:"pointer"},onClick:a=>k(a,Z)},`dot-${x}`)},[k]),$=s.useCallback(l=>{const{cx:h,cy:q,payload:Z,index:x}=l;return e.jsx("circle",{cx:h,cy:q,r:6,fill:"#60a5fa",stroke:"#fff",strokeWidth:2,style:{cursor:"pointer"},onClick:a=>k(a,Z)},`active-dot-${x}`)},[k]),p=Math.ceil(r.length/y),W=r.slice(M*y,(M+1)*y);return t?ge.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center px-4",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 16px)",paddingBottom:"calc(96px + env(safe-area-inset-bottom))"},onTouchMove:l=>l.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:i,onTouchMove:l=>l.preventDefault()}),e.jsxs("div",{className:"relative glass card-dark p-5 rounded-2xl max-w-md w-full my-auto flex flex-col",style:{maxHeight:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom) - 120px)"},onClick:l=>l.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:i,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-white pr-10",children:g.bodyWeight.title}),e.jsxs("div",{className:"mt-4 space-y-4 overflow-y-auto custom-scrollbar pr-1 flex-1 min-h-0",children:[e.jsxs("div",{className:"space-y-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:g.bodyWeight.addWeight}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:g.bodyWeight.weight}),e.jsx("input",{type:"text",inputMode:"decimal",value:w,onChange:l=>{const h=l.target.value.replace(".",",");/^[0-9]*[,]?[0-9]*$/.test(h)&&C(h)},placeholder:g.bodyWeight.weightPlaceholder,className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:g.bodyWeight.date}),e.jsx("input",{type:"text",inputMode:"numeric",value:c,onChange:l=>{const h=Ue(l.target.value,c);z(h)},placeholder:g.bodyWeight.datePlaceholder,maxLength:10,className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:I,disabled:!w||!c||N,className:"btn-glass btn-glass-sm btn-glass-primary disabled:opacity-50",children:N?g.bodyWeight.saving:g.bodyWeight.addWeight})})]}),u&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:g.bodyWeight.stats.current}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[u.current.toFixed(2).replace(".",",")," ",g.common.kg]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:g.bodyWeight.stats.min}),e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[u.min.toFixed(2).replace(".",",")," ",g.common.kg]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:g.bodyWeight.stats.max}),e.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[u.max.toFixed(2).replace(".",",")," ",g.common.kg]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:g.bodyWeight.stats.change}),e.jsxs("p",{className:`text-lg font-bold ${u.change>0?"text-red-400":u.change<0?"text-green-400":"text-gray-400"}`,children:[u.change>0?"+":"",u.change.toFixed(2).replace(".",",")," ",g.common.kg]})]})]}),n.length>1&&e.jsxs("div",{className:"relative",onClick:T,ref:U,children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsx("div",{style:{minWidth:`${Math.max(n.length*50,100)}px`,height:"192px"},children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(_e,{data:n,margin:{top:15,right:20,left:-20,bottom:5},children:[e.jsx(Se,{strokeDasharray:"3 3",stroke:B?"rgba(0,0,0,0.22)":"rgba(255,255,255,0.1)"}),e.jsx(Ee,{dataKey:"fullDate",tickFormatter:l=>X(String(l)),tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1}),e.jsx(Ae,{domain:["dataMin - 2","dataMax + 2"],tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1,tickFormatter:l=>Number(l).toFixed(2).replace(".",",")}),e.jsx(Ie,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:O,activeDot:$,isAnimationActive:!1})]})})})}),S&&e.jsxs("div",{className:"absolute pointer-events-none w-36 text-center",style:{left:`${S.x}px`,top:`${S.y}px`,transform:"translate(-50%, calc(-100% - 12px))",background:"rgba(255,255,255,0.98)",border:"1px solid rgba(0,0,0,0.08)",borderRadius:"8px",padding:"8px 12px",color:"#111827",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",zIndex:20},children:[e.jsx("p",{className:"text-sm text-gray-600 truncate",children:X(S.date)}),e.jsxs("p",{className:"text-sm font-medium truncate",children:[e.jsxs("span",{className:"text-gray-500",children:[g.bodyWeight.tooltipWeight,": "]}),e.jsxs("span",{className:"text-green-600",children:[S.weight.toFixed(2).replace(".",",")," ",g.common.kg]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-300 font-medium",children:[g.bodyWeight.history," (",r.length,")"]}),p>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>K(l=>Math.max(0,l-1)),disabled:M===0,className:"w-7 h-7 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:hover:bg-white/10 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"text-xs text-gray-400 min-w-[40px] text-center",children:[M+1," / ",p]}),e.jsx("button",{type:"button",onClick:()=>K(l=>Math.min(p-1,l+1)),disabled:M>=p-1,className:"w-7 h-7 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:hover:bg-white/10 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):r.length===0?e.jsxs("p",{className:"text-sm text-gray-500 text-center py-4",children:[g.bodyWeight.noData,". ",g.bodyWeight.addFirstWeight,"."]}):e.jsx("div",{className:"space-y-1",children:W.map(l=>e.jsxs("div",{className:"grid grid-cols-[1fr_1fr_auto] items-center gap-3 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("span",{className:"text-white font-medium tabular-nums",children:[Number(l.weight).toFixed(2).replace(".",",")," ",g.common.kg]}),e.jsx("span",{className:"text-sm text-gray-400 tabular-nums text-right",children:ze(new Date(l.recorded_at).toISOString().slice(0,10))}),e.jsx("button",{type:"button",onClick:()=>E(l.id),disabled:v===l.id,className:"p-1 text-gray-500 hover:text-red-400 transition-colors disabled:opacity-50",children:v===l.id?e.jsx("span",{className:"w-4 h-4 border border-white/30 border-t-white rounded-full animate-spin inline-block"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},l.id))})]})]})]}),e.jsx(fe,{open:m,onOpenChange:d,title:g.bodyWeight.deleteConfirm,description:g.bodyWeight.deleteConfirmDesc,confirmText:g.common.delete,cancelText:g.common.cancel,variant:"danger",onConfirm:()=>{b&&j(b)}})]}),document.body):null}function Ye({isOpen:t,onClose:i,isLoadingWorkoutsForDeletion:r,isLoadingTemplatesForDeletion:o,openDeleteWorkoutsDialog:n,openDeleteTemplatesDialog:u}){const{t:w}=re();if(!t)return null;const c=r||o;return ge.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{c||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",onClick:N=>N.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:w.cleanData.title}),e.jsx("p",{className:"text-sm text-gray-300",children:w.cleanData.description}),c&&e.jsx("p",{className:"text-xs text-gray-400",children:w.cleanData.loading}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:n,disabled:c,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:w.cleanData.deleteWorkouts}),e.jsx("button",{type:"button",onClick:u,disabled:c,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:w.cleanData.deleteTemplates}),e.jsx("button",{type:"button",onClick:()=>{c||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:w.common.cancel})]})]})]}),document.body)}function qe({isOpen:t,onClose:i,workoutDateGroups:r,selectedWorkoutDates:o,isDeletingWorkouts:n,areAllWorkoutDatesSelected:u,toggleWorkoutDateSelection:w,selectAllWorkoutDates:c,clearWorkoutSelection:N,handleDeleteSelectedWorkouts:v}){const{t:m}=re();return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:m.deleteWorkouts.title}),e.jsx("p",{className:"text-sm text-gray-300",children:m.deleteWorkouts.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:c,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${u?"bg-green-500 border-green-400":"border-white/40"}`,children:u&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:m.deleteWorkouts.selectAll})]}),e.jsx("button",{type:"button",onClick:N,disabled:o.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:m.deleteWorkouts.clearSelection})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(b=>{const C=o.includes(b.date);return e.jsxs("button",{type:"button",onClick:()=>w(b.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${C?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:b.date}),e.jsx("div",{className:"text-xs text-gray-400",children:b.count===1?m.deleteWorkouts.workout:m.deleteWorkouts.workouts.replace("{count}",String(b.count))})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${C?"bg-green-500 border-green-400":"border-white/40"}`,children:C&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},b.date)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:m.deleteWorkouts.noWorkouts})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:v,disabled:o.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?m.deleteWorkouts.deleting:m.deleteWorkouts.deleteSelected}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:m.common.cancel})]})]})]}):null}function Ge({isOpen:t,onClose:i,templatesForDeletion:r,selectedTemplateIds:o,isDeletingTemplates:n,areAllTemplatesSelected:u,toggleTemplateSelection:w,selectAllTemplates:c,clearTemplateSelection:N,handleDeleteSelectedTemplates:v}){const{t:m}=re();return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:m.deleteTemplates.title}),e.jsx("p",{className:"text-sm text-gray-300",children:m.deleteTemplates.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:c,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${u?"bg-green-500 border-green-400":"border-white/40"}`,children:u&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:m.deleteWorkouts.selectAll})]}),e.jsx("button",{type:"button",onClick:N,disabled:o.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:m.deleteWorkouts.clearSelection})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(b=>{const C=o.includes(b.id);return e.jsxs("button",{type:"button",onClick:()=>w(b.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${C?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:b.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${C?"bg-green-500 border-green-400":"border-white/40"}`,children:C&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},b.id)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:m.deleteTemplates.noTemplates})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:v,disabled:o.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?m.deleteTemplates.deleting:m.deleteTemplates.deleteSelected}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:m.common.cancel})]})]})]}):null}function Je({isImportingWorkouts:t,isImportingTemplates:i,handleStartImportWorkouts:r,handleStartImportTemplates:o,isExporting:n,isExportingTemplates:u,handleExportWorkouts:w,handleExportTemplates:c,isDeleting:N,startCleanDataFlow:v,startDeleteAccountFlow:m}){const[b,C]=s.useState(!1),z=s.useRef(null),{t:d}=re();return s.useEffect(()=>{const I=j=>{z.current&&!z.current.contains(j.target)&&C(!1)};if(b)return document.addEventListener("click",I),()=>document.removeEventListener("click",I)},[b]),e.jsxs("div",{className:"relative",ref:z,children:[e.jsx("button",{onClick:()=>C(!b),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":d.profile.menu,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),b&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:d.profile.import}),e.jsx("button",{onClick:()=>{C(!1),r()},disabled:t,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:t?d.profile.importingWorkouts:d.profile.workouts}),e.jsx("button",{onClick:()=>{C(!1),o()},disabled:i,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:i?d.profile.importingTemplates:d.nav.templates}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:d.profile.export}),e.jsx("button",{onClick:async()=>{C(!1),await w()},disabled:n,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:n?d.profile.exportingWorkouts:d.profile.workouts}),e.jsx("button",{onClick:async()=>{C(!1),await c()},disabled:u,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:u?d.profile.exportingTemplates:d.nav.templates}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:d.profile.dataAndAccount}),e.jsx("button",{onClick:()=>{C(!1),v()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:d.profile.cleanData}),e.jsx("button",{onClick:()=>{C(!1),m()},disabled:N,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:N?d.profile.deletingAccount:d.profile.deleteAccount})]})]})}function Ke({isOpen:t,timerStepInput:i,setTimerStepInput:r,saveStatus:o,saveTimerStep:n,theme:u,handleThemeChange:w}){const{t:c,language:N,setLanguage:v}=re();return t?e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:c.settings.title}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:c.settings.timerStep}),e.jsx("p",{className:"text-xs text-gray-500",children:c.settings.timerStepDesc}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:i,onChange:m=>r(m.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:n,disabled:o==="saving",className:"btn-glass btn-glass-primary flex items-center justify-center gap-2 !py-2 !px-4 min-w-[104px]",children:[o==="saving"&&e.jsx("span",{"aria-label":c.settings.saving,className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),o==="success"&&e.jsx("svg",{"aria-label":c.settings.saved,xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),o==="idle"&&c.common.save]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:c.settings.language}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>v("ru"),className:`btn-glass ${N==="ru"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsx("span",{className:"flex items-center justify-center gap-2",children:c.settings.languageRu})}),e.jsx("button",{type:"button",onClick:()=>v("en"),className:`btn-glass ${N==="en"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsx("span",{className:"flex items-center justify-center gap-2",children:c.settings.languageEn})})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:c.settings.theme}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>w("dark"),className:`btn-glass ${u==="dark"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),c.settings.themeDark]})}),e.jsx("button",{type:"button",onClick:()=>w("light"),className:`btn-glass ${u==="light"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),c.settings.themeLight]})}),e.jsx("button",{type:"button",onClick:()=>w("auto"),className:`btn-glass ${u==="auto"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),c.settings.themeAuto]})})]})]})]}):null}function Xe({isOpen:t,pendingTemplatesDuplicates:i,isImportingTemplates:r,templatesImportAction:o,onClose:n,handleImportTemplatesOnlyNew:u,handleImportTemplatesOverwrite:w}){const{t:c}=re();return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||n()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:c.templatesImport.title}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:c.templatesImport.duplicatesFound}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:c.templatesImport.importOnlyNewHint}),e.jsx("li",{children:c.templatesImport.overwriteHint})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[i.map((N,v)=>{var m;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((m=N.template)==null?void 0:m.name)||c.templatesImport.noName}),e.jsx("div",{className:"text-xs text-gray-400",children:c.templatesImport.existsAs.replace("{name}",N.existingName||c.templatesImport.noName)})]},N.existingId+"-"+v)}),i.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:c.templatesImport.noDuplicates})]}),r?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:o==="overwrite"?c.templatesImport.overwriting:c.templatesImport.importingOnlyNew})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:u,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:c.templatesImport.importOnlyNew}),e.jsx("button",{type:"button",onClick:w,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:c.templatesImport.overwriteAndAdd}),e.jsx("button",{type:"button",onClick:n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:c.common.cancel})]})]})]}):null}function Qe(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,o,n]=i;if(r&&o&&n)return`${n}.${o}.${r}`}return t}function Ze({isOpen:t,pendingWorkoutsImport:i,pendingWorkoutsFileName:r,pendingWorkoutsNewDatesSummary:o,isImportingWorkouts:n,importAction:u,onClose:w,handleConfirmImportWorkoutsOnly:c,handleImportOnlyNewWorkouts:N,handleExportThenImportWorkouts:v}){const{t:m}=re();return!t||!i?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||w()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:m.workoutsImport.title}),e.jsx("p",{className:"text-sm text-gray-300",children:m.workoutsImport.description.replace("{fileName}",r||"file")}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:m.workoutsImport.warning}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:m.workoutsImport.importOnlyNewHint}),e.jsx("li",{children:m.workoutsImport.importOverwriteHint}),e.jsx("li",{children:m.workoutsImport.exportThenImportHint})]})]}),o.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:m.workoutsImport.newWorkoutsTitle}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:o.map(b=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:Qe(b.date)})},b.date))})]}),n?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:u==="exportThenImport"?m.workoutsImport.exportingAndImporting:u==="onlyNew"?m.workoutsImport.importingOnlyNew:m.workoutsImport.importingWorkouts})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[o.length>0&&e.jsx("button",{type:"button",onClick:N,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:m.workoutsImport.importOnlyNew}),e.jsx("button",{type:"button",onClick:c,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:m.workoutsImport.importOverwrite}),e.jsx("button",{type:"button",onClick:v,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:m.workoutsImport.exportThenImport}),e.jsx("button",{type:"button",onClick:w,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:m.common.cancel})]})]})]})}const it=()=>{const{user:t,signOut:i}=Ne(),r=ve(),{t:o}=re(),[n,u]=s.useState(!1),[w,c]=s.useState(!1),[N,v]=s.useState(""),[m,b]=s.useState(null),[C,z]=s.useState(!1),d=$e({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email}),I=Re({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email,setToastVariant:d.setToastVariant,setImportSuccessMessage:d.setImportSuccessMessage,setIsImportSuccessOpen:d.setIsImportSuccessOpen}),j=Be({userId:t==null?void 0:t.id,setToastVariant:d.setToastVariant,setImportSuccessMessage:d.setImportSuccessMessage,setIsImportSuccessOpen:d.setIsImportSuccessOpen}),E=Me({userId:t==null?void 0:t.id}),g=Ce();s.useEffect(()=>{E.isWeightTrackerOpen&&t&&E.loadBodyWeights()},[E.isWeightTrackerOpen,t]);const J=s.useMemo(()=>{var U;if(!t)return"";const A=(U=t.user_metadata)==null?void 0:U.nickname;if(typeof A=="string"&&A.trim().length>0)return A.trim();const y=t.email||"";return y.endsWith("@gymlog.app")?y.replace(/@gymlog\.app$/,""):y},[t]),S=s.useMemo(()=>{const A=(t==null?void 0:t.email)||"";if(!A||typeof A!="string")return null;const[y,U]=A.split("@");if(!y||!U)return null;const F=Math.max(1,Math.ceil(y.length/2)),Y=y.slice(0,F),X=y.slice(F);return{email:A,localPart:y,domain:U,visiblePart:Y,hiddenPart:X}},[t==null?void 0:t.email]),Q=async()=>{try{await i(),r("/login",{replace:!0})}catch(A){console.error("Error logging out:",A)}},M=()=>{!t||!t.email||(v(""),b(null),c(!0))},K=()=>{t&&j.setIsCleanDataDialogOpen(!0)},B=async()=>{if(!(!t||!t.email)){if(N.trim()!==t.email)throw b(o.profile.emailMismatch),new Error("EMAIL_MISMATCH");b(null),u(!0);try{await Oe(),alert(o.profile.accountDeleted),await i(),r("/login",{replace:!0})}catch(A){console.error("Error deleting account:",A),alert(`${o.profile.deleteAccountError}${A.message}`)}finally{u(!1)}}};return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative profile-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:o.profile.title}),e.jsx(Je,{isImportingWorkouts:d.isImportingWorkouts,isImportingTemplates:I.isImportingTemplates,handleStartImportWorkouts:d.handleStartImportWorkouts,handleStartImportTemplates:I.handleStartImportTemplates,isExporting:d.isExporting,isExportingTemplates:I.isExportingTemplates,handleExportWorkouts:d.handleExportWorkouts,handleExportTemplates:I.handleExportTemplates,isDeleting:n,startCleanDataFlow:K,startDeleteAccountFlow:M})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:t&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:o.profile.loggedInAs}),S?e.jsxs("span",{className:"font-semibold",children:[S.visiblePart,S.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>z(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:C?e.jsx("span",{children:S.hiddenPart}):e.jsx("span",{children:"".repeat(Math.max(3,S.hiddenPart.length))})}),"@",S.domain]}):e.jsx("span",{className:"font-semibold",children:J})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>r("/profile/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),o.profile.viewProgress]}),e.jsxs("button",{onClick:()=>E.setIsWeightTrackerOpen(!0),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})}),o.profile.bodyWeightTracker]}),e.jsxs("button",{onClick:()=>g.setIsSettingsOpen(!g.isSettingsOpen),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),o.profile.settings,e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${g.isSettingsOpen?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("button",{onClick:Q,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:o.profile.logout})]}),e.jsx(Ke,{isOpen:g.isSettingsOpen,timerStepInput:g.timerStepInput,setTimerStepInput:g.setTimerStepInput,saveStatus:g.saveStatus,saveTimerStep:g.saveTimerStep,theme:g.theme,handleThemeChange:g.handleThemeChange}),e.jsx("input",{ref:d.workoutsFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:d.handleWorkoutsFileChange}),e.jsx("input",{ref:I.templatesFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:I.handleTemplatesFileChange}),e.jsx(fe,{open:w,onOpenChange:A=>{c(A),A||(v(""),b(null))},title:o.profile.deleteAccountConfirm,description:o.profile.deleteAccountDesc,confirmText:o.profile.deleteAccountBtn,cancelText:o.common.cancel,variant:"danger",confirmDisabled:N.trim().length===0,onConfirm:B,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:[o.profile.emailConfirmation,e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.email})]}),e.jsx("input",{type:"email",value:N,onChange:A=>{v(A.target.value),m&&b(null)},placeholder:(t==null?void 0:t.email)||o.profile.emailPlaceholder,className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),m&&e.jsx("p",{className:"text-xs text-red-400",children:m})]})}),e.jsx(Ye,{isOpen:j.isCleanDataDialogOpen,onClose:()=>j.setIsCleanDataDialogOpen(!1),isLoadingWorkoutsForDeletion:j.isLoadingWorkoutsForDeletion,isLoadingTemplatesForDeletion:j.isLoadingTemplatesForDeletion,openDeleteWorkoutsDialog:j.openDeleteWorkoutsDialog,openDeleteTemplatesDialog:j.openDeleteTemplatesDialog}),e.jsx(qe,{isOpen:j.isDeleteWorkoutsDialogOpen,onClose:j.closeDeleteWorkoutsDialog,workoutDateGroups:j.workoutDateGroups,selectedWorkoutDates:j.selectedWorkoutDates,isDeletingWorkouts:j.isDeletingWorkouts,areAllWorkoutDatesSelected:j.areAllWorkoutDatesSelected,toggleWorkoutDateSelection:j.toggleWorkoutDateSelection,selectAllWorkoutDates:j.selectAllWorkoutDates,clearWorkoutSelection:j.clearWorkoutSelection,handleDeleteSelectedWorkouts:j.handleDeleteSelectedWorkouts}),e.jsx(Ge,{isOpen:j.isDeleteTemplatesDialogOpen,onClose:j.closeDeleteTemplatesDialog,templatesForDeletion:j.templatesForDeletion,selectedTemplateIds:j.selectedTemplateIds,isDeletingTemplates:j.isDeletingTemplates,areAllTemplatesSelected:j.areAllTemplatesSelected,toggleTemplateSelection:j.toggleTemplateSelection,selectAllTemplates:j.selectAllTemplates,clearTemplateSelection:j.clearTemplateSelection,handleDeleteSelectedTemplates:j.handleDeleteSelectedTemplates}),e.jsx(De,{open:d.isImportSuccessOpen,onOpenChange:A=>{A||d.closeImportSuccessToast()},onClose:d.closeImportSuccessToast,message:d.importSuccessMessage||"  .  ,   .",variant:d.toastVariant}),e.jsx(Xe,{isOpen:I.isTemplatesImportDialogOpen,pendingTemplatesDuplicates:I.pendingTemplatesDuplicates,isImportingTemplates:I.isImportingTemplates,templatesImportAction:I.templatesImportAction,onClose:I.closeTemplatesImportDialog,handleImportTemplatesOnlyNew:I.handleImportTemplatesOnlyNew,handleImportTemplatesOverwrite:I.handleImportTemplatesOverwrite}),e.jsx(Ze,{isOpen:d.isWorkoutsImportDialogOpen,pendingWorkoutsImport:d.pendingWorkoutsImport,pendingWorkoutsFileName:d.pendingWorkoutsFileName,pendingWorkoutsNewDatesSummary:d.pendingWorkoutsNewDatesSummary,isImportingWorkouts:d.isImportingWorkouts,importAction:d.importAction,onClose:d.closeWorkoutsImportDialog,handleConfirmImportWorkoutsOnly:d.handleConfirmImportWorkoutsOnly,handleImportOnlyNewWorkouts:d.handleImportOnlyNewWorkouts,handleExportThenImportWorkouts:d.handleExportThenImportWorkouts}),e.jsx(He,{isOpen:E.isWeightTrackerOpen,onClose:()=>E.setIsWeightTrackerOpen(!1),bodyWeights:E.bodyWeights,loadingWeights:E.loadingWeights,weightChartData:E.weightChartData,weightStats:E.weightStats,newWeight:E.newWeight,newWeightDate:E.newWeightDate,savingWeight:E.savingWeight,deletingWeightId:E.deletingWeightId,isDeleteWeightConfirmOpen:E.isDeleteWeightConfirmOpen,weightToDelete:E.weightToDelete,setNewWeight:E.setNewWeight,setNewWeightDate:E.setNewWeightDate,setIsDeleteWeightConfirmOpen:E.setIsDeleteWeightConfirmOpen,handleAddWeight:E.handleAddWeight,handleDeleteWeight:E.handleDeleteWeight,handleOpenDeleteWeightConfirm:E.handleOpenDeleteWeightConfirm})]})};export{it as default};
