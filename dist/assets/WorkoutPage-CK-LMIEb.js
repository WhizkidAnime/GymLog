import{a as ne,j as t,s as Y,u as Ae,W as Ie,g as U}from"./index-CMRT6TmP.js";import{f as Ne,r as i,e as Te,c as Se,L as Le,j as $e,u as Me}from"./vendor-BVca5W6X.js";import{u as xe}from"./useDebounce-C2cqH541.js";import{C as De}from"./confirm-dialog-Cp1MWodJ.js";import{c as be,f as Oe}from"./date-helpers-C_0boXDq.js";import{n as Ce,p as Fe}from"./exercise-name-BJxyXXn3.js";import{W as _e}from"./workout-icons-BnYWVugS.js";import{u as Re}from"./use-modal-scroll-lock-DlG-D3y9.js";import{u as Be}from"./use-workout-actions-menu-C-5wTXkz.js";import{u as qe}from"./usePageState-6XNG0ilq.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";const Ke=({set:e,previousSet:s,onChange:n,onAddDropset:d,onDeleteDropset:a,isLastInGroup:u})=>{const{t:f}=ne(),l=`workout_set_draft:${e.id}`,k=`workout_set_last_non_max_reps:${e.id}`,D=m=>m==null?"":String(m).replace(".",","),S=m=>{if(m==="")return null;const g=Number(m.replace(",","."));return Number.isFinite(g)?g:null},N=m=>{let g=m.replace(".",",");g=g.replace(/[^\d,]/g,"");const _=g.indexOf(",");return _!==-1&&(g=g.slice(0,_+1)+g.slice(_+1).replace(/,/g,"")),g},T=f.common.max,I=m=>m==null?"":m==="0"?T:m,h=m=>{const g=m.trim();if(g==="")return null;const _=g.toLowerCase();return _==="макс"||_==="макс."||_==="max"||_==="max."||/^0+$/.test(g)?"0":g},F=m=>{const g=m.trim();if(g==="")return"";if(/^0+$/.test(g))return T;const _=g.toLowerCase();return _.startsWith("макс")||_.startsWith("max")?T:g.replace(/[^0-9]/g,"")},C=I(e.reps),[W,B]=i.useState(D(e.weight)),[R,$]=i.useState(C),[J,j]=i.useState(h(C)==="0"?null:C||null),[r,c]=i.useState(e.is_done),[b,p]=i.useState(!1),[y,E]=i.useState(()=>h(C)==="0"),A=xe(W,500),L=xe(R,500),Z=!(e.is_dropset??!1)&&!!s&&s.is_done&&s.weight!==null&&S(W)===null,q=m=>{j(m);try{m&&m.trim()!==""?localStorage.setItem(k,m):localStorage.removeItem(k)}catch{}};i.useEffect(()=>{try{const m=localStorage.getItem(l);if(!m)return;const g=JSON.parse(m),_=new Date(e.updated_at).getTime();if(g.updatedAt>_){B(g.weight===""?"":D(g.weight));const O=I(g.reps);$(O);const K=h(O)==="0"?null:O||null;q(K),c(g.isDone)}}catch{}},[]),i.useEffect(()=>{c(e.is_done)},[e.is_done]),i.useEffect(()=>{if(e.reps==="0")try{const m=localStorage.getItem(k);m&&m.trim()!==""&&j(m)}catch{}},[e.reps,k]);const X=Ne.useRef(n);i.useEffect(()=>{X.current=n},[n]),i.useEffect(()=>{(async()=>{var O;const g=S(A),_=h(L);if(g!==(e.weight??null)||_!==(e.reps??null)||r!==e.is_done){const K={weight:g===null?"":g,reps:_,isDone:r,updatedAt:Date.now()};try{localStorage.setItem(l,JSON.stringify(K))}catch{}p(!0);const{error:ie}=await Y.from("workout_sets").update({weight:g,reps:_,is_done:r,updated_at:new Date().toISOString()}).eq("id",e.id);if(ie)console.error("Error saving set:",ie);else{try{localStorage.removeItem(l)}catch{}const re={...e,weight:g,reps:_,is_done:r,updated_at:new Date().toISOString()};(O=X.current)==null||O.call(X,re)}setTimeout(()=>p(!1),500)}})()},[A,L,e.id,e.weight,e.reps,e.is_done,r,l]),i.useEffect(()=>{const m=S(A)!==null,g=h(L)!==null,_=m&&g;_&&!r?c(!0):!_&&r&&c(!1)},[A,L,r]);const ee=r?"bg-green-500":"bg-transparent",te=r?"text-black":"text-inherit",se=r?"setrow-input-done-white":"",w=h(R)==="0",o=y||w,x=()=>{const m=h(R),g=m!==null&&m!=="0";if(o)w&&(J!==null&&J.trim()!==""?$(J):$("")),E(!1);else{if(g){E(!0);return}h(R)!=="0"&&R.trim()!==""&&q(R),$(T),E(!0)}},v=e.is_dropset??!1,V=r?v?v&&r?"bg-purple-500/80":"":ee:v?"bg-purple-500/10 border-l-2 border-purple-500/50 ml-3":"";return t.jsxs("div",{className:`relative grid grid-cols-6 gap-3 items-center p-2 rounded-md transition-colors duration-300 ${V||ee}`,children:[t.jsxs("div",{className:`col-span-1 text-center font-medium ${te} flex items-center justify-center`,children:[v&&t.jsx("span",{className:`text-xs mr-0.5 dropset-indicator ${r?"is-done":""}`,children:"↳"}),t.jsx("span",{children:v?f.setRow.dropset:e.set_index}),!v&&u&&d&&t.jsx("button",{type:"button",onClick:()=>d(e.id),"aria-label":f.setRow.addDropset,className:`absolute left-12 w-5 h-5 flex items-center justify-center rounded transition-colors flex-shrink-0 dropset-btn ${r?"is-done hover:bg-black/10":"hover:bg-white/10"}`,title:f.setRow.addDropset,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:t.jsx("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})})})]}),t.jsx("div",{className:"col-span-2 flex justify-center",children:t.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0",value:W,onChange:m=>B(N(m.target.value)),className:`w-[72px] p-1 text-center rounded-md border-gray-600 shadow-sm placeholder:text-gray-400 focus:placeholder-transparent outline-none focus-visible:outline-none setrow-input ${se} ${te}`})}),Z&&t.jsx("button",{type:"button",onClick:()=>{!s||s.weight===null||B(D(s.weight))},"aria-label":f.setRow.copyWeight,className:"btn-glass btn-glass-icon-round btn-glass-secondary absolute text-white h-6 w-6 p-0",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",transition:"none",width:"1.5rem",height:"1.5rem",minWidth:"1.5rem",minHeight:"1.5rem",padding:0},children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"12",height:"12",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polyline",{points:"5 15 12 8 19 15"})})}),t.jsx("div",{className:"col-span-2 flex justify-center",children:t.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"0",value:R,onChange:m=>{const g=F(m.target.value);if($(g),h(g)!=="0"){const _=g.trim()===""?null:g;q(_)}},className:`w-[64px] p-1 text-center rounded-md border-gray-600 shadow-sm placeholder:text-gray-400 focus:placeholder-transparent outline-none focus-visible:outline-none setrow-input ${se} ${te}`})}),t.jsxs("div",{className:"col-span-1 flex items-center justify-center",children:[!v&&t.jsx("input",{type:"checkbox",checked:o,onChange:x,"aria-label":f.setRow.toFailure,className:"h-6 w-6 rounded-md border border-gray-300 bg-white outline-none focus-visible:outline-none flex-shrink-0",style:{accentColor:"#000000",color:"#0a0a0a"}}),v&&t.jsxs("div",{className:"flex items-center justify-end gap-1 w-14",children:[u&&d?t.jsx("button",{type:"button",onClick:()=>d(e.id),"aria-label":f.setRow.addDropset,className:`w-6 h-6 flex items-center justify-center rounded transition-colors flex-shrink-0 font-bold dropset-btn ${r?"is-done hover:bg-black/10":"hover:bg-white/20"}`,title:f.setRow.addDropset,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})})}):t.jsx("div",{className:"w-6 h-6 flex-shrink-0"}),a&&t.jsx("button",{type:"button",onClick:()=>a(e.id),"aria-label":f.setRow.deleteDropset,className:`w-6 h-6 flex items-center justify-center rounded transition-colors flex-shrink-0 font-bold dropset-btn ${r?"is-done hover:bg-black/10":"hover:bg-white/20"}`,title:f.setRow.deleteDropset,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:t.jsx("path",{fillRule:"evenodd",d:"M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z",clipRule:"evenodd"})})})]})]}),b&&t.jsx("div",{className:"absolute right-2 top-2 h-2 w-2 bg-blue-500 rounded-full animate-ping"})]})},He=Ne.memo(Ke,(e,s)=>{var n,d,a,u;return e.set.id===s.set.id&&e.set.weight===s.set.weight&&e.set.reps===s.set.reps&&e.set.is_done===s.set.is_done&&e.set.set_index===s.set.set_index&&e.set.updated_at===s.set.updated_at&&e.set.is_dropset===s.set.is_dropset&&e.set.parent_set_index===s.set.parent_set_index&&((n=e.previousSet)==null?void 0:n.weight)===((d=s.previousSet)==null?void 0:d.weight)&&((a=e.previousSet)==null?void 0:a.is_done)===((u=s.previousSet)==null?void 0:u.is_done)&&e.isLastInGroup===s.isLastInGroup&&e.onAddDropset===s.onAddDropset&&e.onDeleteDropset===s.onDeleteDropset}),ve=()=>{try{const e=localStorage.getItem("settings:timerStep");return e?Number(e):30}catch{return 30}},Pe=({restSeconds:e,exerciseId:s,onAdjustRestSeconds:n,timerStep:d})=>{const{t:a}=ne(),u=s?`rest_timer:${s}`:void 0,[f,l]=i.useState(()=>d??ve());i.useEffect(()=>{if(d!==void 0)l(d);else{const j=()=>{l(ve())};window.addEventListener("storage",j);const r=()=>{l(ve())};return window.addEventListener("focus",r),()=>{window.removeEventListener("storage",j),window.removeEventListener("focus",r)}}},[d]);const k=i.useRef(null),D=i.useRef(e),S=i.useRef({time:e,isActive:!1,endAt:null}),[N,T]=i.useState(()=>{if(!u)return{time:e,isActive:!1,endAt:null};try{const j=localStorage.getItem(u);if(!j)return{time:e,isActive:!1,endAt:null};const r=JSON.parse(j),c=360*60*1e3;if(Date.now()-r.savedAt>c)return localStorage.removeItem(u),{time:e,isActive:!1,endAt:null};if(r.isActive&&r.endAt){const b=Math.max(0,Math.floor((r.endAt-Date.now())/1e3));return b>0?{time:b,isActive:!0,endAt:r.endAt}:(localStorage.removeItem(u),{time:r.restSeconds,isActive:!1,endAt:null})}return{time:r.restSeconds,isActive:!1,endAt:null}}catch(j){return console.error("Error restoring timer state:",j),{time:e,isActive:!1,endAt:null}}}),{time:I,isActive:h,endAt:F}=N,C=i.useCallback((j,r)=>{if(u)try{const c={endAt:j.endAt,isActive:j.isActive,restSeconds:r??S.current.time??e,savedAt:Date.now()};localStorage.setItem(u,JSON.stringify(c))}catch(c){console.error("Error persisting timer:",c)}},[u,e]),W=i.useRef(C);i.useEffect(()=>{W.current=C},[C]),i.useEffect(()=>{S.current={time:I,isActive:h,endAt:F}},[I,h,F]),i.useEffect(()=>{if(!h||!F){k.current&&(window.clearInterval(k.current),k.current=null);return}let j=!1;const r=()=>{if(j)return;const b=Date.now(),p=Math.max(0,F-b),y=Math.floor(p/1e3);T(E=>({...E,time:y})),y<=0&&(j=!0,T(E=>({...E,isActive:!1,endAt:null,time:e})),k.current&&(window.clearInterval(k.current),k.current=null),u&&localStorage.removeItem(u))};r();const c=window.setInterval(r,1e3);return k.current=c,()=>{j=!0,k.current&&(window.clearInterval(k.current),k.current=null)}},[h,F,u,e]),i.useEffect(()=>{!h&&e!==D.current&&T(j=>({...j,time:e})),D.current=e},[e,h]),i.useEffect(()=>()=>{k.current&&(window.clearInterval(k.current),k.current=null);const{isActive:j,endAt:r}=S.current;j&&r&&W.current({endAt:r,isActive:!0})},[]);const B=()=>{T(j=>{if(j.isActive)return C({endAt:null,isActive:!1},j.time),k.current&&(window.clearInterval(k.current),k.current=null),{time:j.time,isActive:!1,endAt:null};const r=Date.now()+j.time*1e3;return C({endAt:r,isActive:!0},j.time),{time:j.time,isActive:!0,endAt:r}})},R=()=>{T({time:e,isActive:!1,endAt:null}),k.current&&(window.clearInterval(k.current),k.current=null),u&&localStorage.removeItem(u)},$=j=>{T(r=>{const c=Math.max(0,r.time+j);if(c===0)return C({endAt:null,isActive:!1},0),k.current&&(window.clearInterval(k.current),k.current=null),{time:0,isActive:!1,endAt:null};if(r.isActive){const b=Date.now()+c*1e3;return C({endAt:b,isActive:!0},c),{time:c,isActive:!0,endAt:b}}return C({endAt:null,isActive:!1},c),{time:c,isActive:!1,endAt:null}}),n==null||n(j)},J=j=>{const r=Math.floor(j/60),c=j%60;return`${r}:${c<10?"0":""}${c}`};return t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"flex items-center justify-center gap-4",children:[t.jsx("button",{onClick:()=>$(-f),disabled:I<=0&&!h,className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"-"}),t.jsx("div",{className:`text-6xl font-mono font-semibold leading-none min-w-[4ch] text-center ${h?"text-white":""}`,children:J(I)}),t.jsx("button",{onClick:()=>$(f),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"+"})]}),t.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[t.jsx("button",{onClick:B,className:`btn-glass btn-glass-icon-lg ${h?"btn-glass-danger":"btn-glass-primary"}`,children:h?a.timer.stop:a.timer.start}),t.jsx("button",{onClick:R,className:"btn-glass btn-glass-icon-sm btn-glass-secondary",children:a.timer.reset})]})]})},Ve=7200*1e3,je=new Map,Ye=(e,s,n)=>`${e}:${s}:${n||"none"}`,Je=e=>{const s=je.get(e);if(!s)return;if(Date.now()-s.timestamp>Ve){je.delete(e);return}return s.data},we=(e,s)=>{je.set(e,{data:s,timestamp:Date.now()})},Ge=({exercise:e,workoutDate:s,onUpdateExercise:n,onDeleteExercise:d})=>{var se;const{t:a}=ne(),[u,f]=i.useState(e.name),[l,k]=i.useState(e.sets),[D,S]=i.useState(e.rest_seconds),[N,T]=i.useState(!1),[I,h]=i.useState(null),[F,C]=i.useState("idle"),W=i.useRef(null),{user:B}=Ae(),R=xe(u,500),$=xe(D,500),[J,j]=i.useState(!1),r=i.useRef(e.name),c=i.useRef(e);i.useEffect(()=>{c.current=e},[e]);const b=i.useCallback(()=>{const w=W.current;w&&(w.style.height="auto",w.style.height=`${w.scrollHeight}px`)},[]);i.useEffect(()=>{e.name!==r.current&&(f(e.name),r.current=e.name),k(e.sets),S(e.rest_seconds)},[e.id,e.sets,e.rest_seconds]),i.useEffect(()=>{if(!B)return;const w=R.trim(),o=Ce(w);if(!o){h(null),C("idle");return}const x=Ye(B.id,o,s??null),v=Je(x);if(v!==void 0){h(v),C("ready");return}let M=!1;return C("loading"),(async()=>{try{let V=Y.from("workouts").select("id, workout_date, name, user_id").eq("user_id",B.id);s&&(V=V.lt("workout_date",s));const{data:m,error:g}=await V.order("workout_date",{ascending:!0});if(M)return;if(g)throw g;const _=(m||[]).map(H=>({id:H.id,date:H.workout_date,name:H.name})),O=new Map;_.forEach(H=>O.set(H.id,{date:H.date,name:H.name}));const K=_.map(H=>H.id);if(K.length===0){h(null),we(x,null),C("ready");return}const{data:ie,error:re}=await Y.from("workout_exercises").select("id, name, workout_id").in("workout_id",K);if(M)return;if(re)throw re;const oe=new Set,le=new Map;if((ie||[]).forEach(H=>{const ue=(H.name??"").trim();if(ue&&Ce(ue)===o){const Q=H.id;oe.add(Q);const fe=H.workout_id;fe&&le.set(Q,fe)}}),oe.size===0){h(null),we(x,null),C("ready");return}const{data:me,error:de}=await Y.from("exercise_progress_view").select("workout_date, workout_name, workout_id, exercise_id, max_weight, reps_at_max_weight").in("workout_id",K).in("exercise_id",Array.from(oe));if(M)return;if(de)throw de;let ce=(me||[]).map(H=>({workout_date:H.workout_date,workout_name:H.workout_name,workout_id:H.workout_id,exercise_id:H.exercise_id,max_weight:H.max_weight,reps_at_max_weight:H.reps_at_max_weight}));if(ce.length===0){const{data:H,error:ue}=await Y.from("workout_sets").select("id, workout_exercise_id, weight, reps, is_done, updated_at").in("workout_exercise_id",Array.from(oe)).order("updated_at",{ascending:!1});if(M)return;if(ue)throw ue;ce=(H||[]).filter(Q=>Q.weight!==null&&Number(Q.weight)===0).filter(Q=>Q.is_done||typeof Q.reps=="string"&&Q.reps.trim()!=="").map(Q=>{const fe=Q.workout_exercise_id,pe=le.get(fe);if(!pe)return null;const ae=O.get(pe);return ae?{workout_date:ae.date,workout_name:ae.name,workout_id:pe,exercise_id:fe,max_weight:0,reps_at_max_weight:Q.reps}:null}).filter(Q=>Q!==null)}if(ce.length===0){h(null),we(x,null),C("ready");return}const ge=Fe(w,ce),he=ge.dataPoints[ge.dataPoints.length-1];if(!he){h(null),we(x,null),C("ready");return}const ke={weight:he.weight,reps:he.reps,workoutDate:he.date};h(ke),we(x,ke),C("ready")}catch(V){console.error("Failed to fetch last exercise performance",V),C("error")}})(),()=>{M=!0}},[R,B,s]),i.useLayoutEffect(()=>{b()},[b,u]),i.useLayoutEffect(()=>{if(typeof ResizeObserver>"u")return;const w=W.current;if(!w)return;const o=new ResizeObserver(()=>{b()});return o.observe(w),()=>o.disconnect()},[b]),i.useEffect(()=>{(async()=>{if(!(R.trim()===""||R===e.name))try{await Y.from("workout_exercises").update({name:R}).eq("id",e.id);const o={...e,name:R};r.current=R,n(o)}catch(o){console.error("Failed to update exercise name",o)}})()},[R]),i.useEffect(()=>{(async()=>{if($!==e.rest_seconds)try{await Y.from("workout_exercises").update({rest_seconds:$}).eq("id",e.id);const o={...e,rest_seconds:$};n(o)}catch(o){console.error("Failed to update rest seconds",o)}})()},[$,e,n]);const p=w=>{S(o=>Math.max(0,o+w))},y=async w=>{if(!(w<1||w===l||N)){T(!0);try{if(w>l){const o=Array.from({length:w-l},(V,m)=>({workout_exercise_id:e.id,set_index:l+m+1,is_dropset:!1})),{data:x,error:v}=await Y.from("workout_sets").insert(o).select();if(v)throw v;const M=[...e.workout_sets,...x||[]].sort((V,m)=>{const g=V.is_dropset??!1,_=m.is_dropset??!1,O=g?V.parent_set_index??V.set_index:V.set_index,K=_?m.parent_set_index??m.set_index:m.set_index;return O!==K?O-K:g!==_?g?1:-1:V.set_index-m.set_index});await Y.from("workout_exercises").update({sets:w}).eq("id",e.id);const z={...e,sets:w,workout_sets:M};n(z)}else{const x=e.workout_sets.filter(m=>!m.is_dropset&&m.set_index>w).map(m=>m.id),v=new Set(x);let M=0;for(const m of e.workout_sets){if(!m.is_dropset&&m.set_index>w){v.add(m.id);let g=M+1;for(;g<e.workout_sets.length&&e.workout_sets[g].is_dropset;)v.add(e.workout_sets[g].id),g++}M++}if(v.size>0){const{error:m}=await Y.from("workout_sets").delete().in("id",Array.from(v));if(m)throw m}const z=e.workout_sets.filter(m=>!v.has(m.id));await Y.from("workout_exercises").update({sets:w}).eq("id",e.id);const V={...e,sets:w,workout_sets:z};n(V)}k(w)}catch(o){console.error("Failed to change sets count",o),alert(a.exercise.errors.failedToChangeSets)}finally{T(!1)}}},E=async()=>{const{error:w}=await Y.from("workout_sets").delete().eq("workout_exercise_id",e.id);if(w){console.error("Failed to delete sets of exercise",w),alert(a.exercise.errors.failedToDeleteSets);return}const{error:o}=await Y.from("workout_exercises").delete().eq("id",e.id);if(o){console.error("Failed to delete exercise",o),alert(a.exercise.errors.failedToDeleteExercise);return}d&&d(e.id)},A=a.common.max,L=w=>w==null?"—":String(w).replace(".",","),P=w=>{if(w==null)return"—";const o=w.trim();return o?o==="0"?A:o:"—"},Z=()=>u.trim()?F==="loading"?t.jsx("span",{className:"text-gray-400",children:a.exercise.searchingLastResult}):F==="error"?t.jsx("span",{className:"text-red-300",children:a.exercise.loadError}):I?t.jsxs("span",{className:"text-white text-base font-semibold",children:[L(I.weight)," ",a.common.kg," × ",P(I.reps)]}):t.jsx("span",{className:"text-gray-500",children:a.exercise.noDataBeforeDate}):t.jsx("span",{className:"text-gray-500",children:a.exercise.enterNameToSeeResult}),q=i.useCallback(w=>{const o=c.current,x={...o,workout_sets:o.workout_sets.map(v=>v.id===w.id?w:v)};n(x)},[n]),X=i.useCallback(async w=>{const o=c.current,x=o.workout_sets.findIndex(M=>M.id===w);if(x===-1)return;const v=o.workout_sets[x];try{const M=v.is_dropset?v.parent_set_index??v.set_index:v.set_index,V=Math.max(...o.workout_sets.map(ie=>ie.set_index))+1,{data:m,error:g}=await Y.from("workout_sets").insert({workout_exercise_id:o.id,set_index:V,weight:null,reps:null,is_done:!1,is_dropset:!0,parent_set_index:M,updated_at:new Date().toISOString()}).select().single();if(g)throw g;let _=x+1;for(;_<o.workout_sets.length&&o.workout_sets[_].is_dropset;)_++;const O=[...o.workout_sets];O.splice(_,0,m);const K={...o,workout_sets:O};n(K)}catch(M){console.error("Failed to add dropset",M),alert(a.exercise.errors.failedToAddDropset)}},[n]),ee=i.useCallback(async w=>{const o=c.current,x=o.workout_sets.find(v=>v.id===w);if(!(!x||!x.is_dropset))try{const{error:v}=await Y.from("workout_sets").delete().eq("id",w);if(v)throw v;const M={...o,workout_sets:o.workout_sets.filter(z=>z.id!==w)};n(M)}catch(v){console.error("Failed to delete dropset",v),alert(a.exercise.errors.failedToDeleteDropset)}},[n]),te=i.useCallback((w,o,x)=>{const v=x[o+1];return w.is_dropset,!v||!v.is_dropset},[]);return t.jsxs("div",{id:`exercise-${e.id}`,className:"glass card-dark p-4 exercise-card",children:[t.jsxs("div",{className:"exercise-card-header mb-3",children:[t.jsxs("div",{className:"name-wrap relative",children:[t.jsx("textarea",{value:u,onChange:w=>f(w.target.value),ref:W,rows:1,className:"w-full text-base sm:text-lg font-bold text-white whitespace-pre-wrap bg-white/10 hover:bg-white/15 focus:bg-white/10 border border-white/20 hover:border-white/30 focus:border-white/50 focus:ring-2 focus:ring-white/25 focus:outline-none rounded-xl px-4 pr-9 py-3 min-h-[3rem] resize-none overflow-y-hidden leading-relaxed transition-colors"}),u&&u.trim()!==""&&t.jsx("button",{type:"button",onClick:()=>{f(""),requestAnimationFrame(()=>b())},"aria-label":a.common.clear,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-white/10 text-gray-300",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),t.jsx("button",{"aria-label":a.exercise.deleteExercise,className:"delete-btn btn-glass btn-glass-icon btn-glass-outline",onClick:()=>j(!0),type:"button",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M3 6h18"}),t.jsx("path",{d:"M8 6l1-2h6l1 2"}),t.jsx("path",{d:"M10 11v6"}),t.jsx("path",{d:"M14 11v6"}),t.jsx("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"rounded-2xl bg-white/5 px-4 py-3 text-xs sm:text-sm text-gray-300",children:[t.jsxs("div",{className:"mb-1 flex items-center justify-between gap-3",children:[t.jsx("span",{className:"font-semibold text-white",children:a.exercise.lastWeight}),(I==null?void 0:I.workoutDate)&&t.jsx("span",{className:"text-[0.7rem] uppercase tracking-wide text-gray-400",children:be(I.workoutDate)})]}),Z()]}),t.jsx("div",{className:"flex justify-center",children:t.jsx(Pe,{restSeconds:D,exerciseId:e.id,onAdjustRestSeconds:p})}),t.jsxs("div",{className:"flex items-center justify-between text-sm py-3 sm:py-4 px-2 rounded-lg exercise-row-header",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("span",{className:"whitespace-nowrap font-medium",children:[a.exercise.sets,":"]}),t.jsxs("div",{className:"inline-flex items-center gap-2",children:[t.jsx("button",{disabled:N||l<=1,onClick:()=>y(l-1),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"−"}),t.jsx("span",{className:"min-w-[3ch] text-center text-white font-semibold",children:l}),t.jsx("button",{disabled:N||l>=30,onClick:()=>y(l+1),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"+"})]})]}),((se=e.reps)==null?void 0:se.trim())&&t.jsxs("div",{className:"ml-3 flex-1 text-right whitespace-nowrap font-medium",children:[a.exercise.reps,": ",e.reps]})]})]}),t.jsxs("div",{className:"space-y-3 pt-1",children:[t.jsxs("div",{className:"grid grid-cols-6 gap-3 text-sm sm:text-base font-semibold px-2 sm:px-3 py-2 rounded-lg overflow-hidden exercise-sets-header",children:[t.jsx("div",{className:"col-span-1 flex items-center justify-start pl-1 sm:pl-2 whitespace-nowrap",children:a.exercise.set}),t.jsx("div",{className:"col-span-2 flex items-center justify-center whitespace-nowrap",children:a.exercise.weight}),t.jsx("div",{className:"col-span-2 flex items-center justify-center whitespace-nowrap",children:a.exercise.reps}),t.jsx("div",{className:"col-span-1 flex items-center justify-end pr-1 sm:pr-2 whitespace-nowrap",children:a.exercise.toFailure})]}),t.jsx("div",{className:"space-y-2",children:e.workout_sets.map((w,o,x)=>{let v;if(!w.is_dropset){for(let M=o-1;M>=0;M--)if(!x[M].is_dropset){v=x[M];break}}return t.jsx(He,{set:w,previousSet:v,onChange:q,onAddDropset:X,onDeleteDropset:ee,isLastInGroup:te(w,o,x)},w.id)})})]}),t.jsx(De,{open:J,onOpenChange:j,title:a.exercise.deleteExercise,description:e.name?a.exercise.deleteExerciseDesc.replace("{name}",e.name):a.exercise.deleteExerciseDescNoName,confirmText:a.common.delete,cancelText:a.common.cancel,variant:"danger",onConfirm:E})]})},Xe=Ne.memo(Ge,(e,s)=>{const n=e.exercise,d=s.exercise;if(n.id!==d.id||n.name!==d.name||n.sets!==d.sets||n.rest_seconds!==d.rest_seconds||n.reps!==d.reps||e.workoutDate!==s.workoutDate||n.workout_sets.length!==d.workout_sets.length)return!1;for(let a=0;a<n.workout_sets.length;a++){const u=n.workout_sets[a],f=d.workout_sets[a];if(u.id!==f.id||u.weight!==f.weight||u.reps!==f.reps||u.is_done!==f.is_done||u.is_dropset!==f.is_dropset||u.parent_set_index!==f.parent_set_index)return!1}return!0}),We=({normalizedDate:e,className:s=""})=>{const n=Te();return t.jsx("button",{onClick:()=>n("/calendar",{state:{refreshDate:e}}),className:`inline-flex items-center justify-center p-2 rounded-full border border-transparent text-white transition-colors z-10 bg-transparent hover:border-white active:border-white focus:outline-none back-button-plain ${s}`,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})},Qe=({normalizedDate:e,workoutName:s,isEditingName:n,editNameValue:d,isSavingWorkoutName:a,isScrolling:u,inputRef:f,onStartEditName:l,onChangeEditName:k,onSaveEditName:D,onCancelEditName:S,actionsRef:N,actionsBtnRef:T,onToggleActions:I,workoutIcon:h,editIconValue:F,onOpenIconPicker:C})=>{var $;const{t:W}=ne(),B=n?F:h,R=B?_e[B]:null;return t.jsxs("div",{className:`glass card-dark p-4 flex items-center gap-4 header-container ${u?"scrolling":""}`,children:[t.jsx(We,{normalizedDate:e,className:"shrink-0"}),t.jsx("div",{className:"flex-1 text-center",children:n?t.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:C,disabled:a,className:"shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 transition-colors disabled:opacity-50",title:W.iconPicker.title,children:R?t.jsx(R.component,{size:28}):t.jsxs("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"text-gray-400",children:[t.jsx("circle",{cx:"12",cy:"12",r:"9",strokeDasharray:"4 2"}),t.jsx("path",{d:"M12 8v8M8 12h8"})]})}),t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{ref:f,type:"text",value:d,onChange:J=>k(J.target.value),disabled:a,className:"w-full bg-white/10 text-lg font-bold text-white placeholder:text-gray-500 focus:outline-none focus:bg-white/20 rounded-md px-3 pr-9 py-2 transition-colors disabled:opacity-70",placeholder:(($=W.workout.emptyState)==null?void 0:$.title)||"Workout name"}),d&&t.jsx("button",{type:"button",onClick:()=>k(""),"aria-label":W.common.clear,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-white/10 text-gray-300",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("button",{onClick:D,disabled:a,className:"shrink-0 p-1.5 rounded-full hover:bg-green-500/20 transition-colors disabled:opacity-50",title:W.common.save,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),t.jsx("button",{onClick:S,disabled:a,className:"shrink-0 p-1.5 rounded-full hover:bg-red-500/20 transition-colors disabled:opacity-50",title:W.common.cancel,children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}):t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[R&&t.jsx("div",{className:"shrink-0 w-10 h-10 flex items-center justify-center",children:t.jsx(R.component,{size:32})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-white",children:s}),t.jsxs("p",{className:"text-md transition-all duration-300 workout-date-text",children:[W.workoutHeader.date,": ",be(e)]})]}),t.jsx("button",{onClick:l,className:"shrink-0 p-1.5 rounded-full hover:bg-white/10 transition-colors",title:W.common.edit||"Edit",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})}),t.jsx("div",{className:"relative",ref:N,children:t.jsx("button",{ref:T,type:"button","aria-label":W.profile.menu,className:"inline-flex items-center justify-center p-2 rounded-full hover:bg-white/10",onClick:I,children:t.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[t.jsx("circle",{cx:"12",cy:"5",r:"1"}),t.jsx("circle",{cx:"12",cy:"12",r:"1"}),t.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})})]})},Ze=({open:e,templates:s,isCreating:n,onClose:d,onReplaceWithTemplate:a})=>{const{t:u}=ne();return e?Se.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 overscroll-contain",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:d}),t.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-lg font-semibold",children:u.workoutTemplateSelect.title}),t.jsx("button",{onClick:d,className:"px-2 py-1 text-sm text-gray-300 hover:text-white",children:"✕"})]}),s.length===0?t.jsx("p",{className:"text-gray-400",children:u.workoutTemplateSelect.noTemplates}):t.jsx("div",{className:"space-y-2 max-h-[70vh] overflow-y-auto overscroll-contain pr-1",children:s.map(f=>t.jsx("button",{onClick:()=>a(f),disabled:n,className:"w-full text-left px-4 py-2 rounded-md border border-white/20 text-gray-100 hover:bg-white/5 disabled:opacity-50",children:n?u.workoutTemplateSelect.applying:f.name},f.id))})]})]}),document.body):null};function Ue({normalizedDate:e,templates:s,isCreating:n,onCreateWorkout:d,onCreateCustomWorkout:a}){const{t:u}=ne();return n?t.jsx("div",{className:"px-4 pt-4",children:t.jsx(Ie,{message:u.workoutEmptyState.creating})}):t.jsxs("div",{className:"max-w-lg mx-auto px-4 pt-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(We,{normalizedDate:e}),t.jsx("h1",{className:"flex-1 text-xl font-bold text-center",children:u.workoutEmptyState.workoutOn.replace("{date}",be(e))})]}),t.jsxs("div",{className:"mt-4 p-6 text-center",children:[s.length>0?t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-lg font-semibold mb-3",children:u.workoutEmptyState.selectTemplate}),t.jsx("div",{className:"space-y-2",children:s.map(f=>t.jsx("button",{onClick:()=>d(f),disabled:n,className:"btn-glass btn-glass-primary btn-glass-full btn-glass-md disabled:opacity-50",children:f.name},f.id))})]}):t.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[t.jsx("p",{className:"text-gray-400",children:u.workoutEmptyState.createTemplateFirst}),t.jsxs(Le,{to:"/templates/new",className:"btn-glass btn-glass-primary btn-glass-full btn-glass-md",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),u.workoutEmptyState.createTemplate]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{type:"button",onClick:a,disabled:n,className:"btn-dashed",children:u.workoutEmptyState.createCustomDay})})]})]})}function ze({isCardio:e,isSaving:s,onToggle:n}){const{t:d}=ne();return t.jsxs("div",{className:"glass card-dark p-4 rounded-md",children:[t.jsx("p",{className:"text-white text-lg font-bold mb-3 text-center",children:d.workoutCardio.question}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>{e&&n()},disabled:s,className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition duration-200 ease-in-out ${e?"bg-red-500/30 text-white border border-red-400/40 supports-[hover:hover]:hover:bg-red-500/40 supports-[hover:hover]:hover:shadow-sm":"bg-red-500/80 text-white shadow-lg border border-red-400/60"} active:brightness-100 disabled:cursor-not-allowed disabled:pointer-events-none focus:outline-none focus-visible:outline-none [-webkit-tap-highlight-color:transparent]`,children:d.workoutCardio.no}),t.jsx("button",{onClick:()=>{e||n()},disabled:s,className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition duration-200 ease-in-out ${e?"bg-green-500/80 text-white shadow-lg border border-green-400/60":"bg-green-500/30 text-white border border-green-400/40 supports-[hover:hover]:hover:bg-green-500/40 supports-[hover:hover]:hover:shadow-sm"} active:brightness-100 disabled:cursor-not-allowed disabled:pointer-events-none focus:outline-none focus-visible:outline-none [-webkit-tap-highlight-color:transparent]`,children:d.workoutCardio.yes})]})]})}function et({notes:e,isSaving:s,onChange:n}){const{t:d}=ne();return t.jsxs("div",{className:"glass card-dark p-4 rounded-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("p",{className:"text-white text-lg font-bold",children:d.workoutNotes.title}),s&&t.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[t.jsx("span",{className:"w-3 h-3 border border-white/30 border-t-white rounded-full animate-spin"}),d.workoutNotes.saving]})]}),t.jsx("textarea",{value:e,onChange:a=>n(a.target.value),placeholder:d.workoutNotes.placeholder,rows:5,className:"w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-400 text-sm resize-none focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition-colors"})]})}function tt({isOpen:e,menuPos:s,onReorder:n,onChangeTemplate:d,onDelete:a,onClose:u}){const{t:f}=ne();return!e||!s?null:Se.createPortal(t.jsxs("div",{className:"fixed menu-popover",style:{top:s.top,left:s.left,width:192},role:"menu",children:[t.jsx("button",{onClick:()=>{u(),n()},className:"w-full text-left px-4 py-2 hover:bg-white/10 text-gray-100 transition-colors rounded-lg",children:f.workoutActions.reorderExercises}),t.jsx("button",{onClick:()=>{u(),d()},className:"w-full text-left px-4 py-2 hover:bg-white/10 text-gray-100 transition-colors rounded-lg",children:f.workoutActions.changeWorkout}),t.jsx("button",{onClick:()=>{u(),a()},className:"w-full text-left px-4 py-2 text-red-400 hover:bg-red-500/10 transition-colors rounded-lg",children:f.workoutActions.delete})]}),document.body)}function st({normalizedDate:e,exercisesLength:s,scrollKey:n,location:d}){const[a,u]=i.useState(!1),f=i.useRef(!1),l=i.useRef(0),k=i.useRef(!1),D=i.useRef(!1);return i.useEffect(()=>{k.current=!1,D.current=!1},[e,d.key]),i.useEffect(()=>{if(!e||s===0||D.current)return;const S=()=>{var $;const I=($=d.state)==null?void 0:$.focusExerciseId;if(!I||k.current)return!1;const h=document.getElementById(`exercise-${I}`);if(!h)return!1;k.current=!0,f.current=!0;const F=document.querySelector(".header-container"),C=F?F.getBoundingClientRect().bottom:0,W=12,B=h.getBoundingClientRect(),R=Math.max(0,window.scrollY+B.top-C-W);return window.scrollTo({top:R,behavior:"smooth"}),h.animate&&h.animate([{boxShadow:"0 0 0 rgba(59,130,246,0)"},{boxShadow:"0 0 0 4px rgba(59,130,246,0.6)"},{boxShadow:"0 0 0 rgba(59,130,246,0)"}],{duration:1200,easing:"ease-in-out"}),setTimeout(()=>{f.current=!1},600),!0},N=()=>{try{const I=localStorage.getItem(n);if(I){const h=parseInt(I,10);Number.isNaN(h)||(f.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:h,behavior:"auto"}),l.current=h,setTimeout(()=>{f.current=!1},100)})}))}}catch(I){console.error("Error restoring scroll:",I)}};S()||N(),D.current=!0},[e,s,n,d.state]),i.useEffect(()=>{if(!e)return;let S=!1;const N=()=>{l.current=window.scrollY,u(window.scrollY>0),!S&&!f.current&&(window.requestAnimationFrame(()=>{try{localStorage.setItem(n,String(l.current))}catch{}S=!1}),S=!0)};return window.addEventListener("scroll",N,{passive:!0}),()=>window.removeEventListener("scroll",N)},[e,n]),i.useEffect(()=>()=>{if(e&&l.current>0)try{localStorage.setItem(n,String(l.current))}catch{}},[e,n]),{isScrolling:a}}const G=new Map,Ee=3e4,rt=e=>{if(!e)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const s=new Date(e);return Number.isNaN(s.getTime())?null:Oe(s)};function ot(){const{date:e}=$e(),{user:s}=Ae(),n=Me(),d=Y,a=i.useMemo(()=>rt(e),[e]),u=a?`workout-page:${a}`:"workout-page",[f,l]=qe({key:u,initialState:{workout:null,exercises:[],templates:[],loading:!0,isCreating:!1,isSelectTemplateOpen:!1,hasInitialData:!1,isAddingExercise:!1,workoutName:"",isSavingWorkoutName:!1,isCardio:!1,isSavingCardio:!1,workoutIcon:null,workoutNotes:"",isSavingNotes:!1},ttl:1800*1e3}),{workout:k,exercises:D,templates:S,loading:N,isCreating:T,isSelectTemplateOpen:I,hasInitialData:h,isAddingExercise:F,workoutName:C,isSavingWorkoutName:W,isCardio:B,isSavingCardio:R,workoutIcon:$,workoutNotes:J,isSavingNotes:j}=f,r=i.useCallback(o=>l(x=>({...x,workout:o,workoutName:(o==null?void 0:o.name)??"",isSavingWorkoutName:!1,isCardio:(o==null?void 0:o.is_cardio)??!1,isSavingCardio:!1,workoutIcon:(o==null?void 0:o.icon)??null,workoutNotes:(o==null?void 0:o.notes)??"",isSavingNotes:!1})),[l]),c=i.useCallback(o=>l(x=>({...x,exercises:typeof o=="function"?o(x.exercises):o})),[l]),b=i.useCallback(o=>l(x=>({...x,templates:typeof o=="function"?o(x.templates):o})),[l]),p=i.useCallback(o=>l(x=>({...x,loading:o})),[l]),y=i.useCallback(o=>l(x=>({...x,isCreating:o})),[l]),E=i.useCallback(o=>l(x=>({...x,isSelectTemplateOpen:o})),[l]),A=i.useCallback(o=>l(x=>({...x,hasInitialData:o})),[l]),L=i.useCallback(o=>l(x=>({...x,isAddingExercise:o})),[l]),P=i.useCallback(o=>l(x=>({...x,workoutName:o})),[l]),Z=i.useCallback(o=>l(x=>({...x,isSavingWorkoutName:o})),[l]),q=i.useCallback(o=>l(x=>({...x,isCardio:o})),[l]),X=i.useCallback(o=>l(x=>({...x,isSavingCardio:o})),[l]),ee=i.useCallback(o=>l(x=>({...x,workoutIcon:o})),[l]),te=i.useCallback(o=>l(x=>({...x,workoutNotes:o})),[l]),se=i.useCallback(o=>l(x=>({...x,isSavingNotes:o})),[l]),w=i.useCallback(async(o=!1,x=!1)=>{if(!s||!a){r(null),c([]),p(!1),A(!0);return}const v=`${s.id}:${a}`,M=Date.now();if(G.has(v)){const _=G.get(v),O=M-_.timestamp;if(o&&O<Ee){h||(r(_.workout),c(_.exercises),p(!1),A(!0));return}O>=Ee&&(h||(r(_.workout),c(_.exercises),A(!0)),x=!0)}x||p(!0);const{data:z,error:V}=await d.from("workouts").select("*").eq("user_id",s.id).eq("workout_date",a).order("created_at",{ascending:!1}).limit(1);let m=(z==null?void 0:z[0])??null;if(V)console.error("Error fetching workout:",V);else if(m){if(m.template_id&&!m.icon)try{const{data:K}=await d.from("workout_templates").select("icon").eq("id",m.template_id).single();K!=null&&K.icon&&(m={...m,icon:K.icon},d.from("workouts").update({icon:K.icon}).eq("id",m.id).then(()=>{},()=>{}))}catch{}r(m);const{data:_,error:O}=await d.from("workout_exercises").select("id, name, sets, reps, rest_seconds, position, workout_id, workout_sets ( id, workout_exercise_id, set_index, weight, reps, is_done, is_dropset, parent_set_index, updated_at )").eq("workout_id",m.id).order("position");if(O)console.error("Error fetching exercises:",O);else{const K=_||[];K.forEach(ie=>{ie.workout_sets&&ie.workout_sets.sort((re,oe)=>{const le=re.is_dropset??!1,me=oe.is_dropset??!1,de=le?re.parent_set_index??re.set_index:re.set_index,ce=me?oe.parent_set_index??oe.set_index:oe.set_index;return de!==ce?de-ce:le!==me?le?1:-1:re.set_index-oe.set_index})}),c(K),G.set(v,{workout:m,exercises:K,timestamp:M})}}else r(null),c([]),G.set(v,{workout:null,exercises:[],timestamp:M});const g=s?`templates-cache:${s.id}`:void 0;if(g)try{const _=localStorage.getItem(g);if(_){const O=JSON.parse(_);O.data&&b(O.data)}}catch{}d.from("workout_templates").select("id, name, created_at, user_id, icon, is_archived").eq("user_id",s.id).eq("is_archived",!1).then(({data:_,error:O})=>{if(O)console.error("Error fetching templates:",O.message);else if(b(_||[]),g)try{localStorage.setItem(g,JSON.stringify({ts:Date.now(),data:_}))}catch{}}),p(!1),A(!0)},[s,a,h,r,c,p,A,b]);return i.useEffect(()=>{w()},[w]),i.useEffect(()=>{const o=()=>{document.visibilityState==="visible"&&w(!0)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[w]),i.useEffect(()=>{a&&(localStorage.setItem("lastWorkoutPath",`/workout/${a}`),localStorage.setItem("lastWorkoutTimestamp",Date.now().toString()))},[a]),{user:s,normalizedDate:a,location:n,workout:k,exercises:D,templates:S,loading:N,isCreating:T,isSelectTemplateOpen:I,hasInitialData:h,isAddingExercise:F,workoutName:C,isSavingWorkoutName:W,isCardio:B,isSavingCardio:R,workoutIcon:$,workoutNotes:J,isSavingNotes:j,setPageState:l,setWorkout:r,setExercises:c,setTemplates:b,setLoading:p,setIsCreating:y,setIsSelectTemplateOpen:E,setHasInitialData:A,setIsAddingExercise:L,setWorkoutName:P,setIsSavingWorkoutName:Z,setIsCardio:q,setIsSavingCardio:X,setWorkoutIcon:ee,setWorkoutNotes:te,setIsSavingNotes:se,fetchWorkoutData:w}}function nt({user:e,normalizedDate:s,workout:n,exercises:d,setPageState:a,setWorkout:u,setExercises:f,setIsCreating:l,setIsAddingExercise:k,setWorkoutName:D,setIsSelectTemplateOpen:S,fetchWorkoutData:N,isAddingExercise:T}){const I=Te(),h=Y,F=i.useCallback(r=>{a(c=>{const b=c.exercises.map(p=>p.id===r.id?r:p);if(e&&s&&c.workout){const p=`${e.id}:${s}`;G.set(p,{workout:c.workout,exercises:b,timestamp:Date.now()})}return{...c,exercises:b}})},[e,s,a]),C=i.useCallback(r=>{a(c=>{const b=c.exercises.filter(p=>String(p.id)!==String(r));if(e&&s&&c.workout){const p=`${e.id}:${s}`;G.set(p,{workout:c.workout,exercises:b,timestamp:Date.now()})}return{...c,exercises:b}})},[e,s,a]),W=i.useCallback(async()=>{if(!(!e||!s||!n||T)){k(!0);try{const r=d.length>0?Math.max(...d.map(P=>typeof P.position=="number"?P.position:0))+1:1,{data:c,error:b}=await h.from("workout_exercises").insert({workout_id:n.id,name:"",sets:1,reps:"",rest_seconds:150,position:r}).select("id, name, sets, reps, rest_seconds, position, workout_id");if(b)throw b;const p=c==null?void 0:c[0];if(!p)throw new Error(U().hooks.failedToCreateExercise);const{data:y,error:E}=await h.from("workout_sets").insert({workout_exercise_id:p.id,set_index:1,weight:null,reps:null,is_done:!1,is_dropset:!1,updated_at:new Date().toISOString()}).select("id, workout_exercise_id, set_index, weight, reps, is_done, is_dropset, updated_at");if(E)throw E;const A=y==null?void 0:y[0];if(!A)throw new Error(U().hooks.failedToCreateSet);const L={...p,workout_sets:[A]};a(P=>{if(!P.workout)return P;const Z=[...P.exercises,L].sort((q,X)=>q.position-X.position);if(e&&s){const q=`${e.id}:${s}`,X=G.get(q);X&&G.set(q,{workout:X.workout,exercises:Z,timestamp:Date.now()})}return{...P,exercises:Z}})}catch(r){console.error("Failed to add exercise:",r),alert(U().hooks.failedToAddExercise)}finally{k(!1)}}},[e,s,n,d,T,a,k]),B=i.useCallback(async()=>{if(!(!e||!s)){l(!0);try{const{data:r,error:c}=await h.from("workouts").insert({user_id:e.id,workout_date:s,name:U().hooks.newWorkout,template_id:null}).select().single();if(c)throw c;if(!r)throw new Error(U().hooks.failedToCreateWorkoutEntry);u(r),f([]),D(r.name);const b=`${e.id}:${s}`;G.set(b,{workout:r,exercises:[],timestamp:Date.now()})}catch(r){console.error("Failed to create custom workout:",r),alert(U().hooks.failedToCreateWorkoutTryAgain)}finally{l(!1)}}},[e,s,l,u,f,D]),R=i.useCallback(async r=>{if(!(!e||!s)){l(!0);try{const[{data:c},{data:b}]=await Promise.all([h.from("template_exercises").select("*").eq("template_id",r.id),h.from("workout_templates").select("id, name, icon").eq("id",r.id).single()]),p=(b==null?void 0:b.icon)??r.icon??null,y=(b==null?void 0:b.name)??r.name,{data:E}=await h.from("workouts").insert({user_id:e.id,workout_date:s,name:y,template_id:r.id,icon:p}).select().single();if(!E)throw new Error("Failed to create workout entry.");const A=(c||[]).map(q=>({workout_id:E.id,name:q.name,sets:q.sets,reps:q.reps,rest_seconds:q.rest_seconds,position:q.position})),{data:L}=await h.from("workout_exercises").insert(A).select();if(!L)throw new Error("Failed to create workout exercises.");const P=L.flatMap(q=>Array.from({length:q.sets},(X,ee)=>({workout_exercise_id:q.id,set_index:ee+1})));await h.from("workout_sets").insert(P);const Z=`${e.id}:${s}`;G.delete(Z),await N()}catch(c){console.error("Failed to create workout from template:",c),alert(U().hooks.failedToCreateFromTemplate+c.message)}finally{l(!1)}}},[e,s,l,N]),$=i.useCallback(async r=>{if(!(!e||!s||!n))try{l(!0);const[{data:c,error:b},{data:p,error:y}]=await Promise.all([h.from("template_exercises").select("*").eq("template_id",r.id),h.from("workout_templates").select("id, name, icon").eq("id",r.id).single()]);if(b)throw b;if(y)throw y;const{data:E,error:A}=await h.from("workout_exercises").select("id").eq("workout_id",n.id);if(A)throw A;const L=(E||[]).map(o=>o.id);if(L.length>0){const{error:o}=await h.from("workout_sets").delete().in("workout_exercise_id",L);if(o)throw o;const{error:x}=await h.from("workout_exercises").delete().eq("workout_id",n.id);if(x)throw x}const P=(p==null?void 0:p.icon)??r.icon??null,Z=(p==null?void 0:p.name)??r.name,{error:q}=await h.from("workouts").update({name:Z,template_id:r.id,icon:P}).eq("id",n.id);if(q)throw q;const X=(c||[]).map(o=>({workout_id:n.id,name:o.name,sets:o.sets,reps:o.reps,rest_seconds:o.rest_seconds,position:o.position})),{data:ee,error:te}=await h.from("workout_exercises").insert(X).select();if(te)throw te;const se=(ee||[]).flatMap(o=>Array.from({length:o.sets},(x,v)=>({workout_exercise_id:o.id,set_index:v+1})));if(se.length>0){const{error:o}=await h.from("workout_sets").insert(se);if(o)throw o}const w=`${e.id}:${s}`;G.delete(w),S(!1),await N()}catch(c){console.error("Failed to replace workout from template:",c),alert(U().hooks.failedToChangeWorkout+c.message)}finally{l(!1)}},[e,s,n,l,S,N]),J=i.useCallback(async()=>{if(!n)return;const{error:r}=await h.from("workouts").delete().eq("id",n.id);if(r){console.error("Error deleting workout:",r),alert(U().hooks.failedToDeleteWorkout);return}if(e&&s){const c=`${e.id}:${s}`;G.delete(c)}I("/calendar",{state:{removedDate:s}})},[n,e,s,I]),j=i.useCallback(async r=>{if(!e||!n)return;const c=new Map(r.map((p,y)=>[p.id,y+1]));f(p=>{const y=p.map(E=>({...E,position:c.get(E.id)??E.position}));return y.sort((E,A)=>(E.position??0)-(A.position??0)),y});const b=r.map((p,y)=>({id:p.id,position:y+1}));try{if(await Promise.all(b.map(async p=>{const{error:y}=await h.from("workout_exercises").update({position:p.position}).eq("id",p.id);if(y)throw y})),e&&s){const p=`${e.id}:${s}`,y=G.get(p);if(y){const E=[...y.exercises].map(A=>({...A,position:c.get(A.id)??A.position})).sort((A,L)=>(A.position??0)-(L.position??0));G.set(p,{workout:y.workout,exercises:E,timestamp:Date.now()})}}}catch(p){console.error("Failed to save new order:",p),alert(U().hooks.failedToSaveOrder),await N()}},[e,n,s,f,N]);return{handleUpdateExercise:F,handleDeleteExercise:C,handleAddExercise:W,handleCreateCustomWorkout:B,handleCreateWorkout:R,handleReplaceWithTemplate:$,handleDeleteWorkout:J,handleSaveNewOrder:j}}function it({user:e,normalizedDate:s,workout:n,exercises:d,workoutName:a,workoutIcon:u,setWorkout:f,setWorkoutName:l,setIsSavingWorkoutName:k}){const D=Y,S=i.useRef(null),[N,T]=i.useState(!1),[I,h]=i.useState(a),[F,C]=i.useState(u),[W,B]=i.useState(!1);i.useEffect(()=>{N&&S.current&&(S.current.focus(),S.current.select())},[N]);const R=i.useCallback(()=>{h(a),C(u),T(!0)},[a,u]),$=i.useCallback(async()=>{if(!e||!s||!n)return;const p=I.trim();if(p.length===0){h(a),C(u),T(!1);return}const y=p!==n.name,E=F!==n.icon;if(!y&&!E){T(!1);return}k(!0);try{const A={};y&&(A.name=p),E&&(A.icon=F);const{data:L,error:P}=await D.from("workouts").update(A).eq("id",n.id).select().single();if(P)throw P;if(!L)throw new Error(U().hooks.failedToUpdateWorkout);f(L),h(p),C(L.icon),T(!1);const Z=`${e.id}:${s}`;G.set(Z,{workout:L,exercises:d,timestamp:Date.now()})}catch(A){console.error("Failed to update workout:",A),alert(U().hooks.failedToSaveChanges)}finally{k(!1)}},[e,s,n,d,I,F,a,u,f,k]),J=i.useCallback(()=>{h(a),C(u),T(!1)},[a,u]),j=i.useCallback(()=>{B(!0)},[]),r=i.useCallback(p=>{C(p)},[]),c=i.useCallback(async()=>{if(!e||!s||!n)return;const p=a.trim();if(p.length===0){l(n.name);return}if(p!==n.name){k(!0);try{const{data:y,error:E}=await D.from("workouts").update({name:p}).eq("id",n.id).select().single();if(E)throw E;if(!y)throw new Error(U().hooks.failedToUpdateWorkoutName);f(y);const A=`${e.id}:${s}`;G.set(A,{workout:y,exercises:d,timestamp:Date.now()})}catch(y){console.error("Failed to update workout name:",y),alert(U().hooks.failedToSaveName),l(n.name)}finally{k(!1)}}},[e,s,n,d,a,f,l,k]),b=i.useCallback(p=>{p.key==="Enter"&&p.currentTarget.blur()},[]);return{inputRef:S,isEditingName:N,editNameValue:I,editIconValue:F,isIconPickerOpen:W,setIsIconPickerOpen:B,setEditNameValue:h,handleStartEditName:R,handleSaveEditName:$,handleCancelEditName:J,handleOpenIconPicker:j,handleIconChange:r,handleSaveWorkoutName:c,handleWorkoutNameKeyDown:b}}function at({user:e,normalizedDate:s,workout:n,exercises:d,isCardio:a,setIsCardio:u,setIsSavingCardio:f,setWorkout:l}){const k=Y;return{handleToggleCardio:i.useCallback(async()=>{if(!e||!s||!n)return;const S=!a;u(S),f(!0);try{const{data:N,error:T}=await k.from("workouts").update({is_cardio:S}).eq("id",n.id).select().single();if(T)throw T;if(!N)throw new Error(U().hooks.failedToUpdateCardio);l(N);const I=`${e.id}:${s}`;G.set(I,{workout:N,exercises:d,timestamp:Date.now()})}catch(N){console.error("Failed to update cardio status:",N),alert(U().hooks.failedToSaveCardio),u(!S)}finally{f(!1)}},[e,s,n,d,a,u,f,l])}}function ct({user:e,normalizedDate:s,workout:n,workoutNotes:d,setIsSavingNotes:a}){const u=Y,f=xe(d,800),l=i.useRef(d);i.useEffect(()=>{l.current=d},[d]),i.useEffect(()=>{if(!e||!s||!n||f===(n.notes??""))return;(async()=>{a(!0);try{const{error:D}=await u.from("workouts").update({notes:f||null}).eq("id",n.id);if(D)throw D;const S=`${e.id}:${s}`,N=G.get(S);N&&N.workout&&G.set(S,{...N,workout:{...N.workout,notes:f||null},timestamp:Date.now()})}catch(D){console.error("Failed to save notes:",D)}finally{a(!1)}})()},[f,e,s,n==null?void 0:n.id,a])}function ye(e,s,n){const d=e.slice(),[a]=d.splice(s,1);return d.splice(n,0,a),d}const lt=({open:e,items:s,onClose:n,onSave:d})=>{const{t:a}=ne(),[u,f]=i.useState([]),l=i.useRef(null),[k,D]=i.useState(!1),[S,N]=i.useState(null),T=i.useRef(0),I=i.useRef(null),h=i.useMemo(()=>s.slice().sort((r,c)=>(r.position??0)-(c.position??0)),[s]);if(i.useEffect(()=>{e&&f(h)},[e,h]),Re(e),!e)return null;const F=(r,c)=>{c<0||c>=u.length||f(b=>ye(b,r,c))},C=r=>c=>{l.current=r,c.dataTransfer.effectAllowed="move"},W=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move"},B=r=>c=>{c.preventDefault();const b=l.current;if(l.current=null,b==null||b===r)return;const p=u.findIndex(E=>E.id===b),y=u.findIndex(E=>E.id===r);p===-1||y===-1||f(E=>ye(E,p,y))},R=r=>c=>{const b=c.touches[0];T.current=b.clientY,N(r)},$=r=>{if(!S)return;const b=r.touches[0].clientY,p=b-T.current,y=u.findIndex(L=>L.id===S);if(y===-1)return;const A=Math.round(p/60);if(Math.abs(A)>=1){const L=y+A;L>=0&&L<u.length&&L!==y&&(f(P=>ye(P,y,L)),T.current=b)}},J=()=>{N(null)},j=async()=>{D(!0);try{await d(u.map((r,c)=>({...r,position:c+1}))),n()}finally{D(!1)}};return Se.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 overscroll-contain",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:n}),t.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-4",children:[t.jsx("h2",{className:"text-lg font-semibold mb-3",children:a.reorderExercises.title}),t.jsx("ol",{ref:I,className:"space-y-2 max-h-[55vh] overflow-y-auto pr-1",onTouchMove:$,onTouchEnd:J,children:u.map((r,c)=>t.jsxs("li",{draggable:!0,onDragStart:C(r.id),onDragOver:W,onDrop:B(r.id),className:`rounded-lg p-2 flex items-center gap-2 hover:bg-white/5 transition-colors ${S===r.id?"bg-white/20 scale-105":""}`,children:[t.jsxs("span",{className:"select-none w-6 text-center opacity-70",children:[c+1,"."]}),t.jsx("button",{type:"button","aria-label":a.reorderExercises.drag,className:"cursor-grab px-2 py-1 rounded-md bg-white/5 hover:bg-white/10 active:cursor-grabbing touch-none",draggable:!0,onDragStart:C(r.id),onTouchStart:R(r.id),children:"⋮⋮"}),t.jsx("div",{className:"flex-1 whitespace-normal break-words leading-snug",children:r.name||a.reorderExercises.noName}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:()=>F(c,c-1),disabled:c===0,children:"↑"}),t.jsx("button",{type:"button",className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:()=>F(c,c+1),disabled:c===u.length-1,children:"↓"})]})]},r.id))}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:n,disabled:k,children:a.common.cancel}),t.jsx("button",{className:"btn-glass btn-glass-sm btn-glass-primary",onClick:j,disabled:k,children:k?a.reorderExercises.saving:a.common.save})]})]})]}),document.body)},dt=({open:e,value:s,onClose:n,onChange:d})=>{const{t:a}=ne();if(!e)return null;const u=Object.keys(_e),f=l=>{d(l),n()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:n,children:t.jsxs("div",{className:"glass card-dark p-4 rounded-xl w-[90%] max-w-sm mx-auto",onClick:l=>l.stopPropagation(),children:[t.jsx("h2",{className:"text-lg font-semibold text-white mb-4 text-center",children:a.workoutIconPicker.title}),t.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[t.jsxs("button",{type:"button",onClick:()=>f(null),className:`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${s===null?"bg-white/20 ring-2 ring-white/50":"bg-white/5 hover:bg-white/10"}`,children:[t.jsx("div",{className:"w-10 h-10 flex items-center justify-center text-gray-500",children:t.jsx("svg",{viewBox:"0 0 24 24",width:"28",height:"28",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:t.jsx("circle",{cx:"12",cy:"12",r:"9",strokeDasharray:"4 2"})})}),t.jsx("span",{className:"text-[10px] mt-1 text-gray-400",children:a.workoutIconPicker.none})]}),u.map(l=>{const{component:k,label:D}=_e[l],S=s===l;return t.jsxs("button",{type:"button",onClick:()=>f(l),className:`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${S?"bg-white/20 ring-2 ring-white/50":"bg-white/5 hover:bg-white/10"}`,children:[t.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:t.jsx(k,{size:28})}),t.jsx("span",{className:"text-[10px] mt-1 text-gray-300",children:D})]},l)})]}),t.jsx("button",{type:"button",onClick:n,className:"mt-4 w-full py-2 text-gray-400 hover:text-white transition-colors",children:a.common.cancel})]})})},_t=()=>{const{t:e}=ne(),s=ot(),{user:n,normalizedDate:d,location:a,workout:u,exercises:f,templates:l,isCreating:k,isSelectTemplateOpen:D,hasInitialData:S,isAddingExercise:N,workoutName:T,isSavingWorkoutName:I,isCardio:h,isSavingCardio:F,workoutIcon:C,workoutNotes:W,isSavingNotes:B,setPageState:R,setWorkout:$,setExercises:J,setIsCreating:j,setIsSelectTemplateOpen:r,setIsAddingExercise:c,setWorkoutName:b,setIsSavingWorkoutName:p,setIsCardio:y,setIsSavingCardio:E,setWorkoutNotes:A,setIsSavingNotes:L,fetchWorkoutData:P}=s,{isActionsOpen:Z,menuPos:q,actionsRef:X,actionsBtnRef:ee,toggleActions:te,closeActions:se}=Be(),{handleUpdateExercise:w,handleDeleteExercise:o,handleAddExercise:x,handleCreateCustomWorkout:v,handleCreateWorkout:M,handleReplaceWithTemplate:z,handleDeleteWorkout:V,handleSaveNewOrder:m}=nt({user:n,normalizedDate:d,workout:u,exercises:f,setPageState:R,setWorkout:$,setExercises:J,setIsCreating:j,setIsAddingExercise:c,setWorkoutName:b,setIsSelectTemplateOpen:r,fetchWorkoutData:P,isAddingExercise:N}),{inputRef:g,isEditingName:_,editNameValue:O,editIconValue:K,isIconPickerOpen:ie,setIsIconPickerOpen:re,setEditNameValue:oe,handleStartEditName:le,handleSaveEditName:me,handleCancelEditName:de,handleOpenIconPicker:ce,handleIconChange:ge}=it({user:n,normalizedDate:d,workout:u,exercises:f,workoutName:T,workoutIcon:C,setWorkout:$,setWorkoutName:b,setIsSavingWorkoutName:p}),{handleToggleCardio:he}=at({user:n,normalizedDate:d,workout:u,exercises:f,isCardio:h,setIsCardio:y,setIsSavingCardio:E,setWorkout:$});ct({user:n,normalizedDate:d,workout:u,workoutNotes:W,setIsSavingNotes:L});const[ke,H]=i.useState(!1),[ue,Q]=i.useState(!1),fe=`scroll:workout:${d??""}`,{isScrolling:pe}=st({normalizedDate:d,exercisesLength:f.length,scrollKey:fe,location:a});return Re(D),S?d?u?t.jsxs("div",{className:"relative px-4 space-y-4 pt-4 pb-10",children:[t.jsx("div",{className:`status-bar-blur ${pe?"visible":""}`}),t.jsx(Qe,{normalizedDate:d,workoutName:T,isEditingName:_,editNameValue:O,isSavingWorkoutName:I,isScrolling:pe,inputRef:g,onStartEditName:le,onChangeEditName:oe,onSaveEditName:me,onCancelEditName:de,actionsRef:X,actionsBtnRef:ee,onToggleActions:te,workoutIcon:C,editIconValue:K,onOpenIconPicker:ce}),t.jsx("div",{className:"space-y-4",children:f.map(ae=>t.jsx(Xe,{exercise:ae,workoutDate:d,onUpdateExercise:w,onDeleteExercise:o},ae.id))}),t.jsx(ze,{isCardio:h,isSaving:F,onToggle:he}),t.jsx(et,{notes:W,isSaving:B,onChange:A}),t.jsx("div",{children:t.jsx("button",{type:"button",onClick:x,disabled:N,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:N?e.workout.adding:e.workout.addExercise})}),t.jsx(Ze,{open:D,templates:l,isCreating:k,onClose:()=>r(!1),onReplaceWithTemplate:z}),t.jsx(lt,{open:ue,onClose:()=>Q(!1),items:f.map(ae=>({id:ae.id,name:ae.name,position:ae.position??0})),onSave:m}),t.jsx(De,{open:ke,onOpenChange:H,title:e.workout.deleteWorkout,description:e.workout.deleteWorkoutDesc.replace("{date}",be(d)),confirmText:e.common.delete,cancelText:e.common.cancel,variant:"danger",onConfirm:V}),t.jsx(dt,{open:ie,value:K,onClose:()=>re(!1),onChange:ge}),t.jsx(tt,{isOpen:Z,menuPos:q,onReorder:()=>Q(!0),onChangeTemplate:()=>r(!0),onDelete:()=>H(!0),onClose:se})]}):t.jsx(Ue,{normalizedDate:d,templates:l,isCreating:k,onCreateWorkout:M,onCreateCustomWorkout:v}):null:t.jsx(Ie,{message:e.common.loading})};export{_t as default};
