import{u as W,a as C,s as g,j as e,W as q}from"./index-CZDbzh2k.js";import{d as z,r as m,e as S,L as M}from"./vendor-CITejod9.js";import{u as P}from"./usePageState-Qdkxdikz.js";import{C as E}from"./confirm-dialog-DnjLLOQ0.js";import{W as j}from"./workout-icons-Cnx9g7i9.js";import"./supabase-vtL5VWMt.js";import"./charts-D-QCyllA.js";import"./use-modal-scroll-lock-CmZrgGCz.js";const $=({id:n,name:w,onDeleted:s})=>{const{t:a}=C(),[i,d]=m.useState(!1),[x,o]=m.useState(!1),b=async()=>{if(!i){d(!0);try{const{error:p}=await g.from("template_exercises").delete().eq("template_id",n);if(p)throw p;const{error:h}=await g.from("workout_templates").delete().eq("id",n);if(h)throw h;s(n),o(!1)}catch(p){console.error("Error deleting template forever",p),alert(a.templates.deleteError)}finally{d(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>o(!0),disabled:i,className:"btn-glass btn-glass-danger btn-glass-sm disabled:opacity-50",children:i?a.templates.deleting:a.templates.delete}),e.jsx(E,{open:x,onOpenChange:o,title:a.templates.deleteConfirm,description:a.templates.deleteConfirmDesc,confirmText:a.common.delete,cancelText:a.common.cancel,variant:"danger",onConfirm:b})]})},X=()=>{const{user:n}=W(),w=z(),{t:s}=C(),[a,i]=m.useState([]),[d,x]=m.useState(!1),[o,b]=m.useState(!1),[p,h]=m.useState(!1),[v,f]=P({key:"templates-archive-page",initialState:{templates:[],loading:!0},ttl:1800*1e3}),{templates:c,loading:y}=v,N=c.length>0&&a.length===c.length,_=t=>{f(l=>({...l,templates:t,loading:!1}))},T=t=>{f(l=>({...l,loading:t}))},u=S.useCallback(async()=>{if(!n)return;v.templates.length>0||T(!0);const{data:l,error:r}=await g.from("workout_templates").select("id, name, created_at, user_id, icon, is_archived").eq("user_id",n.id).eq("is_archived",!0).order("created_at",{ascending:!1});r?(console.error("Error fetching archived templates:",r),alert(s.templates.archiveLoadError)):_(l||[])},[n,v.templates.length]);m.useEffect(()=>{u()},[n,u]);const D=t=>{i(l=>l.includes(t)?l.filter(r=>r!==t):[...l,t])},L=()=>{c.length!==0&&i(t=>t.length===c.length?[]:c.map(l=>l.id))},R=()=>i([]),O=async()=>{if(n&&a.length!==0&&!d){x(!0);try{const{error:t}=await g.from("workout_templates").update({is_archived:!1}).in("id",a);if(t)throw t;f(l=>({...l,templates:l.templates.filter(r=>!a.includes(r.id))})),i([]),u()}catch(t){console.error("Error restoring templates",t),alert(s.templates.restoreError)}finally{x(!1)}}},A=async()=>{if(n&&a.length!==0&&!o){b(!0);try{const t=a,{error:l}=await g.from("template_exercises").delete().in("template_id",t);if(l)throw l;const{error:r}=await g.from("workout_templates").delete().in("id",t);if(r)throw r;f(k=>({...k,templates:k.templates.filter(B=>!t.includes(B.id))})),i([]),h(!1),u()}catch(t){console.error("Error deleting selected templates",t),alert(s.templates.deleteError)}finally{b(!1)}}},I=t=>{f(l=>({...l,templates:l.templates.filter(r=>r.id!==t)})),u()};return e.jsxs("div",{className:"p-4 pb-24",children:[e.jsxs("div",{className:"mb-4 glass card-dark p-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>w("/templates"),className:"shrink-0 p-2 rounded-full border border-transparent text-white hover:border-white transition-colors","aria-label":s.common.back,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-center flex-1",children:s.templates.archive})]}),!y&&c.length>0&&e.jsxs("div",{className:"mb-4 glass card-dark p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300",children:[e.jsxs("button",{type:"button",onClick:L,className:"inline-flex items-center gap-3",children:[e.jsx("div",{className:`archive-checkbox w-6 h-6 rounded-md border flex items-center justify-center ${N?"bg-green-500 border-green-400":"border-white/40"}`,children:N&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:s.templates.selectAll})]}),e.jsx("button",{type:"button",onClick:R,disabled:a.length===0,className:"text-sm text-gray-400 hover:text-gray-200 disabled:opacity-40",children:s.templates.clearSelection})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:O,disabled:a.length===0||d||o,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:d?s.templates.restoring:s.templates.restoreSelected}),e.jsx("button",{type:"button",onClick:()=>h(!0),disabled:a.length===0||d||o,className:"btn-glass btn-glass-full btn-glass-md btn-glass-danger disabled:opacity-50",children:o?s.templates.deletingSelected:s.templates.deleteSelected})]})})]}),y?e.jsx(q,{message:s.templates.archiveLoading}):c.length===0?e.jsx("div",{className:"mt-4 p-8 text-center glass",children:e.jsx("p",{className:"text-gray-500",children:s.templates.archiveEmpty})}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"relative p-4 glass card-dark flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>D(t.id),className:"shrink-0","aria-label":s.templates.selectAll,children:e.jsx("div",{className:`archive-checkbox w-7 h-7 rounded-md border flex items-center justify-center ${a.includes(t.id)?"bg-green-500 border-green-400":"border-white/40"}`,children:a.includes(t.id)&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),e.jsxs(M,{to:`/templates/${t.id}`,state:{from:"archive"},className:"text-left flex-1 hover:opacity-90 flex items-center gap-3",children:[t.icon&&j[t.icon]&&e.jsx("div",{style:{color:j[t.icon].color},children:S.createElement(j[t.icon].component,{size:24})}),e.jsx("h2",{className:"font-semibold text-lg text-gray-100",children:t.name})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{id:t.id,name:t.name,onDeleted:I})})]},t.id))}),e.jsx(E,{open:p,onOpenChange:h,title:s.templates.deleteConfirm,description:s.templates.deleteConfirmDesc,confirmText:s.common.delete,cancelText:s.common.cancel,variant:"danger",onConfirm:A})]})};export{X as default};
