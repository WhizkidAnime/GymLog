import{u as fe,s as F,j as e,W as Me}from"./index-42bJkKlu.js";import{r as s,e as Ee}from"./vendor-BVca5W6X.js";import{n as q,p as Le}from"./exercise-name-BJxyXXn3.js";import{u as We}from"./use-header-scroll-Cg2zr4na.js";import{u as $e}from"./use-scroll-restoration-CZtb4aM8.js";import{u as Ie}from"./use-modal-scroll-lock-DlG-D3y9.js";import{u as me}from"./usePageState-6XNG0ilq.js";import{R as Re,L as Pe,C as Oe,X as Fe,Y as Te,T as ze,a as Be}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";function Ye(){const{user:h}=fe(),c=s.useRef(null),p=s.useRef(new Map),$=300*1e3,y=s.useRef(!1),_=s.useRef(void 0),[N,i]=me({key:"progress-page:exercises",initialState:{loaded:!1,exercises:[]},ttl:600*1e3}),[K,T]=s.useState(()=>!N.loaded),[A,D]=s.useState(null),[te,b]=s.useState(!1),[U,I]=me({key:"progress-page",initialState:{searchQuery:"",selectedExercise:null},ttl:1800*1e3}),{searchQuery:V,selectedExercise:z}=U,X=d=>{I(m=>({...m,searchQuery:d}))},B=d=>{I(m=>({...m,selectedExercise:d}))},R=s.useCallback(async()=>{if(!h)return[];if(c.current)return c.current;const{data:d,error:m}=await F.from("workouts").select("id").eq("user_id",h.id);if(m)throw m;const x=(d||[]).map(M=>M.id);return c.current=x,x},[h]),P=s.useCallback(async(d=!1)=>{if(h){d||T(!0);try{const m=await R();if(m.length===0){i({loaded:!0,exercises:[]});return}const{data:x,error:M}=await F.from("exercise_progress_view").select("workout_id, exercise_id, max_weight").in("workout_id",m);if(M)throw M;const u=new Map;if((x||[]).forEach(j=>{const g=j.exercise_id,l=j.max_weight||0;if(!g||l<=0)return;const C=u.get(g)||0;u.set(g,C+1)}),u.size===0){i({loaded:!0,exercises:[]});return}const{data:Y,error:k}=await F.from("workout_exercises").select("id, name").in("id",Array.from(u.keys()));if(k)throw k;const E=q,L=new Map;(Y||[]).forEach(j=>{const g=(j.name??"").trim();if(!g)return;const l=E(g),C=u.get(j.id)||0;if(C<=0)return;const S=L.get(l);S?L.set(l,{name:S.name.length>=g.length?S.name:g,total:S.total+C}):L.set(l,{name:g,total:C})});const H=Array.from(L.values()).map(({name:j,total:g})=>({name:j,totalSets:g})).sort((j,g)=>j.name.localeCompare(g.name,"ru"));i({loaded:!0,exercises:H})}catch(m){console.error("Error fetching progress exercises:",m),d||(alert("Не удалось загрузить список упражнений"),i({loaded:!0,exercises:[]}))}finally{d||T(!1)}}},[h,R,i]),Q=s.useCallback(async d=>{if(!h||!d){D(null);return}const m=q(d),x=p.current.get(m),M=Date.now();if(x&&M-x.ts<$){D(x.data);return}b(!0);try{const u=await R();if(u.length===0){D({exerciseName:d,dataPoints:[],totalSessions:0,maxWeight:0,minWeight:0}),p.current.set(m,{data:{exerciseName:d,dataPoints:[],totalSessions:0,maxWeight:0,minWeight:0},ts:Date.now()});return}const{data:Y,error:k}=await F.from("workout_exercises").select("id, name, workout_id").in("workout_id",u);if(k)throw k;const E=new Set;if((Y||[]).forEach(l=>{const C=(l.name??"").trim();C&&q(C)===m&&E.add(l.id)}),E.size===0){D({exerciseName:d,dataPoints:[],totalSessions:0,maxWeight:0,minWeight:0});return}const{data:L,error:H}=await F.from("exercise_progress_view").select("workout_date, workout_name, workout_id, exercise_id, max_weight, reps_at_max_weight").in("workout_id",u).in("exercise_id",Array.from(E));if(H)throw H;const j=(L||[]).map(l=>({workout_date:l.workout_date,workout_name:l.workout_name,workout_id:l.workout_id,exercise_id:l.exercise_id,max_weight:l.max_weight,reps_at_max_weight:l.reps_at_max_weight})),g=Le(d,j);D(g),p.current.set(m,{data:g,ts:Date.now()})}catch(u){console.error("Error loading progress data:",u),alert("Не удалось загрузить данные прогресса"),D(null)}finally{b(!1)}},[h,R,$]);return s.useEffect(()=>{h&&(y.current||(y.current=!0,P(N.loaded)))},[P,N.loaded,h]),s.useEffect(()=>{const d=h==null?void 0:h.id;if(_.current===void 0){_.current=d;return}_.current!==d&&(_.current=d,c.current=null,p.current.clear(),y.current=!1,i({loaded:!1,exercises:[]}),T(!0))},[h==null?void 0:h.id,i]),{exercises:N.exercises,loading:K,progressData:A,loadingProgress:te,searchQuery:V,selectedExercise:z,setSearchQuery:X,setSelectedExercise:B,loadProgress:Q}}function re(h,c,p,$){const y=Math.abs(h),_=y%10,N=y%100;return N>=11&&N<=19?$:_===1?c:_>=2&&_<=4?p:$}const ge=F,He=({active:h,payload:c})=>{if(!h||!(c!=null&&c[0]))return null;const p=c[0].payload;return e.jsxs("div",{className:"glass card-dark p-3 rounded-lg shadow-lg border border-white/20",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-1",children:p.workoutName}),e.jsxs("p",{className:"text-base font-bold text-white",children:[p.weight," кг × ",p.reps||"?"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(p.date).toLocaleDateString("ru")})]})},Ze=()=>{var ce,de;const h=Ee(),{user:c}=fe(),{exercises:p,loading:$,progressData:y,loadingProgress:_,searchQuery:N,selectedExercise:i,setSearchQuery:K,setSelectedExercise:T,loadProgress:A}=Ye(),D=s.useRef(null),te=We(),[b,U]=s.useState("all"),[I,V]=s.useState(null),[z,X]=s.useState(null),[B,R]=s.useState(!1),[P,Q]=s.useState(!1),d=s.useRef(null),m=s.useRef(null),[x,M]=s.useState(()=>{try{return localStorage.getItem("progress:activeTab")||"exercises"}catch{return"exercises"}}),[u,Y]=s.useState(3),[k,E]=s.useState([]),[L,H]=s.useState(!1),[j,g]=s.useState(!1),[l,C]=s.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}),S="progress:cardioCache",Z=1800*1e3,ne=s.useRef(!1);Ie(j);const pe=s.useCallback(()=>i?`scroll:progress-page:detail:${q(i||"")}`:"scroll:progress-page:list",[i]),we=t=>{T(t),A(t)},be=t=>{h(`/workout/${t.date}`,{state:{focusExerciseId:t.exerciseId}})},je=()=>{i?(T(null),A(null)):h("/profile")};$e({key:pe(),enabled:!$&&(!i||!_&&!!y)}),s.useEffect(()=>{try{const t="progress:lastSelectedExercise";i?localStorage.setItem(t,i):localStorage.removeItem(t)}catch{}},[i]),s.useEffect(()=>{if(!i)try{const t=localStorage.getItem("progress:lastSelectedExercise");t&&T(t)}catch{}},[]),s.useEffect(()=>{i&&A(i)},[i,A]),s.useEffect(()=>{U("all"),V(null),X(null)},[i]),s.useEffect(()=>{const t=a=>{d.current&&!d.current.contains(a.target)&&R(!1),m.current&&!m.current.contains(a.target)&&Q(!1)};if(B||P)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[B,P]),s.useEffect(()=>{try{localStorage.setItem("progress:activeTab",x)}catch{}},[x]),s.useEffect(()=>{if(!c)return;let t=!1;return(async()=>{var n;try{const{data:r,error:o}=await ge.from("user_settings").select("cardio_weekly_goal").eq("user_id",c.id).limit(1);if(o){console.error("Error loading cardio goal:",o);return}!t&&r&&r.length>0&&typeof((n=r[0])==null?void 0:n.cardio_weekly_goal)=="number"&&Y(r[0].cardio_weekly_goal)}catch(r){console.error("Error loading cardio goal:",r)}finally{t||(ne.current=!0)}})(),()=>{t=!0}},[c]),s.useEffect(()=>{if(!c||!ne.current)return;(async()=>{try{const{error:a}=await ge.from("user_settings").upsert({user_id:c.id,cardio_weekly_goal:u},{onConflict:"user_id"});a&&console.error("Error saving cardio goal:",a)}catch(a){console.error("Error saving cardio goal:",a)}})()},[u,c]),s.useEffect(()=>{if(x!=="cardio"||!c)return;const t=()=>{try{const o=localStorage.getItem(S);if(!o)return null;const v=JSON.parse(o);return Date.now()-(v.timestamp||0)>Z?null:v.data||null}catch{return null}},a=o=>{try{localStorage.setItem(S,JSON.stringify({data:o,timestamp:Date.now()}))}catch{}},n=async(o=!1)=>{o||H(!0);try{const{data:v,error:f}=await F.from("workouts").select("workout_date").eq("user_id",c.id).eq("is_cardio",!0).order("workout_date",{ascending:!1});if(f)throw f;const J=v||[];E(J),a(J)}catch(v){console.error("Error fetching cardio workouts:",v)}finally{o||H(!1)}},r=t();if(r){E(r),n(!0);return}n(!1)},[x,c,S,Z]),s.useEffect(()=>{const t=()=>{if(document.visibilityState!=="visible"||x!=="cardio"||!c)return;const a=localStorage.getItem(S);let n=!0;if(a)try{const r=JSON.parse(a);n=Date.now()-(r.timestamp||0)>Z}catch{n=!0}n&&(async()=>{try{const{data:r,error:o}=await F.from("workouts").select("workout_date").eq("user_id",c.id).eq("is_cardio",!0).order("workout_date",{ascending:!1});!o&&r&&(E(r),localStorage.setItem(S,JSON.stringify({data:r,timestamp:Date.now()})))}catch{}})()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[x,c,S,Z]);const ae=s.useMemo(()=>{if(!l)return[];const[t,a]=l.split("-").map(Number),n=new Date(t,a-1,1),r=new Date(t,a,0);n.setHours(0,0,0,0),r.setHours(23,59,59,999);const o=new Date;o.setHours(0,0,0,0);const v=[];let f=new Date(n);const J=f.getDay(),Ce=J===0?-6:1-J;for(f.setDate(f.getDate()+Ce);f<=r||f.getMonth()===a-1||f.getMonth()===a-2&&f.getDate()>20;){const G=new Date(f),W=new Date(f);if(G.setHours(0,0,0,0),W.setDate(W.getDate()+6),W.setHours(23,59,59,999),W>=n&&G<=r){const Se=k.filter(De=>{const[he,xe,ue]=De.workout_date.split("-").map(Number);if(!he||!xe||!ue)return!1;const se=new Date(he,xe-1,ue);return se.setHours(12,0,0,0),se>=G&&se<=W}).length,_e=o>=G&&o<=W;v.push({weekStart:G.toISOString().slice(0,10),weekEnd:W.toISOString().slice(0,10),weekLabel:`${G.getDate()}.${String(G.getMonth()+1).padStart(2,"0")} - ${W.getDate()}.${String(W.getMonth()+1).padStart(2,"0")}`,count:Se,goal:u,isCurrentWeek:_e})}if(f.setDate(f.getDate()+7),f>r&&f.getMonth()!==a-1)break}return v},[l,k,u]),ee=s.useMemo(()=>{const t={},a=["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"];return k.forEach(n=>{const r=new Date(n.workout_date),o=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;t[o]||(t[o]={month:o,year:r.getFullYear(),count:0,monthLabel:`${a[r.getMonth()]} ${r.getFullYear()}`}),t[o].count++}),Object.values(t).sort((n,r)=>r.month.localeCompare(n.month))},[k]),oe=s.useMemo(()=>{const t=[],a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],n=new Date;for(let r=0;r<12;r++){const o=new Date(n.getFullYear(),n.getMonth()-r,1),v=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`;t.push({value:v,label:`${a[o.getMonth()]} ${o.getFullYear()}`})}return t},[]),ve=s.useMemo(()=>{var t;return l&&((t=ee.find(a=>a.month===l))==null?void 0:t.count)||0},[l,ee]),ie=[{id:"all",label:"Все данные"},{id:"3m",label:"Последние 3 мес"},{id:"6m",label:"Последние 6 мес"},{id:"1y",label:"Последний год"},{id:"custom",label:"Произвольный период"}],ye=((ce=ie.find(t=>t.id===b))==null?void 0:ce.label)||"Выбрать",w=s.useMemo(()=>{if(!y)return[];const t=y.dataPoints;if(b==="all")return t;const a=new Date;if(b==="3m"||b==="6m"||b==="1y"){const n=new Date(a);return b==="3m"?n.setMonth(n.getMonth()-3):b==="6m"?n.setMonth(n.getMonth()-6):n.setFullYear(n.getFullYear()-1),t.filter(r=>new Date(r.date)>=n)}if(b==="custom"){if(!I&&!z)return t;const n=I?new Date(I):null,r=z?new Date(z):null;return t.filter(o=>{const v=new Date(o.date);if(n&&v<n)return!1;if(r){const f=new Date(r);if(f.setHours(23,59,59,999),v>f)return!1}return!0})}return t},[y,b,I,z]),Ne=Math.max((w.length||0)*56,320),O=s.useMemo(()=>{if(!y||w.length===0)return null;const t=w.map(o=>o.weight),a=w.length,n=Math.max(...t),r=Math.min(...t);return{totalSessions:a,maxWeight:n,minWeight:r}},[y,w]),ke=s.useMemo(()=>{if(!w||w.length<=1)return"—";const t=w[0].weight,a=w[w.length-1].weight;if(t<=0)return"—";const n=(a-t)/t*100;return`${n>0?"+":""}${n.toFixed(1)}%`},[w]),le=N.trim()?p.filter(t=>q(t.name).includes(q(N))):p;return $&&x==="exercises"?e.jsx(Me,{message:"Загрузка упражнений..."}):e.jsxs("div",{className:"p-4 max-w-4xl mx-auto pt-safe pb-4",children:[e.jsxs("div",{className:`mb-6 glass card-dark p-4 flex items-center gap-4 header-container ${te?"scrolling":""}`,children:[e.jsx("button",{onClick:je,className:"shrink-0 inline-flex items-center justify-center p-2 rounded-full border border-transparent text-white bg-transparent transition-colors focus:outline-none active:outline-none back-button-plain","aria-label":"Назад",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"flex-1 text-xl font-bold text-center",children:x==="exercises"?i||"Прогресс":"Кардио"}),x==="cardio"&&e.jsx("button",{onClick:()=>g(!0),className:"shrink-0 inline-flex items-center justify-center w-8 h-8 rounded-full text-white bg-white/10 hover:bg-white/20 transition-colors","aria-label":"Информация о кардио",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}),!i&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>M("exercises"),className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition-all ${x==="exercises"?"bg-blue-500/30 text-white border border-blue-400/40":"bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10"}`,children:"Упражнения"}),e.jsx("button",{onClick:()=>M("cardio"),className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition-all ${x==="cardio"?"bg-green-500/30 text-white border border-green-400/40":"bg-white/5 text-gray-400 border border-white/10 hover:bg-white/10"}`,children:"Кардио"})]}),!i&&x==="exercises"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"glass card-dark rounded-full px-4 py-3 search-container",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-5 w-5 text-gray-400",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-4.35-4.35m0 0A7.5 7.5 0 103.5 10.5a7.5 7.5 0 0013.15 6.15z"})}),e.jsx("input",{ref:D,type:"text",value:N,onChange:t=>K(t.target.value),placeholder:"Поиск","aria-label":"Поиск упражнений",className:"flex-1 bg-transparent border-0 outline-none ring-0 focus:outline-none focus:ring-0 appearance-none text-white placeholder-white/60 text-base shadow-none search-input"}),e.jsx("button",{type:"button",onClick:()=>{var t;K(""),(t=D.current)==null||t.focus()},"aria-label":"Очистить","aria-hidden":!N,className:`shrink-0 w-7 h-7 grid place-items-center rounded-full text-gray-400 hover:text-gray-200 hover:bg-white/10 transition ${N?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-4 w-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6l12 12M18 6L6 18"})})})]})}),p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"Нет данных для отображения"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Выполните несколько тренировок с записанным весом"})]}):le.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"Упражнения не найдены"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Попробуйте изменить запрос"})]}):le.map(t=>e.jsx("button",{onClick:()=>we(t.name),className:"w-full glass card-dark p-4 rounded-lg hover:bg-white/5 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Выполнено подходов: ",t.totalSets]})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},t.name))]}),x==="cardio"&&!i&&e.jsx("div",{className:"space-y-4",children:L?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center",style:{background:"transparent"},children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"relative w-12 h-12",children:e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-green-500 border-r-green-500 rounded-full animate-spin"})}),e.jsx("p",{className:"text-white text-center",children:"Загрузка кардио..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass card-dark p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Цель на неделю"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Y(Math.max(1,u-1)),className:"w-8 h-8 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors flex items-center justify-center",disabled:u<=1,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx("span",{className:"text-2xl font-bold text-green-400 w-8 text-center",children:u}),e.jsx("button",{onClick:()=>Y(Math.min(7,u+1)),className:"w-8 h-8 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors flex items-center justify-center",disabled:u>=7,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[re(u,"тренировка","тренировки","тренировок")," в неделю"]})]}),e.jsxs("div",{className:"glass card-dark p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Статистика по месяцам"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center mb-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:ve}),e.jsx("p",{className:"text-xs text-gray-400",children:"В этом месяце"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:k.length}),e.jsx("p",{className:"text-xs text-gray-400",children:"Всего кардио"})]})]}),ee.length>0&&e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:ee.map(t=>e.jsxs("div",{onClick:()=>C(t.month),className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${t.month===l?"bg-green-500/20 border border-green-500/30":"bg-white/5 hover:bg-white/10"}`,children:[e.jsx("span",{className:"text-sm text-gray-300",children:t.monthLabel}),e.jsx("span",{className:"text-lg font-bold text-white",children:t.count})]},t.month))})]}),e.jsxs("div",{className:"glass card-dark p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Прогресс по неделям"}),e.jsxs("div",{ref:m,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>Q(!P),className:"flex items-center justify-between gap-2 bg-white/10 border border-white/20 rounded-lg px-3 py-1.5 text-sm text-white hover:bg-white/15 transition-colors min-w-[160px] progress-dropdown-btn",children:[e.jsx("span",{children:((de=oe.find(t=>t.value===l))==null?void 0:de.label)||"Выберите месяц"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 text-gray-400 transition-transform ${P?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsx("div",{className:"absolute top-full right-0 mt-1 w-full min-w-[160px] max-h-60 overflow-y-auto rounded-lg shadow-lg border border-white/10 z-50 progress-dropdown-menu",children:oe.map(t=>e.jsx("button",{onClick:()=>{C(t.value),Q(!1)},className:`w-full text-left px-4 py-2.5 text-sm transition-colors border-b border-white/5 last:border-0 ${l===t.value?"bg-green-500/20 text-green-400":"text-gray-200 hover:bg-white/10"}`,children:t.label},t.value))})]})]}),e.jsx("div",{className:"space-y-3",children:ae.length===0?e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"Нет данных за этот месяц"}):ae.map((t,a)=>{const n=Math.min(t.count/t.goal*100,100),r=t.count>=t.goal;return e.jsxs("div",{className:`p-3 rounded-lg ${t.isCurrentWeek?"bg-green-500/10 border border-green-500/30":"bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`text-sm ${t.isCurrentWeek?"text-green-300 font-medium":"text-gray-300"}`,children:[t.weekLabel,t.isCurrentWeek&&" (текущая)"]}),e.jsxs("span",{className:`text-sm font-bold ${r?"text-green-400":"text-gray-400"}`,children:[t.count," / ",t.goal]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 rounded-full ${r?"bg-gradient-to-r from-green-500 to-green-400":"bg-gradient-to-r from-blue-500 to-blue-400"}`,style:{width:`${n}%`}})}),!r&&t.isCurrentWeek&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Осталось: ",t.goal-t.count," ",re(t.goal-t.count,"тренировка","тренировки","тренировок")]})]},a)})})]})]})}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:()=>g(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative glass card-dark p-5 rounded-2xl max-w-md w-full max-h-[80vh]",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{onClick:()=>g(!1),className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex items-center justify-center","aria-label":"Закрыть",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-bold text-white pr-10",children:"О кардио тренировках"}),e.jsxs("div",{className:"mt-4 space-y-4 text-sm text-gray-300 max-h-[60vh] overflow-y-auto pr-1",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Что такое кардио?"}),e.jsx("p",{children:"Аэробные нагрузки, укрепляющие сердечно-сосудистую систему и улучшающие выносливость."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Сколько делать?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"2-3 раза в неделю — минимум для здоровья"}),e.jsx("li",{children:"3-5 раз — оптимально для похудения"}),e.jsx("li",{children:"20-40 минут за сессию"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Целевой пульс"}),e.jsx("p",{children:"130-140 уд/мин — зона жиросжигания. Вы должны мочь говорить, но с усилием."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Виды кардио"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("b",{children:"Stair Master"})," — имитация подъёма по лестнице"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Эллипсоид"})," — щадящая нагрузка на суставы"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Велотренажёр"})," — подходит для начинающих"]}),e.jsxs("li",{children:[e.jsx("b",{children:"Беговая дорожка"})," — быстрая ходьба"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Плюсы"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Укрепляет сердце и сосуды"}),e.jsx("li",{children:"Ускоряет метаболизм"}),e.jsx("li",{children:"Снижает уровень стресса"}),e.jsx("li",{children:"Улучшает качество сна"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-green-400 font-semibold mb-2",children:"Когда делать?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"После силовой тренировки (20-30 мин)"}),e.jsx("li",{children:"В отдельный день (40-60 мин)"}),e.jsx("li",{children:"Утром натощак — для продвинутых"})]})]}),e.jsxs("div",{className:"cardio-warning p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/30",children:[e.jsx("h3",{className:"cardio-warning-title text-yellow-400 font-semibold mb-2",children:"⚠️ Предупреждение"}),e.jsx("p",{className:"cardio-warning-text text-yellow-200/80",children:"При проблемах с сердцем, суставами или давлением — проконсультируйтесь с врачом перед началом кардио тренировок."})]})]})]})]}),i&&e.jsx("div",{className:"space-y-4",children:L?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center",style:{background:"transparent"},children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"relative w-12 h-12",children:e.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-green-500 border-r-green-500 rounded-full animate-spin"})}),e.jsx("p",{className:"text-white text-center",children:"Загрузка кардио..."})]})}):k.length===0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"glass card-dark p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:(O==null?void 0:O.totalSessions)??0}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:re((O==null?void 0:O.totalSessions)??0,"Тренировка","Тренировки","Тренировок")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:O?`${O.maxWeight} кг`:"—"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Максимум"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:ke}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Прирост"})]})]})}),e.jsxs("div",{className:"glass card-dark p-4 rounded-lg",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Динамика веса"}),e.jsxs("div",{ref:d,className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>R(!B),className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/15 text-xs text-gray-200 hover:bg-white/10 hover:border-white/25 transition-colors progress-dropdown-btn",children:[e.jsx("span",{className:"hidden sm:inline text-gray-400",children:"Период:"}),e.jsx("span",{className:"font-medium",children:ye}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-3 w-3 transition-transform ${B?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})]}),B&&e.jsx("div",{className:"absolute top-full right-0 mt-1 w-48 rounded-lg shadow-lg border border-white/10 z-50 overflow-hidden progress-dropdown-menu",children:ie.map(t=>e.jsx("button",{type:"button",onClick:()=>{U(t.id),R(!1)},className:`w-full text-left px-3 py-2 text-xs transition-colors ${b===t.id?"bg-white/15 text-white font-medium":"text-gray-300 hover:bg-white/8"}`,children:t.label},t.id))})]})]}),b==="custom"&&e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 text-xs text-gray-300 flex-wrap text-center",children:[e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"с"}),e.jsx("input",{type:"date",value:I??"",onChange:t=>V(t.target.value||null),className:"bg-transparent border border-white/20 rounded px-2 py-1 text-xs text-white focus:outline-none focus:ring-0 focus:border-blue-400/80"})]}),e.jsxs("label",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"по"}),e.jsx("input",{type:"date",value:z??"",onChange:t=>X(t.target.value||null),className:"bg-transparent border border-white/20 rounded px-2 py-1 text-xs text-white focus:outline-none focus:ring-0 focus:border-blue-400/80"})]})]})]}),w.length===0?e.jsx("div",{className:"pt-6 pb-3 text-sm text-gray-400 text-center",children:"Нет данных за выбранный период"}):e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 pb-2",children:e.jsx("div",{style:{minWidth:`${Ne}px`},children:e.jsx(Re,{width:"100%",height:300,children:e.jsxs(Pe,{data:w,margin:{top:24,right:10,left:0,bottom:5},children:[e.jsx(Oe,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(Fe,{dataKey:"displayDate",stroke:"rgba(255,255,255,0.5)",style:{fontSize:"12px"}}),e.jsx(Te,{stroke:"rgba(255,255,255,0.5)",style:{fontSize:"12px"},label:{value:"Вес (кг)",angle:-90,position:"insideLeft",fill:"rgba(255,255,255,0.7)",dx:8}}),e.jsx(ze,{content:e.jsx(He,{})}),e.jsx(Be,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})})]}),e.jsxs("div",{className:"glass card-dark p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"История"}),w.length===0?e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Нет тренировок за выбранный период"}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:w.slice().reverse().map((t,a)=>e.jsxs("div",{onClick:()=>be(t),className:"flex items-center justify-between p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:new Date(t.date).toLocaleDateString("ru")}),e.jsx("p",{className:"text-sm text-gray-400",children:t.workoutName})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-white",children:[t.weight," кг"]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[t.reps||"?"," повторов"]})]})]},a))})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"Нет данных для отображения"})})})]})};export{Ze as default};
