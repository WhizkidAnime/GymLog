import{u as G,j as e,s as d}from"./index-Bdz1zsQX.js";import{e as W,r as a,f as b}from"./vendor-BVca5W6X.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";const M=()=>{const{session:y}=G(),j=W(),[r,L]=a.useState(!1),[v,N]=a.useState(""),[l,u]=a.useState(""),[C,m]=a.useState(""),[f,i]=a.useState(!1),[k,p]=a.useState(""),[S,o]=a.useState(""),x=b.useRef(null),g=b.useRef(null),h=b.useRef(null);a.useEffect(()=>{y&&j("/calendar",{replace:!0})},[y,j]),a.useEffect(()=>{const s=()=>{N(""),u(""),m(""),x.current&&(x.current.value=""),g.current&&(g.current.value=""),h.current&&(h.current.value="")};s();const t=window.setTimeout(s,100);return()=>window.clearTimeout(t)},[]);const P=s=>{if(!s||!s.message||typeof s.message!="string")return"Произошла ошибка. Попробуйте ещё раз.";const t=s.message.toLowerCase();return t.includes("invalid login credentials")?"Неверный никнейм или пароль":t.includes("user already registered")?"Пользователь с таким никнеймом уже существует":s.message},I=async s=>{s.preventDefault(),p(""),o("");const t=v.trim();if(!t){o("Введите никнейм");return}if(r){if(l.length<6){o("Пароль должен быть не короче 6 символов");return}if(l!==C){o("Пароли не совпадают");return}}i(!0);const c=t,w=c.includes("@")?c:`${c}@gymlog.app`;try{if(r){const{data:n,error:R}=await d.auth.signUp({email:w,password:l,options:{data:{nickname:c}}});if(R)throw R;if(!(n!=null&&n.session)){const{error:E}=await d.auth.signInWithPassword({email:w,password:l});if(E)throw E}p("Регистрация успешна! Вы вошли в аккаунт.")}else{const{error:n}=await d.auth.signInWithPassword({email:w,password:l});if(n)throw n}}catch(n){o(P(n))}finally{i(!1)}},F=async()=>{i(!0),o("");const s=`${window.location.origin}/GymLog/`,{error:t}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:s}});t&&(o(t.message),i(!1))};return e.jsx("div",{className:"flex items-center justify-center min-h-screen px-4",style:{background:"#0a0a0b"},children:e.jsxs("div",{className:"w-full max-w-sm p-8 space-y-4 glass card-dark rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-center",style:{color:"#e4e4e7"},children:"GymLog"}),e.jsx("p",{className:"text-center",style:{color:"#a1a1aa"},children:r?"Создайте аккаунт":"Войдите в свой аккаунт"}),e.jsxs("form",{onSubmit:I,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nickname",className:"sr-only",children:"Никнейм"}),e.jsx("input",{id:"nickname",type:"text",placeholder:r?"Логин":"Ваш логин",value:v,onChange:s=>N(s.target.value),required:!0,name:"nickname",autoComplete:"off",className:"w-full px-4 py-2 rounded-md focus:outline-none",style:{backgroundColor:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"},ref:x})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Пароль"}),e.jsx("input",{id:"password",type:"password",placeholder:"Введите пароль",value:l,onChange:s=>u(s.target.value),required:!0,minLength:6,name:r?"new-password":"current-password",autoComplete:r?"new-password":"off",className:"w-full px-4 py-2 rounded-md focus:outline-none",style:{backgroundColor:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"},ref:g})]}),r&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:"Повторите пароль"}),e.jsx("input",{id:"confirm-password",type:"password",placeholder:"Повторите пароль",value:C,onChange:s=>m(s.target.value),required:!0,minLength:6,name:"confirm-password",autoComplete:"off",className:"w-full px-4 py-2 rounded-md focus:outline-none",style:{backgroundColor:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"},ref:h})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:f?"Загрузка...":r?"Зарегистрироваться":"Войти"})]}),k&&e.jsx("p",{className:"text-center text-sm text-green-600",children:k}),S&&e.jsx("p",{className:"text-center text-sm text-red-500",children:S}),e.jsxs("p",{className:"text-sm text-center text-gray-600",children:[r?"Уже есть аккаунт?":"Нет аккаунта?",e.jsx("button",{type:"button",onClick:()=>{L(!r),p(""),o(""),u(""),m("")},className:"ml-1 font-semibold text-blue-600 hover:underline",children:r?"Войти":"Зарегистрироваться"})]}),e.jsxs("div",{className:"relative flex items-center py-2",children:[e.jsx("div",{className:"flex-grow border-t border-gray-300"}),e.jsx("span",{className:"flex-shrink mx-4 text-xs text-gray-500",children:"ИЛИ"}),e.jsx("div",{className:"flex-grow border-t border-gray-300"})]}),e.jsxs("button",{onClick:F,disabled:f,className:"w-full flex items-center justify-center px-4 py-2 font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:e.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 381.5 512 244 512 110.3 512 0 398.8 0 256S110.3 0 244 0c73 0 135.5 28.2 182.3 74.3l-64.3 62.1C337 113.4 294.3 96 244 96c-85.6 0-154.5 68.9-154.5 160s68.9 160 154.5 160c97.9 0 135-71.2 138.6-106.2H244v-75.3h236.1c2.4 12.6 3.9 26.2 3.9 41z"})}),"Войти через Google"]})]})})};export{M as default};
