import{u as F,a as G,j as e,s as u}from"./index-DnqATjGw.js";import{d as M,r as a,e as v}from"./vendor-CITejod9.js";import{u as T}from"./use-profile-settings-BLPJ6R0U.js";import"./supabase-vtL5VWMt.js";import"./charts-D-QCyllA.js";const O=()=>{const{session:N}=F(),k=M(),{theme:g,handleThemeChange:m}=T(),{t:s}=G(),[n,A]=a.useState(!1),[C,S]=a.useState(""),[l,f]=a.useState(""),[P,h]=a.useState(""),[p,c]=a.useState(!1),[I,x]=a.useState(""),[L,o]=a.useState(""),w=v.useRef(null),b=v.useRef(null),y=v.useRef(null);a.useEffect(()=>{N&&k("/calendar",{replace:!0})},[N,k]),a.useEffect(()=>{const t=()=>{S(""),f(""),h(""),w.current&&(w.current.value=""),b.current&&(b.current.value=""),y.current&&(y.current.value="")};t();const r=window.setTimeout(t,100);return()=>window.clearTimeout(r)},[]);const U=t=>{if(!t||!t.message||typeof t.message!="string")return s.login.errors.generic;const r=t.message.toLowerCase();return r.includes("invalid login credentials")?s.login.errors.invalidCredentials:r.includes("user already registered")?s.login.errors.userExists:t.message},W=async t=>{t.preventDefault(),x(""),o("");const r=C.trim();if(!r){o(s.login.errors.enterNickname);return}if(n){if(l.length<6){o(s.login.errors.passwordMinLength);return}if(l!==P){o(s.login.errors.passwordsMismatch);return}}c(!0);const d=r,j=d.includes("@")?d:`${d}@gymlog.app`;try{if(n){const{data:i,error:E}=await u.auth.signUp({email:j,password:l,options:{data:{nickname:d}}});if(E)throw E;if(!(i!=null&&i.session)){const{error:R}=await u.auth.signInWithPassword({email:j,password:l});if(R)throw R}x(s.login.registrationSuccess)}else{const{error:i}=await u.auth.signInWithPassword({email:j,password:l});if(i)throw i}}catch(i){o(U(i))}finally{c(!1)}},$=async()=>{c(!0),o("");const t=`${window.location.origin}/GymLog/`,{error:r}=await u.auth.signInWithOAuth({provider:"google",options:{redirectTo:t}});r&&(o(r.message),c(!1))};return e.jsxs("div",{className:"relative flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed z-10",style:{top:"calc(16px + var(--sat))",right:"calc(16px + var(--sar))"},children:e.jsxs("div",{className:"glass rounded-lg p-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("auto"),className:`btn-glass btn-glass-sm ${g==="auto"?"btn-glass-primary":"btn-glass-secondary"}`,children:s.login.theme.auto}),e.jsx("button",{type:"button",onClick:()=>m("dark"),className:`btn-glass btn-glass-sm ${g==="dark"?"btn-glass-primary":"btn-glass-secondary"}`,children:s.login.theme.dark}),e.jsx("button",{type:"button",onClick:()=>m("light"),className:`btn-glass btn-glass-sm ${g==="light"?"btn-glass-primary":"btn-glass-secondary"}`,children:s.login.theme.light})]})}),e.jsxs("div",{className:"w-full max-w-sm p-8 space-y-4 glass card-dark rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-center text-white",children:"GymLog"}),e.jsx("p",{className:"text-center text-gray-400",children:n?s.login.createAccount:s.login.signIn}),e.jsxs("form",{onSubmit:W,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nickname",className:"sr-only",children:s.login.nickname}),e.jsx("input",{id:"nickname",type:"text",placeholder:n?s.login.loginPlaceholder:s.login.yourLoginPlaceholder,value:C,onChange:t=>S(t.target.value),required:!0,name:"nickname",autoComplete:"off",className:"w-full px-4 py-2 rounded-md shadow-xs focus:outline-hidden focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:w})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:s.login.password}),e.jsx("input",{id:"password",type:"password",placeholder:s.login.enterPassword,value:l,onChange:t=>f(t.target.value),required:!0,minLength:6,name:n?"new-password":"current-password",autoComplete:n?"new-password":"off",className:"w-full px-4 py-2 rounded-md shadow-xs focus:outline-hidden focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:b})]}),n&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:s.login.confirmPassword}),e.jsx("input",{id:"confirm-password",type:"password",placeholder:s.login.confirmPassword,value:P,onChange:t=>h(t.target.value),required:!0,minLength:6,name:"confirm-password",autoComplete:"off",className:"w-full px-4 py-2 rounded-md shadow-xs focus:outline-hidden focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:y})]}),e.jsx("button",{type:"submit",disabled:p,className:"btn-glass btn-glass-md btn-glass-primary btn-glass-full",children:p?s.common.loading:n?s.login.signUp:s.login.signInBtn})]}),I&&e.jsx("p",{className:"text-center text-sm text-green-400",children:I}),L&&e.jsx("p",{className:"text-center text-sm text-red-400",children:L}),e.jsxs("p",{className:"text-sm text-center text-gray-400",children:[n?s.login.alreadyHaveAccount:s.login.noAccount,e.jsx("button",{type:"button",onClick:()=>{A(!n),x(""),o(""),f(""),h("")},className:"ml-1 font-semibold text-blue-400 hover:underline",children:n?s.login.signInBtn:s.login.signUp})]}),e.jsxs("div",{className:"relative flex items-center py-2",children:[e.jsx("div",{className:"grow border-t border-white/10"}),e.jsx("span",{className:"shrink mx-4 text-xs text-gray-500",children:s.common.or}),e.jsx("div",{className:"grow border-t border-white/10"})]}),e.jsxs("button",{onClick:$,disabled:p,className:"btn-glass btn-glass-md btn-glass-secondary btn-glass-full flex items-center justify-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:e.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 381.5 512 244 512 110.3 512 0 398.8 0 256S110.3 0 244 0c73 0 135.5 28.2 182.3 74.3l-64.3 62.1C337 113.4 294.3 96 244 96c-85.6 0-154.5 68.9-154.5 160s68.9 160 154.5 160c97.9 0 135-71.2 138.6-106.2H244v-75.3h236.1c2.4 12.6 3.9 26.2 3.9 41z"})}),s.login.signInWithGoogle]})]})]})};export{O as default};
