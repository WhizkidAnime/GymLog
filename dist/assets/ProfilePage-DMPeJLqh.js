import{s as ht,u as ms,j as e}from"./index-Bc8oTa1J.js";import{e as ps,r as o,f as N}from"./vendor-BVca5W6X.js";import{C as gt}from"./confirm-dialog-DavcsIhn.js";import{T as gs}from"./template-saved-dialog-CekLYsR_.js";import{R as hs,L as xs,C as fs,X as ws,Y as bs,T as ys,a as ks}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function js(){const n=ht,{error:X}=await n.rpc("delete_user_account");if(X)throw X}const Is=()=>{const{user:n,signOut:X}=ms(),je=ps(),f=ht,[Re,Pe]=o.useState(!1),[le,C]=o.useState(!1),[xt,ze]=o.useState(!1),[Ne,ve]=o.useState(""),[Se,Q]=o.useState(null),[Fe,$e]=o.useState(!1),[Be,Ue]=o.useState(!1),[Z,E]=o.useState(!1),[ft,z]=o.useState(!1),[I,F]=o.useState(null),[wt,$]=o.useState(null),[bt,A]=o.useState([]),[_e,L]=o.useState([]),[ee,O]=o.useState(!1),[yt,u]=o.useState(!1),[kt,m]=o.useState(null),[qe,B]=o.useState("none"),[jt,p]=o.useState("success"),[Nt,M]=o.useState(!1),[ie,ce]=o.useState([]),[te,de]=o.useState([]),[vt,ue]=o.useState("none"),[St,se]=o.useState(!1),[_t,me]=o.useState(!1),[Dt,pe]=o.useState(!1),[U,Je]=o.useState(!1),[q,Ve]=o.useState(!1),[S,Ye]=o.useState([]),[R,re]=o.useState([]),[T,Ge]=o.useState([]),[P,ne]=o.useState([]),[J,He]=o.useState(!1),[V,Ke]=o.useState(!1),De=N.useRef(null),ge=N.useRef(null),he=N.useRef(null),[Ct,Et]=o.useState(!1),[Ce,It]=o.useState(!1),[Xe,Tt]=o.useState(()=>{try{const t=localStorage.getItem("settings:timerStep");return t?Number(t):30}catch{return 30}}),[Qe,Ze]=o.useState(()=>String(Xe)),[xe,fe]=o.useState("idle"),Y=N.useRef(null),[Ee,Ie]=o.useState(!1),[_,Te]=o.useState([]),[Wt,et]=o.useState(!1),[we,tt]=o.useState(""),[We,st]=o.useState(()=>new Date().toISOString().slice(0,10)),[Ae,rt]=o.useState(!1),[Le,nt]=o.useState(null),[At,Oe]=o.useState(!1),[at,ot]=o.useState(null),[ae,Lt]=o.useState(()=>{try{return localStorage.getItem("settings:theme")==="light"?"light":"dark"}catch{return"dark"}}),Ot=N.useMemo(()=>{var r;if(!n)return"";const t=(r=n.user_metadata)==null?void 0:r.nickname;if(typeof t=="string"&&t.trim().length>0)return t.trim();const s=n.email||"";return s.endsWith("@gymlog.app")?s.replace(/@gymlog\.app$/,""):s},[n]),G=N.useMemo(()=>{const t=(n==null?void 0:n.email)||"";if(!t||typeof t!="string")return null;const[s,r]=t.split("@");if(!s||!r)return null;const a=Math.max(1,Math.ceil(s.length/2)),l=s.slice(0,a),g=s.slice(a);return{email:t,localPart:s,domain:r,visiblePart:l,hiddenPart:g}},[n==null?void 0:n.email]),lt=N.useMemo(()=>["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"],[]),be=N.useCallback(t=>{if(typeof t!="string")return null;const s=t.trim();return lt.includes(s)?s:null},[lt]),Mt=t=>{if(!t||typeof t!="string")return t;const s=t.split("-");if(s.length===3){const[r,a,l]=s;if(r&&a&&l)return`${l}.${a}.${r}`}return t};N.useEffect(()=>{const t=s=>{De.current&&!De.current.contains(s.target)&&C(!1)};if(le)return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[le]),N.useEffect(()=>()=>{Y.current&&clearTimeout(Y.current)},[]),o.useEffect(()=>{const t=document.documentElement,s=document.querySelector('meta[name="theme-color"]');ae==="light"?(t.classList.add("light-theme"),s&&s.setAttribute("content","#f5f5f7")):(t.classList.remove("light-theme"),s&&s.setAttribute("content","#0a0a0b"))},[ae]);const it=()=>{const t=ae==="dark"?"light":"dark";Lt(t);try{localStorage.setItem("settings:theme",t)}catch{}},ct=o.useCallback(async()=>{if(n){et(!0);try{const{data:t,error:s}=await f.from("user_body_weights").select("*").eq("user_id",n.id).order("recorded_at",{ascending:!1}).limit(100);if(s)throw s;Te(t||[])}catch(t){console.error("Error loading body weights:",t)}finally{et(!1)}}},[n]);o.useEffect(()=>{Ee&&n&&ct()},[Ee,n,ct]);const Rt=async()=>{if(!n||!we||Ae)return;const t=parseFloat(we.replace(",","."));if(isNaN(t)||t<=0||t>500){alert("Введите корректный вес (от 0.1 до 500 кг)");return}rt(!0);try{const{data:s,error:r}=await f.from("user_body_weights").upsert({user_id:n.id,weight:t,recorded_at:We},{onConflict:"user_id,recorded_at"}).select().single();if(r)throw r;Te(a=>{const l=a.filter(g=>g.recorded_at!==We);return[s,...l].sort((g,b)=>new Date(b.recorded_at).getTime()-new Date(g.recorded_at).getTime())}),tt(""),st(new Date().toISOString().slice(0,10))}catch(s){console.error("Error saving weight:",s),alert("Не удалось сохранить вес")}finally{rt(!1)}},Pt=async t=>{if(!(!n||Le)){nt(t);try{const{error:s}=await f.from("user_body_weights").delete().eq("id",t);if(s)throw s;Te(r=>r.filter(a=>a.id!==t)),Oe(!1),ot(null)}catch(s){console.error("Error deleting weight:",s),alert("Не удалось удалить запись")}finally{nt(null)}}},zt=t=>{ot(t),Oe(!0)},dt=N.useMemo(()=>[..._].sort((t,s)=>new Date(t.recorded_at).getTime()-new Date(s.recorded_at).getTime()).slice(-30).map(t=>({date:new Date(t.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short"}),weight:Number(t.weight),fullDate:t.recorded_at})),[_]),W=N.useMemo(()=>{if(_.length===0)return null;const t=_.map(g=>Number(g.weight)),s=t[0],r=Math.min(...t),a=Math.max(...t),l=_.length>1?s-t[t.length-1]:0;return{current:s,min:r,max:a,change:l}},[_]),Ft=async()=>{try{await X(),je("/login",{replace:!0})}catch(t){console.error("Error logging out:",t)}},$t=()=>{!n||!n.email||(ve(""),Q(null),ze(!0))},Bt=()=>{n&&se(!0)},Ut=async()=>{if(!(!n||!n.email)){if(Ne.trim()!==n.email)throw Q("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");Q(null),Pe(!0);try{await js(),alert("Ваш аккаунт и все данные были успешно удалены."),await X(),je("/login",{replace:!0})}catch(t){console.error("Error deleting account:",t),alert(`Не удалось удалить аккаунт: ${t.message}`)}finally{Pe(!1)}}},ut=async()=>{if(n){$e(!0);try{const{data:t,error:s}=await f.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",n.id).order("workout_date",{ascending:!1});if(s){console.error("Error exporting workouts:",s),alert("Не удалось загрузить данные тренировок для экспорта.");return}const r=(t||[]).map(c=>({id:c.id,name:c.name,icon:be(c.icon),date:c.workout_date,isCardio:!!c.is_cardio,templateId:c.template_id,exercises:(c.workout_exercises||[]).map(d=>({id:d.id,name:d.name,position:d.position,reps:d.reps,restSeconds:d.rest_seconds,setsPlanned:d.sets,sets:(d.workout_sets||[]).map(h=>({id:h.id,index:h.set_index,weight:h.weight,reps:h.reps,isDone:h.is_done,updatedAt:h.updated_at}))}))})),a={exportedAt:new Date().toISOString(),user:{id:n.id,email:n.email},workouts:r},l=JSON.stringify(a,null,2),g=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(g),i=document.createElement("a"),y=new Date().toISOString().slice(0,10);i.href=b,i.download=`gymlog-workouts-${y}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting workouts:",t),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{$e(!1)}}},qt=async()=>{if(n){Ue(!0);try{const{data:t,error:s}=await f.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error exporting templates:",s),alert("Не удалось загрузить шаблоны для экспорта.");return}const r=(t||[]).map(c=>({id:c.id,name:c.name,icon:be(c.icon),createdAt:c.created_at,exercises:(c.template_exercises||[]).map(d=>({id:d.id,name:d.name,sets:d.sets,reps:d.reps,restSeconds:d.rest_seconds,position:d.position}))})),a={exportedAt:new Date().toISOString(),user:{id:n.id,email:n.email},templates:r},l=JSON.stringify(a,null,2),g=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(g),i=document.createElement("a"),y=new Date().toISOString().slice(0,10);i.href=b,i.download=`gymlog-templates-${y}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting templates:",t),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{Ue(!1)}}},Jt=()=>{!n||Z||ge.current&&(ge.current.value="",ge.current.click())},Vt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{A([]),L([]);const r=await s.text();let a;try{a=JSON.parse(r)}catch{p("error"),m("Файл не является корректным JSON."),u(!0);return}if(!a||!Array.isArray(a.workouts)){p("error"),m("Файл не похож на экспорт тренировок из GymLog."),u(!0);return}if(!n)return;const l=Array.isArray(a.workouts)?a.workouts:[],g=new Set;l.forEach(x=>{const j=typeof x.date=="string"&&x.date?x.date:typeof x.workout_date=="string"&&x.workout_date?x.workout_date:"";j&&g.add(j)});const{data:b,error:i}=await f.from("workouts").select("workout_date").eq("user_id",n.id);if(i){console.error("Error checking existing workouts before import:",i),p("error"),m("Не удалось проверить существующие тренировки перед импортом."),u(!0);return}const y=new Set((b||[]).map(x=>x.workout_date)),c=y.size>0,d=new Map;l.forEach(x=>{const j=typeof x.date=="string"&&x.date?x.date:typeof x.workout_date=="string"&&x.workout_date?x.workout_date:"";j&&d.set(j,(d.get(j)||0)+1)});const h=[],k=[];g.forEach(x=>{y.has(x)?h.push(x):k.push(x)});const H=h.length>0;if(!c||!H){p("success"),E(!0);try{await ye(a),m("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(x){console.error("Error importing workouts:",x),alert("Не удалось импортировать тренировки: "+((x==null?void 0:x.message)||String(x)))}finally{E(!1)}return}if(k.length===0){p("error"),m("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),u(!0);return}if(F(a),$(s.name),k.length>0){const x=k.map(j=>({date:j,count:d.get(j)||0})).sort((j,oe)=>oe.date.localeCompare(j.date));A(k),L(x)}else A([]),L([]);z(!0)}catch(r){console.error("Error reading workouts import file:",r),alert("Не удалось прочитать файл тренировок.")}finally{t.target.value=""}},ye=async t=>{if(!n)return;const s=Array.isArray(t.workouts)?t.workouts:[];if(s.length===0){p("error"),m("В файле нет тренировок для импорта."),u(!0);return}const{data:r,error:a}=await f.from("workouts").select("id, workout_date").eq("user_id",n.id);if(a)throw a;const l=new Set;s.forEach(i=>{const y=typeof i.date=="string"&&i.date?i.date:typeof i.workout_date=="string"&&i.workout_date?i.workout_date:"";y&&l.add(y)});const b=(r||[]).filter(i=>l.has(i.workout_date)).map(i=>i.id);if(b.length>0){const{data:i,error:y}=await f.from("workout_exercises").select("id, workout_id").in("workout_id",b);if(y)throw y;const c=(i||[]).map(d=>d.id);if(c.length>0){const{error:d}=await f.from("workout_sets").delete().in("workout_exercise_id",c);if(d)throw d}if(b.length>0){const{error:d}=await f.from("workout_exercises").delete().in("workout_id",b);if(d)throw d;const{error:h}=await f.from("workouts").delete().in("id",b);if(h)throw h}}for(const i of s){const y=typeof i.name=="string"&&i.name.trim().length>0?i.name.trim():"Импортированная тренировка",c=typeof i.date=="string"&&i.date?i.date:new Date().toISOString().slice(0,10),{data:d,error:h}=await f.from("workouts").insert({user_id:n.id,name:y,icon:be(i.icon),workout_date:c,is_cardio:!!i.isCardio,template_id:null}).select().single();if(h||!d)throw h||new Error("Не удалось создать тренировку при импорте.");const k=Array.isArray(i.exercises)?i.exercises:[];if(k.length===0)continue;const H=k.map((w,D)=>({workout_id:d.id,name:typeof w.name=="string"?w.name:"",position:typeof w.position=="number"?w.position:D+1,reps:typeof w.reps=="string"?w.reps:"",rest_seconds:typeof w.restSeconds=="number"?w.restSeconds:typeof w.rest_seconds=="number"?w.rest_seconds:150,sets:typeof w.setsPlanned=="number"?w.setsPlanned:Array.isArray(w.sets)?w.sets.length:1})),{data:x,error:j}=await f.from("workout_exercises").insert(H).select();if(j||!x)throw j||new Error("Не удалось создать упражнения при импорте.");const oe=[],ds=[...k].sort((w,D)=>{const K=typeof w.position=="number"?w.position:0,ke=typeof D.position=="number"?D.position:0;return K-ke}),us=[...x].sort((w,D)=>{const K=typeof w.position=="number"?w.position:0,ke=typeof D.position=="number"?D.position:0;return K-ke});if(ds.forEach((w,D)=>{const K=us[D];if(!K)return;(Array.isArray(w.sets)?w.sets:[]).forEach(v=>{oe.push({workout_exercise_id:K.id,set_index:typeof v.index=="number"?v.index:1,weight:typeof v.weight=="number"?v.weight:null,reps:v.reps==null?null:String(v.reps),is_done:!!v.isDone,updated_at:typeof v.updatedAt=="string"&&v.updatedAt?v.updatedAt:new Date().toISOString()})})}),oe.length>0){const{error:w}=await f.from("workout_sets").insert(oe);if(w)throw w}}},Yt=async()=>{if(I){B("import"),E(!0);try{await ye(I),F(null),$(null),A([]),L([]),z(!1),p("success"),m("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(t){console.error("Error importing workouts:",t),alert("Не удалось импортировать тренировки: "+((t==null?void 0:t.message)||String(t)))}finally{E(!1),B("none")}}},Gt=async()=>{if(!I)return;const t=Array.isArray(I.workouts)?I.workouts:[];if(t.length===0){p("error"),m("В файле нет тренировок для импорта."),u(!0);return}const s=new Set(bt);if(s.size===0){p("error"),m("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),u(!0);return}const r=t.filter(a=>{const l=typeof a.date=="string"&&a.date?a.date:typeof a.workout_date=="string"&&a.workout_date?a.workout_date:"";return!!l&&s.has(l)});if(r.length===0){p("error"),m("Не удалось определить новые тренировки для импорта. Проверьте файл."),u(!0);return}B("onlyNew"),E(!0);try{await ye({workouts:r}),F(null),$(null),A([]),L([]),z(!1),p("success"),m("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(a){console.error("Error importing only new workouts:",a),p("error"),m("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),u(!0)}finally{E(!1),B("none")}},Ht=async()=>{if(I){B("exportThenImport"),E(!0);try{await ut(),await ye(I),F(null),$(null),z(!1),p("success"),m("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(t){console.error("Error exporting and importing workouts:",t),p("error"),m("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),u(!0)}finally{E(!1),B("none")}}},Kt=()=>{!n||ee||he.current&&(he.current.value="",he.current.click())},Me=async t=>{if(!n)return;const s=Array.isArray(t.templates)?t.templates:[];if(s.length===0){p("error"),m("В файле нет шаблонов для импорта."),u(!0);return}for(const r of s){const a=typeof r.name=="string"&&r.name.trim().length>0?r.name.trim():"Импортированный шаблон",{data:l,error:g}=await f.from("workout_templates").insert({user_id:n.id,name:a,icon:be(r.icon)}).select().single();if(g||!l)throw g||new Error("Не удалось создать шаблон при импорте.");const b=Array.isArray(r.exercises)?r.exercises:[];if(b.length===0)continue;const i=b.map((c,d)=>({template_id:l.id,name:typeof c.name=="string"?c.name:"",sets:typeof c.sets=="number"?c.sets:1,reps:typeof c.reps=="string"?c.reps:"",rest_seconds:typeof c.restSeconds=="number"?c.restSeconds:typeof c.rest_seconds=="number"?c.rest_seconds:150,position:typeof c.position=="number"?c.position:d+1})),{error:y}=await f.from("template_exercises").insert(i);if(y)throw y}},Xt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{const r=await s.text();let a;try{a=JSON.parse(r)}catch{p("error"),m("Файл не является корректным JSON."),u(!0);return}if(!a||!Array.isArray(a.templates)){p("error"),m("Файл не похож на экспорт шаблонов из GymLog."),u(!0);return}if(!n)return;const l=Array.isArray(a.templates)?a.templates:[];if(l.length===0){p("error"),m("В файле нет шаблонов для импорта."),u(!0);return}const{data:g,error:b}=await f.from("workout_templates").select("id, name").eq("user_id",n.id);if(b){console.error("Error checking existing templates before import:",b),p("error"),m("Не удалось проверить существующие шаблоны перед импортом."),u(!0);return}const i=h=>typeof h=="string"?h.trim().toLowerCase():"",y=new Map;(g||[]).forEach(h=>{const k=i(h.name);k&&(y.has(k)||y.set(k,{id:h.id,name:h.name||""}))});const c=[],d=[];if(l.forEach(h=>{const k=i(h==null?void 0:h.name);if(!k||!y.has(k))c.push(h);else{const H=y.get(k);d.push({existingId:H.id,existingName:H.name||"",template:h})}}),c.length===0&&d.length>0){p("error"),m("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),u(!0);return}if(d.length===0){O(!0);try{await Me({templates:l}),p("success"),m("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),u(!0)}catch(h){console.error("Error importing templates:",h),p("error"),m("Не удалось импортировать шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1)}return}ce(c),de(d),M(!0)}catch(r){console.error("Error importing templates:",r),p("error"),m("Не удалось импортировать шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1),t.target.value=""}},Qt=async()=>{if(ie.length===0){M(!1),de([]),ce([]),p("error"),m("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),u(!0);return}ue("onlyNew"),O(!0);try{await Me({templates:ie}),ce([]),de([]),M(!1),p("success"),m("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),u(!0)}catch(t){console.error("Error importing only new templates:",t),p("error"),m("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1),ue("none")}},Zt=async()=>{if(!(!n||U)){Je(!0),re([]);try{const{data:t,error:s}=await f.from("workouts").select("id, workout_date").eq("user_id",n.id).order("workout_date",{ascending:!1});if(s){console.error("Error loading workouts for deletion:",s),alert("Не удалось загрузить список тренировок для удаления.");return}const r=new Map;(t||[]).forEach(l=>{const g=l.workout_date,b=l.id;!g||!b||(r.has(g)||r.set(g,[]),r.get(g).push(b))});const a=Array.from(r.entries()).map(([l,g])=>({date:l,workoutIds:g,count:g.length})).sort((l,g)=>g.date.localeCompare(l.date));if(a.length===0){p("error"),m("У вас нет тренировок для удаления."),u(!0);return}Ye(a),se(!1),me(!0)}catch(t){console.error("Unexpected error while loading workouts for deletion:",t),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{Je(!1)}}},es=async()=>{if(!(!n||q)){Ve(!0),ne([]);try{const{data:t,error:s}=await f.from("workout_templates").select("id, name").eq("user_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error loading templates for deletion:",s),alert("Не удалось загрузить список шаблонов для удаления.");return}const r=(t||[]).map(a=>({id:a.id,name:a.name||"Без названия"}));if(r.length===0){p("error"),m("У вас нет шаблонов для удаления."),u(!0);return}Ge(r),se(!1),pe(!0)}catch(t){console.error("Unexpected error while loading templates for deletion:",t),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{Ve(!1)}}},ts=t=>{re(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ss=()=>{if(S.length===0)return;const t=R.length===S.length;re(t?[]:S.map(s=>s.date))},rs=()=>{re([])},ns=t=>{ne(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},as=()=>{if(T.length===0)return;const t=P.length===T.length;ne(t?[]:T.map(s=>s.id))},os=()=>{ne([])},ls=async()=>{if(!n||R.length===0)return;const t=S.filter(s=>R.includes(s.date)).flatMap(s=>s.workoutIds);if(t.length!==0){He(!0);try{const{data:s,error:r}=await f.from("workout_exercises").select("id, workout_id").in("workout_id",t);if(r)throw r;const a=(s||[]).map(l=>l.id);if(a.length>0){const{error:l}=await f.from("workout_sets").delete().in("workout_exercise_id",a);if(l)throw l}if(t.length>0){const{error:l}=await f.from("workout_exercises").delete().in("workout_id",t);if(l)throw l;const{error:g}=await f.from("workouts").delete().in("id",t);if(g)throw g}me(!1),Ye([]),re([]),p("success"),m("Выбранные тренировки успешно удалены."),u(!0)}catch(s){console.error("Error deleting workouts:",s),p("error"),m("Не удалось удалить выбранные тренировки."),u(!0)}finally{He(!1)}}},is=async()=>{if(n&&P.length!==0){Ke(!0);try{const t=P;if(t.length>0){const{error:s}=await f.from("template_exercises").delete().in("template_id",t);if(s)throw s;const{error:r}=await f.from("workout_templates").delete().in("id",t);if(r)throw r}pe(!1),Ge([]),ne([]),p("success"),m("Выбранные шаблоны тренировок успешно удалены."),u(!0)}catch(t){console.error("Error deleting templates:",t),p("error"),m("Не удалось удалить выбранные шаблоны тренировок."),u(!0)}finally{Ke(!1)}}},cs=async()=>{if(te.length===0&&ie.length===0){M(!1);return}ue("overwrite"),O(!0);try{const t=Array.from(new Set(te.map(r=>r.existingId)));if(t.length>0){const{error:r}=await f.from("template_exercises").delete().in("template_id",t);if(r)throw r;const{error:a}=await f.from("workout_templates").delete().in("id",t);if(a)throw a}const s=[...ie,...te.map(r=>r.template)];await Me({templates:s}),ce([]),de([]),M(!1),p("success"),m("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),u(!0)}catch(t){console.error("Error overwriting templates:",t),alert("Не удалось импортировать шаблоны с перезаписью: "+((t==null?void 0:t.message)||String(t)))}finally{O(!1),ue("none")}},mt=S.length>0&&R.length===S.length,pt=T.length>0&&P.length===T.length;return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative profile-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsxs("div",{className:"relative",ref:De,children:[e.jsx("button",{onClick:()=>C(!le),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),le&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{C(!1),Jt()},disabled:Z,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Z?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{C(!1),Kt()},disabled:ee,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:ee?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{C(!1),await ut()},disabled:Fe,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Fe?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{C(!1),await qt()},disabled:Be,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Be?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{C(!1),Bt()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{C(!1),$t()},disabled:Re,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:Re?"Удаление...":"Удалить аккаунт"})]})]})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:n&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),G?e.jsxs("span",{className:"font-semibold",children:[G.visiblePart,G.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>Et(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:Ct?e.jsx("span",{children:G.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,G.hiddenPart.length))})}),"@",G.domain]}):e.jsx("span",{className:"font-semibold",children:Ot})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>je("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:"Узнать прогресс"}),e.jsxs("button",{onClick:()=>Ie(!0),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})}),"Трекер веса тела"]}),e.jsxs("button",{onClick:()=>It(!Ce),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Настройки",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${Ce?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("button",{onClick:Ft,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"})]}),Ce&&e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Настройки"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Шаг таймера отдыха (секунды)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Значение, на которое изменяется таймер при нажатии +/-"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:Qe,onChange:t=>Ze(t.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:()=>{Y.current&&clearTimeout(Y.current);const t=parseInt(Qe,10);if(!isNaN(t)&&t>=1&&t<=300){fe("saving"),Tt(t);try{localStorage.setItem("settings:timerStep",String(t))}catch{}Y.current=setTimeout(()=>{fe("success"),Y.current=setTimeout(()=>{fe("idle")},500)},350)}else Ze(String(Xe)),fe("idle")},disabled:xe==="saving",className:"btn-glass btn-glass-sm btn-glass-primary flex items-center justify-center gap-2 min-w-[120px]",children:[xe==="saving"&&e.jsx("span",{"aria-label":"Сохранение...",className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),xe==="success"&&e.jsx("svg",{"aria-label":"Сохранено",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),xe==="idle"&&"Сохранить"]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Тема оформления"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:it,className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all duration-200 ease-out ${ae==="dark"?"btn-glass btn-glass-primary":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),"Тёмная"]})}),e.jsx("button",{type:"button",onClick:it,className:`flex-1 py-2 px-4 rounded-lg font-medium transition-all duration-200 ease-out ${ae==="light"?"btn-glass btn-glass-primary":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),"Светлая"]})})]})]})]}),e.jsx("input",{ref:ge,type:"file",accept:"application/json",className:"hidden",onChange:Vt}),e.jsx("input",{ref:he,type:"file",accept:"application/json",className:"hidden",onChange:Xt}),e.jsx(gt,{open:xt,onOpenChange:t=>{ze(t),t||(ve(""),Q(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:Ne.trim().length===0,onConfirm:Ut,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:n==null?void 0:n.email})]}),e.jsx("input",{type:"email",value:Ne,onChange:t=>{ve(t.target.value),Se&&Q(null)},placeholder:(n==null?void 0:n.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),Se&&e.jsx("p",{className:"text-xs text-red-400",children:Se})]})}),St&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{U||q||se(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),(U||q)&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:Zt,disabled:U||q,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:es,disabled:U||q,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{U||q||se(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]}),_t&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{J||me(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:ss,disabled:S.length===0||J,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${mt?"bg-green-500 border-green-400":"border-white/40"}`,children:mt&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:rs,disabled:R.length===0||J,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[S.map(t=>{const s=R.includes(t.date);return e.jsxs("button",{type:"button",onClick:()=>ts(t.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.date}),e.jsx("div",{className:"text-xs text-gray-400",children:t.count===1?"1 тренировка":`${t.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.date)}),S.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:ls,disabled:R.length===0||J,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:J?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{J||me(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),Dt&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{V||pe(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:as,disabled:T.length===0||V,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${pt?"bg-green-500 border-green-400":"border-white/40"}`,children:pt&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:os,disabled:P.length===0||V,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[T.map(t=>{const s=P.includes(t.id);return e.jsxs("button",{type:"button",onClick:()=>ns(t.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.id)}),T.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:is,disabled:P.length===0||V,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:V?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{V||pe(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),e.jsx(gs,{open:yt,onOpenChange:t=>{t||(u(!1),m(null))},onClose:()=>{u(!1),m(null)},message:kt||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:jt}),Nt&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{ee||M(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[te.map((t,s)=>{var r;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((r=t.template)==null?void 0:r.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",t.existingName||"Без названия","»"]})]},t.existingId+"-"+s)}),te.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),ee?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:vt==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:Qt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:cs,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:()=>{M(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),ft&&I&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{Z||(z(!1),F(null),$(null),A([]),L([]))}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${wt||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),_e.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:_e.map(t=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:Mt(t.date)})},t.date))})]}),Z?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:qe==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":qe==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[_e.length>0&&e.jsx("button",{type:"button",onClick:Gt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:Yt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:Ht,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:()=>{z(!1),F(null),$(null),A([]),L([])},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]}),Ee&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>Ie(!1)}),e.jsxs("div",{className:"relative w-full max-w-lg glass card-dark rounded-xl shadow-xl p-5 space-y-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Трекер веса тела"}),e.jsx("button",{type:"button",onClick:()=>Ie(!1),className:"p-1 text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Добавить запись"}),e.jsxs("div",{className:"flex gap-2 items-end flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[100px]",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Вес (кг)"}),e.jsx("input",{type:"text",inputMode:"decimal",value:we,onChange:t=>{const s=t.target.value.replace(".",",");/^[0-9]*[,]?[0-9]*$/.test(s)&&tt(s)},placeholder:"70,5",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1 min-w-[130px]",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Дата"}),e.jsx("input",{type:"date",value:We,onChange:t=>st(t.target.value),max:new Date().toISOString().slice(0,10),className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{type:"button",onClick:Rt,disabled:!we||Ae,className:"btn-glass btn-glass-sm btn-glass-primary disabled:opacity-50",children:Ae?"...":"Добавить"})]})]}),W&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Текущий"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[W.current.toFixed(1).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Мин"}),e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[W.min.toFixed(1).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Макс"}),e.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[W.max.toFixed(1).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Изменение"}),e.jsxs("p",{className:`text-lg font-bold ${W.change>0?"text-red-400":W.change<0?"text-green-400":"text-gray-400"}`,children:[W.change>0?"+":"",W.change.toFixed(1).replace(".",",")," кг"]})]})]}),dt.length>1&&e.jsx("div",{className:"h-48 w-full",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(xs,{data:dt,margin:{top:5,right:5,left:-20,bottom:5},children:[e.jsx(fs,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(ws,{dataKey:"date",tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1}),e.jsx(bs,{domain:["dataMin - 2","dataMax + 2"],tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1,tickFormatter:t=>`${t}`}),e.jsx(ys,{contentStyle:{background:"rgba(24,24,27,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",color:"#fff"},formatter:t=>[`${t.toFixed(1).replace(".",",")} кг`,"Вес"]}),e.jsx(ks,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",strokeWidth:0,r:3},activeDot:{r:5,fill:"#60a5fa"}})]})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-300 font-medium",children:["История (",_.length,")"]}),Wt?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):_.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Пока нет записей. Добавьте свой первый вес выше."}):e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:_.slice(0,20).map(t=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-medium",children:[Number(t.weight).toFixed(1).replace(".",",")," кг"]}),e.jsx("span",{className:"text-sm text-gray-400",children:new Date(t.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short",year:"numeric"})})]}),e.jsx("button",{type:"button",onClick:()=>zt(t.id),disabled:Le===t.id,className:"p-1 text-gray-500 hover:text-red-400 transition-colors disabled:opacity-50",children:Le===t.id?e.jsx("span",{className:"w-4 h-4 border border-white/30 border-t-white rounded-full animate-spin inline-block"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},t.id))})]})]})]}),e.jsx(gt,{open:At,onOpenChange:Oe,title:"Удалить запись о весе?",description:"Это действие необратимо.",confirmText:"Удалить",cancelText:"Отмена",variant:"danger",onConfirm:()=>{at&&Pt(at)}})]})};export{Is as default};
