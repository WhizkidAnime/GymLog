import{s as Me,u as Dt,j as e}from"./index-BEFAvpTy.js";import{e as Et,r as m,f as Y}from"./vendor-BVca5W6X.js";import{C as It}from"./confirm-dialog-D95FzO4Z.js";import{T as Ct}from"./template-saved-dialog-7MXQQOV3.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function At(){const o=Me,{error:V}=await o.rpc("delete_user_account");if(V)throw V}const zt=()=>{const{user:o,signOut:V}=Dt(),fe=Et(),w=Me,[ke,je]=m.useState(!1),[re,S]=m.useState(!1),[ze,Ne]=m.useState(!1),[ge,xe]=m.useState(""),[he,H]=m.useState(null),[ve,_e]=m.useState(!1),[Se,De]=m.useState(!1),[K,D]=m.useState(!1),[Fe,P]=m.useState(!1),[E,L]=m.useState(null),[$e,M]=m.useState(null),[Ue,C]=m.useState([]),[we,A]=m.useState([]),[Q,T]=m.useState(!1),[Be,c]=m.useState(!1),[qe,d]=m.useState(null),[Ee,z]=m.useState("none"),[Je,p]=m.useState("success"),[Ge,O]=m.useState(!1),[oe,ne]=m.useState([]),[X,ae]=m.useState([]),[Ye,le]=m.useState("none"),[Ve,Z]=m.useState(!1),[He,ie]=m.useState(!1),[Ke,ce]=m.useState(!1),[F,Ie]=m.useState(!1),[$,Ce]=m.useState(!1),[v,Ae]=m.useState([]),[W,ee]=m.useState([]),[I,Te]=m.useState([]),[R,te]=m.useState([]),[U,Oe]=m.useState(!1),[B,We]=m.useState(!1),be=Y.useRef(null),de=Y.useRef(null),ue=Y.useRef(null),[Qe,Xe]=m.useState(!1),Ze=Y.useMemo(()=>{var r;if(!o)return"";const t=(r=o.user_metadata)==null?void 0:r.nickname;if(typeof t=="string"&&t.trim().length>0)return t.trim();const s=o.email||"";return s.endsWith("@gymlog.app")?s.replace(/@gymlog\.app$/,""):s},[o]),q=Y.useMemo(()=>{const t=(o==null?void 0:o.email)||"";if(!t||typeof t!="string")return null;const[s,r]=t.split("@");if(!s||!r)return null;const n=Math.max(1,Math.ceil(s.length/2)),l=s.slice(0,n),x=s.slice(n);return{email:t,localPart:s,domain:r,visiblePart:l,hiddenPart:x}},[o==null?void 0:o.email]),et=t=>{if(!t||typeof t!="string")return t;const s=t.split("-");if(s.length===3){const[r,n,l]=s;if(r&&n&&l)return`${l}.${n}.${r}`}return t};Y.useEffect(()=>{const t=s=>{be.current&&!be.current.contains(s.target)&&S(!1)};if(re)return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[re]);const tt=async()=>{try{await V(),fe("/login",{replace:!0})}catch(t){console.error("Error logging out:",t)}},st=()=>{!o||!o.email||(xe(""),H(null),Ne(!0))},rt=()=>{o&&Z(!0)},ot=async()=>{if(!(!o||!o.email)){if(ge.trim()!==o.email)throw H("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");H(null),je(!0);try{await At(),alert("Ваш аккаунт и все данные были успешно удалены."),await V(),fe("/login",{replace:!0})}catch(t){console.error("Error deleting account:",t),alert(`Не удалось удалить аккаунт: ${t.message}`)}finally{je(!1)}}},Re=async()=>{if(o){_e(!0);try{const{data:t,error:s}=await w.from("workouts").select(`
          id,
          name,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",o.id).order("workout_date",{ascending:!1});if(s){console.error("Error exporting workouts:",s),alert("Не удалось загрузить данные тренировок для экспорта.");return}const r=(t||[]).map(u=>({id:u.id,name:u.name,date:u.workout_date,isCardio:!!u.is_cardio,templateId:u.template_id,exercises:(u.workout_exercises||[]).map(i=>({id:i.id,name:i.name,position:i.position,reps:i.reps,restSeconds:i.rest_seconds,setsPlanned:i.sets,sets:(i.workout_sets||[]).map(f=>({id:f.id,index:f.set_index,weight:f.weight,reps:f.reps,isDone:f.is_done,updatedAt:f.updated_at}))}))})),n={exportedAt:new Date().toISOString(),user:{id:o.id,email:o.email},workouts:r},l=JSON.stringify(n,null,2),x=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(x),a=document.createElement("a"),y=new Date().toISOString().slice(0,10);a.href=b,a.download=`gymlog-workouts-${y}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting workouts:",t),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{_e(!1)}}},nt=async()=>{if(o){De(!0);try{const{data:t,error:s}=await w.from("workout_templates").select(`
          id,
          name,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",o.id).order("created_at",{ascending:!1});if(s){console.error("Error exporting templates:",s),alert("Не удалось загрузить шаблоны для экспорта.");return}const r=(t||[]).map(u=>({id:u.id,name:u.name,createdAt:u.created_at,exercises:(u.template_exercises||[]).map(i=>({id:i.id,name:i.name,sets:i.sets,reps:i.reps,restSeconds:i.rest_seconds,position:i.position}))})),n={exportedAt:new Date().toISOString(),user:{id:o.id,email:o.email},templates:r},l=JSON.stringify(n,null,2),x=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(x),a=document.createElement("a"),y=new Date().toISOString().slice(0,10);a.href=b,a.download=`gymlog-templates-${y}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting templates:",t),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{De(!1)}}},at=()=>{!o||K||de.current&&(de.current.value="",de.current.click())},lt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{C([]),A([]);const r=await s.text();let n;try{n=JSON.parse(r)}catch{p("error"),d("Файл не является корректным JSON."),c(!0);return}if(!n||!Array.isArray(n.workouts)){p("error"),d("Файл не похож на экспорт тренировок из GymLog."),c(!0);return}if(!o)return;const l=Array.isArray(n.workouts)?n.workouts:[],x=new Set;l.forEach(g=>{const j=typeof g.date=="string"&&g.date?g.date:typeof g.workout_date=="string"&&g.workout_date?g.workout_date:"";j&&x.add(j)});const{data:b,error:a}=await w.from("workouts").select("workout_date").eq("user_id",o.id);if(a){console.error("Error checking existing workouts before import:",a),p("error"),d("Не удалось проверить существующие тренировки перед импортом."),c(!0);return}const y=new Set((b||[]).map(g=>g.workout_date)),u=y.size>0,i=new Map;l.forEach(g=>{const j=typeof g.date=="string"&&g.date?g.date:typeof g.workout_date=="string"&&g.workout_date?g.workout_date:"";j&&i.set(j,(i.get(j)||0)+1)});const f=[],k=[];x.forEach(g=>{y.has(g)?f.push(g):k.push(g)});const J=f.length>0;if(!u||!J){p("success"),D(!0);try{await me(n),d("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),c(!0)}catch(g){console.error("Error importing workouts:",g),alert("Не удалось импортировать тренировки: "+((g==null?void 0:g.message)||String(g)))}finally{D(!1)}return}if(k.length===0){p("error"),d("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),c(!0);return}if(L(n),M(s.name),k.length>0){const g=k.map(j=>({date:j,count:i.get(j)||0})).sort((j,se)=>se.date.localeCompare(j.date));C(k),A(g)}else C([]),A([]);P(!0)}catch(r){console.error("Error reading workouts import file:",r),alert("Не удалось прочитать файл тренировок.")}finally{t.target.value=""}},me=async t=>{if(!o)return;const s=Array.isArray(t.workouts)?t.workouts:[];if(s.length===0){p("error"),d("В файле нет тренировок для импорта."),c(!0);return}const{data:r,error:n}=await w.from("workouts").select("id, workout_date").eq("user_id",o.id);if(n)throw n;const l=new Set;s.forEach(a=>{const y=typeof a.date=="string"&&a.date?a.date:typeof a.workout_date=="string"&&a.workout_date?a.workout_date:"";y&&l.add(y)});const b=(r||[]).filter(a=>l.has(a.workout_date)).map(a=>a.id);if(b.length>0){const{data:a,error:y}=await w.from("workout_exercises").select("id, workout_id").in("workout_id",b);if(y)throw y;const u=(a||[]).map(i=>i.id);if(u.length>0){const{error:i}=await w.from("workout_sets").delete().in("workout_exercise_id",u);if(i)throw i}if(b.length>0){const{error:i}=await w.from("workout_exercises").delete().in("workout_id",b);if(i)throw i;const{error:f}=await w.from("workouts").delete().in("id",b);if(f)throw f}}for(const a of s){const y=typeof a.name=="string"&&a.name.trim().length>0?a.name.trim():"Импортированная тренировка",u=typeof a.date=="string"&&a.date?a.date:new Date().toISOString().slice(0,10),{data:i,error:f}=await w.from("workouts").insert({user_id:o.id,name:y,workout_date:u,is_cardio:!!a.isCardio,template_id:null}).select().single();if(f||!i)throw f||new Error("Не удалось создать тренировку при импорте.");const k=Array.isArray(a.exercises)?a.exercises:[];if(k.length===0)continue;const J=k.map((h,_)=>({workout_id:i.id,name:typeof h.name=="string"?h.name:"",position:typeof h.position=="number"?h.position:_+1,reps:typeof h.reps=="string"?h.reps:"",rest_seconds:typeof h.restSeconds=="number"?h.restSeconds:typeof h.rest_seconds=="number"?h.rest_seconds:150,sets:typeof h.setsPlanned=="number"?h.setsPlanned:Array.isArray(h.sets)?h.sets.length:1})),{data:g,error:j}=await w.from("workout_exercises").insert(J).select();if(j||!g)throw j||new Error("Не удалось создать упражнения при импорте.");const se=[],_t=[...k].sort((h,_)=>{const G=typeof h.position=="number"?h.position:0,pe=typeof _.position=="number"?_.position:0;return G-pe}),St=[...g].sort((h,_)=>{const G=typeof h.position=="number"?h.position:0,pe=typeof _.position=="number"?_.position:0;return G-pe});if(_t.forEach((h,_)=>{const G=St[_];if(!G)return;(Array.isArray(h.sets)?h.sets:[]).forEach(N=>{se.push({workout_exercise_id:G.id,set_index:typeof N.index=="number"?N.index:1,weight:typeof N.weight=="number"?N.weight:null,reps:N.reps==null?null:String(N.reps),is_done:!!N.isDone,updated_at:typeof N.updatedAt=="string"&&N.updatedAt?N.updatedAt:new Date().toISOString()})})}),se.length>0){const{error:h}=await w.from("workout_sets").insert(se);if(h)throw h}}},it=async()=>{if(E){z("import"),D(!0);try{await me(E),L(null),M(null),C([]),A([]),P(!1),p("success"),d("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),c(!0)}catch(t){console.error("Error importing workouts:",t),alert("Не удалось импортировать тренировки: "+((t==null?void 0:t.message)||String(t)))}finally{D(!1),z("none")}}},ct=async()=>{if(!E)return;const t=Array.isArray(E.workouts)?E.workouts:[];if(t.length===0){p("error"),d("В файле нет тренировок для импорта."),c(!0);return}const s=new Set(Ue);if(s.size===0){p("error"),d("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),c(!0);return}const r=t.filter(n=>{const l=typeof n.date=="string"&&n.date?n.date:typeof n.workout_date=="string"&&n.workout_date?n.workout_date:"";return!!l&&s.has(l)});if(r.length===0){p("error"),d("Не удалось определить новые тренировки для импорта. Проверьте файл."),c(!0);return}z("onlyNew"),D(!0);try{await me({workouts:r}),L(null),M(null),C([]),A([]),P(!1),p("success"),d("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),c(!0)}catch(n){console.error("Error importing only new workouts:",n),p("error"),d("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),c(!0)}finally{D(!1),z("none")}},dt=async()=>{if(E){z("exportThenImport"),D(!0);try{await Re(),await me(E),L(null),M(null),P(!1),p("success"),d("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),c(!0)}catch(t){console.error("Error exporting and importing workouts:",t),p("error"),d("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),c(!0)}finally{D(!1),z("none")}}},ut=()=>{!o||Q||ue.current&&(ue.current.value="",ue.current.click())},ye=async t=>{if(!o)return;const s=Array.isArray(t.templates)?t.templates:[];if(s.length===0){p("error"),d("В файле нет шаблонов для импорта."),c(!0);return}for(const r of s){const n=typeof r.name=="string"&&r.name.trim().length>0?r.name.trim():"Импортированный шаблон",{data:l,error:x}=await w.from("workout_templates").insert({user_id:o.id,name:n}).select().single();if(x||!l)throw x||new Error("Не удалось создать шаблон при импорте.");const b=Array.isArray(r.exercises)?r.exercises:[];if(b.length===0)continue;const a=b.map((u,i)=>({template_id:l.id,name:typeof u.name=="string"?u.name:"",sets:typeof u.sets=="number"?u.sets:1,reps:typeof u.reps=="string"?u.reps:"",rest_seconds:typeof u.restSeconds=="number"?u.restSeconds:typeof u.rest_seconds=="number"?u.rest_seconds:150,position:typeof u.position=="number"?u.position:i+1})),{error:y}=await w.from("template_exercises").insert(a);if(y)throw y}},mt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{const r=await s.text();let n;try{n=JSON.parse(r)}catch{p("error"),d("Файл не является корректным JSON."),c(!0);return}if(!n||!Array.isArray(n.templates)){p("error"),d("Файл не похож на экспорт шаблонов из GymLog."),c(!0);return}if(!o)return;const l=Array.isArray(n.templates)?n.templates:[];if(l.length===0){p("error"),d("В файле нет шаблонов для импорта."),c(!0);return}const{data:x,error:b}=await w.from("workout_templates").select("id, name").eq("user_id",o.id);if(b){console.error("Error checking existing templates before import:",b),p("error"),d("Не удалось проверить существующие шаблоны перед импортом."),c(!0);return}const a=f=>typeof f=="string"?f.trim().toLowerCase():"",y=new Map;(x||[]).forEach(f=>{const k=a(f.name);k&&(y.has(k)||y.set(k,{id:f.id,name:f.name||""}))});const u=[],i=[];if(l.forEach(f=>{const k=a(f==null?void 0:f.name);if(!k||!y.has(k))u.push(f);else{const J=y.get(k);i.push({existingId:J.id,existingName:J.name||"",template:f})}}),u.length===0&&i.length>0){p("error"),d("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),c(!0);return}if(i.length===0){T(!0);try{await ye({templates:l}),p("success"),d("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),c(!0)}catch(f){console.error("Error importing templates:",f),p("error"),d("Не удалось импортировать шаблоны. Попробуйте ещё раз."),c(!0)}finally{T(!1)}return}ne(u),ae(i),O(!0)}catch(r){console.error("Error importing templates:",r),p("error"),d("Не удалось импортировать шаблоны. Попробуйте ещё раз."),c(!0)}finally{T(!1),t.target.value=""}},pt=async()=>{if(oe.length===0){O(!1),ae([]),ne([]),p("error"),d("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),c(!0);return}le("onlyNew"),T(!0);try{await ye({templates:oe}),ne([]),ae([]),O(!1),p("success"),d("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),c(!0)}catch(t){console.error("Error importing only new templates:",t),p("error"),d("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),c(!0)}finally{T(!1),le("none")}},ft=async()=>{if(!(!o||F)){Ie(!0),ee([]);try{const{data:t,error:s}=await w.from("workouts").select("id, workout_date").eq("user_id",o.id).order("workout_date",{ascending:!1});if(s){console.error("Error loading workouts for deletion:",s),alert("Не удалось загрузить список тренировок для удаления.");return}const r=new Map;(t||[]).forEach(l=>{const x=l.workout_date,b=l.id;!x||!b||(r.has(x)||r.set(x,[]),r.get(x).push(b))});const n=Array.from(r.entries()).map(([l,x])=>({date:l,workoutIds:x,count:x.length})).sort((l,x)=>x.date.localeCompare(l.date));if(n.length===0){p("error"),d("У вас нет тренировок для удаления."),c(!0);return}Ae(n),Z(!1),ie(!0)}catch(t){console.error("Unexpected error while loading workouts for deletion:",t),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{Ie(!1)}}},gt=async()=>{if(!(!o||$)){Ce(!0),te([]);try{const{data:t,error:s}=await w.from("workout_templates").select("id, name").eq("user_id",o.id).order("created_at",{ascending:!1});if(s){console.error("Error loading templates for deletion:",s),alert("Не удалось загрузить список шаблонов для удаления.");return}const r=(t||[]).map(n=>({id:n.id,name:n.name||"Без названия"}));if(r.length===0){p("error"),d("У вас нет шаблонов для удаления."),c(!0);return}Te(r),Z(!1),ce(!0)}catch(t){console.error("Unexpected error while loading templates for deletion:",t),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{Ce(!1)}}},xt=t=>{ee(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ht=()=>{if(v.length===0)return;const t=W.length===v.length;ee(t?[]:v.map(s=>s.date))},wt=()=>{ee([])},bt=t=>{te(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},yt=()=>{if(I.length===0)return;const t=R.length===I.length;te(t?[]:I.map(s=>s.id))},kt=()=>{te([])},jt=async()=>{if(!o||W.length===0)return;const t=v.filter(s=>W.includes(s.date)).flatMap(s=>s.workoutIds);if(t.length!==0){Oe(!0);try{const{data:s,error:r}=await w.from("workout_exercises").select("id, workout_id").in("workout_id",t);if(r)throw r;const n=(s||[]).map(l=>l.id);if(n.length>0){const{error:l}=await w.from("workout_sets").delete().in("workout_exercise_id",n);if(l)throw l}if(t.length>0){const{error:l}=await w.from("workout_exercises").delete().in("workout_id",t);if(l)throw l;const{error:x}=await w.from("workouts").delete().in("id",t);if(x)throw x}ie(!1),Ae([]),ee([]),p("success"),d("Выбранные тренировки успешно удалены."),c(!0)}catch(s){console.error("Error deleting workouts:",s),p("error"),d("Не удалось удалить выбранные тренировки."),c(!0)}finally{Oe(!1)}}},Nt=async()=>{if(o&&R.length!==0){We(!0);try{const t=R;if(t.length>0){const{error:s}=await w.from("template_exercises").delete().in("template_id",t);if(s)throw s;const{error:r}=await w.from("workout_templates").delete().in("id",t);if(r)throw r}ce(!1),Te([]),te([]),p("success"),d("Выбранные шаблоны тренировок успешно удалены."),c(!0)}catch(t){console.error("Error deleting templates:",t),p("error"),d("Не удалось удалить выбранные шаблоны тренировок."),c(!0)}finally{We(!1)}}},vt=async()=>{if(X.length===0&&oe.length===0){O(!1);return}le("overwrite"),T(!0);try{const t=Array.from(new Set(X.map(r=>r.existingId)));if(t.length>0){const{error:r}=await w.from("template_exercises").delete().in("template_id",t);if(r)throw r;const{error:n}=await w.from("workout_templates").delete().in("id",t);if(n)throw n}const s=[...oe,...X.map(r=>r.template)];await ye({templates:s}),ne([]),ae([]),O(!1),p("success"),d("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),c(!0)}catch(t){console.error("Error overwriting templates:",t),alert("Не удалось импортировать шаблоны с перезаписью: "+((t==null?void 0:t.message)||String(t)))}finally{T(!1),le("none")}},Pe=v.length>0&&W.length===v.length,Le=I.length>0&&R.length===I.length;return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative",style:{background:"#0a0a0b"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsxs("div",{className:"relative",ref:be,children:[e.jsx("button",{onClick:()=>S(!re),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),re&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{S(!1),at()},disabled:K,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:K?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{S(!1),ut()},disabled:Q,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Q?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{S(!1),await Re()},disabled:ve,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:ve?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{S(!1),await nt()},disabled:Se,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Se?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{S(!1),rt()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{S(!1),st()},disabled:ke,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:ke?"Удаление...":"Удалить аккаунт"})]})]})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:o&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),q?e.jsxs("span",{className:"font-semibold",children:[q.visiblePart,q.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>Xe(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:Qe?e.jsx("span",{children:q.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,q.hiddenPart.length))})}),"@",q.domain]}):e.jsx("span",{className:"font-semibold",children:Ze})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>fe("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary",children:"Узнать прогресс"}),e.jsx("button",{onClick:tt,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"})]}),e.jsx("input",{ref:de,type:"file",accept:"application/json",className:"hidden",onChange:lt}),e.jsx("input",{ref:ue,type:"file",accept:"application/json",className:"hidden",onChange:mt}),e.jsx(It,{open:ze,onOpenChange:t=>{Ne(t),t||(xe(""),H(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:ge.trim().length===0,onConfirm:ot,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:o==null?void 0:o.email})]}),e.jsx("input",{type:"email",value:ge,onChange:t=>{xe(t.target.value),he&&H(null)},placeholder:(o==null?void 0:o.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),he&&e.jsx("p",{className:"text-xs text-red-400",children:he})]})}),Ve&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{F||$||Z(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),(F||$)&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:ft,disabled:F||$,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:gt,disabled:F||$,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{F||$||Z(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]}),He&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{U||ie(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:ht,disabled:v.length===0||U,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${Pe?"bg-green-500 border-green-400":"border-white/40"}`,children:Pe&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:wt,disabled:W.length===0||U,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[v.map(t=>{const s=W.includes(t.date);return e.jsxs("button",{type:"button",onClick:()=>xt(t.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.date}),e.jsx("div",{className:"text-xs text-gray-400",children:t.count===1?"1 тренировка":`${t.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.date)}),v.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:jt,disabled:W.length===0||U,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:U?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{U||ie(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),Ke&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{B||ce(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:yt,disabled:I.length===0||B,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${Le?"bg-green-500 border-green-400":"border-white/40"}`,children:Le&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:kt,disabled:R.length===0||B,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[I.map(t=>{const s=R.includes(t.id);return e.jsxs("button",{type:"button",onClick:()=>bt(t.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.id)}),I.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:Nt,disabled:R.length===0||B,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:B?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{B||ce(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),e.jsx(Ct,{open:Be,onOpenChange:t=>{t||(c(!1),d(null))},onClose:()=>{c(!1),d(null)},message:qe||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:Je}),Ge&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{Q||O(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[X.map((t,s)=>{var r;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((r=t.template)==null?void 0:r.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",t.existingName||"Без названия","»"]})]},t.existingId+"-"+s)}),X.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),Q?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:Ye==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:pt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:vt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:()=>{O(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),Fe&&E&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{K||(P(!1),L(null),M(null),C([]),A([]))}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${$e||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),we.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:we.map(t=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:et(t.date)})},t.date))})]}),K?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:Ee==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":Ee==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[we.length>0&&e.jsx("button",{type:"button",onClick:ct,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:it,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:dt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:()=>{P(!1),L(null),M(null),C([]),A([])},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})]})};export{zt as default};
