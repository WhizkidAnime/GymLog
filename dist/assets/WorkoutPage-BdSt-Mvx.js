import{j as e,s as J,u as Ce,W as Se}from"./index-42bJkKlu.js";import{f as _e,r as n,e as Ee,c as ye,L as De,j as Le,u as Re}from"./vendor-BVca5W6X.js";import{u as pe}from"./useDebounce-C2cqH541.js";import{C as Ie}from"./confirm-dialog-D7qQ8hrI.js";import{c as ge,f as Me}from"./date-helpers-BoyNci5t.js";import{n as je,p as Te}from"./exercise-name-BJxyXXn3.js";import{W as ke}from"./workout-icons-DcUcUM9V.js";import{u as Ae}from"./use-modal-scroll-lock-DlG-D3y9.js";import{u as We}from"./use-workout-actions-menu-C-5wTXkz.js";import{u as Oe}from"./usePageState-6XNG0ilq.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";const Fe=({set:t,previousSet:s,onChange:r,onAddDropset:f,onDeleteDropset:i,isLastInGroup:w})=>{const h=`workout_set_draft:${t.id}`,o=`workout_set_last_non_max_reps:${t.id}`,E=p=>p==null?"":String(p).replace(".",","),A=p=>{if(p==="")return null;const g=Number(p.replace(",","."));return Number.isFinite(g)?g:null},I=p=>{let g=p.replace(".",",");g=g.replace(/[^\d,]/g,"");const D=g.indexOf(",");return D!==-1&&(g=g.slice(0,D+1)+g.slice(D+1).replace(/,/g,"")),g},_="макс.",$=p=>p==null?"":p==="0"?_:p,v=p=>{const g=p.trim();if(g==="")return null;const D=g.toLowerCase();return D==="макс"||D==="макс."||/^0+$/.test(g)?"0":g},k=p=>{const g=p.trim();return g===""?"":/^0+$/.test(g)||g.toLowerCase().startsWith("макс")?_:g.replace(/[^0-9]/g,"")},C=$(t.reps),[W,q]=n.useState(E(t.weight)),[L,O]=n.useState(C),[Y,j]=n.useState(v(C)==="0"?null:C||null),[c,l]=n.useState(t.is_done),[m,S]=n.useState(!1),[u,y]=n.useState(()=>v(C)==="0"),R=pe(W,500),N=pe(L,500),V=!(t.is_dropset??!1)&&!!s&&s.is_done&&s.weight!==null&&A(W)===null,X=p=>{j(p);try{p&&p.trim()!==""?localStorage.setItem(o,p):localStorage.removeItem(o)}catch{}};n.useEffect(()=>{try{const p=localStorage.getItem(h);if(!p)return;const g=JSON.parse(p),D=new Date(t.updated_at).getTime();if(g.updatedAt>D){q(g.weight===""?"":E(g.weight));const T=$(g.reps);O(T);const B=v(T)==="0"?null:T||null;X(B),l(g.isDone)}}catch{}},[]),n.useEffect(()=>{l(t.is_done)},[t.is_done]),n.useEffect(()=>{if(t.reps==="0")try{const p=localStorage.getItem(o);p&&p.trim()!==""&&j(p)}catch{}},[t.reps,o]);const F=_e.useRef(r);n.useEffect(()=>{F.current=r},[r]),n.useEffect(()=>{(async()=>{var T;const g=A(R),D=v(N);if(g!==(t.weight??null)||D!==(t.reps??null)||c!==t.is_done){const B={weight:g===null?"":g,reps:D,isDone:c,updatedAt:Date.now()};try{localStorage.setItem(h,JSON.stringify(B))}catch{}S(!0);const{error:Q}=await J.from("workout_sets").update({weight:g,reps:D,is_done:c,updated_at:new Date().toISOString()}).eq("id",t.id);if(Q)console.error("Error saving set:",Q);else{try{localStorage.removeItem(h)}catch{}const oe={...t,weight:g,reps:D,is_done:c,updated_at:new Date().toISOString()};(T=F.current)==null||T.call(F,oe)}setTimeout(()=>S(!1),500)}})()},[R,N,t.id,t.weight,t.reps,t.is_done,c,h]),n.useEffect(()=>{const p=A(R)!==null,g=v(N)!==null,D=p&&g;D&&!c?l(!0):!D&&c&&l(!1)},[R,N,c]);const U=c?"bg-green-500":"bg-transparent",ee=c?"text-black":"text-inherit",te=c?"setrow-input-done-white":"",x=v(L)==="0",b=u||x,a=()=>{const p=v(L),g=p!==null&&p!=="0";if(b)x&&(Y!==null&&Y.trim()!==""?O(Y):O("")),y(!1);else{if(g){y(!0);return}v(L)!=="0"&&L.trim()!==""&&X(L),O(_),y(!0)}},d=t.is_dropset??!1,H=c?d?d&&c?"bg-purple-500/80":"":U:d?"bg-purple-500/10 border-l-2 border-purple-500/50 ml-3":"";return e.jsxs("div",{className:`relative grid grid-cols-6 gap-3 items-center p-2 rounded-md transition-colors duration-300 ${H||U}`,children:[e.jsxs("div",{className:`col-span-1 text-center font-medium ${ee} flex items-center justify-center`,children:[d&&e.jsx("span",{className:`text-xs mr-0.5 dropset-indicator ${c?"is-done":""}`,children:"↳"}),e.jsx("span",{children:d?"ДС":t.set_index}),!d&&w&&f&&e.jsx("button",{type:"button",onClick:()=>f(t.id),"aria-label":"Добавить дропсет",className:`absolute left-12 w-5 h-5 flex items-center justify-center rounded transition-colors flex-shrink-0 dropset-btn ${c?"is-done hover:bg-black/10":"hover:bg-white/10"}`,title:"Добавить дропсет",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})})})]}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0",value:W,onChange:p=>q(I(p.target.value)),className:`w-[72px] p-1 text-center rounded-md border-gray-600 shadow-sm placeholder:text-gray-400 focus:placeholder-transparent outline-none focus-visible:outline-none setrow-input ${te} ${ee}`})}),V&&e.jsx("button",{type:"button",onClick:()=>{!s||s.weight===null||q(E(s.weight))},"aria-label":"Скопировать вес из предыдущего подхода",className:"btn-glass btn-glass-icon-round btn-glass-secondary absolute text-white h-6 w-6 p-0",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",transition:"none",width:"1.5rem",height:"1.5rem",minWidth:"1.5rem",minHeight:"1.5rem",padding:0},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"12",height:"12",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"5 15 12 8 19 15"})})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"0",value:L,onChange:p=>{const g=k(p.target.value);if(O(g),v(g)!=="0"){const D=g.trim()===""?null:g;X(D)}},className:`w-[64px] p-1 text-center rounded-md border-gray-600 shadow-sm placeholder:text-gray-400 focus:placeholder-transparent outline-none focus-visible:outline-none setrow-input ${te} ${ee}`})}),e.jsxs("div",{className:"col-span-1 flex items-center justify-center",children:[!d&&e.jsx("input",{type:"checkbox",checked:b,onChange:a,"aria-label":"Подход в отказ (макс.)",className:"h-6 w-6 rounded-md border border-gray-300 bg-white outline-none focus-visible:outline-none flex-shrink-0",style:{accentColor:"#000000",color:"#0a0a0a"}}),d&&e.jsxs("div",{className:"flex items-center justify-end gap-1 w-14",children:[w&&f?e.jsx("button",{type:"button",onClick:()=>f(t.id),"aria-label":"Добавить дропсет",className:`w-6 h-6 flex items-center justify-center rounded transition-colors flex-shrink-0 font-bold dropset-btn ${c?"is-done hover:bg-black/10":"hover:bg-white/20"}`,title:"Добавить дропсет",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{d:"M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"})})}):e.jsx("div",{className:"w-6 h-6 flex-shrink-0"}),i&&e.jsx("button",{type:"button",onClick:()=>i(t.id),"aria-label":"Удалить дропсет",className:`w-6 h-6 flex items-center justify-center rounded transition-colors flex-shrink-0 font-bold dropset-btn ${c?"is-done hover:bg-black/10":"hover:bg-white/20"}`,title:"Удалить дропсет",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:e.jsx("path",{fillRule:"evenodd",d:"M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z",clipRule:"evenodd"})})})]})]}),m&&e.jsx("div",{className:"absolute right-2 top-2 h-2 w-2 bg-blue-500 rounded-full animate-ping"})]})},Be=_e.memo(Fe,(t,s)=>{var r,f,i,w;return t.set.id===s.set.id&&t.set.weight===s.set.weight&&t.set.reps===s.set.reps&&t.set.is_done===s.set.is_done&&t.set.set_index===s.set.set_index&&t.set.updated_at===s.set.updated_at&&t.set.is_dropset===s.set.is_dropset&&t.set.parent_set_index===s.set.parent_set_index&&((r=t.previousSet)==null?void 0:r.weight)===((f=s.previousSet)==null?void 0:f.weight)&&((i=t.previousSet)==null?void 0:i.is_done)===((w=s.previousSet)==null?void 0:w.is_done)&&t.isLastInGroup===s.isLastInGroup&&t.onAddDropset===s.onAddDropset&&t.onDeleteDropset===s.onDeleteDropset}),xe=()=>{try{const t=localStorage.getItem("settings:timerStep");return t?Number(t):30}catch{return 30}},qe=({restSeconds:t,exerciseId:s,onAdjustRestSeconds:r,timerStep:f})=>{const i=s?`rest_timer:${s}`:void 0,[w,h]=n.useState(()=>f??xe());n.useEffect(()=>{if(f!==void 0)h(f);else{const j=()=>{h(xe())};window.addEventListener("storage",j);const c=()=>{h(xe())};return window.addEventListener("focus",c),()=>{window.removeEventListener("storage",j),window.removeEventListener("focus",c)}}},[f]);const o=n.useRef(null),E=n.useRef(t),A=n.useRef({time:t,isActive:!1,endAt:null}),[I,_]=n.useState(()=>{if(!i)return{time:t,isActive:!1,endAt:null};try{const j=localStorage.getItem(i);if(!j)return{time:t,isActive:!1,endAt:null};const c=JSON.parse(j),l=360*60*1e3;if(Date.now()-c.savedAt>l)return localStorage.removeItem(i),{time:t,isActive:!1,endAt:null};if(c.isActive&&c.endAt){const m=Math.max(0,Math.floor((c.endAt-Date.now())/1e3));return m>0?{time:m,isActive:!0,endAt:c.endAt}:(localStorage.removeItem(i),{time:c.restSeconds,isActive:!1,endAt:null})}return{time:c.restSeconds,isActive:!1,endAt:null}}catch(j){return console.error("Error restoring timer state:",j),{time:t,isActive:!1,endAt:null}}}),{time:$,isActive:v,endAt:k}=I,C=n.useCallback((j,c)=>{if(i)try{const l={endAt:j.endAt,isActive:j.isActive,restSeconds:c??A.current.time??t,savedAt:Date.now()};localStorage.setItem(i,JSON.stringify(l))}catch(l){console.error("Error persisting timer:",l)}},[i,t]),W=n.useRef(C);n.useEffect(()=>{W.current=C},[C]),n.useEffect(()=>{A.current={time:$,isActive:v,endAt:k}},[$,v,k]),n.useEffect(()=>{if(!v||!k){o.current&&(window.clearInterval(o.current),o.current=null);return}let j=!1;const c=()=>{if(j)return;const m=Date.now(),S=Math.max(0,k-m),u=Math.floor(S/1e3);_(y=>({...y,time:u})),u<=0&&(j=!0,_(y=>({...y,isActive:!1,endAt:null,time:t})),o.current&&(window.clearInterval(o.current),o.current=null),i&&localStorage.removeItem(i))};c();const l=window.setInterval(c,1e3);return o.current=l,()=>{j=!0,o.current&&(window.clearInterval(o.current),o.current=null)}},[v,k,i,t]),n.useEffect(()=>{!v&&t!==E.current&&_(j=>({...j,time:t})),E.current=t},[t,v]),n.useEffect(()=>()=>{o.current&&(window.clearInterval(o.current),o.current=null);const{isActive:j,endAt:c}=A.current;j&&c&&W.current({endAt:c,isActive:!0})},[]);const q=()=>{_(j=>{if(j.isActive)return C({endAt:null,isActive:!1},j.time),o.current&&(window.clearInterval(o.current),o.current=null),{time:j.time,isActive:!1,endAt:null};const c=Date.now()+j.time*1e3;return C({endAt:c,isActive:!0},j.time),{time:j.time,isActive:!0,endAt:c}})},L=()=>{_({time:t,isActive:!1,endAt:null}),o.current&&(window.clearInterval(o.current),o.current=null),i&&localStorage.removeItem(i)},O=j=>{_(c=>{const l=Math.max(0,c.time+j);if(l===0)return C({endAt:null,isActive:!1},0),o.current&&(window.clearInterval(o.current),o.current=null),{time:0,isActive:!1,endAt:null};if(c.isActive){const m=Date.now()+l*1e3;return C({endAt:m,isActive:!0},l),{time:l,isActive:!0,endAt:m}}return C({endAt:null,isActive:!1},l),{time:l,isActive:!1,endAt:null}}),r==null||r(j)},Y=j=>{const c=Math.floor(j/60),l=j%60;return`${c}:${l<10?"0":""}${l}`};return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>O(-w),disabled:$<=0&&!v,className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"-"}),e.jsx("div",{className:`text-6xl font-mono font-semibold leading-none min-w-[4ch] text-center ${v?"text-white":""}`,children:Y($)}),e.jsx("button",{onClick:()=>O(w),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"+"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:q,className:`btn-glass btn-glass-icon-lg ${v?"btn-glass-danger":"btn-glass-primary"}`,children:v?"Стоп":"Старт"}),e.jsx("button",{onClick:L,className:"btn-glass btn-glass-icon-sm btn-glass-secondary",children:"Сброс"})]})]})},Ke=7200*1e3,ve=new Map,He=(t,s,r)=>`${t}:${s}:${r||"none"}`,Pe=t=>{const s=ve.get(t);if(!s)return;if(Date.now()-s.timestamp>Ke){ve.delete(t);return}return s.data},he=(t,s)=>{ve.set(t,{data:s,timestamp:Date.now()})},Ve=({exercise:t,workoutDate:s,onUpdateExercise:r,onDeleteExercise:f})=>{var te;const[i,w]=n.useState(t.name),[h,o]=n.useState(t.sets),[E,A]=n.useState(t.rest_seconds),[I,_]=n.useState(!1),[$,v]=n.useState(null),[k,C]=n.useState("idle"),W=n.useRef(null),{user:q}=Ce(),L=pe(i,500),O=pe(E,500),[Y,j]=n.useState(!1),c=n.useRef(t.name),l=n.useRef(t);n.useEffect(()=>{l.current=t},[t]);const m=n.useCallback(()=>{const x=W.current;x&&(x.style.height="auto",x.style.height=`${x.scrollHeight}px`)},[]);n.useEffect(()=>{t.name!==c.current&&(w(t.name),c.current=t.name),o(t.sets),A(t.rest_seconds)},[t.id,t.sets,t.rest_seconds]),n.useEffect(()=>{if(!q)return;const x=L.trim(),b=je(x);if(!b){v(null),C("idle");return}const a=He(q.id,b,s??null),d=Pe(a);if(d!==void 0){v(d),C("ready");return}let M=!1;return C("loading"),(async()=>{try{let H=J.from("workouts").select("id, workout_date, name, user_id").eq("user_id",q.id);s&&(H=H.lt("workout_date",s));const{data:p,error:g}=await H.order("workout_date",{ascending:!0});if(M)return;if(g)throw g;const D=(p||[]).map(K=>({id:K.id,date:K.workout_date,name:K.name})),T=new Map;D.forEach(K=>T.set(K.id,{date:K.date,name:K.name}));const B=D.map(K=>K.id);if(B.length===0){v(null),he(a,null),C("ready");return}const{data:Q,error:oe}=await J.from("workout_exercises").select("id, name, workout_id").in("workout_id",B);if(M)return;if(oe)throw oe;const se=new Set,re=new Map;if((Q||[]).forEach(K=>{const de=(K.name??"").trim();if(de&&je(de)===b){const Z=K.id;se.add(Z);const ue=K.workout_id;ue&&re.set(Z,ue)}}),se.size===0){v(null),he(a,null),C("ready");return}const{data:ae,error:le}=await J.from("exercise_progress_view").select("workout_date, workout_name, workout_id, exercise_id, max_weight, reps_at_max_weight").in("workout_id",B).in("exercise_id",Array.from(se));if(M)return;if(le)throw le;let ie=(ae||[]).map(K=>({workout_date:K.workout_date,workout_name:K.workout_name,workout_id:K.workout_id,exercise_id:K.exercise_id,max_weight:K.max_weight,reps_at_max_weight:K.reps_at_max_weight}));if(ie.length===0){const{data:K,error:de}=await J.from("workout_sets").select("id, workout_exercise_id, weight, reps, is_done, updated_at").in("workout_exercise_id",Array.from(se)).order("updated_at",{ascending:!1});if(M)return;if(de)throw de;ie=(K||[]).filter(Z=>Z.weight!==null&&Number(Z.weight)===0).filter(Z=>Z.is_done||typeof Z.reps=="string"&&Z.reps.trim()!=="").map(Z=>{const ue=Z.workout_exercise_id,me=re.get(ue);if(!me)return null;const ne=T.get(me);return ne?{workout_date:ne.date,workout_name:ne.name,workout_id:me,exercise_id:ue,max_weight:0,reps_at_max_weight:Z.reps}:null}).filter(Z=>Z!==null)}if(ie.length===0){v(null),he(a,null),C("ready");return}const ce=Te(x,ie),fe=ce.dataPoints[ce.dataPoints.length-1];if(!fe){v(null),he(a,null),C("ready");return}const we={weight:fe.weight,reps:fe.reps,workoutDate:fe.date};v(we),he(a,we),C("ready")}catch(H){console.error("Failed to fetch last exercise performance",H),C("error")}})(),()=>{M=!0}},[L,q,s]),n.useLayoutEffect(()=>{m()},[m,i]),n.useLayoutEffect(()=>{if(typeof ResizeObserver>"u")return;const x=W.current;if(!x)return;const b=new ResizeObserver(()=>{m()});return b.observe(x),()=>b.disconnect()},[m]),n.useEffect(()=>{(async()=>{if(!(L.trim()===""||L===t.name))try{await J.from("workout_exercises").update({name:L}).eq("id",t.id);const b={...t,name:L};c.current=L,r(b)}catch(b){console.error("Failed to update exercise name",b)}})()},[L]),n.useEffect(()=>{(async()=>{if(O!==t.rest_seconds)try{await J.from("workout_exercises").update({rest_seconds:O}).eq("id",t.id);const b={...t,rest_seconds:O};r(b)}catch(b){console.error("Failed to update rest seconds",b)}})()},[O,t,r]);const S=x=>{A(b=>Math.max(0,b+x))},u=async x=>{if(!(x<1||x===h||I)){_(!0);try{if(x>h){const b=Array.from({length:x-h},(H,p)=>({workout_exercise_id:t.id,set_index:h+p+1,is_dropset:!1})),{data:a,error:d}=await J.from("workout_sets").insert(b).select();if(d)throw d;const M=[...t.workout_sets,...a||[]].sort((H,p)=>{const g=H.is_dropset??!1,D=p.is_dropset??!1,T=g?H.parent_set_index??H.set_index:H.set_index,B=D?p.parent_set_index??p.set_index:p.set_index;return T!==B?T-B:g!==D?g?1:-1:H.set_index-p.set_index});await J.from("workout_exercises").update({sets:x}).eq("id",t.id);const z={...t,sets:x,workout_sets:M};r(z)}else{const a=t.workout_sets.filter(p=>!p.is_dropset&&p.set_index>x).map(p=>p.id),d=new Set(a);let M=0;for(const p of t.workout_sets){if(!p.is_dropset&&p.set_index>x){d.add(p.id);let g=M+1;for(;g<t.workout_sets.length&&t.workout_sets[g].is_dropset;)d.add(t.workout_sets[g].id),g++}M++}if(d.size>0){const{error:p}=await J.from("workout_sets").delete().in("id",Array.from(d));if(p)throw p}const z=t.workout_sets.filter(p=>!d.has(p.id));await J.from("workout_exercises").update({sets:x}).eq("id",t.id);const H={...t,sets:x,workout_sets:z};r(H)}o(x)}catch(b){console.error("Failed to change sets count",b),alert("Не удалось изменить количество подходов")}finally{_(!1)}}},y=async()=>{const{error:x}=await J.from("workout_sets").delete().eq("workout_exercise_id",t.id);if(x){console.error("Failed to delete sets of exercise",x),alert("Не удалось удалить подходы упражнения. Попробуйте снова.");return}const{error:b}=await J.from("workout_exercises").delete().eq("id",t.id);if(b){console.error("Failed to delete exercise",b),alert("Не удалось удалить упражнение. Попробуйте снова.");return}f&&f(t.id)},R="макс.",N=x=>x==null?"—":String(x).replace(".",","),P=x=>{if(x==null)return"—";const b=x.trim();return b?b==="0"?R:b:"—"},V=()=>i.trim()?k==="loading"?e.jsx("span",{className:"text-gray-400",children:"Поиск последнего результата…"}):k==="error"?e.jsx("span",{className:"text-red-300",children:"Не удалось загрузить данные"}):$?e.jsxs("span",{className:"text-white text-base font-semibold",children:[N($.weight)," кг × ",P($.reps)]}):e.jsx("span",{className:"text-gray-500",children:"До этой даты нет данных по этому упражнению"}):e.jsx("span",{className:"text-gray-500",children:"Введите название, чтобы увидеть прошлый результат"}),X=n.useCallback(x=>{const b=l.current,a={...b,workout_sets:b.workout_sets.map(d=>d.id===x.id?x:d)};r(a)},[r]),F=n.useCallback(async x=>{const b=l.current,a=b.workout_sets.findIndex(M=>M.id===x);if(a===-1)return;const d=b.workout_sets[a];try{const M=d.is_dropset?d.parent_set_index??d.set_index:d.set_index,H=Math.max(...b.workout_sets.map(Q=>Q.set_index))+1,{data:p,error:g}=await J.from("workout_sets").insert({workout_exercise_id:b.id,set_index:H,weight:null,reps:null,is_done:!1,is_dropset:!0,parent_set_index:M,updated_at:new Date().toISOString()}).select().single();if(g)throw g;let D=a+1;for(;D<b.workout_sets.length&&b.workout_sets[D].is_dropset;)D++;const T=[...b.workout_sets];T.splice(D,0,p);const B={...b,workout_sets:T};r(B)}catch(M){console.error("Failed to add dropset",M),alert("Не удалось добавить дропсет")}},[r]),U=n.useCallback(async x=>{const b=l.current,a=b.workout_sets.find(d=>d.id===x);if(!(!a||!a.is_dropset))try{const{error:d}=await J.from("workout_sets").delete().eq("id",x);if(d)throw d;const M={...b,workout_sets:b.workout_sets.filter(z=>z.id!==x)};r(M)}catch(d){console.error("Failed to delete dropset",d),alert("Не удалось удалить дропсет")}},[r]),ee=n.useCallback((x,b,a)=>{const d=a[b+1];return x.is_dropset,!d||!d.is_dropset},[]);return e.jsxs("div",{id:`exercise-${t.id}`,className:"glass card-dark p-4 exercise-card",children:[e.jsxs("div",{className:"exercise-card-header mb-3",children:[e.jsxs("div",{className:"name-wrap relative",children:[e.jsx("textarea",{value:i,onChange:x=>w(x.target.value),ref:W,rows:1,className:"w-full text-base sm:text-lg font-bold text-white whitespace-pre-wrap bg-white/10 hover:bg-white/15 focus:bg-white/10 border border-white/20 hover:border-white/30 focus:border-white/50 focus:ring-2 focus:ring-white/25 focus:outline-none rounded-xl px-4 pr-9 py-3 min-h-[3rem] resize-none overflow-y-hidden leading-relaxed transition-colors"}),i&&i.trim()!==""&&e.jsx("button",{type:"button",onClick:()=>{w(""),requestAnimationFrame(()=>m())},"aria-label":"Очистить",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-white/10 text-gray-300",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx("button",{"aria-label":"Удалить упражнение",className:"delete-btn btn-glass btn-glass-icon btn-glass-outline",onClick:()=>j(!0),type:"button",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M8 6l1-2h6l1 2"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl bg-white/5 px-4 py-3 text-xs sm:text-sm text-gray-300",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-3",children:[e.jsx("span",{className:"font-semibold text-white",children:"Последний рабочий вес"}),($==null?void 0:$.workoutDate)&&e.jsx("span",{className:"text-[0.7rem] uppercase tracking-wide text-gray-400",children:ge($.workoutDate)})]}),V()]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(qe,{restSeconds:E,exerciseId:t.id,onAdjustRestSeconds:S})}),e.jsxs("div",{className:"flex items-center justify-between text-sm py-3 sm:py-4 px-2 rounded-lg exercise-row-header",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"whitespace-nowrap font-medium",children:"Подходы:"}),e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("button",{disabled:I||h<=1,onClick:()=>u(h-1),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"−"}),e.jsx("span",{className:"min-w-[3ch] text-center text-white font-semibold",children:h}),e.jsx("button",{disabled:I||h>=30,onClick:()=>u(h+1),className:"btn-glass btn-glass-icon-round btn-glass-secondary",children:"+"})]})]}),((te=t.reps)==null?void 0:te.trim())&&e.jsxs("div",{className:"ml-3 flex-1 text-right whitespace-nowrap font-medium",children:["Повторы: ",t.reps]})]})]}),e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 text-sm sm:text-base font-semibold px-2 sm:px-3 py-2 rounded-lg overflow-hidden exercise-sets-header",children:[e.jsx("div",{className:"col-span-1 flex items-center justify-start pl-1 sm:pl-2 whitespace-nowrap",children:"Подход"}),e.jsx("div",{className:"col-span-2 flex items-center justify-center whitespace-nowrap",children:"Вес (кг)"}),e.jsx("div",{className:"col-span-2 flex items-center justify-center whitespace-nowrap",children:"Повторы"}),e.jsx("div",{className:"col-span-1 flex items-center justify-end pr-1 sm:pr-2 whitespace-nowrap",children:"В отказ"})]}),e.jsx("div",{className:"space-y-2",children:t.workout_sets.map((x,b,a)=>{let d;if(!x.is_dropset){for(let M=b-1;M>=0;M--)if(!a[M].is_dropset){d=a[M];break}}return e.jsx(Be,{set:x,previousSet:d,onChange:X,onAddDropset:F,onDeleteDropset:U,isLastInGroup:ee(x,b,a)},x.id)})})]}),e.jsx(Ie,{open:Y,onOpenChange:j,title:"Удалить упражнение?",description:t.name?`Вы собираетесь удалить упражнение "${t.name}". Действие необратимо.`:"Вы собираетесь удалить упражнение. Действие необратимо.",cancelText:"Отмена",variant:"danger",onConfirm:y})]})},Ye=_e.memo(Ve,(t,s)=>{const r=t.exercise,f=s.exercise;if(r.id!==f.id||r.name!==f.name||r.sets!==f.sets||r.rest_seconds!==f.rest_seconds||r.reps!==f.reps||t.workoutDate!==s.workoutDate||r.workout_sets.length!==f.workout_sets.length)return!1;for(let i=0;i<r.workout_sets.length;i++){const w=r.workout_sets[i],h=f.workout_sets[i];if(w.id!==h.id||w.weight!==h.weight||w.reps!==h.reps||w.is_done!==h.is_done||w.is_dropset!==h.is_dropset||w.parent_set_index!==h.parent_set_index)return!1}return!0}),$e=({normalizedDate:t,className:s=""})=>{const r=Ee();return e.jsx("button",{onClick:()=>r("/calendar",{state:{refreshDate:t}}),className:`inline-flex items-center justify-center p-2 rounded-full border border-transparent text-white transition-colors z-10 bg-transparent hover:border-white active:border-white focus:outline-none back-button-plain ${s}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})},Je=({normalizedDate:t,workoutName:s,isEditingName:r,editNameValue:f,isSavingWorkoutName:i,isScrolling:w,inputRef:h,onStartEditName:o,onChangeEditName:E,onSaveEditName:A,onCancelEditName:I,actionsRef:_,actionsBtnRef:$,onToggleActions:v,workoutIcon:k,editIconValue:C,onOpenIconPicker:W})=>{const q=r?C:k,L=q?ke[q]:null;return e.jsxs("div",{className:`glass card-dark p-4 flex items-center gap-4 header-container ${w?"scrolling":""}`,children:[e.jsx($e,{normalizedDate:t,className:"shrink-0"}),e.jsx("div",{className:"flex-1 text-center",children:r?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:W,disabled:i,className:"shrink-0 w-12 h-12 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 transition-colors disabled:opacity-50",title:"Выбрать иконку",children:L?e.jsx(L.component,{size:28}):e.jsxs("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",className:"text-gray-400",children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeDasharray:"4 2"}),e.jsx("path",{d:"M12 8v8M8 12h8"})]})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{ref:h,type:"text",value:f,onChange:O=>E(O.target.value),disabled:i,className:"w-full bg-white/10 text-lg font-bold text-white placeholder:text-gray-500 focus:outline-none focus:bg-white/20 rounded-md px-3 pr-9 py-2 transition-colors disabled:opacity-70",placeholder:"Название тренировки"}),f&&e.jsx("button",{type:"button",onClick:()=>E(""),"aria-label":"Очистить",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-white/10 text-gray-300",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:A,disabled:i,className:"shrink-0 p-1.5 rounded-full hover:bg-green-500/20 transition-colors disabled:opacity-50",title:"Сохранить",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:I,disabled:i,className:"shrink-0 p-1.5 rounded-full hover:bg-red-500/20 transition-colors disabled:opacity-50",title:"Отмена",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[L&&e.jsx("div",{className:"shrink-0 w-10 h-10 flex items-center justify-center",children:e.jsx(L.component,{size:32})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:s}),e.jsxs("p",{className:"text-md transition-all duration-300 workout-date-text",children:["Дата: ",ge(t)]})]}),e.jsx("button",{onClick:o,className:"shrink-0 p-1.5 rounded-full hover:bg-white/10 transition-colors",title:"Редактировать название",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})}),e.jsx("div",{className:"relative",ref:_,children:e.jsx("button",{ref:$,type:"button","aria-label":"Меню действий",className:"inline-flex items-center justify-center p-2 rounded-full hover:bg-white/10",onClick:v,children:e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})})]})},Ge=({open:t,templates:s,isCreating:r,onClose:f,onReplaceWithTemplate:i})=>t?ye.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 overscroll-contain",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:f}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Выберите шаблон"}),e.jsx("button",{onClick:f,className:"px-2 py-1 text-sm text-gray-300 hover:text-white",children:"✕"})]}),s.length===0?e.jsx("p",{className:"text-gray-400",children:"Нет доступных шаблонов."}):e.jsx("div",{className:"space-y-2 max-h-[70vh] overflow-y-auto overscroll-contain pr-1",children:s.map(w=>e.jsx("button",{onClick:()=>i(w),disabled:r,className:"w-full text-left px-4 py-2 rounded-md border border-white/20 text-gray-100 hover:bg-white/5 disabled:opacity-50",children:r?"Применение...":w.name},w.id))})]})]}),document.body):null;function Xe({normalizedDate:t,templates:s,isCreating:r,onCreateWorkout:f,onCreateCustomWorkout:i}){return r?e.jsx("div",{className:"px-4 pt-4",children:e.jsx(Se,{message:"Создание..."})}):e.jsxs("div",{className:"max-w-lg mx-auto px-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx($e,{normalizedDate:t}),e.jsxs("h1",{className:"flex-1 text-xl font-bold text-center",children:["Тренировка на ",ge(t)]})]}),e.jsxs("div",{className:"mt-4 p-6 text-center",children:[s.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Выбрать шаблон"}),e.jsx("div",{className:"space-y-2",children:s.map(w=>e.jsx("button",{onClick:()=>f(w),disabled:r,className:"btn-glass btn-glass-primary btn-glass-full btn-glass-md disabled:opacity-50",children:w.name},w.id))})]}):e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("p",{className:"text-gray-400",children:"Сначала создайте шаблон."}),e.jsxs(De,{to:"/templates/new",className:"btn-glass btn-glass-primary btn-glass-full btn-glass-md",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Создать шаблон"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:i,disabled:r,className:"btn-dashed",children:"Создать свой день"})})]})]})}function Qe({isCardio:t,isSaving:s,onToggle:r}){return e.jsxs("div",{className:"glass card-dark p-4 rounded-md",children:[e.jsx("p",{className:"text-white text-lg font-bold mb-3 text-center",children:"Было кардио?"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{t&&r()},disabled:s,className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition duration-200 ease-in-out ${t?"bg-red-500/30 text-white border border-red-400/40 supports-[hover:hover]:hover:bg-red-500/40 supports-[hover:hover]:hover:shadow-sm":"bg-red-500/80 text-white shadow-lg border border-red-400/60"} active:brightness-100 disabled:cursor-not-allowed disabled:pointer-events-none focus:outline-none focus-visible:outline-none [-webkit-tap-highlight-color:transparent]`,children:"Нет"}),e.jsx("button",{onClick:()=>{t||r()},disabled:s,className:`flex-1 py-2.5 px-4 rounded-xl font-medium transition duration-200 ease-in-out ${t?"bg-green-500/80 text-white shadow-lg border border-green-400/60":"bg-green-500/30 text-white border border-green-400/40 supports-[hover:hover]:hover:bg-green-500/40 supports-[hover:hover]:hover:shadow-sm"} active:brightness-100 disabled:cursor-not-allowed disabled:pointer-events-none focus:outline-none focus-visible:outline-none [-webkit-tap-highlight-color:transparent]`,children:"Да"})]})]})}function Ze({notes:t,isSaving:s,onChange:r}){return e.jsxs("div",{className:"glass card-dark p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-white text-lg font-bold",children:"Заметки"}),s&&e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 border border-white/30 border-t-white rounded-full animate-spin"}),"Сохранение..."]})]}),e.jsx("textarea",{value:t,onChange:f=>r(f.target.value),placeholder:"Как себя чувствовали, что получилось, над чем надо поработать",rows:5,className:"w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-400 text-sm resize-none focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition-colors"})]})}function Ue({isOpen:t,menuPos:s,onReorder:r,onChangeTemplate:f,onDelete:i,onClose:w}){return!t||!s?null:ye.createPortal(e.jsxs("div",{className:"fixed menu-popover",style:{top:s.top,left:s.left,width:192},role:"menu",children:[e.jsx("button",{onClick:()=>{w(),r()},className:"w-full text-left px-4 py-2 hover:bg-white/10 text-gray-100 transition-colors rounded-lg",children:"Поменять порядок упражнений"}),e.jsx("button",{onClick:()=>{w(),f()},className:"w-full text-left px-4 py-2 hover:bg-white/10 text-gray-100 transition-colors rounded-lg",children:"Изменить тренировку"}),e.jsx("button",{onClick:()=>{w(),i()},className:"w-full text-left px-4 py-2 text-red-400 hover:bg-red-500/10 transition-colors rounded-lg",children:"Удалить"})]}),document.body)}function ze({normalizedDate:t,exercisesLength:s,scrollKey:r,location:f}){const[i,w]=n.useState(!1),h=n.useRef(!1),o=n.useRef(0),E=n.useRef(!1),A=n.useRef(!1);return n.useEffect(()=>{E.current=!1,A.current=!1},[t,f.key]),n.useEffect(()=>{if(!t||s===0||A.current)return;const I=()=>{var Y;const v=(Y=f.state)==null?void 0:Y.focusExerciseId;if(!v||E.current)return!1;const k=document.getElementById(`exercise-${v}`);if(!k)return!1;E.current=!0,h.current=!0;const C=document.querySelector(".header-container"),W=C?C.getBoundingClientRect().bottom:0,q=12,L=k.getBoundingClientRect(),O=Math.max(0,window.scrollY+L.top-W-q);return window.scrollTo({top:O,behavior:"smooth"}),k.animate&&k.animate([{boxShadow:"0 0 0 rgba(59,130,246,0)"},{boxShadow:"0 0 0 4px rgba(59,130,246,0.6)"},{boxShadow:"0 0 0 rgba(59,130,246,0)"}],{duration:1200,easing:"ease-in-out"}),setTimeout(()=>{h.current=!1},600),!0},_=()=>{try{const v=localStorage.getItem(r);if(v){const k=parseInt(v,10);Number.isNaN(k)||(h.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:k,behavior:"auto"}),o.current=k,setTimeout(()=>{h.current=!1},100)})}))}}catch(v){console.error("Error restoring scroll:",v)}};I()||_(),A.current=!0},[t,s,r,f.state]),n.useEffect(()=>{if(!t)return;let I=!1;const _=()=>{o.current=window.scrollY,w(window.scrollY>0),!I&&!h.current&&(window.requestAnimationFrame(()=>{try{localStorage.setItem(r,String(o.current))}catch{}I=!1}),I=!0)};return window.addEventListener("scroll",_,{passive:!0}),()=>window.removeEventListener("scroll",_)},[t,r]),n.useEffect(()=>()=>{if(t&&o.current>0)try{localStorage.setItem(r,String(o.current))}catch{}},[t,r]),{isScrolling:i}}const G=new Map,Ne=3e4,et=t=>{if(!t)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const s=new Date(t);return Number.isNaN(s.getTime())?null:Me(s)};function tt(){const{date:t}=Le(),{user:s}=Ce(),r=Re(),f=J,i=n.useMemo(()=>et(t),[t]),w=i?`workout-page:${i}`:"workout-page",[h,o]=Oe({key:w,initialState:{workout:null,exercises:[],templates:[],loading:!0,isCreating:!1,isSelectTemplateOpen:!1,hasInitialData:!1,isAddingExercise:!1,workoutName:"",isSavingWorkoutName:!1,isCardio:!1,isSavingCardio:!1,workoutIcon:null,workoutNotes:"",isSavingNotes:!1},ttl:1800*1e3}),{workout:E,exercises:A,templates:I,loading:_,isCreating:$,isSelectTemplateOpen:v,hasInitialData:k,isAddingExercise:C,workoutName:W,isSavingWorkoutName:q,isCardio:L,isSavingCardio:O,workoutIcon:Y,workoutNotes:j,isSavingNotes:c}=h,l=n.useCallback(a=>o(d=>({...d,workout:a,workoutName:(a==null?void 0:a.name)??"",isSavingWorkoutName:!1,isCardio:(a==null?void 0:a.is_cardio)??!1,isSavingCardio:!1,workoutIcon:(a==null?void 0:a.icon)??null,workoutNotes:(a==null?void 0:a.notes)??"",isSavingNotes:!1})),[o]),m=n.useCallback(a=>o(d=>({...d,exercises:typeof a=="function"?a(d.exercises):a})),[o]),S=n.useCallback(a=>o(d=>({...d,templates:typeof a=="function"?a(d.templates):a})),[o]),u=n.useCallback(a=>o(d=>({...d,loading:a})),[o]),y=n.useCallback(a=>o(d=>({...d,isCreating:a})),[o]),R=n.useCallback(a=>o(d=>({...d,isSelectTemplateOpen:a})),[o]),N=n.useCallback(a=>o(d=>({...d,hasInitialData:a})),[o]),P=n.useCallback(a=>o(d=>({...d,isAddingExercise:a})),[o]),V=n.useCallback(a=>o(d=>({...d,workoutName:a})),[o]),X=n.useCallback(a=>o(d=>({...d,isSavingWorkoutName:a})),[o]),F=n.useCallback(a=>o(d=>({...d,isCardio:a})),[o]),U=n.useCallback(a=>o(d=>({...d,isSavingCardio:a})),[o]),ee=n.useCallback(a=>o(d=>({...d,workoutIcon:a})),[o]),te=n.useCallback(a=>o(d=>({...d,workoutNotes:a})),[o]),x=n.useCallback(a=>o(d=>({...d,isSavingNotes:a})),[o]),b=n.useCallback(async(a=!1,d=!1)=>{if(!s||!i){l(null),m([]),u(!1),N(!0);return}const M=`${s.id}:${i}`,z=Date.now();if(G.has(M)){const T=G.get(M),B=z-T.timestamp;if(a&&B<Ne){k||(l(T.workout),m(T.exercises),u(!1),N(!0));return}B>=Ne&&(k||(l(T.workout),m(T.exercises),N(!0)),d=!0)}d||u(!0);const{data:H,error:p}=await f.from("workouts").select("*").eq("user_id",s.id).eq("workout_date",i).order("created_at",{ascending:!1}).limit(1);let g=(H==null?void 0:H[0])??null;if(p)console.error("Error fetching workout:",p);else if(g){if(g.template_id&&!g.icon)try{const{data:Q}=await f.from("workout_templates").select("icon").eq("id",g.template_id).single();Q!=null&&Q.icon&&(g={...g,icon:Q.icon},f.from("workouts").update({icon:Q.icon}).eq("id",g.id).then(()=>{},()=>{}))}catch{}l(g);const{data:T,error:B}=await f.from("workout_exercises").select("id, name, sets, reps, rest_seconds, position, workout_id, workout_sets ( id, workout_exercise_id, set_index, weight, reps, is_done, is_dropset, parent_set_index, updated_at )").eq("workout_id",g.id).order("position");if(B)console.error("Error fetching exercises:",B);else{const Q=T||[];Q.forEach(oe=>{oe.workout_sets&&oe.workout_sets.sort((se,re)=>{const ae=se.is_dropset??!1,le=re.is_dropset??!1,ie=ae?se.parent_set_index??se.set_index:se.set_index,ce=le?re.parent_set_index??re.set_index:re.set_index;return ie!==ce?ie-ce:ae!==le?ae?1:-1:se.set_index-re.set_index})}),m(Q),G.set(M,{workout:g,exercises:Q,timestamp:z})}}else l(null),m([]),G.set(M,{workout:null,exercises:[],timestamp:z});const D=s?`templates-cache:${s.id}`:void 0;if(D)try{const T=localStorage.getItem(D);if(T){const B=JSON.parse(T);B.data&&S(B.data)}}catch{}f.from("workout_templates").select("id, name, created_at, user_id, icon").eq("user_id",s.id).then(({data:T,error:B})=>{if(B)console.error("Error fetching templates:",B.message);else if(S(T||[]),D)try{localStorage.setItem(D,JSON.stringify({ts:Date.now(),data:T}))}catch{}}),u(!1),N(!0)},[s,i,k,l,m,u,N,S]);return n.useEffect(()=>{b()},[b]),n.useEffect(()=>{const a=()=>{document.visibilityState==="visible"&&b(!0)};return document.addEventListener("visibilitychange",a),()=>document.removeEventListener("visibilitychange",a)},[b]),n.useEffect(()=>{i&&(localStorage.setItem("lastWorkoutPath",`/workout/${i}`),localStorage.setItem("lastWorkoutTimestamp",Date.now().toString()))},[i]),{user:s,normalizedDate:i,location:r,workout:E,exercises:A,templates:I,loading:_,isCreating:$,isSelectTemplateOpen:v,hasInitialData:k,isAddingExercise:C,workoutName:W,isSavingWorkoutName:q,isCardio:L,isSavingCardio:O,workoutIcon:Y,workoutNotes:j,isSavingNotes:c,setPageState:o,setWorkout:l,setExercises:m,setTemplates:S,setLoading:u,setIsCreating:y,setIsSelectTemplateOpen:R,setHasInitialData:N,setIsAddingExercise:P,setWorkoutName:V,setIsSavingWorkoutName:X,setIsCardio:F,setIsSavingCardio:U,setWorkoutIcon:ee,setWorkoutNotes:te,setIsSavingNotes:x,fetchWorkoutData:b}}function st({user:t,normalizedDate:s,workout:r,exercises:f,setPageState:i,setWorkout:w,setExercises:h,setIsCreating:o,setIsAddingExercise:E,setWorkoutName:A,setIsSelectTemplateOpen:I,fetchWorkoutData:_,isAddingExercise:$}){const v=Ee(),k=J,C=n.useCallback(l=>{i(m=>{const S=m.exercises.map(u=>u.id===l.id?l:u);if(t&&s&&m.workout){const u=`${t.id}:${s}`;G.set(u,{workout:m.workout,exercises:S,timestamp:Date.now()})}return{...m,exercises:S}})},[t,s,i]),W=n.useCallback(l=>{i(m=>{const S=m.exercises.filter(u=>String(u.id)!==String(l));if(t&&s&&m.workout){const u=`${t.id}:${s}`;G.set(u,{workout:m.workout,exercises:S,timestamp:Date.now()})}return{...m,exercises:S}})},[t,s,i]),q=n.useCallback(async()=>{if(!(!t||!s||!r||$)){E(!0);try{const l=f.length>0?Math.max(...f.map(V=>typeof V.position=="number"?V.position:0))+1:1,{data:m,error:S}=await k.from("workout_exercises").insert({workout_id:r.id,name:"",sets:1,reps:"",rest_seconds:150,position:l}).select("id, name, sets, reps, rest_seconds, position, workout_id");if(S)throw S;const u=m==null?void 0:m[0];if(!u)throw new Error("Не удалось создать упражнение");const{data:y,error:R}=await k.from("workout_sets").insert({workout_exercise_id:u.id,set_index:1,weight:null,reps:null,is_done:!1,is_dropset:!1,updated_at:new Date().toISOString()}).select("id, workout_exercise_id, set_index, weight, reps, is_done, is_dropset, updated_at");if(R)throw R;const N=y==null?void 0:y[0];if(!N)throw new Error("Не удалось создать подход");const P={...u,workout_sets:[N]};i(V=>{if(!V.workout)return V;const X=[...V.exercises,P].sort((F,U)=>F.position-U.position);if(t&&s){const F=`${t.id}:${s}`,U=G.get(F);U&&G.set(F,{workout:U.workout,exercises:X,timestamp:Date.now()})}return{...V,exercises:X}})}catch(l){console.error("Failed to add exercise:",l),alert("Не удалось добавить упражнение. Попробуйте снова.")}finally{E(!1)}}},[t,s,r,f,$,i,E]),L=n.useCallback(async()=>{if(!(!t||!s)){o(!0);try{const{data:l,error:m}=await k.from("workouts").insert({user_id:t.id,workout_date:s,name:"Новая тренировка",template_id:null}).select().single();if(m)throw m;if(!l)throw new Error("Не удалось создать тренировку");w(l),h([]),A(l.name);const S=`${t.id}:${s}`;G.set(S,{workout:l,exercises:[],timestamp:Date.now()})}catch(l){console.error("Failed to create custom workout:",l),alert("Не удалось создать тренировку. Попробуйте снова.")}finally{o(!1)}}},[t,s,o,w,h,A]),O=n.useCallback(async l=>{if(!(!t||!s)){o(!0);try{const[{data:m},{data:S}]=await Promise.all([k.from("template_exercises").select("*").eq("template_id",l.id),k.from("workout_templates").select("id, name, icon").eq("id",l.id).single()]),u=(S==null?void 0:S.icon)??l.icon??null,y=(S==null?void 0:S.name)??l.name,{data:R}=await k.from("workouts").insert({user_id:t.id,workout_date:s,name:y,template_id:l.id,icon:u}).select().single();if(!R)throw new Error("Failed to create workout entry.");const N=(m||[]).map(F=>({workout_id:R.id,name:F.name,sets:F.sets,reps:F.reps,rest_seconds:F.rest_seconds,position:F.position})),{data:P}=await k.from("workout_exercises").insert(N).select();if(!P)throw new Error("Failed to create workout exercises.");const V=P.flatMap(F=>Array.from({length:F.sets},(U,ee)=>({workout_exercise_id:F.id,set_index:ee+1})));await k.from("workout_sets").insert(V);const X=`${t.id}:${s}`;G.delete(X),await _()}catch(m){console.error("Failed to create workout from template:",m),alert(`Не удалось создать тренировку: ${m.message}`)}finally{o(!1)}}},[t,s,o,_]),Y=n.useCallback(async l=>{if(!(!t||!s||!r))try{o(!0);const[{data:m,error:S},{data:u,error:y}]=await Promise.all([k.from("template_exercises").select("*").eq("template_id",l.id),k.from("workout_templates").select("id, name, icon").eq("id",l.id).single()]);if(S)throw S;if(y)throw y;const{data:R,error:N}=await k.from("workout_exercises").select("id").eq("workout_id",r.id);if(N)throw N;const P=(R||[]).map(a=>a.id);if(P.length>0){const{error:a}=await k.from("workout_sets").delete().in("workout_exercise_id",P);if(a)throw a;const{error:d}=await k.from("workout_exercises").delete().eq("workout_id",r.id);if(d)throw d}const V=(u==null?void 0:u.icon)??l.icon??null,X=(u==null?void 0:u.name)??l.name,{error:F}=await k.from("workouts").update({name:X,template_id:l.id,icon:V}).eq("id",r.id);if(F)throw F;const U=(m||[]).map(a=>({workout_id:r.id,name:a.name,sets:a.sets,reps:a.reps,rest_seconds:a.rest_seconds,position:a.position})),{data:ee,error:te}=await k.from("workout_exercises").insert(U).select();if(te)throw te;const x=(ee||[]).flatMap(a=>Array.from({length:a.sets},(d,M)=>({workout_exercise_id:a.id,set_index:M+1})));if(x.length>0){const{error:a}=await k.from("workout_sets").insert(x);if(a)throw a}const b=`${t.id}:${s}`;G.delete(b),I(!1),await _()}catch(m){console.error("Failed to replace workout from template:",m),alert(`Не удалось изменить тренировку: ${m.message}`)}finally{o(!1)}},[t,s,r,o,I,_]),j=n.useCallback(async()=>{if(!r)return;const{error:l}=await k.from("workouts").delete().eq("id",r.id);if(l){console.error("Error deleting workout:",l),alert("Не удалось удалить тренировку.");return}if(t&&s){const m=`${t.id}:${s}`;G.delete(m)}v("/calendar",{state:{removedDate:s}})},[r,t,s,v]),c=n.useCallback(async l=>{if(!t||!r)return;const m=new Map(l.map((u,y)=>[u.id,y+1]));h(u=>{const y=u.map(R=>({...R,position:m.get(R.id)??R.position}));return y.sort((R,N)=>(R.position??0)-(N.position??0)),y});const S=l.map((u,y)=>({id:u.id,position:y+1}));try{if(await Promise.all(S.map(async u=>{const{error:y}=await k.from("workout_exercises").update({position:u.position}).eq("id",u.id);if(y)throw y})),t&&s){const u=`${t.id}:${s}`,y=G.get(u);if(y){const R=[...y.exercises].map(N=>({...N,position:m.get(N.id)??N.position})).sort((N,P)=>(N.position??0)-(P.position??0));G.set(u,{workout:y.workout,exercises:R,timestamp:Date.now()})}}}catch(u){console.error("Failed to save new order:",u),alert("Не удалось сохранить порядок. Я вернул предыдущие данные."),await _()}},[t,r,s,h,_]);return{handleUpdateExercise:C,handleDeleteExercise:W,handleAddExercise:q,handleCreateCustomWorkout:L,handleCreateWorkout:O,handleReplaceWithTemplate:Y,handleDeleteWorkout:j,handleSaveNewOrder:c}}function rt({user:t,normalizedDate:s,workout:r,exercises:f,workoutName:i,workoutIcon:w,setWorkout:h,setWorkoutName:o,setIsSavingWorkoutName:E}){const A=J,I=n.useRef(null),[_,$]=n.useState(!1),[v,k]=n.useState(i),[C,W]=n.useState(w),[q,L]=n.useState(!1);n.useEffect(()=>{_&&I.current&&(I.current.focus(),I.current.select())},[_]);const O=n.useCallback(()=>{k(i),W(w),$(!0)},[i,w]),Y=n.useCallback(async()=>{if(!t||!s||!r)return;const u=v.trim();if(u.length===0){k(i),W(w),$(!1);return}const y=u!==r.name,R=C!==r.icon;if(!y&&!R){$(!1);return}E(!0);try{const N={};y&&(N.name=u),R&&(N.icon=C);const{data:P,error:V}=await A.from("workouts").update(N).eq("id",r.id).select().single();if(V)throw V;if(!P)throw new Error("Не удалось обновить тренировку");h(P),k(u),W(P.icon),$(!1);const X=`${t.id}:${s}`;G.set(X,{workout:P,exercises:f,timestamp:Date.now()})}catch(N){console.error("Failed to update workout:",N),alert("Не удалось сохранить изменения. Попробуйте снова.")}finally{E(!1)}},[t,s,r,f,v,C,i,w,h,E]),j=n.useCallback(()=>{k(i),W(w),$(!1)},[i,w]),c=n.useCallback(()=>{L(!0)},[]),l=n.useCallback(u=>{W(u)},[]),m=n.useCallback(async()=>{if(!t||!s||!r)return;const u=i.trim();if(u.length===0){o(r.name);return}if(u!==r.name){E(!0);try{const{data:y,error:R}=await A.from("workouts").update({name:u}).eq("id",r.id).select().single();if(R)throw R;if(!y)throw new Error("Не удалось обновить название тренировки");h(y);const N=`${t.id}:${s}`;G.set(N,{workout:y,exercises:f,timestamp:Date.now()})}catch(y){console.error("Failed to update workout name:",y),alert("Не удалось сохранить название. Попробуйте снова."),o(r.name)}finally{E(!1)}}},[t,s,r,f,i,h,o,E]),S=n.useCallback(u=>{u.key==="Enter"&&u.currentTarget.blur()},[]);return{inputRef:I,isEditingName:_,editNameValue:v,editIconValue:C,isIconPickerOpen:q,setIsIconPickerOpen:L,setEditNameValue:k,handleStartEditName:O,handleSaveEditName:Y,handleCancelEditName:j,handleOpenIconPicker:c,handleIconChange:l,handleSaveWorkoutName:m,handleWorkoutNameKeyDown:S}}function nt({user:t,normalizedDate:s,workout:r,exercises:f,isCardio:i,setIsCardio:w,setIsSavingCardio:h,setWorkout:o}){const E=J;return{handleToggleCardio:n.useCallback(async()=>{if(!t||!s||!r)return;const I=!i;w(I),h(!0);try{const{data:_,error:$}=await E.from("workouts").update({is_cardio:I}).eq("id",r.id).select().single();if($)throw $;if(!_)throw new Error("Не удалось обновить статус кардио");o(_);const v=`${t.id}:${s}`;G.set(v,{workout:_,exercises:f,timestamp:Date.now()})}catch(_){console.error("Failed to update cardio status:",_),alert("Не удалось сохранить статус кардио."),w(!I)}finally{h(!1)}},[t,s,r,f,i,w,h,o])}}function ot({user:t,normalizedDate:s,workout:r,workoutNotes:f,setIsSavingNotes:i}){const w=J,h=pe(f,800),o=n.useRef(f);n.useEffect(()=>{o.current=f},[f]),n.useEffect(()=>{if(!t||!s||!r||h===(r.notes??""))return;(async()=>{i(!0);try{const{error:A}=await w.from("workouts").update({notes:h||null}).eq("id",r.id);if(A)throw A;const I=`${t.id}:${s}`,_=G.get(I);_&&_.workout&&G.set(I,{..._,workout:{..._.workout,notes:h||null},timestamp:Date.now()})}catch(A){console.error("Failed to save notes:",A)}finally{i(!1)}})()},[h,t,s,r==null?void 0:r.id,i])}function be(t,s,r){const f=t.slice(),[i]=f.splice(s,1);return f.splice(r,0,i),f}const it=({open:t,items:s,onClose:r,onSave:f})=>{const[i,w]=n.useState([]),h=n.useRef(null),[o,E]=n.useState(!1),[A,I]=n.useState(null),_=n.useRef(0),$=n.useRef(null),v=n.useMemo(()=>s.slice().sort((c,l)=>(c.position??0)-(l.position??0)),[s]);if(n.useEffect(()=>{t&&w(v)},[t,v]),Ae(t),!t)return null;const k=(c,l)=>{l<0||l>=i.length||w(m=>be(m,c,l))},C=c=>l=>{h.current=c,l.dataTransfer.effectAllowed="move"},W=c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},q=c=>l=>{l.preventDefault();const m=h.current;if(h.current=null,m==null||m===c)return;const S=i.findIndex(y=>y.id===m),u=i.findIndex(y=>y.id===c);S===-1||u===-1||w(y=>be(y,S,u))},L=c=>l=>{const m=l.touches[0];_.current=m.clientY,I(c)},O=c=>{if(!A)return;const m=c.touches[0].clientY,S=m-_.current,u=i.findIndex(N=>N.id===A);if(u===-1)return;const R=Math.round(S/60);if(Math.abs(R)>=1){const N=u+R;N>=0&&N<i.length&&N!==u&&(w(P=>be(P,u,N)),_.current=m)}},Y=()=>{I(null)},j=async()=>{E(!0);try{await f(i.map((c,l)=>({...c,position:l+1}))),r()}finally{E(!1)}};return ye.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 overscroll-contain",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Порядок упражнений"}),e.jsx("ol",{ref:$,className:"space-y-2 max-h-[55vh] overflow-y-auto pr-1",onTouchMove:O,onTouchEnd:Y,children:i.map((c,l)=>e.jsxs("li",{draggable:!0,onDragStart:C(c.id),onDragOver:W,onDrop:q(c.id),className:`rounded-lg p-2 flex items-center gap-2 hover:bg-white/5 transition-colors ${A===c.id?"bg-white/20 scale-105":""}`,children:[e.jsxs("span",{className:"select-none w-6 text-center opacity-70",children:[l+1,"."]}),e.jsx("button",{type:"button","aria-label":"Перетащить",className:"cursor-grab px-2 py-1 rounded-md bg-white/5 hover:bg-white/10 active:cursor-grabbing touch-none",draggable:!0,onDragStart:C(c.id),onTouchStart:L(c.id),children:"⋮⋮"}),e.jsx("div",{className:"flex-1 whitespace-normal break-words leading-snug",children:c.name||"Без названия"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:()=>k(l,l-1),disabled:l===0,children:"↑"}),e.jsx("button",{type:"button",className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:()=>k(l,l+1),disabled:l===i.length-1,children:"↓"})]})]},c.id))}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{className:"btn-glass btn-glass-sm btn-glass-secondary",onClick:r,disabled:o,children:"Отмена"}),e.jsx("button",{className:"btn-glass btn-glass-sm btn-glass-primary",onClick:j,disabled:o,children:o?"Сохранение…":"Сохранить"})]})]})]}),document.body)},at=({open:t,value:s,onClose:r,onChange:f})=>{if(!t)return null;const i=Object.keys(ke),w=h=>{f(h),r()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:r,children:e.jsxs("div",{className:"glass card-dark p-4 rounded-xl w-[90%] max-w-sm mx-auto",onClick:h=>h.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4 text-center",children:"Выберите иконку"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>w(null),className:`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${s===null?"bg-white/20 ring-2 ring-white/50":"bg-white/5 hover:bg-white/10"}`,children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center text-gray-500",children:e.jsx("svg",{viewBox:"0 0 24 24",width:"28",height:"28",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeDasharray:"4 2"})})}),e.jsx("span",{className:"text-[10px] mt-1 text-gray-400",children:"Нет"})]}),i.map(h=>{const{component:o,label:E}=ke[h],A=s===h;return e.jsxs("button",{type:"button",onClick:()=>w(h),className:`flex flex-col items-center justify-center p-2 rounded-lg transition-all ${A?"bg-white/20 ring-2 ring-white/50":"bg-white/5 hover:bg-white/10"}`,children:[e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx(o,{size:28})}),e.jsx("span",{className:"text-[10px] mt-1 text-gray-300",children:E})]},h)})]}),e.jsx("button",{type:"button",onClick:r,className:"mt-4 w-full py-2 text-gray-400 hover:text-white transition-colors",children:"Отмена"})]})})},kt=()=>{const t=tt(),{user:s,normalizedDate:r,location:f,workout:i,exercises:w,templates:h,isCreating:o,isSelectTemplateOpen:E,hasInitialData:A,isAddingExercise:I,workoutName:_,isSavingWorkoutName:$,isCardio:v,isSavingCardio:k,workoutIcon:C,workoutNotes:W,isSavingNotes:q,setPageState:L,setWorkout:O,setExercises:Y,setIsCreating:j,setIsSelectTemplateOpen:c,setIsAddingExercise:l,setWorkoutName:m,setIsSavingWorkoutName:S,setIsCardio:u,setIsSavingCardio:y,setWorkoutNotes:R,setIsSavingNotes:N,fetchWorkoutData:P}=t,{isActionsOpen:V,menuPos:X,actionsRef:F,actionsBtnRef:U,toggleActions:ee,closeActions:te}=We(),{handleUpdateExercise:x,handleDeleteExercise:b,handleAddExercise:a,handleCreateCustomWorkout:d,handleCreateWorkout:M,handleReplaceWithTemplate:z,handleDeleteWorkout:H,handleSaveNewOrder:p}=st({user:s,normalizedDate:r,workout:i,exercises:w,setPageState:L,setWorkout:O,setExercises:Y,setIsCreating:j,setIsAddingExercise:l,setWorkoutName:m,setIsSelectTemplateOpen:c,fetchWorkoutData:P,isAddingExercise:I}),{inputRef:g,isEditingName:D,editNameValue:T,editIconValue:B,isIconPickerOpen:Q,setIsIconPickerOpen:oe,setEditNameValue:se,handleStartEditName:re,handleSaveEditName:ae,handleCancelEditName:le,handleOpenIconPicker:ie,handleIconChange:ce}=rt({user:s,normalizedDate:r,workout:i,exercises:w,workoutName:_,workoutIcon:C,setWorkout:O,setWorkoutName:m,setIsSavingWorkoutName:S}),{handleToggleCardio:fe}=nt({user:s,normalizedDate:r,workout:i,exercises:w,isCardio:v,setIsCardio:u,setIsSavingCardio:y,setWorkout:O});ot({user:s,normalizedDate:r,workout:i,workoutNotes:W,setIsSavingNotes:N});const[we,K]=n.useState(!1),[de,Z]=n.useState(!1),ue=`scroll:workout:${r??""}`,{isScrolling:me}=ze({normalizedDate:r,exercisesLength:w.length,scrollKey:ue,location:f});return Ae(E),A?r?i?e.jsxs("div",{className:"relative px-4 space-y-4 pt-4 pb-10",children:[e.jsx("div",{className:`status-bar-blur ${me?"visible":""}`}),e.jsx(Je,{normalizedDate:r,workoutName:_,isEditingName:D,editNameValue:T,isSavingWorkoutName:$,isScrolling:me,inputRef:g,onStartEditName:re,onChangeEditName:se,onSaveEditName:ae,onCancelEditName:le,actionsRef:F,actionsBtnRef:U,onToggleActions:ee,workoutIcon:C,editIconValue:B,onOpenIconPicker:ie}),e.jsx("div",{className:"space-y-4",children:w.map(ne=>e.jsx(Ye,{exercise:ne,workoutDate:r,onUpdateExercise:x,onDeleteExercise:b},ne.id))}),e.jsx(Qe,{isCardio:v,isSaving:k,onToggle:fe}),e.jsx(Ze,{notes:W,isSaving:q,onChange:R}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:a,disabled:I,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:I?"Добавление...":"Добавить упражнение"})}),e.jsx(Ge,{open:E,templates:h,isCreating:o,onClose:()=>c(!1),onReplaceWithTemplate:z}),e.jsx(it,{open:de,onClose:()=>Z(!1),items:w.map(ne=>({id:ne.id,name:ne.name,position:ne.position??0})),onSave:p}),e.jsx(Ie,{open:we,onOpenChange:K,title:"Удалить тренировку?",description:`Вы собираетесь удалить тренировку на ${ge(r)}. Действие необратимо.`,confirmText:"Удалить",cancelText:"Отмена",variant:"danger",onConfirm:H}),e.jsx(at,{open:Q,value:B,onClose:()=>oe(!1),onChange:ce}),e.jsx(Ue,{isOpen:V,menuPos:X,onReorder:()=>Z(!0),onChangeTemplate:()=>c(!0),onDelete:()=>K(!0),onClose:te})]}):e.jsx(Xe,{normalizedDate:r,templates:h,isCreating:o,onCreateWorkout:M,onCreateCustomWorkout:d}):null:e.jsx(Se,{message:"Загрузка..."})};export{kt as default};
