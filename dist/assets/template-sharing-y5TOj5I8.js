import{s as m}from"./index-BtV5doUL.js";const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l=9;function u(){const r=typeof window<"u"?window.crypto??window.msCrypto:void 0;let n="";if(r&&r.getRandomValues){const t=new Uint8Array(l);r.getRandomValues(t);for(let e=0;e<t.length;e++)n+=c[t[e]%c.length];return n}for(let t=0;t<l;t++){const e=Math.floor(Math.random()*c.length);n+=c[e]}return n}function d(r){try{const n=decodeURIComponent(escape(atob(decodeURIComponent(r)))),t=JSON.parse(n);if(!t.name||!Array.isArray(t.exercises))throw new Error("Invalid template structure");for(const e of t.exercises)if(!e.name||typeof e.sets!="number"||typeof e.rest_seconds!="number")throw new Error("Invalid exercise structure");return t}catch(n){throw console.error("Error decoding template:",n),new Error("Неверный формат ссылки на шаблон")}}async function p(r){for(let t=0;t<5;t++){const e=u(),{error:o}=await m.from("template_share_codes").insert({id:e,template:r});if(!o)return`${window.location.origin+window.location.pathname}?s=${e}`;const a=o;if(!a||a.code!=="23505")break}throw new Error("Не удалось сгенерировать короткую ссылку")}function h(r){try{const e=/#\/templates\/import\?data=([^&\s]+)/,o=r.match(e);if(o&&o[1])return d(o[1]),!0}catch{}const n=/[?&]s=([a-zA-Z0-9_-]{4,})/,t=r.match(n);return!!(t&&t[1])}async function y(r){try{const o=/#\/templates\/import\?data=([^&\s]+)/,a=r.match(o);if(a&&a[1])return d(a[1])}catch{return null}const n=/[?&]s=([a-zA-Z0-9_-]{4,})/,t=r.match(n);if(!t||!t[1])return null;const e=t[1];try{const{data:o,error:a}=await m.from("template_share_codes").select("template").eq("id",e).single();if(a||!o)return null;const s=o.template;if(!s||!s.name||!Array.isArray(s.exercises))return null;for(const i of s.exercises)if(!i.name||typeof i.sets!="number"||typeof i.rest_seconds!="number")return null;return s}catch{return null}}export{y as e,p as g,h as i};
