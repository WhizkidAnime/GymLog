import{s as re,j as e,u as me}from"./index-DicrduyI.js";import{r as s,c as pe,e as he}from"./vendor-BVca5W6X.js";import{C as ce}from"./confirm-dialog-Dxc_NETr.js";import{T as ge}from"./template-saved-dialog-B86zvD0j.js";import{u as fe}from"./usePageState-6XNG0ilq.js";import{R as xe,L as be,C as we,X as ye,Y as ke,a as je}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function ve(){const t=re,{error:i}=await t.rpc("delete_user_account");if(i)throw i}const oe="body-weights-data",Ne=600*1e3;function De({userId:t}){const i=re,r=s.useRef(!1),[a,n]=s.useState(!1),[l,d]=fe({key:t?`${oe}-${t}`:oe,initialState:[],ttl:Ne}),[g,j]=s.useState(l),[b,v]=s.useState(!1),[k,T]=s.useState(""),[o,w]=s.useState(()=>{const x=new Date,S=String(x.getDate()).padStart(2,"0"),L=String(x.getMonth()+1).padStart(2,"0"),M=x.getFullYear();return`${S}.${L}.${M}`}),[h,N]=s.useState(!1),[P,O]=s.useState(null),[I,E]=s.useState(!1),[G,p]=s.useState(null);s.useEffect(()=>{l.length>0&&g.length===0&&(j(l),r.current=!0)},[]);const F=s.useCallback(async(x=!1)=>{if(t){if(!x&&r.current&&l.length>0){j(l);return}if(!x&&l.length>0){j(l),r.current=!0;return}v(!0);try{const{data:S,error:L}=await i.from("user_body_weights").select("*").eq("user_id",t).order("recorded_at",{ascending:!1}).limit(100);if(L)throw L;const M=S||[];j(M),d(M),r.current=!0}catch(S){console.error("Error loading body weights:",S)}finally{v(!1)}}},[t,i,l,d]),u=s.useCallback(x=>{const S=x.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!S)return null;const[,L,M,m]=S,D=parseInt(L,10),W=parseInt(M,10),C=parseInt(m,10);if(W<1||W>12||D<1||D>31||C<1900||C>2100)return null;const J=new Date(C,W,0).getDate();if(D>J)return null;const V=new Date(C,W-1,D),y=new Date;if(y.setHours(23,59,59,999),V>y)return null;const c=String(D).padStart(2,"0"),A=String(W).padStart(2,"0");return`${C}-${A}-${c}`},[]),B=s.useCallback(()=>{const x=new Date,S=String(x.getDate()).padStart(2,"0"),L=String(x.getMonth()+1).padStart(2,"0"),M=x.getFullYear();return`${S}.${L}.${M}`},[]),f=s.useCallback(async()=>{if(!t||!k||h)return;const x=parseFloat(k.replace(",","."));if(isNaN(x)||x<=0||x>500){alert("Введите корректный вес (от 0.1 до 500 кг)");return}const S=u(o);if(!S){alert("Введите корректную дату в формате д.мм.гггг (не в будущем)");return}N(!0);try{const{data:L,error:M}=await i.from("user_body_weights").upsert({user_id:t,weight:x,recorded_at:S},{onConflict:"user_id,recorded_at"}).select().single();if(M)throw M;const m=(()=>{const D=g.filter(W=>W.recorded_at!==S);return[L,...D].sort((W,C)=>new Date(C.recorded_at).getTime()-new Date(W.recorded_at).getTime())})();j(m),d(m),T(""),w(B())}catch(L){console.error("Error saving weight:",L),alert("Не удалось сохранить вес")}finally{N(!1)}},[t,k,o,h,i,u,B,g,d]),H=s.useCallback(async x=>{if(!(!t||P)){O(x);try{const{error:S}=await i.from("user_body_weights").delete().eq("id",x);if(S)throw S;const L=g.filter(M=>M.id!==x);j(L),d(L),E(!1),p(null)}catch(S){console.error("Error deleting weight:",S),alert("Не удалось удалить запись")}finally{O(null)}}},[t,P,i,g,d]),z=s.useCallback(x=>{p(x),E(!0)},[]),q=s.useMemo(()=>[...g].sort((x,S)=>new Date(x.recorded_at).getTime()-new Date(S.recorded_at).getTime()).slice(-30).map(x=>({date:new Date(x.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short"}),weight:Number(x.weight),fullDate:x.recorded_at})),[g]),K=s.useMemo(()=>{if(g.length===0)return null;const x=g.map(D=>Number(D.weight)),S=x[0],L=Math.min(...x),M=Math.max(...x),m=g.length>1?S-x[x.length-1]:0;return{current:S,min:L,max:M,change:m}},[g]);return{isWeightTrackerOpen:a,bodyWeights:g,loadingWeights:b,newWeight:k,newWeightDate:o,savingWeight:h,deletingWeightId:P,isDeleteWeightConfirmOpen:I,weightToDelete:G,weightChartData:q,weightStats:K,setIsWeightTrackerOpen:n,setNewWeight:T,setNewWeightDate:w,setIsDeleteWeightConfirmOpen:E,loadBodyWeights:F,handleAddWeight:f,handleDeleteWeight:H,handleOpenDeleteWeightConfirm:z}}function Ce(){const[t,i]=s.useState(()=>{try{const o=localStorage.getItem("settings:timerStep");return o?Number(o):30}catch{return 30}}),[r,a]=s.useState(()=>String(t)),[n,l]=s.useState("idle"),d=s.useRef(null),[g,j]=s.useState(()=>{try{const o=localStorage.getItem("settings:theme");if(o==="light"||o==="dark"||o==="auto")return o}catch{}return"auto"}),[b,v]=s.useState(!1);s.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]),s.useEffect(()=>{const o=document.documentElement,w=document.querySelector('meta[name="theme-color"]'),h=(E,G)=>{(E==="auto"?G?"light":"dark":E)==="light"?(o.classList.add("light-theme"),w&&w.setAttribute("content","#f5f5f7")):(o.classList.remove("light-theme"),w&&w.setAttribute("content","#0a0a0b"))},P=(()=>{if(typeof window>"u"||!window.matchMedia)return!1;try{return window.matchMedia("(prefers-color-scheme: light)").matches}catch{return!1}})();if(h(g,P),typeof window>"u"||!window.matchMedia)return;const O=window.matchMedia("(prefers-color-scheme: light)"),I=E=>{h(g,E.matches)};if(typeof O.addEventListener=="function")return O.addEventListener("change",I),()=>{O.removeEventListener("change",I)};if(typeof O.addListener=="function")return O.addListener(I),()=>{O.removeListener(I)}},[g]);const k=s.useCallback(o=>{j(o);try{localStorage.setItem("settings:theme",o)}catch{}},[]),T=s.useCallback(()=>{d.current&&clearTimeout(d.current);const o=parseInt(r,10);if(!isNaN(o)&&o>=1&&o<=300){l("saving"),i(o);try{localStorage.setItem("settings:timerStep",String(o))}catch{}d.current=setTimeout(()=>{l("success"),d.current=setTimeout(()=>{l("idle")},500)},350)}else a(String(t)),l("idle")},[r,t]);return{timerStep:t,timerStepInput:r,setTimerStepInput:a,saveStatus:n,saveTimerStep:T,theme:g,handleThemeChange:k,isSettingsOpen:b,setIsSettingsOpen:v}}const Se=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function le(t){if(typeof t!="string")return null;const i=t.trim();return Se.includes(i)?i:null}function We({userId:t,userEmail:i}){const r=re,[a,n]=s.useState(!1),[l,d]=s.useState(!1),[g,j]=s.useState(!1),[b,v]=s.useState(null),[k,T]=s.useState(null),[o,w]=s.useState([]),[h,N]=s.useState([]),[P,O]=s.useState("none"),[I,E]=s.useState(!1),[G,p]=s.useState(null),[F,u]=s.useState("success"),B=s.useRef(null),f=s.useCallback(async m=>{if(!t)return;const D=Array.isArray(m.workouts)?m.workouts:[];if(D.length===0){u("error"),p("В файле нет тренировок для импорта."),E(!0);return}const{data:W,error:C}=await r.from("workouts").select("id, workout_date").eq("user_id",t);if(C)throw C;const J=new Set;D.forEach(c=>{const A=typeof c.date=="string"&&c.date?c.date:typeof c.workout_date=="string"&&c.workout_date?c.workout_date:"";A&&J.add(A)});const y=(W||[]).filter(c=>J.has(c.workout_date)).map(c=>c.id);if(y.length>0){const{data:c,error:A}=await r.from("workout_exercises").select("id, workout_id").in("workout_id",y);if(A)throw A;const Y=(c||[]).map(_=>_.id);if(Y.length>0){const{error:_}=await r.from("workout_sets").delete().in("workout_exercise_id",Y);if(_)throw _}if(y.length>0){const{error:_}=await r.from("workout_exercises").delete().in("workout_id",y);if(_)throw _;const{error:R}=await r.from("workouts").delete().in("id",y);if(R)throw R}}for(const c of D){const A=typeof c.name=="string"&&c.name.trim().length>0?c.name.trim():"Импортированная тренировка",Y=typeof c.date=="string"&&c.date?c.date:new Date().toISOString().slice(0,10),{data:_,error:R}=await r.from("workouts").insert({user_id:t,name:A,icon:le(c.icon),workout_date:Y,is_cardio:!!c.isCardio,template_id:null}).select().single();if(R||!_)throw R||new Error("Не удалось создать тренировку при импорте.");const Q=Array.isArray(c.exercises)?c.exercises:[];if(Q.length===0)continue;const ae=Q.map((U,ee)=>({workout_id:_.id,name:typeof U.name=="string"?U.name:"",position:typeof U.position=="number"?U.position:ee+1,reps:typeof U.reps=="string"?U.reps:"",rest_seconds:typeof U.restSeconds=="number"?U.restSeconds:typeof U.rest_seconds=="number"?U.rest_seconds:150,sets:typeof U.setsPlanned=="number"?U.setsPlanned:Array.isArray(U.sets)?U.sets.length:1})),{data:$,error:X}=await r.from("workout_exercises").insert(ae).select();if(X||!$)throw X||new Error("Не удалось создать упражнения при импорте.");const se=[],de=[...Q].sort((U,ee)=>{const te=typeof U.position=="number"?U.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne}),ue=[...$].sort((U,ee)=>{const te=typeof U.position=="number"?U.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne});if(de.forEach((U,ee)=>{const te=ue[ee];if(!te)return;(Array.isArray(U.sets)?U.sets:[]).forEach(Z=>{se.push({workout_exercise_id:te.id,set_index:typeof Z.index=="number"?Z.index:1,weight:typeof Z.weight=="number"?Z.weight:null,reps:Z.reps==null?null:String(Z.reps),is_done:!!Z.isDone,updated_at:typeof Z.updatedAt=="string"&&Z.updatedAt?Z.updatedAt:new Date().toISOString()})})}),se.length>0){const{error:U}=await r.from("workout_sets").insert(se);if(U)throw U}}},[t,r]),H=s.useCallback(async()=>{if(t){n(!0);try{const{data:m,error:D}=await r.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",t).order("workout_date",{ascending:!1});if(D){console.error("Error exporting workouts:",D),alert("Не удалось загрузить данные тренировок для экспорта.");return}const W=(m||[]).map(Y=>({id:Y.id,name:Y.name,icon:le(Y.icon),date:Y.workout_date,isCardio:!!Y.is_cardio,templateId:Y.template_id,exercises:(Y.workout_exercises||[]).map(_=>({id:_.id,name:_.name,position:_.position,reps:_.reps,restSeconds:_.rest_seconds,setsPlanned:_.sets,sets:(_.workout_sets||[]).map(R=>({id:R.id,index:R.set_index,weight:R.weight,reps:R.reps,isDone:R.is_done,updatedAt:R.updated_at}))}))})),C={exportedAt:new Date().toISOString(),user:{id:t,email:i},workouts:W},J=JSON.stringify(C,null,2),V=new Blob([J],{type:"application/json;charset=utf-8;"}),y=URL.createObjectURL(V),c=document.createElement("a"),A=new Date().toISOString().slice(0,10);c.href=y,c.download=`gymlog-workouts-${A}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(y)}catch(m){console.error("Unexpected error while exporting workouts:",m),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{n(!1)}}},[t,i,r]),z=s.useCallback(()=>{!t||l||B.current&&(B.current.value="",B.current.click())},[t,l]),q=s.useCallback(async m=>{const D=m.target.files&&m.target.files[0];if(D)try{w([]),N([]);const W=await D.text();let C;try{C=JSON.parse(W)}catch{u("error"),p("Файл не является корректным JSON."),E(!0);return}if(!C||!Array.isArray(C.workouts)){u("error"),p("Файл не похож на экспорт тренировок из GymLog."),E(!0);return}if(!t)return;const J=Array.isArray(C.workouts)?C.workouts:[],V=new Set;J.forEach($=>{const X=typeof $.date=="string"&&$.date?$.date:typeof $.workout_date=="string"&&$.workout_date?$.workout_date:"";X&&V.add(X)});const{data:y,error:c}=await r.from("workouts").select("workout_date").eq("user_id",t);if(c){console.error("Error checking existing workouts before import:",c),u("error"),p("Не удалось проверить существующие тренировки перед импортом."),E(!0);return}const A=new Set((y||[]).map($=>$.workout_date)),Y=A.size>0,_=new Map;J.forEach($=>{const X=typeof $.date=="string"&&$.date?$.date:typeof $.workout_date=="string"&&$.workout_date?$.workout_date:"";X&&_.set(X,(_.get(X)||0)+1)});const R=[],Q=[];V.forEach($=>{A.has($)?R.push($):Q.push($)});const ae=R.length>0;if(!Y||!ae){u("success"),d(!0);try{await f(C),p("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),E(!0)}catch($){console.error("Error importing workouts:",$),alert("Не удалось импортировать тренировки: "+(($==null?void 0:$.message)||String($)))}finally{d(!1)}return}if(Q.length===0){u("error"),p("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),E(!0);return}if(v(C),T(D.name),Q.length>0){const $=Q.map(X=>({date:X,count:_.get(X)||0})).sort((X,se)=>se.date.localeCompare(X.date));w(Q),N($)}else w([]),N([]);j(!0)}catch(W){console.error("Error reading workouts import file:",W),alert("Не удалось прочитать файл тренировок.")}finally{m.target.value=""}},[t,r,f]),K=s.useCallback(async()=>{if(b){O("import"),d(!0);try{await f(b),v(null),T(null),w([]),N([]),j(!1),u("success"),p("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),E(!0)}catch(m){console.error("Error importing workouts:",m),alert("Не удалось импортировать тренировки: "+((m==null?void 0:m.message)||String(m)))}finally{d(!1),O("none")}}},[b,f]),x=s.useCallback(async()=>{if(!b)return;const m=Array.isArray(b.workouts)?b.workouts:[];if(m.length===0){u("error"),p("В файле нет тренировок для импорта."),E(!0);return}const D=new Set(o);if(D.size===0){u("error"),p("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),E(!0);return}const W=m.filter(C=>{const J=typeof C.date=="string"&&C.date?C.date:typeof C.workout_date=="string"&&C.workout_date?C.workout_date:"";return!!J&&D.has(J)});if(W.length===0){u("error"),p("Не удалось определить новые тренировки для импорта. Проверьте файл."),E(!0);return}O("onlyNew"),d(!0);try{await f({workouts:W}),v(null),T(null),w([]),N([]),j(!1),u("success"),p("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),E(!0)}catch(C){console.error("Error importing only new workouts:",C),u("error"),p("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),E(!0)}finally{d(!1),O("none")}},[b,o,f]),S=s.useCallback(async()=>{if(b){O("exportThenImport"),d(!0);try{await H(),await f(b),v(null),T(null),j(!1),u("success"),p("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),E(!0)}catch(m){console.error("Error exporting and importing workouts:",m),u("error"),p("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),E(!0)}finally{d(!1),O("none")}}},[b,H,f]),L=s.useCallback(()=>{j(!1),v(null),T(null),w([]),N([])},[]),M=s.useCallback(()=>{E(!1),p(null)},[]);return{isExporting:a,isImportingWorkouts:l,isWorkoutsImportDialogOpen:g,pendingWorkoutsImport:b,pendingWorkoutsFileName:k,pendingWorkoutsNewDates:o,pendingWorkoutsNewDatesSummary:h,importAction:P,isImportSuccessOpen:I,importSuccessMessage:G,toastVariant:F,workoutsFileInputRef:B,handleExportWorkouts:H,handleStartImportWorkouts:z,handleWorkoutsFileChange:q,handleConfirmImportWorkoutsOnly:K,handleImportOnlyNewWorkouts:x,handleExportThenImportWorkouts:S,closeWorkoutsImportDialog:L,closeImportSuccessToast:M,setIsImportSuccessOpen:E,setImportSuccessMessage:p,setToastVariant:u}}const _e=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function ie(t){if(typeof t!="string")return null;const i=t.trim();return _e.includes(i)?i:null}function Ee({userId:t,userEmail:i,setToastVariant:r,setImportSuccessMessage:a,setIsImportSuccessOpen:n}){const l=re,[d,g]=s.useState(!1),[j,b]=s.useState(!1),[v,k]=s.useState(!1),[T,o]=s.useState([]),[w,h]=s.useState([]),[N,P]=s.useState("none"),O=s.useRef(null),I=s.useCallback(async f=>{if(!t)return;const H=Array.isArray(f.templates)?f.templates:[];if(H.length===0){r("error"),a("В файле нет шаблонов для импорта."),n(!0);return}for(const z of H){const q=typeof z.name=="string"&&z.name.trim().length>0?z.name.trim():"Импортированный шаблон",{data:K,error:x}=await l.from("workout_templates").insert({user_id:t,name:q,icon:ie(z.icon)}).select().single();if(x||!K)throw x||new Error("Не удалось создать шаблон при импорте.");const S=Array.isArray(z.exercises)?z.exercises:[];if(S.length===0)continue;const L=S.map((m,D)=>({template_id:K.id,name:typeof m.name=="string"?m.name:"",sets:typeof m.sets=="number"?m.sets:1,reps:typeof m.reps=="string"?m.reps:"",rest_seconds:typeof m.restSeconds=="number"?m.restSeconds:typeof m.rest_seconds=="number"?m.rest_seconds:150,position:typeof m.position=="number"?m.position:D+1})),{error:M}=await l.from("template_exercises").insert(L);if(M)throw M}},[t,l,r,a,n]),E=s.useCallback(async()=>{if(t){g(!0);try{const{data:f,error:H}=await l.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",t).order("created_at",{ascending:!1});if(H){console.error("Error exporting templates:",H),alert("Не удалось загрузить шаблоны для экспорта.");return}const z=(f||[]).map(m=>({id:m.id,name:m.name,icon:ie(m.icon),createdAt:m.created_at,exercises:(m.template_exercises||[]).map(D=>({id:D.id,name:D.name,sets:D.sets,reps:D.reps,restSeconds:D.rest_seconds,position:D.position}))})),q={exportedAt:new Date().toISOString(),user:{id:t,email:i},templates:z},K=JSON.stringify(q,null,2),x=new Blob([K],{type:"application/json;charset=utf-8;"}),S=URL.createObjectURL(x),L=document.createElement("a"),M=new Date().toISOString().slice(0,10);L.href=S,L.download=`gymlog-templates-${M}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(S)}catch(f){console.error("Unexpected error while exporting templates:",f),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{g(!1)}}},[t,i,l]),G=s.useCallback(()=>{!t||j||O.current&&(O.current.value="",O.current.click())},[t,j]),p=s.useCallback(async f=>{const H=f.target.files&&f.target.files[0];if(H)try{const z=await H.text();let q;try{q=JSON.parse(z)}catch{r("error"),a("Файл не является корректным JSON."),n(!0);return}if(!q||!Array.isArray(q.templates)){r("error"),a("Файл не похож на экспорт шаблонов из GymLog."),n(!0);return}if(!t)return;const K=Array.isArray(q.templates)?q.templates:[];if(K.length===0){r("error"),a("В файле нет шаблонов для импорта."),n(!0);return}const{data:x,error:S}=await l.from("workout_templates").select("id, name").eq("user_id",t);if(S){console.error("Error checking existing templates before import:",S),r("error"),a("Не удалось проверить существующие шаблоны перед импортом."),n(!0);return}const L=W=>typeof W=="string"?W.trim().toLowerCase():"",M=new Map;(x||[]).forEach(W=>{const C=L(W.name);C&&(M.has(C)||M.set(C,{id:W.id,name:W.name||""}))});const m=[],D=[];if(K.forEach(W=>{const C=L(W==null?void 0:W.name);if(!C||!M.has(C))m.push(W);else{const J=M.get(C);D.push({existingId:J.id,existingName:J.name||"",template:W})}}),m.length===0&&D.length>0){r("error"),a("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),n(!0);return}if(D.length===0){b(!0);try{await I({templates:K}),r("success"),a("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),n(!0)}catch(W){console.error("Error importing templates:",W),r("error"),a("Не удалось импортировать шаблоны. Попробуйте ещё раз."),n(!0)}finally{b(!1)}return}o(m),h(D),k(!0)}catch(z){console.error("Error importing templates:",z),r("error"),a("Не удалось импортировать шаблоны. Попробуйте ещё раз."),n(!0)}finally{b(!1),f.target.value=""}},[t,l,I,r,a,n]),F=s.useCallback(async()=>{if(T.length===0){k(!1),h([]),o([]),r("error"),a("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),n(!0);return}P("onlyNew"),b(!0);try{await I({templates:T}),o([]),h([]),k(!1),r("success"),a("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),n(!0)}catch(f){console.error("Error importing only new templates:",f),r("error"),a("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),n(!0)}finally{b(!1),P("none")}},[T,I,r,a,n]),u=s.useCallback(async()=>{if(w.length===0&&T.length===0){k(!1);return}P("overwrite"),b(!0);try{const f=Array.from(new Set(w.map(z=>z.existingId)));if(f.length>0){const{error:z}=await l.from("template_exercises").delete().in("template_id",f);if(z)throw z;const{error:q}=await l.from("workout_templates").delete().in("id",f);if(q)throw q}const H=[...T,...w.map(z=>z.template)];await I({templates:H}),o([]),h([]),k(!1),r("success"),a("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),n(!0)}catch(f){console.error("Error overwriting templates:",f),alert("Не удалось импортировать шаблоны с перезаписью: "+((f==null?void 0:f.message)||String(f)))}finally{b(!1),P("none")}},[w,T,l,I,r,a,n]),B=s.useCallback(()=>{k(!1),o([]),h([])},[]);return{isExportingTemplates:d,handleExportTemplates:E,isImportingTemplates:j,isTemplatesImportDialogOpen:v,pendingTemplatesNew:T,pendingTemplatesDuplicates:w,templatesImportAction:N,templatesFileInputRef:O,handleStartImportTemplates:G,handleTemplatesFileChange:p,handleImportTemplatesOnlyNew:F,handleImportTemplatesOverwrite:u,closeTemplatesImportDialog:B}}function Te({userId:t,setToastVariant:i,setImportSuccessMessage:r,setIsImportSuccessOpen:a}){const n=re,[l,d]=s.useState(!1),[g,j]=s.useState(!1),[b,v]=s.useState(!1),[k,T]=s.useState([]),[o,w]=s.useState([]),[h,N]=s.useState(!1),[P,O]=s.useState(!1),[I,E]=s.useState(!1),[G,p]=s.useState([]),[F,u]=s.useState([]),[B,f]=s.useState(!1),H=k.length>0&&o.length===k.length,z=G.length>0&&F.length===G.length,q=s.useCallback(async()=>{if(!(!t||b)){v(!0),w([]);try{const{data:y,error:c}=await n.from("workouts").select("id, workout_date").eq("user_id",t).order("workout_date",{ascending:!1});if(c){console.error("Error loading workouts for deletion:",c),alert("Не удалось загрузить список тренировок для удаления.");return}const A=new Map;(y||[]).forEach(_=>{const R=_.workout_date,Q=_.id;!R||!Q||(A.has(R)||A.set(R,[]),A.get(R).push(Q))});const Y=Array.from(A.entries()).map(([_,R])=>({date:_,workoutIds:R,count:R.length})).sort((_,R)=>R.date.localeCompare(_.date));if(Y.length===0){i("error"),r("У вас нет тренировок для удаления."),a(!0);return}T(Y),d(!1),j(!0)}catch(y){console.error("Unexpected error while loading workouts for deletion:",y),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{v(!1)}}},[t,b,n,i,r,a]),K=s.useCallback(async()=>{if(!(!t||I)){E(!0),u([]);try{const{data:y,error:c}=await n.from("workout_templates").select("id, name").eq("user_id",t).order("created_at",{ascending:!1});if(c){console.error("Error loading templates for deletion:",c),alert("Не удалось загрузить список шаблонов для удаления.");return}const A=(y||[]).map(Y=>({id:Y.id,name:Y.name||"Без названия"}));if(A.length===0){i("error"),r("У вас нет шаблонов для удаления."),a(!0);return}p(A),d(!1),O(!0)}catch(y){console.error("Unexpected error while loading templates for deletion:",y),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{E(!1)}}},[t,I,n,i,r,a]),x=s.useCallback(y=>{w(c=>c.includes(y)?c.filter(A=>A!==y):[...c,y])},[]),S=s.useCallback(()=>{if(k.length===0)return;const y=o.length===k.length;w(y?[]:k.map(c=>c.date))},[k,o.length]),L=s.useCallback(()=>{w([])},[]),M=s.useCallback(y=>{u(c=>c.includes(y)?c.filter(A=>A!==y):[...c,y])},[]),m=s.useCallback(()=>{if(G.length===0)return;const y=F.length===G.length;u(y?[]:G.map(c=>c.id))},[G,F.length]),D=s.useCallback(()=>{u([])},[]),W=s.useCallback(async()=>{if(!t||o.length===0)return;const y=k.filter(c=>o.includes(c.date)).flatMap(c=>c.workoutIds);if(y.length!==0){N(!0);try{const{data:c,error:A}=await n.from("workout_exercises").select("id, workout_id").in("workout_id",y);if(A)throw A;const Y=(c||[]).map(_=>_.id);if(Y.length>0){const{error:_}=await n.from("workout_sets").delete().in("workout_exercise_id",Y);if(_)throw _}if(y.length>0){const{error:_}=await n.from("workout_exercises").delete().in("workout_id",y);if(_)throw _;const{error:R}=await n.from("workouts").delete().in("id",y);if(R)throw R}j(!1),T([]),w([]),i("success"),r("Выбранные тренировки успешно удалены."),a(!0)}catch(c){console.error("Error deleting workouts:",c),i("error"),r("Не удалось удалить выбранные тренировки."),a(!0)}finally{N(!1)}}},[t,o,k,n,i,r,a]),C=s.useCallback(async()=>{if(t&&F.length!==0){f(!0);try{const y=F;if(y.length>0){const{error:c}=await n.from("template_exercises").delete().in("template_id",y);if(c)throw c;const{error:A}=await n.from("workout_templates").delete().in("id",y);if(A)throw A}O(!1),p([]),u([]),i("success"),r("Выбранные шаблоны тренировок успешно удалены."),a(!0)}catch(y){console.error("Error deleting templates:",y),i("error"),r("Не удалось удалить выбранные шаблоны тренировок."),a(!0)}finally{f(!1)}}},[t,F,n,i,r,a]),J=s.useCallback(()=>{h||j(!1)},[h]),V=s.useCallback(()=>{B||O(!1)},[B]);return{isCleanDataDialogOpen:l,setIsCleanDataDialogOpen:d,isDeleteWorkoutsDialogOpen:g,isLoadingWorkoutsForDeletion:b,workoutDateGroups:k,selectedWorkoutDates:o,isDeletingWorkouts:h,areAllWorkoutDatesSelected:H,isDeleteTemplatesDialogOpen:P,isLoadingTemplatesForDeletion:I,templatesForDeletion:G,selectedTemplateIds:F,isDeletingTemplates:B,areAllTemplatesSelected:z,openDeleteWorkoutsDialog:q,toggleWorkoutDateSelection:x,selectAllWorkoutDates:S,clearWorkoutSelection:L,handleDeleteSelectedWorkouts:W,closeDeleteWorkoutsDialog:J,openDeleteTemplatesDialog:K,toggleTemplateSelection:M,selectAllTemplates:m,clearTemplateSelection:D,handleDeleteSelectedTemplates:C,closeDeleteTemplatesDialog:V}}function Le(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,a,n]=i;if(r&&a&&n)return`${n}.${a}.${r}`}return t}function Ae(t,i){const r=t.replace(/[^0-9.]/g,""),a=r.split(".");let n=a[0]||"",l=a[1]||"",d=a[2]||"";n=n.slice(0,2),l=l.slice(0,2),d=d.slice(0,4);const g=r.length>i.replace(/[^0-9.]/g,"").length;return a.length===1&&n.length===2&&g?`${n}.`:a.length===2&&l.length===2&&g?`${n}.${l}.`:a.length===1?n:a.length===2?`${n}.${l}`:`${n}.${l}.${d}`}function Oe({isOpen:t,onClose:i,bodyWeights:r,loadingWeights:a,weightChartData:n,weightStats:l,newWeight:d,newWeightDate:g,savingWeight:j,deletingWeightId:b,isDeleteWeightConfirmOpen:v,weightToDelete:k,setNewWeight:T,setNewWeightDate:o,setIsDeleteWeightConfirmOpen:w,handleAddWeight:h,handleDeleteWeight:N,handleOpenDeleteWeightConfirm:P}){const[O,I]=s.useState(null),E=s.useCallback((p,F)=>{var u;(u=p==null?void 0:p.stopPropagation)==null||u.call(p),F&&I({date:F.date,weight:F.weight})},[]),G=s.useCallback(()=>{I(null)},[]);return t?pe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-8 px-4",style:{paddingBottom:"calc(96px + env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:i}),e.jsxs("div",{className:"relative glass card-dark p-5 rounded-2xl max-w-md w-full my-auto",style:{maxHeight:"calc(100dvh - 120px - env(safe-area-inset-bottom))"},onClick:p=>p.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:i,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-white pr-10",children:"Трекер веса тела"}),e.jsxs("div",{className:"mt-4 space-y-4 overflow-y-auto custom-scrollbar",style:{maxHeight:"calc(100dvh - 200px - env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"space-y-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Добавить запись"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Вес (кг)"}),e.jsx("input",{type:"text",inputMode:"decimal",value:d,onChange:p=>{const F=p.target.value.replace(".",",");/^[0-9]*[,]?[0-9]*$/.test(F)&&T(F)},placeholder:"70,25",className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Дата"}),e.jsx("input",{type:"text",inputMode:"numeric",value:g,onChange:p=>{const F=Ae(p.target.value,g);o(F)},placeholder:"8.12.2025",maxLength:10,className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:h,disabled:!d||!g||j,className:"btn-glass btn-glass-sm btn-glass-primary disabled:opacity-50",children:j?"...":"Добавить"})})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Текущий"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[l.current.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Мин"}),e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[l.min.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Макс"}),e.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[l.max.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Изменение"}),e.jsxs("p",{className:`text-lg font-bold ${l.change>0?"text-red-400":l.change<0?"text-green-400":"text-gray-400"}`,children:[l.change>0?"+":"",l.change.toFixed(2).replace(".",",")," кг"]})]})]}),n.length>1&&e.jsxs("div",{className:"relative",onClick:G,children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsx("div",{style:{minWidth:`${Math.max(n.length*50,100)}px`,height:"192px"},children:e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(be,{data:n,margin:{top:15,right:20,left:-20,bottom:5},children:[e.jsx(we,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(ye,{dataKey:"date",tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1}),e.jsx(ke,{domain:["dataMin - 2","dataMax + 2"],tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1,tickFormatter:p=>Number(p).toFixed(2).replace(".",",")}),e.jsx(je,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:({cx:p,cy:F,payload:u,index:B})=>e.jsx("circle",{cx:p,cy:F,r:4,fill:"#3b82f6",stroke:"none",style:{cursor:"pointer"},onClick:f=>E(f,u)},`dot-${B}`),activeDot:({cx:p,cy:F,payload:u,index:B})=>e.jsx("circle",{cx:p,cy:F,r:6,fill:"#60a5fa",stroke:"#fff",strokeWidth:2,style:{cursor:"pointer"},onClick:f=>E(f,u)},`active-dot-${B}`)})]})})})}),O&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",style:{background:"rgba(24,24,27,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"8px 12px",color:"#fff",zIndex:10},children:[e.jsx("p",{className:"text-sm text-gray-300",children:O.date}),e.jsxs("p",{className:"text-sm font-medium",children:[e.jsx("span",{className:"text-gray-400",children:"Вес : "}),e.jsxs("span",{className:"text-green-400",children:[O.weight.toFixed(2).replace(".",",")," кг"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-300 font-medium",children:["История (",r.length,")"]}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):r.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Пока нет записей. Добавьте свой первый вес выше."}):e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1 custom-scrollbar pr-1",children:r.slice(0,20).map(p=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-medium",children:[Number(p.weight).toFixed(2).replace(".",",")," кг"]}),e.jsx("span",{className:"text-sm text-gray-400",children:Le(new Date(p.recorded_at).toISOString().slice(0,10))})]}),e.jsx("button",{type:"button",onClick:()=>P(p.id),disabled:b===p.id,className:"p-1 text-gray-500 hover:text-red-400 transition-colors disabled:opacity-50",children:b===p.id?e.jsx("span",{className:"w-4 h-4 border border-white/30 border-t-white rounded-full animate-spin inline-block"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},p.id))})]})]})]}),e.jsx(ce,{open:v,onOpenChange:w,title:"Удалить запись о весе?",description:"Это действие необратимо.",confirmText:"Удалить",cancelText:"Отмена",variant:"danger",onConfirm:()=>{k&&N(k)}})]}),document.body):null}function $e({isOpen:t,onClose:i,isLoadingWorkoutsForDeletion:r,isLoadingTemplatesForDeletion:a,openDeleteWorkoutsDialog:n,openDeleteTemplatesDialog:l}){if(!t)return null;const d=r||a;return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{d||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),d&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:n,disabled:d,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:l,disabled:d,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{d||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}function Ie({isOpen:t,onClose:i,workoutDateGroups:r,selectedWorkoutDates:a,isDeletingWorkouts:n,areAllWorkoutDatesSelected:l,toggleWorkoutDateSelection:d,selectAllWorkoutDates:g,clearWorkoutSelection:j,handleDeleteSelectedWorkouts:b}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:g,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${l?"bg-green-500 border-green-400":"border-white/40"}`,children:l&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:j,disabled:a.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(v=>{const k=a.includes(v.date);return e.jsxs("button",{type:"button",onClick:()=>d(v.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${k?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:v.date}),e.jsx("div",{className:"text-xs text-gray-400",children:v.count===1?"1 тренировка":`${v.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${k?"bg-green-500 border-green-400":"border-white/40"}`,children:k&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},v.date)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:b,disabled:a.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Me({isOpen:t,onClose:i,templatesForDeletion:r,selectedTemplateIds:a,isDeletingTemplates:n,areAllTemplatesSelected:l,toggleTemplateSelection:d,selectAllTemplates:g,clearTemplateSelection:j,handleDeleteSelectedTemplates:b}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:g,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${l?"bg-green-500 border-green-400":"border-white/40"}`,children:l&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:j,disabled:a.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(v=>{const k=a.includes(v.id);return e.jsxs("button",{type:"button",onClick:()=>d(v.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${k?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:v.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${k?"bg-green-500 border-green-400":"border-white/40"}`,children:k&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},v.id)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:b,disabled:a.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Fe({isImportingWorkouts:t,isImportingTemplates:i,handleStartImportWorkouts:r,handleStartImportTemplates:a,isExporting:n,isExportingTemplates:l,handleExportWorkouts:d,handleExportTemplates:g,isDeleting:j,startCleanDataFlow:b,startDeleteAccountFlow:v}){const[k,T]=s.useState(!1),o=s.useRef(null);return s.useEffect(()=>{const w=h=>{o.current&&!o.current.contains(h.target)&&T(!1)};if(k)return document.addEventListener("click",w),()=>document.removeEventListener("click",w)},[k]),e.jsxs("div",{className:"relative",ref:o,children:[e.jsx("button",{onClick:()=>T(!k),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),k&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{T(!1),r()},disabled:t,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:t?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{T(!1),a()},disabled:i,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:i?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{T(!1),await d()},disabled:n,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:n?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{T(!1),await g()},disabled:l,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:l?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{T(!1),b()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{T(!1),v()},disabled:j,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:j?"Удаление...":"Удалить аккаунт"})]})]})}function Re({isOpen:t,timerStepInput:i,setTimerStepInput:r,saveStatus:a,saveTimerStep:n,theme:l,handleThemeChange:d}){return t?e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Настройки"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Шаг таймера отдыха (секунды)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Значение, на которое изменяется таймер при нажатии +/-"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:i,onChange:g=>r(g.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:n,disabled:a==="saving",className:"btn-glass btn-glass-sm btn-glass-primary flex items-center justify-center gap-2 min-w-[120px]",children:[a==="saving"&&e.jsx("span",{"aria-label":"Сохранение...",className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),a==="success"&&e.jsx("svg",{"aria-label":"Сохранено",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),a==="idle"&&"Сохранить"]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Тема оформления"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d("dark"),className:`btn-glass ${l==="dark"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),"Тёмная"]})}),e.jsx("button",{type:"button",onClick:()=>d("light"),className:`btn-glass ${l==="light"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),"Светлая"]})}),e.jsx("button",{type:"button",onClick:()=>d("auto"),className:`btn-glass ${l==="auto"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Авто"]})})]})]})]}):null}function Pe({isOpen:t,pendingTemplatesDuplicates:i,isImportingTemplates:r,templatesImportAction:a,onClose:n,handleImportTemplatesOnlyNew:l,handleImportTemplatesOverwrite:d}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||n()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[i.map((g,j)=>{var b;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((b=g.template)==null?void 0:b.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",g.existingName||"Без названия","»"]})]},g.existingId+"-"+j)}),i.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),r?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:a==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:d,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Be(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,a,n]=i;if(r&&a&&n)return`${n}.${a}.${r}`}return t}function ze({isOpen:t,pendingWorkoutsImport:i,pendingWorkoutsFileName:r,pendingWorkoutsNewDatesSummary:a,isImportingWorkouts:n,importAction:l,onClose:d,handleConfirmImportWorkoutsOnly:g,handleImportOnlyNewWorkouts:j,handleExportThenImportWorkouts:b}){return!t||!i?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||d()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${r||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),a.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:a.map(v=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:Be(v.date)})},v.date))})]}),n?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:l==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":l==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[a.length>0&&e.jsx("button",{type:"button",onClick:j,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:g,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:b,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:d,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}const Qe=()=>{const{user:t,signOut:i}=me(),r=he(),[a,n]=s.useState(!1),[l,d]=s.useState(!1),[g,j]=s.useState(""),[b,v]=s.useState(null),[k,T]=s.useState(!1),o=We({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email}),w=Ee({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email,setToastVariant:o.setToastVariant,setImportSuccessMessage:o.setImportSuccessMessage,setIsImportSuccessOpen:o.setIsImportSuccessOpen}),h=Te({userId:t==null?void 0:t.id,setToastVariant:o.setToastVariant,setImportSuccessMessage:o.setImportSuccessMessage,setIsImportSuccessOpen:o.setIsImportSuccessOpen}),N=De({userId:t==null?void 0:t.id}),P=Ce();s.useEffect(()=>{N.isWeightTrackerOpen&&t&&N.loadBodyWeights()},[N.isWeightTrackerOpen,t]);const O=s.useMemo(()=>{var f;if(!t)return"";const u=(f=t.user_metadata)==null?void 0:f.nickname;if(typeof u=="string"&&u.trim().length>0)return u.trim();const B=t.email||"";return B.endsWith("@gymlog.app")?B.replace(/@gymlog\.app$/,""):B},[t]),I=s.useMemo(()=>{const u=(t==null?void 0:t.email)||"";if(!u||typeof u!="string")return null;const[B,f]=u.split("@");if(!B||!f)return null;const H=Math.max(1,Math.ceil(B.length/2)),z=B.slice(0,H),q=B.slice(H);return{email:u,localPart:B,domain:f,visiblePart:z,hiddenPart:q}},[t==null?void 0:t.email]),E=async()=>{try{await i(),r("/login",{replace:!0})}catch(u){console.error("Error logging out:",u)}},G=()=>{!t||!t.email||(j(""),v(null),d(!0))},p=()=>{t&&h.setIsCleanDataDialogOpen(!0)},F=async()=>{if(!(!t||!t.email)){if(g.trim()!==t.email)throw v("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");v(null),n(!0);try{await ve(),alert("Ваш аккаунт и все данные были успешно удалены."),await i(),r("/login",{replace:!0})}catch(u){console.error("Error deleting account:",u),alert(`Не удалось удалить аккаунт: ${u.message}`)}finally{n(!1)}}};return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative profile-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsx(Fe,{isImportingWorkouts:o.isImportingWorkouts,isImportingTemplates:w.isImportingTemplates,handleStartImportWorkouts:o.handleStartImportWorkouts,handleStartImportTemplates:w.handleStartImportTemplates,isExporting:o.isExporting,isExportingTemplates:w.isExportingTemplates,handleExportWorkouts:o.handleExportWorkouts,handleExportTemplates:w.handleExportTemplates,isDeleting:a,startCleanDataFlow:p,startDeleteAccountFlow:G})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:t&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),I?e.jsxs("span",{className:"font-semibold",children:[I.visiblePart,I.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>T(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:k?e.jsx("span",{children:I.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,I.hiddenPart.length))})}),"@",I.domain]}):e.jsx("span",{className:"font-semibold",children:O})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>r("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Узнать прогресс"]}),e.jsxs("button",{onClick:()=>N.setIsWeightTrackerOpen(!0),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})}),"Трекер веса тела"]}),e.jsxs("button",{onClick:()=>P.setIsSettingsOpen(!P.isSettingsOpen),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Настройки",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${P.isSettingsOpen?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("button",{onClick:E,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"})]}),e.jsx(Re,{isOpen:P.isSettingsOpen,timerStepInput:P.timerStepInput,setTimerStepInput:P.setTimerStepInput,saveStatus:P.saveStatus,saveTimerStep:P.saveTimerStep,theme:P.theme,handleThemeChange:P.handleThemeChange}),e.jsx("input",{ref:o.workoutsFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:o.handleWorkoutsFileChange}),e.jsx("input",{ref:w.templatesFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:w.handleTemplatesFileChange}),e.jsx(ce,{open:l,onOpenChange:u=>{d(u),u||(j(""),v(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:g.trim().length===0,onConfirm:F,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.email})]}),e.jsx("input",{type:"email",value:g,onChange:u=>{j(u.target.value),b&&v(null)},placeholder:(t==null?void 0:t.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),b&&e.jsx("p",{className:"text-xs text-red-400",children:b})]})}),e.jsx($e,{isOpen:h.isCleanDataDialogOpen,onClose:()=>h.setIsCleanDataDialogOpen(!1),isLoadingWorkoutsForDeletion:h.isLoadingWorkoutsForDeletion,isLoadingTemplatesForDeletion:h.isLoadingTemplatesForDeletion,openDeleteWorkoutsDialog:h.openDeleteWorkoutsDialog,openDeleteTemplatesDialog:h.openDeleteTemplatesDialog}),e.jsx(Ie,{isOpen:h.isDeleteWorkoutsDialogOpen,onClose:h.closeDeleteWorkoutsDialog,workoutDateGroups:h.workoutDateGroups,selectedWorkoutDates:h.selectedWorkoutDates,isDeletingWorkouts:h.isDeletingWorkouts,areAllWorkoutDatesSelected:h.areAllWorkoutDatesSelected,toggleWorkoutDateSelection:h.toggleWorkoutDateSelection,selectAllWorkoutDates:h.selectAllWorkoutDates,clearWorkoutSelection:h.clearWorkoutSelection,handleDeleteSelectedWorkouts:h.handleDeleteSelectedWorkouts}),e.jsx(Me,{isOpen:h.isDeleteTemplatesDialogOpen,onClose:h.closeDeleteTemplatesDialog,templatesForDeletion:h.templatesForDeletion,selectedTemplateIds:h.selectedTemplateIds,isDeletingTemplates:h.isDeletingTemplates,areAllTemplatesSelected:h.areAllTemplatesSelected,toggleTemplateSelection:h.toggleTemplateSelection,selectAllTemplates:h.selectAllTemplates,clearTemplateSelection:h.clearTemplateSelection,handleDeleteSelectedTemplates:h.handleDeleteSelectedTemplates}),e.jsx(ge,{open:o.isImportSuccessOpen,onOpenChange:u=>{u||o.closeImportSuccessToast()},onClose:o.closeImportSuccessToast,message:o.importSuccessMessage||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:o.toastVariant}),e.jsx(Pe,{isOpen:w.isTemplatesImportDialogOpen,pendingTemplatesDuplicates:w.pendingTemplatesDuplicates,isImportingTemplates:w.isImportingTemplates,templatesImportAction:w.templatesImportAction,onClose:w.closeTemplatesImportDialog,handleImportTemplatesOnlyNew:w.handleImportTemplatesOnlyNew,handleImportTemplatesOverwrite:w.handleImportTemplatesOverwrite}),e.jsx(ze,{isOpen:o.isWorkoutsImportDialogOpen,pendingWorkoutsImport:o.pendingWorkoutsImport,pendingWorkoutsFileName:o.pendingWorkoutsFileName,pendingWorkoutsNewDatesSummary:o.pendingWorkoutsNewDatesSummary,isImportingWorkouts:o.isImportingWorkouts,importAction:o.importAction,onClose:o.closeWorkoutsImportDialog,handleConfirmImportWorkoutsOnly:o.handleConfirmImportWorkoutsOnly,handleImportOnlyNewWorkouts:o.handleImportOnlyNewWorkouts,handleExportThenImportWorkouts:o.handleExportThenImportWorkouts}),e.jsx(Oe,{isOpen:N.isWeightTrackerOpen,onClose:()=>N.setIsWeightTrackerOpen(!1),bodyWeights:N.bodyWeights,loadingWeights:N.loadingWeights,weightChartData:N.weightChartData,weightStats:N.weightStats,newWeight:N.newWeight,newWeightDate:N.newWeightDate,savingWeight:N.savingWeight,deletingWeightId:N.deletingWeightId,isDeleteWeightConfirmOpen:N.isDeleteWeightConfirmOpen,weightToDelete:N.weightToDelete,setNewWeight:N.setNewWeight,setNewWeightDate:N.setNewWeightDate,setIsDeleteWeightConfirmOpen:N.setIsDeleteWeightConfirmOpen,handleAddWeight:N.handleAddWeight,handleDeleteWeight:N.handleDeleteWeight,handleOpenDeleteWeightConfirm:N.handleOpenDeleteWeightConfirm})]})};export{Qe as default};
