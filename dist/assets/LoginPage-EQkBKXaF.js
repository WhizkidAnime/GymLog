import{u as T,j as e,s as d}from"./index-BgIe2abQ.js";import{e as W,r as a,f as j}from"./vendor-BVca5W6X.js";import{u as q}from"./use-profile-settings-_EsJTNvx.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";const D=()=>{const{session:v}=T(),N=W(),{theme:u,handleThemeChange:m}=q(),[t,I]=a.useState(!1),[C,k]=a.useState(""),[l,f]=a.useState(""),[S,g]=a.useState(""),[p,i]=a.useState(!1),[P,h]=a.useState(""),[R,n]=a.useState(""),x=j.useRef(null),b=j.useRef(null),w=j.useRef(null);a.useEffect(()=>{v&&N("/calendar",{replace:!0})},[v,N]),a.useEffect(()=>{const s=()=>{k(""),f(""),g(""),x.current&&(x.current.value=""),b.current&&(b.current.value=""),w.current&&(w.current.value="")};s();const r=window.setTimeout(s,100);return()=>window.clearTimeout(r)},[]);const $=s=>{if(!s||!s.message||typeof s.message!="string")return"Произошла ошибка. Попробуйте ещё раз.";const r=s.message.toLowerCase();return r.includes("invalid login credentials")?"Неверный никнейм или пароль":r.includes("user already registered")?"Пользователь с таким никнеймом уже существует":s.message},F=async s=>{s.preventDefault(),h(""),n("");const r=C.trim();if(!r){n("Введите никнейм");return}if(t){if(l.length<6){n("Пароль должен быть не короче 6 символов");return}if(l!==S){n("Пароли не совпадают");return}}i(!0);const c=r,y=c.includes("@")?c:`${c}@gymlog.app`;try{if(t){const{data:o,error:E}=await d.auth.signUp({email:y,password:l,options:{data:{nickname:c}}});if(E)throw E;if(!(o!=null&&o.session)){const{error:L}=await d.auth.signInWithPassword({email:y,password:l});if(L)throw L}h("Регистрация успешна! Вы вошли в аккаунт.")}else{const{error:o}=await d.auth.signInWithPassword({email:y,password:l});if(o)throw o}}catch(o){n($(o))}finally{i(!1)}},G=async()=>{i(!0),n("");const s=`${window.location.origin}/GymLog/`,{error:r}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:s}});r&&(n(r.message),i(!1))};return e.jsxs("div",{className:"relative flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:"fixed z-10",style:{top:"calc(16px + var(--sat))",right:"calc(16px + var(--sar))"},children:e.jsxs("div",{className:"glass rounded-lg p-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("auto"),className:`btn-glass btn-glass-sm ${u==="auto"?"btn-glass-primary":"btn-glass-secondary"}`,children:"Авто"}),e.jsx("button",{type:"button",onClick:()=>m("dark"),className:`btn-glass btn-glass-sm ${u==="dark"?"btn-glass-primary":"btn-glass-secondary"}`,children:"Тёмная"}),e.jsx("button",{type:"button",onClick:()=>m("light"),className:`btn-glass btn-glass-sm ${u==="light"?"btn-glass-primary":"btn-glass-secondary"}`,children:"Светлая"})]})}),e.jsxs("div",{className:"w-full max-w-sm p-8 space-y-4 glass card-dark rounded-lg shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-center text-white",children:"GymLog"}),e.jsx("p",{className:"text-center text-gray-400",children:t?"Создайте аккаунт":"Войдите в свой аккаунт"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nickname",className:"sr-only",children:"Никнейм"}),e.jsx("input",{id:"nickname",type:"text",placeholder:t?"Логин":"Ваш логин",value:C,onChange:s=>k(s.target.value),required:!0,name:"nickname",autoComplete:"off",className:"w-full px-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:x})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Пароль"}),e.jsx("input",{id:"password",type:"password",placeholder:"Введите пароль",value:l,onChange:s=>f(s.target.value),required:!0,minLength:6,name:t?"new-password":"current-password",autoComplete:t?"new-password":"off",className:"w-full px-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:b})]}),t&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:"Повторите пароль"}),e.jsx("input",{id:"confirm-password",type:"password",placeholder:"Повторите пароль",value:S,onChange:s=>g(s.target.value),required:!0,minLength:6,name:"confirm-password",autoComplete:"off",className:"w-full px-4 py-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",ref:w})]}),e.jsx("button",{type:"submit",disabled:p,className:"btn-glass btn-glass-md btn-glass-primary btn-glass-full",children:p?"Загрузка...":t?"Зарегистрироваться":"Войти"})]}),P&&e.jsx("p",{className:"text-center text-sm text-green-400",children:P}),R&&e.jsx("p",{className:"text-center text-sm text-red-400",children:R}),e.jsxs("p",{className:"text-sm text-center text-gray-400",children:[t?"Уже есть аккаунт?":"Нет аккаунта?",e.jsx("button",{type:"button",onClick:()=>{I(!t),h(""),n(""),f(""),g("")},className:"ml-1 font-semibold text-blue-400 hover:underline",children:t?"Войти":"Зарегистрироваться"})]}),e.jsxs("div",{className:"relative flex items-center py-2",children:[e.jsx("div",{className:"flex-grow border-t border-white/10"}),e.jsx("span",{className:"flex-shrink mx-4 text-xs text-gray-500",children:"ИЛИ"}),e.jsx("div",{className:"flex-grow border-t border-white/10"})]}),e.jsxs("button",{onClick:G,disabled:p,className:"btn-glass btn-glass-md btn-glass-secondary btn-glass-full flex items-center justify-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"google",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 488 512",children:e.jsx("path",{fill:"currentColor",d:"M488 261.8C488 403.3 381.5 512 244 512 110.3 512 0 398.8 0 256S110.3 0 244 0c73 0 135.5 28.2 182.3 74.3l-64.3 62.1C337 113.4 294.3 96 244 96c-85.6 0-154.5 68.9-154.5 160s68.9 160 154.5 160c97.9 0 135-71.2 138.6-106.2H244v-75.3h236.1c2.4 12.6 3.9 26.2 3.9 41z"})}),"Войти через Google"]})]})]})};export{D as default};
