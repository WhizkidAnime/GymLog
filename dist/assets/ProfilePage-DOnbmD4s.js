import{s as Ye,u as Pt,j as e}from"./index-C9C52k7W.js";import{e as zt,r as i,f as v}from"./vendor-BVca5W6X.js";import{C as $t}from"./confirm-dialog-BDjQ603X.js";import{T as Ft}from"./template-saved-dialog-GTHqg_03.js";import"./supabase-CWpvgLJU.js";import"./charts-33RH-A39.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function Ut(){const n=Ye,{error:H}=await n.rpc("delete_user_account");if(H)throw H}const Kt=()=>{const{user:n,signOut:H}=Pt(),we=zt(),w=Ye,[_e,De]=i.useState(!1),[ne,D]=i.useState(!1),[Ve,Ee]=i.useState(!1),[be,ye]=i.useState(""),[ke,K]=i.useState(null),[Ie,Ce]=i.useState(!1),[Te,Ae]=i.useState(!1),[Q,E]=i.useState(!1),[He,M]=i.useState(!1),[I,P]=i.useState(null),[Ke,z]=i.useState(null),[Qe,T]=i.useState([]),[je,A]=i.useState([]),[X,O]=i.useState(!1),[Xe,u]=i.useState(!1),[Ze,m]=i.useState(null),[Oe,$]=i.useState("none"),[et,p]=i.useState("success"),[tt,W]=i.useState(!1),[oe,ae]=i.useState([]),[Z,le]=i.useState([]),[st,ie]=i.useState("none"),[rt,ee]=i.useState(!1),[nt,ce]=i.useState(!1),[ot,de]=i.useState(!1),[F,We]=i.useState(!1),[U,Le]=i.useState(!1),[S,Re]=i.useState([]),[L,te]=i.useState([]),[C,Me]=i.useState([]),[R,se]=i.useState([]),[B,Pe]=i.useState(!1),[q,ze]=i.useState(!1),Ne=v.useRef(null),ue=v.useRef(null),me=v.useRef(null),[at,lt]=i.useState(!1),[ve,it]=i.useState(!1),[$e,ct]=i.useState(()=>{try{const t=localStorage.getItem("settings:timerStep");return t?Number(t):30}catch{return 30}}),[Fe,Ue]=i.useState(()=>String($e)),[pe,fe]=i.useState("idle"),J=v.useRef(null),dt=v.useMemo(()=>{var r;if(!n)return"";const t=(r=n.user_metadata)==null?void 0:r.nickname;if(typeof t=="string"&&t.trim().length>0)return t.trim();const s=n.email||"";return s.endsWith("@gymlog.app")?s.replace(/@gymlog\.app$/,""):s},[n]),G=v.useMemo(()=>{const t=(n==null?void 0:n.email)||"";if(!t||typeof t!="string")return null;const[s,r]=t.split("@");if(!s||!r)return null;const o=Math.max(1,Math.ceil(s.length/2)),l=s.slice(0,o),x=s.slice(o);return{email:t,localPart:s,domain:r,visiblePart:l,hiddenPart:x}},[n==null?void 0:n.email]),Be=v.useMemo(()=>["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"],[]),ge=v.useCallback(t=>{if(typeof t!="string")return null;const s=t.trim();return Be.includes(s)?s:null},[Be]),ut=t=>{if(!t||typeof t!="string")return t;const s=t.split("-");if(s.length===3){const[r,o,l]=s;if(r&&o&&l)return`${l}.${o}.${r}`}return t};v.useEffect(()=>{const t=s=>{Ne.current&&!Ne.current.contains(s.target)&&D(!1)};if(ne)return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[ne]),v.useEffect(()=>()=>{J.current&&clearTimeout(J.current)},[]);const mt=async()=>{try{await H(),we("/login",{replace:!0})}catch(t){console.error("Error logging out:",t)}},pt=()=>{!n||!n.email||(ye(""),K(null),Ee(!0))},ft=()=>{n&&ee(!0)},gt=async()=>{if(!(!n||!n.email)){if(be.trim()!==n.email)throw K("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");K(null),De(!0);try{await Ut(),alert("Ваш аккаунт и все данные были успешно удалены."),await H(),we("/login",{replace:!0})}catch(t){console.error("Error deleting account:",t),alert(`Не удалось удалить аккаунт: ${t.message}`)}finally{De(!1)}}},qe=async()=>{if(n){Ce(!0);try{const{data:t,error:s}=await w.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",n.id).order("workout_date",{ascending:!1});if(s){console.error("Error exporting workouts:",s),alert("Не удалось загрузить данные тренировок для экспорта.");return}const r=(t||[]).map(c=>({id:c.id,name:c.name,icon:ge(c.icon),date:c.workout_date,isCardio:!!c.is_cardio,templateId:c.template_id,exercises:(c.workout_exercises||[]).map(d=>({id:d.id,name:d.name,position:d.position,reps:d.reps,restSeconds:d.rest_seconds,setsPlanned:d.sets,sets:(d.workout_sets||[]).map(f=>({id:f.id,index:f.set_index,weight:f.weight,reps:f.reps,isDone:f.is_done,updatedAt:f.updated_at}))}))})),o={exportedAt:new Date().toISOString(),user:{id:n.id,email:n.email},workouts:r},l=JSON.stringify(o,null,2),x=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(x),a=document.createElement("a"),y=new Date().toISOString().slice(0,10);a.href=b,a.download=`gymlog-workouts-${y}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting workouts:",t),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{Ce(!1)}}},xt=async()=>{if(n){Ae(!0);try{const{data:t,error:s}=await w.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error exporting templates:",s),alert("Не удалось загрузить шаблоны для экспорта.");return}const r=(t||[]).map(c=>({id:c.id,name:c.name,icon:ge(c.icon),createdAt:c.created_at,exercises:(c.template_exercises||[]).map(d=>({id:d.id,name:d.name,sets:d.sets,reps:d.reps,restSeconds:d.rest_seconds,position:d.position}))})),o={exportedAt:new Date().toISOString(),user:{id:n.id,email:n.email},templates:r},l=JSON.stringify(o,null,2),x=new Blob([l],{type:"application/json;charset=utf-8;"}),b=URL.createObjectURL(x),a=document.createElement("a"),y=new Date().toISOString().slice(0,10);a.href=b,a.download=`gymlog-templates-${y}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(b)}catch(t){console.error("Unexpected error while exporting templates:",t),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{Ae(!1)}}},ht=()=>{!n||Q||ue.current&&(ue.current.value="",ue.current.click())},wt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{T([]),A([]);const r=await s.text();let o;try{o=JSON.parse(r)}catch{p("error"),m("Файл не является корректным JSON."),u(!0);return}if(!o||!Array.isArray(o.workouts)){p("error"),m("Файл не похож на экспорт тренировок из GymLog."),u(!0);return}if(!n)return;const l=Array.isArray(o.workouts)?o.workouts:[],x=new Set;l.forEach(g=>{const j=typeof g.date=="string"&&g.date?g.date:typeof g.workout_date=="string"&&g.workout_date?g.workout_date:"";j&&x.add(j)});const{data:b,error:a}=await w.from("workouts").select("workout_date").eq("user_id",n.id);if(a){console.error("Error checking existing workouts before import:",a),p("error"),m("Не удалось проверить существующие тренировки перед импортом."),u(!0);return}const y=new Set((b||[]).map(g=>g.workout_date)),c=y.size>0,d=new Map;l.forEach(g=>{const j=typeof g.date=="string"&&g.date?g.date:typeof g.workout_date=="string"&&g.workout_date?g.workout_date:"";j&&d.set(j,(d.get(j)||0)+1)});const f=[],k=[];x.forEach(g=>{y.has(g)?f.push(g):k.push(g)});const Y=f.length>0;if(!c||!Y){p("success"),E(!0);try{await xe(o),m("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(g){console.error("Error importing workouts:",g),alert("Не удалось импортировать тренировки: "+((g==null?void 0:g.message)||String(g)))}finally{E(!1)}return}if(k.length===0){p("error"),m("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),u(!0);return}if(P(o),z(s.name),k.length>0){const g=k.map(j=>({date:j,count:d.get(j)||0})).sort((j,re)=>re.date.localeCompare(j.date));T(k),A(g)}else T([]),A([]);M(!0)}catch(r){console.error("Error reading workouts import file:",r),alert("Не удалось прочитать файл тренировок.")}finally{t.target.value=""}},xe=async t=>{if(!n)return;const s=Array.isArray(t.workouts)?t.workouts:[];if(s.length===0){p("error"),m("В файле нет тренировок для импорта."),u(!0);return}const{data:r,error:o}=await w.from("workouts").select("id, workout_date").eq("user_id",n.id);if(o)throw o;const l=new Set;s.forEach(a=>{const y=typeof a.date=="string"&&a.date?a.date:typeof a.workout_date=="string"&&a.workout_date?a.workout_date:"";y&&l.add(y)});const b=(r||[]).filter(a=>l.has(a.workout_date)).map(a=>a.id);if(b.length>0){const{data:a,error:y}=await w.from("workout_exercises").select("id, workout_id").in("workout_id",b);if(y)throw y;const c=(a||[]).map(d=>d.id);if(c.length>0){const{error:d}=await w.from("workout_sets").delete().in("workout_exercise_id",c);if(d)throw d}if(b.length>0){const{error:d}=await w.from("workout_exercises").delete().in("workout_id",b);if(d)throw d;const{error:f}=await w.from("workouts").delete().in("id",b);if(f)throw f}}for(const a of s){const y=typeof a.name=="string"&&a.name.trim().length>0?a.name.trim():"Импортированная тренировка",c=typeof a.date=="string"&&a.date?a.date:new Date().toISOString().slice(0,10),{data:d,error:f}=await w.from("workouts").insert({user_id:n.id,name:y,icon:ge(a.icon),workout_date:c,is_cardio:!!a.isCardio,template_id:null}).select().single();if(f||!d)throw f||new Error("Не удалось создать тренировку при импорте.");const k=Array.isArray(a.exercises)?a.exercises:[];if(k.length===0)continue;const Y=k.map((h,_)=>({workout_id:d.id,name:typeof h.name=="string"?h.name:"",position:typeof h.position=="number"?h.position:_+1,reps:typeof h.reps=="string"?h.reps:"",rest_seconds:typeof h.restSeconds=="number"?h.restSeconds:typeof h.rest_seconds=="number"?h.rest_seconds:150,sets:typeof h.setsPlanned=="number"?h.setsPlanned:Array.isArray(h.sets)?h.sets.length:1})),{data:g,error:j}=await w.from("workout_exercises").insert(Y).select();if(j||!g)throw j||new Error("Не удалось создать упражнения при импорте.");const re=[],Rt=[...k].sort((h,_)=>{const V=typeof h.position=="number"?h.position:0,he=typeof _.position=="number"?_.position:0;return V-he}),Mt=[...g].sort((h,_)=>{const V=typeof h.position=="number"?h.position:0,he=typeof _.position=="number"?_.position:0;return V-he});if(Rt.forEach((h,_)=>{const V=Mt[_];if(!V)return;(Array.isArray(h.sets)?h.sets:[]).forEach(N=>{re.push({workout_exercise_id:V.id,set_index:typeof N.index=="number"?N.index:1,weight:typeof N.weight=="number"?N.weight:null,reps:N.reps==null?null:String(N.reps),is_done:!!N.isDone,updated_at:typeof N.updatedAt=="string"&&N.updatedAt?N.updatedAt:new Date().toISOString()})})}),re.length>0){const{error:h}=await w.from("workout_sets").insert(re);if(h)throw h}}},bt=async()=>{if(I){$("import"),E(!0);try{await xe(I),P(null),z(null),T([]),A([]),M(!1),p("success"),m("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(t){console.error("Error importing workouts:",t),alert("Не удалось импортировать тренировки: "+((t==null?void 0:t.message)||String(t)))}finally{E(!1),$("none")}}},yt=async()=>{if(!I)return;const t=Array.isArray(I.workouts)?I.workouts:[];if(t.length===0){p("error"),m("В файле нет тренировок для импорта."),u(!0);return}const s=new Set(Qe);if(s.size===0){p("error"),m("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),u(!0);return}const r=t.filter(o=>{const l=typeof o.date=="string"&&o.date?o.date:typeof o.workout_date=="string"&&o.workout_date?o.workout_date:"";return!!l&&s.has(l)});if(r.length===0){p("error"),m("Не удалось определить новые тренировки для импорта. Проверьте файл."),u(!0);return}$("onlyNew"),E(!0);try{await xe({workouts:r}),P(null),z(null),T([]),A([]),M(!1),p("success"),m("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(o){console.error("Error importing only new workouts:",o),p("error"),m("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),u(!0)}finally{E(!1),$("none")}},kt=async()=>{if(I){$("exportThenImport"),E(!0);try{await qe(),await xe(I),P(null),z(null),M(!1),p("success"),m("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),u(!0)}catch(t){console.error("Error exporting and importing workouts:",t),p("error"),m("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),u(!0)}finally{E(!1),$("none")}}},jt=()=>{!n||X||me.current&&(me.current.value="",me.current.click())},Se=async t=>{if(!n)return;const s=Array.isArray(t.templates)?t.templates:[];if(s.length===0){p("error"),m("В файле нет шаблонов для импорта."),u(!0);return}for(const r of s){const o=typeof r.name=="string"&&r.name.trim().length>0?r.name.trim():"Импортированный шаблон",{data:l,error:x}=await w.from("workout_templates").insert({user_id:n.id,name:o,icon:ge(r.icon)}).select().single();if(x||!l)throw x||new Error("Не удалось создать шаблон при импорте.");const b=Array.isArray(r.exercises)?r.exercises:[];if(b.length===0)continue;const a=b.map((c,d)=>({template_id:l.id,name:typeof c.name=="string"?c.name:"",sets:typeof c.sets=="number"?c.sets:1,reps:typeof c.reps=="string"?c.reps:"",rest_seconds:typeof c.restSeconds=="number"?c.restSeconds:typeof c.rest_seconds=="number"?c.rest_seconds:150,position:typeof c.position=="number"?c.position:d+1})),{error:y}=await w.from("template_exercises").insert(a);if(y)throw y}},Nt=async t=>{const s=t.target.files&&t.target.files[0];if(s)try{const r=await s.text();let o;try{o=JSON.parse(r)}catch{p("error"),m("Файл не является корректным JSON."),u(!0);return}if(!o||!Array.isArray(o.templates)){p("error"),m("Файл не похож на экспорт шаблонов из GymLog."),u(!0);return}if(!n)return;const l=Array.isArray(o.templates)?o.templates:[];if(l.length===0){p("error"),m("В файле нет шаблонов для импорта."),u(!0);return}const{data:x,error:b}=await w.from("workout_templates").select("id, name").eq("user_id",n.id);if(b){console.error("Error checking existing templates before import:",b),p("error"),m("Не удалось проверить существующие шаблоны перед импортом."),u(!0);return}const a=f=>typeof f=="string"?f.trim().toLowerCase():"",y=new Map;(x||[]).forEach(f=>{const k=a(f.name);k&&(y.has(k)||y.set(k,{id:f.id,name:f.name||""}))});const c=[],d=[];if(l.forEach(f=>{const k=a(f==null?void 0:f.name);if(!k||!y.has(k))c.push(f);else{const Y=y.get(k);d.push({existingId:Y.id,existingName:Y.name||"",template:f})}}),c.length===0&&d.length>0){p("error"),m("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),u(!0);return}if(d.length===0){O(!0);try{await Se({templates:l}),p("success"),m("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),u(!0)}catch(f){console.error("Error importing templates:",f),p("error"),m("Не удалось импортировать шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1)}return}ae(c),le(d),W(!0)}catch(r){console.error("Error importing templates:",r),p("error"),m("Не удалось импортировать шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1),t.target.value=""}},vt=async()=>{if(oe.length===0){W(!1),le([]),ae([]),p("error"),m("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),u(!0);return}ie("onlyNew"),O(!0);try{await Se({templates:oe}),ae([]),le([]),W(!1),p("success"),m("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),u(!0)}catch(t){console.error("Error importing only new templates:",t),p("error"),m("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),u(!0)}finally{O(!1),ie("none")}},St=async()=>{if(!(!n||F)){We(!0),te([]);try{const{data:t,error:s}=await w.from("workouts").select("id, workout_date").eq("user_id",n.id).order("workout_date",{ascending:!1});if(s){console.error("Error loading workouts for deletion:",s),alert("Не удалось загрузить список тренировок для удаления.");return}const r=new Map;(t||[]).forEach(l=>{const x=l.workout_date,b=l.id;!x||!b||(r.has(x)||r.set(x,[]),r.get(x).push(b))});const o=Array.from(r.entries()).map(([l,x])=>({date:l,workoutIds:x,count:x.length})).sort((l,x)=>x.date.localeCompare(l.date));if(o.length===0){p("error"),m("У вас нет тренировок для удаления."),u(!0);return}Re(o),ee(!1),ce(!0)}catch(t){console.error("Unexpected error while loading workouts for deletion:",t),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{We(!1)}}},_t=async()=>{if(!(!n||U)){Le(!0),se([]);try{const{data:t,error:s}=await w.from("workout_templates").select("id, name").eq("user_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error loading templates for deletion:",s),alert("Не удалось загрузить список шаблонов для удаления.");return}const r=(t||[]).map(o=>({id:o.id,name:o.name||"Без названия"}));if(r.length===0){p("error"),m("У вас нет шаблонов для удаления."),u(!0);return}Me(r),ee(!1),de(!0)}catch(t){console.error("Unexpected error while loading templates for deletion:",t),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{Le(!1)}}},Dt=t=>{te(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},Et=()=>{if(S.length===0)return;const t=L.length===S.length;te(t?[]:S.map(s=>s.date))},It=()=>{te([])},Ct=t=>{se(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},Tt=()=>{if(C.length===0)return;const t=R.length===C.length;se(t?[]:C.map(s=>s.id))},At=()=>{se([])},Ot=async()=>{if(!n||L.length===0)return;const t=S.filter(s=>L.includes(s.date)).flatMap(s=>s.workoutIds);if(t.length!==0){Pe(!0);try{const{data:s,error:r}=await w.from("workout_exercises").select("id, workout_id").in("workout_id",t);if(r)throw r;const o=(s||[]).map(l=>l.id);if(o.length>0){const{error:l}=await w.from("workout_sets").delete().in("workout_exercise_id",o);if(l)throw l}if(t.length>0){const{error:l}=await w.from("workout_exercises").delete().in("workout_id",t);if(l)throw l;const{error:x}=await w.from("workouts").delete().in("id",t);if(x)throw x}ce(!1),Re([]),te([]),p("success"),m("Выбранные тренировки успешно удалены."),u(!0)}catch(s){console.error("Error deleting workouts:",s),p("error"),m("Не удалось удалить выбранные тренировки."),u(!0)}finally{Pe(!1)}}},Wt=async()=>{if(n&&R.length!==0){ze(!0);try{const t=R;if(t.length>0){const{error:s}=await w.from("template_exercises").delete().in("template_id",t);if(s)throw s;const{error:r}=await w.from("workout_templates").delete().in("id",t);if(r)throw r}de(!1),Me([]),se([]),p("success"),m("Выбранные шаблоны тренировок успешно удалены."),u(!0)}catch(t){console.error("Error deleting templates:",t),p("error"),m("Не удалось удалить выбранные шаблоны тренировок."),u(!0)}finally{ze(!1)}}},Lt=async()=>{if(Z.length===0&&oe.length===0){W(!1);return}ie("overwrite"),O(!0);try{const t=Array.from(new Set(Z.map(r=>r.existingId)));if(t.length>0){const{error:r}=await w.from("template_exercises").delete().in("template_id",t);if(r)throw r;const{error:o}=await w.from("workout_templates").delete().in("id",t);if(o)throw o}const s=[...oe,...Z.map(r=>r.template)];await Se({templates:s}),ae([]),le([]),W(!1),p("success"),m("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),u(!0)}catch(t){console.error("Error overwriting templates:",t),alert("Не удалось импортировать шаблоны с перезаписью: "+((t==null?void 0:t.message)||String(t)))}finally{O(!1),ie("none")}},Je=S.length>0&&L.length===S.length,Ge=C.length>0&&R.length===C.length;return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative",style:{background:"#0a0a0b"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsxs("div",{className:"relative",ref:Ne,children:[e.jsx("button",{onClick:()=>D(!ne),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),ne&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{D(!1),ht()},disabled:Q,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Q?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{D(!1),jt()},disabled:X,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:X?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{D(!1),await qe()},disabled:Ie,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Ie?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{D(!1),await xt()},disabled:Te,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:Te?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{D(!1),ft()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{D(!1),pt()},disabled:_e,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:_e?"Удаление...":"Удалить аккаунт"})]})]})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:n&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),G?e.jsxs("span",{className:"font-semibold",children:[G.visiblePart,G.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>lt(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:at?e.jsx("span",{children:G.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,G.hiddenPart.length))})}),"@",G.domain]}):e.jsx("span",{className:"font-semibold",children:dt})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>we("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary",children:"Узнать прогресс"}),e.jsx("button",{onClick:mt,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"}),e.jsxs("button",{onClick:()=>it(!ve),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Настройки",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${ve?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})]}),ve&&e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Настройки"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Шаг таймера отдыха (секунды)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Значение, на которое изменяется таймер при нажатии +/-"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:Fe,onChange:t=>Ue(t.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:()=>{J.current&&clearTimeout(J.current);const t=parseInt(Fe,10);if(!isNaN(t)&&t>=1&&t<=300){fe("saving"),ct(t);try{localStorage.setItem("settings:timerStep",String(t))}catch{}J.current=setTimeout(()=>{fe("success"),J.current=setTimeout(()=>{fe("idle")},500)},350)}else Ue(String($e)),fe("idle")},disabled:pe==="saving",className:"btn-glass btn-glass-sm btn-glass-primary flex items-center justify-center gap-2 min-w-[120px]",children:[pe==="saving"&&e.jsx("span",{"aria-label":"Сохранение...",className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),pe==="success"&&e.jsx("svg",{"aria-label":"Сохранено",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),pe==="idle"&&"Сохранить"]})]})]})]}),e.jsx("input",{ref:ue,type:"file",accept:"application/json",className:"hidden",onChange:wt}),e.jsx("input",{ref:me,type:"file",accept:"application/json",className:"hidden",onChange:Nt}),e.jsx($t,{open:Ve,onOpenChange:t=>{Ee(t),t||(ye(""),K(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:be.trim().length===0,onConfirm:gt,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:n==null?void 0:n.email})]}),e.jsx("input",{type:"email",value:be,onChange:t=>{ye(t.target.value),ke&&K(null)},placeholder:(n==null?void 0:n.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),ke&&e.jsx("p",{className:"text-xs text-red-400",children:ke})]})}),rt&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{F||U||ee(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),(F||U)&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:St,disabled:F||U,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:_t,disabled:F||U,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{F||U||ee(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]}),nt&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{B||ce(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:Et,disabled:S.length===0||B,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${Je?"bg-green-500 border-green-400":"border-white/40"}`,children:Je&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:It,disabled:L.length===0||B,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[S.map(t=>{const s=L.includes(t.date);return e.jsxs("button",{type:"button",onClick:()=>Dt(t.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.date}),e.jsx("div",{className:"text-xs text-gray-400",children:t.count===1?"1 тренировка":`${t.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.date)}),S.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:Ot,disabled:L.length===0||B,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:B?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{B||ce(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),ot&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{q||de(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:Tt,disabled:C.length===0||q,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${Ge?"bg-green-500 border-green-400":"border-white/40"}`,children:Ge&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:At,disabled:R.length===0||q,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[C.map(t=>{const s=R.includes(t.id);return e.jsxs("button",{type:"button",onClick:()=>Ct(t.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${s?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${s?"bg-green-500 border-green-400":"border-white/40"}`,children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},t.id)}),C.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:Wt,disabled:R.length===0||q,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:q?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{q||de(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),e.jsx(Ft,{open:Xe,onOpenChange:t=>{t||(u(!1),m(null))},onClose:()=>{u(!1),m(null)},message:Ze||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:et}),tt&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{X||W(!1)}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[Z.map((t,s)=>{var r;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((r=t.template)==null?void 0:r.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",t.existingName||"Без названия","»"]})]},t.existingId+"-"+s)}),Z.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),X?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:st==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:vt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:Lt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:()=>{W(!1)},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}),He&&I&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{Q||(M(!1),P(null),z(null),T([]),A([]))}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${Ke||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),je.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:je.map(t=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:ut(t.date)})},t.date))})]}),Q?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:Oe==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":Oe==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[je.length>0&&e.jsx("button",{type:"button",onClick:yt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:bt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:kt,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:()=>{M(!1),P(null),z(null),T([]),A([])},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})]})};export{Kt as default};
