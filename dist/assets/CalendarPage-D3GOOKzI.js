import{c as L,u as B,a as U,s as V,j as t}from"./index-CdKHO-e-.js";import{d as G,u as J,r as y,e as S}from"./vendor-CITejod9.js";import{u as Q}from"./usePageState-Qdkxdikz.js";import{f as b,g as X,a as Z}from"./date-helpers-BU1_uwmq.js";import{W as T}from"./workout-icons-hM1IbQXr.js";import"./supabase-vtL5VWMt.js";import"./charts-D-QCyllA.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],te=L("ChevronLeft",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ae=L("ChevronRight",se),j=new Map,W=3e4,me=()=>{var $,E;const{user:o}=B(),C=G(),{t:f,language:O}=U(),D=J(),[H,N]=Q({key:"calendar-page",initialState:{currentDate:new Date,workouts:[],loading:!0,hasInitialData:!1},ttl:1800*1e3}),{currentDate:a,workouts:z,loading:R,hasInitialData:p}=H,A=s=>{N(e=>({...e,currentDate:s}))},w=s=>{N(e=>({...e,workouts:s}))},k=s=>{N(e=>({...e,loading:s}))},v=s=>{N(e=>({...e,hasInitialData:s}))},m=y.useCallback(async(s=!1,e=!1)=>{if(!o)return;const l=`${o.id}:${a.getFullYear()}-${a.getMonth()}`,n=Date.now();let i=e;if(j.has(l)){const r=j.get(l),c=n-r.timestamp;if(s&&c<W){p||(w(r.workouts),k(!1),v(!0));return}c>=W&&(p||(w(r.workouts),v(!0)),i=!0)}i||k(!0);const g=new Date(a.getFullYear(),a.getMonth(),1),d=new Date(a.getFullYear(),a.getMonth()+1,0),{data:x,error:h}=await V.from("workouts").select("id, workout_date, template_id, icon, notes, name, workout_templates(icon, name)").eq("user_id",o.id).gte("workout_date",b(g)).lte("workout_date",b(d));if(h)console.error("Error fetching workouts:",h);else{const r=(x||[]).map(c=>{var F,Y;return{...c,template_icon:((F=c.workout_templates)==null?void 0:F.icon)||null,workout_icon:c.icon||null,template_name:((Y=c.workout_templates)==null?void 0:Y.name)||null}});w(r),j.set(l,{workouts:r,timestamp:n})}k(!1),v(!0)},[o,a,p]);y.useEffect(()=>{p||m()},[a.getFullYear(),a.getMonth(),o]),y.useEffect(()=>{var l;if(!o||!((l=D.state)==null?void 0:l.removedDate))return;const e=`${o.id}:${a.getFullYear()}-${a.getMonth()}`;j.delete(e),m(!1,!1)},[($=D.state)==null?void 0:$.removedDate,o,a,m]),y.useEffect(()=>{var l;if(!o||!((l=D.state)==null?void 0:l.refreshDate))return;const e=`${o.id}:${a.getFullYear()}-${a.getMonth()}`;j.delete(e),m(!1,!1)},[(E=D.state)==null?void 0:E.refreshDate,o,a,m]),y.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&m(!0)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[m]);const K=X(a),M=f.calendar.daysOfWeekShort,u=new Date,P=s=>{const e=new Date(a.getFullYear(),a.getMonth(),s);C(`/workout/${b(e)}`)},I=s=>{const e=new Date(a.getFullYear(),a.getMonth()+s,1);A(e),v(!1)},_=new Map;z.forEach(s=>_.set(s.workout_date,s));const q=s=>{const l=new Date(a.getFullYear(),a.getMonth(),s).getDay();return l===0?6:l-1};return t.jsx("div",{className:"px-3 pt-3 pb-4 w-full max-w-2xl mx-auto flex flex-col",children:R&&!p?t.jsx("div",{className:"fixed inset-0 flex items-center justify-center",style:{background:"transparent"},children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"relative w-12 h-12",children:t.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-blue-500 border-r-blue-500 rounded-full animate-spin"})}),t.jsx("p",{className:"text-white text-center",children:f.calendar.loading})]})}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4 glass p-2 rounded-xl",children:[t.jsx("button",{onClick:()=>I(-1),className:"p-2 rounded-full text-white transition-colors focus:outline-hidden active:bg-white/10",style:{WebkitTapHighlightColor:"transparent"},children:t.jsx(te,{size:24})}),t.jsx("h1",{className:"text-lg font-bold text-center capitalize",children:Z(a,O)}),t.jsx("button",{onClick:()=>I(1),className:"p-2 rounded-full text-white transition-colors focus:outline-hidden active:bg-white/10",style:{WebkitTapHighlightColor:"transparent"},children:t.jsx(ae,{size:24})})]}),(()=>{const s=b(u),e=_.get(s),l=!!e,n=(e==null?void 0:e.workout_icon)||(e==null?void 0:e.template_icon),i=n?T[n]:null,g=u.getDay()===0?6:u.getDay()-1,d=M[g],x=(e==null?void 0:e.name)||(e==null?void 0:e.template_name),h=e==null?void 0:e.notes;return t.jsxs("div",{onClick:()=>C(`/workout/${s}`),className:"glass rounded-xl p-4 mb-4 cursor-pointer transition-all active:scale-[0.99] ring-2 ring-blue-500",style:{WebkitTapHighlightColor:"transparent"},children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-blue-400 font-medium uppercase mb-1",children:f.calendar.today}),t.jsxs("div",{className:"flex items-baseline gap-2",children:[t.jsx("span",{className:"text-3xl font-bold text-blue-400",children:u.getDate()}),t.jsx("span",{className:"text-sm text-gray-400 uppercase",children:d})]})]}),l&&i&&t.jsx("div",{style:{color:i.color},className:"shrink-0",children:S.createElement(i.component,{size:40,className:"opacity-90"})})]}),l?t.jsxs("div",{className:"mt-2",children:[x&&t.jsx("p",{className:"text-base font-medium text-white/90",children:x}),h&&t.jsx("p",{className:"text-sm text-gray-400 line-clamp-2 mt-1 whitespace-pre-line",children:h})]}):t.jsx("p",{className:"text-sm text-gray-400 mt-2",children:f.calendar.noWorkout})]})})(),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:Array.from({length:K},(s,e)=>e+1).map(s=>{const e=s===u.getDate()&&a.getMonth()===u.getMonth()&&a.getFullYear()===u.getFullYear(),l=b(new Date(a.getFullYear(),a.getMonth(),s)),n=_.get(l),i=!!n,g=(n==null?void 0:n.workout_icon)||(n==null?void 0:n.template_icon),d=g?T[g]:null,x=q(s),h=M[x],r=(n==null?void 0:n.name)||(n==null?void 0:n.template_name),c=n==null?void 0:n.notes;return t.jsxs("div",{onClick:()=>P(s),className:`calendar-cell glass rounded-xl p-2.5 cursor-pointer transition-all active:scale-[0.98] ${e?"calendar-cell-today ring-2 ring-blue-500":""}`,style:{WebkitTapHighlightColor:"transparent"},children:[t.jsxs("div",{className:"flex items-start justify-between mb-1",children:[t.jsxs("div",{className:"flex items-baseline gap-1",children:[t.jsx("span",{className:`text-lg font-bold ${e?"text-blue-400":""}`,children:s}),t.jsx("span",{className:"text-xs text-gray-400 uppercase",children:h})]}),i&&d&&t.jsx("div",{style:{color:d.color},className:"shrink-0",children:S.createElement(d.component,{size:32,className:"opacity-90"})})]}),i?t.jsxs("div",{className:"flex flex-col gap-0.5",children:[r&&t.jsx("p",{className:"text-sm font-medium text-white/90 line-clamp-1",children:r}),c&&t.jsx("p",{className:"text-xs text-gray-400 line-clamp-2 whitespace-pre-line",children:c}),!r&&!c&&!d&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full shrink-0"}),t.jsx("p",{className:"text-xs text-gray-400",children:f.calendar.noWorkout})]})]}):t.jsx("div",{className:"min-h-[32px]"})]},s)})})]})})};export{me as default};
