import{s as re,j as e,u as me}from"./index-42bJkKlu.js";import{r as s,c as pe,e as he}from"./vendor-BVca5W6X.js";import{C as ce}from"./confirm-dialog-D7qQ8hrI.js";import{T as ge}from"./template-saved-dialog-fosH9H3W.js";import{u as xe}from"./usePageState-6XNG0ilq.js";import{u as fe}from"./use-profile-settings-_EsJTNvx.js";import{R as we,L as be,C as ye,X as ke,Y as je,a as Ne}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function ve(){const t=re,{error:i}=await t.rpc("delete_user_account");if(i)throw i}const ae="body-weights-data",De=600*1e3;function Ce({userId:t}){const i=re,r=s.useRef(!1),[o,n]=s.useState(!1),[c,m]=xe({key:t?`${ae}-${t}`:ae,initialState:[],ttl:De}),[k,W]=s.useState(c),[j,_]=s.useState(!1),[N,A]=s.useState(""),[u,D]=s.useState(()=>{const h=new Date,a=String(h.getDate()).padStart(2,"0"),y=String(h.getMonth()+1).padStart(2,"0"),E=h.getFullYear();return`${a}.${y}.${E}`}),[g,C]=s.useState(!1),[B,P]=s.useState(null),[z,T]=s.useState(!1),[q,L]=s.useState(null);s.useEffect(()=>{c.length>0&&k.length===0&&(W(c),r.current=!0)},[]);const K=s.useCallback(async(h=!1)=>{if(t){if(!h&&r.current&&c.length>0){W(c);return}if(!h&&c.length>0){W(c),r.current=!0;return}_(!0);try{const{data:a,error:y}=await i.from("user_body_weights").select("*").eq("user_id",t).order("recorded_at",{ascending:!1}).limit(100);if(y)throw y;const E=a||[];W(E),m(E),r.current=!0}catch(a){console.error("Error loading body weights:",a)}finally{_(!1)}}},[t,i,c,m]),p=s.useCallback(h=>{const a=h.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!a)return null;const[,y,E,d]=a,f=parseInt(y,10),b=parseInt(E,10),v=parseInt(d,10);if(b<1||b>12||f<1||f>31||v<1900||v>2100)return null;const J=new Date(v,b,0).getDate();if(f>J)return null;const Q=new Date(v,b-1,f),w=new Date;if(w.setHours(23,59,59,999),Q>w)return null;const l=String(f).padStart(2,"0"),O=String(b).padStart(2,"0");return`${v}-${O}-${l}`},[]),I=s.useCallback(()=>{const h=new Date,a=String(h.getDate()).padStart(2,"0"),y=String(h.getMonth()+1).padStart(2,"0"),E=h.getFullYear();return`${a}.${y}.${E}`},[]),x=s.useCallback(async()=>{if(!t||!N||g)return;const h=parseFloat(N.replace(",","."));if(isNaN(h)||h<=0||h>500){alert("Введите корректный вес (от 0.1 до 500 кг)");return}const a=p(u);if(!a){alert("Введите корректную дату в формате д.мм.гггг (не в будущем)");return}C(!0);try{const{data:y,error:E}=await i.from("user_body_weights").upsert({user_id:t,weight:h,recorded_at:a},{onConflict:"user_id,recorded_at"}).select().single();if(E)throw E;const d=(()=>{const f=k.filter(b=>b.recorded_at!==a);return[y,...f].sort((b,v)=>new Date(v.recorded_at).getTime()-new Date(b.recorded_at).getTime())})();W(d),m(d),A(""),D(I())}catch(y){console.error("Error saving weight:",y),alert("Не удалось сохранить вес")}finally{C(!1)}},[t,N,u,g,i,p,I,k,m]),U=s.useCallback(async h=>{if(!(!t||B)){P(h);try{const{error:a}=await i.from("user_body_weights").delete().eq("id",h);if(a)throw a;const y=k.filter(E=>E.id!==h);W(y),m(y),T(!1),L(null)}catch(a){console.error("Error deleting weight:",a),alert("Не удалось удалить запись")}finally{P(null)}}},[t,B,i,k,m]),M=s.useCallback(h=>{L(h),T(!0)},[]),H=s.useMemo(()=>[...k].sort((h,a)=>new Date(h.recorded_at).getTime()-new Date(a.recorded_at).getTime()).slice(-30).map(h=>({date:new Date(h.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short"}),weight:Number(h.weight),fullDate:h.recorded_at})),[k]),G=s.useMemo(()=>{if(k.length===0)return null;const h=k.map(f=>Number(f.weight)),a=h[0],y=Math.min(...h),E=Math.max(...h),d=k.length>1?a-h[h.length-1]:0;return{current:a,min:y,max:E,change:d}},[k]);return{isWeightTrackerOpen:o,bodyWeights:k,loadingWeights:j,newWeight:N,newWeightDate:u,savingWeight:g,deletingWeightId:B,isDeleteWeightConfirmOpen:z,weightToDelete:q,weightChartData:H,weightStats:G,setIsWeightTrackerOpen:n,setNewWeight:A,setNewWeightDate:D,setIsDeleteWeightConfirmOpen:T,loadBodyWeights:K,handleAddWeight:x,handleDeleteWeight:U,handleOpenDeleteWeightConfirm:M}}const We=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function le(t){if(typeof t!="string")return null;const i=t.trim();return We.includes(i)?i:null}function _e({userId:t,userEmail:i}){const r=re,[o,n]=s.useState(!1),[c,m]=s.useState(!1),[k,W]=s.useState(!1),[j,_]=s.useState(null),[N,A]=s.useState(null),[u,D]=s.useState([]),[g,C]=s.useState([]),[B,P]=s.useState("none"),[z,T]=s.useState(!1),[q,L]=s.useState(null),[K,p]=s.useState("success"),I=s.useRef(null),x=s.useCallback(async d=>{if(!t)return;const f=Array.isArray(d.workouts)?d.workouts:[];if(f.length===0){p("error"),L("В файле нет тренировок для импорта."),T(!0);return}const{data:b,error:v}=await r.from("workouts").select("id, workout_date").eq("user_id",t);if(v)throw v;const J=new Set;f.forEach(l=>{const O=typeof l.date=="string"&&l.date?l.date:typeof l.workout_date=="string"&&l.workout_date?l.workout_date:"";O&&J.add(O)});const w=(b||[]).filter(l=>J.has(l.workout_date)).map(l=>l.id);if(w.length>0){const{data:l,error:O}=await r.from("workout_exercises").select("id, workout_id").in("workout_id",w);if(O)throw O;const Y=(l||[]).map(S=>S.id);if(Y.length>0){const{error:S}=await r.from("workout_sets").delete().in("workout_exercise_id",Y);if(S)throw S}if(w.length>0){const{error:S}=await r.from("workout_exercises").delete().in("workout_id",w);if(S)throw S;const{error:R}=await r.from("workouts").delete().in("id",w);if(R)throw R}}for(const l of f){const O=typeof l.name=="string"&&l.name.trim().length>0?l.name.trim():"Импортированная тренировка",Y=typeof l.date=="string"&&l.date?l.date:new Date().toISOString().slice(0,10),{data:S,error:R}=await r.from("workouts").insert({user_id:t,name:O,icon:le(l.icon),workout_date:Y,is_cardio:!!l.isCardio,template_id:null}).select().single();if(R||!S)throw R||new Error("Не удалось создать тренировку при импорте.");const Z=Array.isArray(l.exercises)?l.exercises:[];if(Z.length===0)continue;const oe=Z.map((F,ee)=>({workout_id:S.id,name:typeof F.name=="string"?F.name:"",position:typeof F.position=="number"?F.position:ee+1,reps:typeof F.reps=="string"?F.reps:"",rest_seconds:typeof F.restSeconds=="number"?F.restSeconds:typeof F.rest_seconds=="number"?F.rest_seconds:150,sets:typeof F.setsPlanned=="number"?F.setsPlanned:Array.isArray(F.sets)?F.sets.length:1})),{data:$,error:X}=await r.from("workout_exercises").insert(oe).select();if(X||!$)throw X||new Error("Не удалось создать упражнения при импорте.");const se=[],de=[...Z].sort((F,ee)=>{const te=typeof F.position=="number"?F.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne}),ue=[...$].sort((F,ee)=>{const te=typeof F.position=="number"?F.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne});if(de.forEach((F,ee)=>{const te=ue[ee];if(!te)return;(Array.isArray(F.sets)?F.sets:[]).forEach(V=>{se.push({workout_exercise_id:te.id,set_index:typeof V.index=="number"?V.index:1,weight:typeof V.weight=="number"?V.weight:null,reps:V.reps==null?null:String(V.reps),is_done:!!V.isDone,updated_at:typeof V.updatedAt=="string"&&V.updatedAt?V.updatedAt:new Date().toISOString()})})}),se.length>0){const{error:F}=await r.from("workout_sets").insert(se);if(F)throw F}}},[t,r]),U=s.useCallback(async()=>{if(t){n(!0);try{const{data:d,error:f}=await r.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",t).order("workout_date",{ascending:!1});if(f){console.error("Error exporting workouts:",f),alert("Не удалось загрузить данные тренировок для экспорта.");return}const b=(d||[]).map(Y=>({id:Y.id,name:Y.name,icon:le(Y.icon),date:Y.workout_date,isCardio:!!Y.is_cardio,templateId:Y.template_id,exercises:(Y.workout_exercises||[]).map(S=>({id:S.id,name:S.name,position:S.position,reps:S.reps,restSeconds:S.rest_seconds,setsPlanned:S.sets,sets:(S.workout_sets||[]).map(R=>({id:R.id,index:R.set_index,weight:R.weight,reps:R.reps,isDone:R.is_done,updatedAt:R.updated_at}))}))})),v={exportedAt:new Date().toISOString(),user:{id:t,email:i},workouts:b},J=JSON.stringify(v,null,2),Q=new Blob([J],{type:"application/json;charset=utf-8;"}),w=URL.createObjectURL(Q),l=document.createElement("a"),O=new Date().toISOString().slice(0,10);l.href=w,l.download=`gymlog-workouts-${O}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(w)}catch(d){console.error("Unexpected error while exporting workouts:",d),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{n(!1)}}},[t,i,r]),M=s.useCallback(()=>{!t||c||I.current&&(I.current.value="",I.current.click())},[t,c]),H=s.useCallback(async d=>{const f=d.target.files&&d.target.files[0];if(f)try{D([]),C([]);const b=await f.text();let v;try{v=JSON.parse(b)}catch{p("error"),L("Файл не является корректным JSON."),T(!0);return}if(!v||!Array.isArray(v.workouts)){p("error"),L("Файл не похож на экспорт тренировок из GymLog."),T(!0);return}if(!t)return;const J=Array.isArray(v.workouts)?v.workouts:[],Q=new Set;J.forEach($=>{const X=typeof $.date=="string"&&$.date?$.date:typeof $.workout_date=="string"&&$.workout_date?$.workout_date:"";X&&Q.add(X)});const{data:w,error:l}=await r.from("workouts").select("workout_date").eq("user_id",t);if(l){console.error("Error checking existing workouts before import:",l),p("error"),L("Не удалось проверить существующие тренировки перед импортом."),T(!0);return}const O=new Set((w||[]).map($=>$.workout_date)),Y=O.size>0,S=new Map;J.forEach($=>{const X=typeof $.date=="string"&&$.date?$.date:typeof $.workout_date=="string"&&$.workout_date?$.workout_date:"";X&&S.set(X,(S.get(X)||0)+1)});const R=[],Z=[];Q.forEach($=>{O.has($)?R.push($):Z.push($)});const oe=R.length>0;if(!Y||!oe){p("success"),m(!0);try{await x(v),L("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),T(!0)}catch($){console.error("Error importing workouts:",$),alert("Не удалось импортировать тренировки: "+(($==null?void 0:$.message)||String($)))}finally{m(!1)}return}if(Z.length===0){p("error"),L("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),T(!0);return}if(_(v),A(f.name),Z.length>0){const $=Z.map(X=>({date:X,count:S.get(X)||0})).sort((X,se)=>se.date.localeCompare(X.date));D(Z),C($)}else D([]),C([]);W(!0)}catch(b){console.error("Error reading workouts import file:",b),alert("Не удалось прочитать файл тренировок.")}finally{d.target.value=""}},[t,r,x]),G=s.useCallback(async()=>{if(j){P("import"),m(!0);try{await x(j),_(null),A(null),D([]),C([]),W(!1),p("success"),L("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),T(!0)}catch(d){console.error("Error importing workouts:",d),alert("Не удалось импортировать тренировки: "+((d==null?void 0:d.message)||String(d)))}finally{m(!1),P("none")}}},[j,x]),h=s.useCallback(async()=>{if(!j)return;const d=Array.isArray(j.workouts)?j.workouts:[];if(d.length===0){p("error"),L("В файле нет тренировок для импорта."),T(!0);return}const f=new Set(u);if(f.size===0){p("error"),L("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),T(!0);return}const b=d.filter(v=>{const J=typeof v.date=="string"&&v.date?v.date:typeof v.workout_date=="string"&&v.workout_date?v.workout_date:"";return!!J&&f.has(J)});if(b.length===0){p("error"),L("Не удалось определить новые тренировки для импорта. Проверьте файл."),T(!0);return}P("onlyNew"),m(!0);try{await x({workouts:b}),_(null),A(null),D([]),C([]),W(!1),p("success"),L("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),T(!0)}catch(v){console.error("Error importing only new workouts:",v),p("error"),L("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),T(!0)}finally{m(!1),P("none")}},[j,u,x]),a=s.useCallback(async()=>{if(j){P("exportThenImport"),m(!0);try{await U(),await x(j),_(null),A(null),W(!1),p("success"),L("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),T(!0)}catch(d){console.error("Error exporting and importing workouts:",d),p("error"),L("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),T(!0)}finally{m(!1),P("none")}}},[j,U,x]),y=s.useCallback(()=>{W(!1),_(null),A(null),D([]),C([])},[]),E=s.useCallback(()=>{T(!1),L(null)},[]);return{isExporting:o,isImportingWorkouts:c,isWorkoutsImportDialogOpen:k,pendingWorkoutsImport:j,pendingWorkoutsFileName:N,pendingWorkoutsNewDates:u,pendingWorkoutsNewDatesSummary:g,importAction:B,isImportSuccessOpen:z,importSuccessMessage:q,toastVariant:K,workoutsFileInputRef:I,handleExportWorkouts:U,handleStartImportWorkouts:M,handleWorkoutsFileChange:H,handleConfirmImportWorkoutsOnly:G,handleImportOnlyNewWorkouts:h,handleExportThenImportWorkouts:a,closeWorkoutsImportDialog:y,closeImportSuccessToast:E,setIsImportSuccessOpen:T,setImportSuccessMessage:L,setToastVariant:p}}const Se=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function ie(t){if(typeof t!="string")return null;const i=t.trim();return Se.includes(i)?i:null}function Ee({userId:t,userEmail:i,setToastVariant:r,setImportSuccessMessage:o,setIsImportSuccessOpen:n}){const c=re,[m,k]=s.useState(!1),[W,j]=s.useState(!1),[_,N]=s.useState(!1),[A,u]=s.useState([]),[D,g]=s.useState([]),[C,B]=s.useState("none"),P=s.useRef(null),z=s.useCallback(async x=>{if(!t)return;const U=Array.isArray(x.templates)?x.templates:[];if(U.length===0){r("error"),o("В файле нет шаблонов для импорта."),n(!0);return}for(const M of U){const H=typeof M.name=="string"&&M.name.trim().length>0?M.name.trim():"Импортированный шаблон",{data:G,error:h}=await c.from("workout_templates").insert({user_id:t,name:H,icon:ie(M.icon)}).select().single();if(h||!G)throw h||new Error("Не удалось создать шаблон при импорте.");const a=Array.isArray(M.exercises)?M.exercises:[];if(a.length===0)continue;const y=a.map((d,f)=>({template_id:G.id,name:typeof d.name=="string"?d.name:"",sets:typeof d.sets=="number"?d.sets:1,reps:typeof d.reps=="string"?d.reps:"",rest_seconds:typeof d.restSeconds=="number"?d.restSeconds:typeof d.rest_seconds=="number"?d.rest_seconds:150,position:typeof d.position=="number"?d.position:f+1})),{error:E}=await c.from("template_exercises").insert(y);if(E)throw E}},[t,c,r,o,n]),T=s.useCallback(async()=>{if(t){k(!0);try{const{data:x,error:U}=await c.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",t).order("created_at",{ascending:!1});if(U){console.error("Error exporting templates:",U),alert("Не удалось загрузить шаблоны для экспорта.");return}const M=(x||[]).map(d=>({id:d.id,name:d.name,icon:ie(d.icon),createdAt:d.created_at,exercises:(d.template_exercises||[]).map(f=>({id:f.id,name:f.name,sets:f.sets,reps:f.reps,restSeconds:f.rest_seconds,position:f.position}))})),H={exportedAt:new Date().toISOString(),user:{id:t,email:i},templates:M},G=JSON.stringify(H,null,2),h=new Blob([G],{type:"application/json;charset=utf-8;"}),a=URL.createObjectURL(h),y=document.createElement("a"),E=new Date().toISOString().slice(0,10);y.href=a,y.download=`gymlog-templates-${E}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(a)}catch(x){console.error("Unexpected error while exporting templates:",x),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{k(!1)}}},[t,i,c]),q=s.useCallback(()=>{!t||W||P.current&&(P.current.value="",P.current.click())},[t,W]),L=s.useCallback(async x=>{const U=x.target.files&&x.target.files[0];if(U)try{const M=await U.text();let H;try{H=JSON.parse(M)}catch{r("error"),o("Файл не является корректным JSON."),n(!0);return}if(!H||!Array.isArray(H.templates)){r("error"),o("Файл не похож на экспорт шаблонов из GymLog."),n(!0);return}if(!t)return;const G=Array.isArray(H.templates)?H.templates:[];if(G.length===0){r("error"),o("В файле нет шаблонов для импорта."),n(!0);return}const{data:h,error:a}=await c.from("workout_templates").select("id, name").eq("user_id",t);if(a){console.error("Error checking existing templates before import:",a),r("error"),o("Не удалось проверить существующие шаблоны перед импортом."),n(!0);return}const y=b=>typeof b=="string"?b.trim().toLowerCase():"",E=new Map;(h||[]).forEach(b=>{const v=y(b.name);v&&(E.has(v)||E.set(v,{id:b.id,name:b.name||""}))});const d=[],f=[];if(G.forEach(b=>{const v=y(b==null?void 0:b.name);if(!v||!E.has(v))d.push(b);else{const J=E.get(v);f.push({existingId:J.id,existingName:J.name||"",template:b})}}),d.length===0&&f.length>0){r("error"),o("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),n(!0);return}if(f.length===0){j(!0);try{await z({templates:G}),r("success"),o("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),n(!0)}catch(b){console.error("Error importing templates:",b),r("error"),o("Не удалось импортировать шаблоны. Попробуйте ещё раз."),n(!0)}finally{j(!1)}return}u(d),g(f),N(!0)}catch(M){console.error("Error importing templates:",M),r("error"),o("Не удалось импортировать шаблоны. Попробуйте ещё раз."),n(!0)}finally{j(!1),x.target.value=""}},[t,c,z,r,o,n]),K=s.useCallback(async()=>{if(A.length===0){N(!1),g([]),u([]),r("error"),o("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),n(!0);return}B("onlyNew"),j(!0);try{await z({templates:A}),u([]),g([]),N(!1),r("success"),o("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),n(!0)}catch(x){console.error("Error importing only new templates:",x),r("error"),o("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),n(!0)}finally{j(!1),B("none")}},[A,z,r,o,n]),p=s.useCallback(async()=>{if(D.length===0&&A.length===0){N(!1);return}B("overwrite"),j(!0);try{const x=Array.from(new Set(D.map(M=>M.existingId)));if(x.length>0){const{error:M}=await c.from("template_exercises").delete().in("template_id",x);if(M)throw M;const{error:H}=await c.from("workout_templates").delete().in("id",x);if(H)throw H}const U=[...A,...D.map(M=>M.template)];await z({templates:U}),u([]),g([]),N(!1),r("success"),o("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),n(!0)}catch(x){console.error("Error overwriting templates:",x),alert("Не удалось импортировать шаблоны с перезаписью: "+((x==null?void 0:x.message)||String(x)))}finally{j(!1),B("none")}},[D,A,c,z,r,o,n]),I=s.useCallback(()=>{N(!1),u([]),g([])},[]);return{isExportingTemplates:m,handleExportTemplates:T,isImportingTemplates:W,isTemplatesImportDialogOpen:_,pendingTemplatesNew:A,pendingTemplatesDuplicates:D,templatesImportAction:C,templatesFileInputRef:P,handleStartImportTemplates:q,handleTemplatesFileChange:L,handleImportTemplatesOnlyNew:K,handleImportTemplatesOverwrite:p,closeTemplatesImportDialog:I}}function Te({userId:t,setToastVariant:i,setImportSuccessMessage:r,setIsImportSuccessOpen:o}){const n=re,[c,m]=s.useState(!1),[k,W]=s.useState(!1),[j,_]=s.useState(!1),[N,A]=s.useState([]),[u,D]=s.useState([]),[g,C]=s.useState(!1),[B,P]=s.useState(!1),[z,T]=s.useState(!1),[q,L]=s.useState([]),[K,p]=s.useState([]),[I,x]=s.useState(!1),U=N.length>0&&u.length===N.length,M=q.length>0&&K.length===q.length,H=s.useCallback(async()=>{if(!(!t||j)){_(!0),D([]);try{const{data:w,error:l}=await n.from("workouts").select("id, workout_date").eq("user_id",t).order("workout_date",{ascending:!1});if(l){console.error("Error loading workouts for deletion:",l),alert("Не удалось загрузить список тренировок для удаления.");return}const O=new Map;(w||[]).forEach(S=>{const R=S.workout_date,Z=S.id;!R||!Z||(O.has(R)||O.set(R,[]),O.get(R).push(Z))});const Y=Array.from(O.entries()).map(([S,R])=>({date:S,workoutIds:R,count:R.length})).sort((S,R)=>R.date.localeCompare(S.date));if(Y.length===0){i("error"),r("У вас нет тренировок для удаления."),o(!0);return}A(Y),m(!1),W(!0)}catch(w){console.error("Unexpected error while loading workouts for deletion:",w),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{_(!1)}}},[t,j,n,i,r,o]),G=s.useCallback(async()=>{if(!(!t||z)){T(!0),p([]);try{const{data:w,error:l}=await n.from("workout_templates").select("id, name").eq("user_id",t).order("created_at",{ascending:!1});if(l){console.error("Error loading templates for deletion:",l),alert("Не удалось загрузить список шаблонов для удаления.");return}const O=(w||[]).map(Y=>({id:Y.id,name:Y.name||"Без названия"}));if(O.length===0){i("error"),r("У вас нет шаблонов для удаления."),o(!0);return}L(O),m(!1),P(!0)}catch(w){console.error("Unexpected error while loading templates for deletion:",w),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{T(!1)}}},[t,z,n,i,r,o]),h=s.useCallback(w=>{D(l=>l.includes(w)?l.filter(O=>O!==w):[...l,w])},[]),a=s.useCallback(()=>{if(N.length===0)return;const w=u.length===N.length;D(w?[]:N.map(l=>l.date))},[N,u.length]),y=s.useCallback(()=>{D([])},[]),E=s.useCallback(w=>{p(l=>l.includes(w)?l.filter(O=>O!==w):[...l,w])},[]),d=s.useCallback(()=>{if(q.length===0)return;const w=K.length===q.length;p(w?[]:q.map(l=>l.id))},[q,K.length]),f=s.useCallback(()=>{p([])},[]),b=s.useCallback(async()=>{if(!t||u.length===0)return;const w=N.filter(l=>u.includes(l.date)).flatMap(l=>l.workoutIds);if(w.length!==0){C(!0);try{const{data:l,error:O}=await n.from("workout_exercises").select("id, workout_id").in("workout_id",w);if(O)throw O;const Y=(l||[]).map(S=>S.id);if(Y.length>0){const{error:S}=await n.from("workout_sets").delete().in("workout_exercise_id",Y);if(S)throw S}if(w.length>0){const{error:S}=await n.from("workout_exercises").delete().in("workout_id",w);if(S)throw S;const{error:R}=await n.from("workouts").delete().in("id",w);if(R)throw R}W(!1),A([]),D([]),i("success"),r("Выбранные тренировки успешно удалены."),o(!0)}catch(l){console.error("Error deleting workouts:",l),i("error"),r("Не удалось удалить выбранные тренировки."),o(!0)}finally{C(!1)}}},[t,u,N,n,i,r,o]),v=s.useCallback(async()=>{if(t&&K.length!==0){x(!0);try{const w=K;if(w.length>0){const{error:l}=await n.from("template_exercises").delete().in("template_id",w);if(l)throw l;const{error:O}=await n.from("workout_templates").delete().in("id",w);if(O)throw O}P(!1),L([]),p([]),i("success"),r("Выбранные шаблоны тренировок успешно удалены."),o(!0)}catch(w){console.error("Error deleting templates:",w),i("error"),r("Не удалось удалить выбранные шаблоны тренировок."),o(!0)}finally{x(!1)}}},[t,K,n,i,r,o]),J=s.useCallback(()=>{g||W(!1)},[g]),Q=s.useCallback(()=>{I||P(!1)},[I]);return{isCleanDataDialogOpen:c,setIsCleanDataDialogOpen:m,isDeleteWorkoutsDialogOpen:k,isLoadingWorkoutsForDeletion:j,workoutDateGroups:N,selectedWorkoutDates:u,isDeletingWorkouts:g,areAllWorkoutDatesSelected:U,isDeleteTemplatesDialogOpen:B,isLoadingTemplatesForDeletion:z,templatesForDeletion:q,selectedTemplateIds:K,isDeletingTemplates:I,areAllTemplatesSelected:M,openDeleteWorkoutsDialog:H,toggleWorkoutDateSelection:h,selectAllWorkoutDates:a,clearWorkoutSelection:y,handleDeleteSelectedWorkouts:b,closeDeleteWorkoutsDialog:J,openDeleteTemplatesDialog:G,toggleTemplateSelection:E,selectAllTemplates:d,clearTemplateSelection:f,handleDeleteSelectedTemplates:v,closeDeleteTemplatesDialog:Q}}function Ae(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,o,n]=i;if(r&&o&&n)return`${n}.${o}.${r}`}return t}function Oe(t,i){const r=t.replace(/[^0-9.]/g,""),o=r.split(".");let n=o[0]||"",c=o[1]||"",m=o[2]||"";n=n.slice(0,2),c=c.slice(0,2),m=m.slice(0,4);const k=r.length>i.replace(/[^0-9.]/g,"").length;return o.length===1&&n.length===2&&k?`${n}.`:o.length===2&&c.length===2&&k?`${n}.${c}.`:o.length===1?n:o.length===2?`${n}.${c}`:`${n}.${c}.${m}`}function Le({isOpen:t,onClose:i,bodyWeights:r,loadingWeights:o,weightChartData:n,weightStats:c,newWeight:m,newWeightDate:k,savingWeight:W,deletingWeightId:j,isDeleteWeightConfirmOpen:_,weightToDelete:N,setNewWeight:A,setNewWeightDate:u,setIsDeleteWeightConfirmOpen:D,handleAddWeight:g,handleDeleteWeight:C,handleOpenDeleteWeightConfirm:B}){const[P,z]=s.useState(null),[T,q]=s.useState(0),L=7,K=s.useRef(null),p=144,I=8;s.useEffect(()=>(t?(document.body.style.overflow="hidden",document.body.style.touchAction="none"):(document.body.style.overflow="",document.body.style.touchAction=""),()=>{document.body.style.overflow="",document.body.style.touchAction=""}),[t]),s.useEffect(()=>{q(0)},[r.length]);const x=s.useCallback((a,y)=>{var l;if((l=a==null?void 0:a.stopPropagation)==null||l.call(a),!y)return;const E=K.current,d=a==null?void 0:a.currentTarget;if(!E||!d||typeof d.getBoundingClientRect!="function")return;const f=E.getBoundingClientRect(),b=d.getBoundingClientRect(),v=b.left+b.width/2-f.left,J=b.top+b.height/2-f.top,Q=p/2,w=Math.max(Q+I,Math.min(v,f.width-Q-I));z({date:y.date,weight:y.weight,x:w,y:J})},[I,p]),U=s.useCallback(()=>{z(null)},[]),M=s.useCallback(a=>{const{cx:y,cy:E,payload:d,index:f}=a;return e.jsx("circle",{cx:y,cy:E,r:4,fill:"#3b82f6",stroke:"none",style:{cursor:"pointer"},onClick:b=>x(b,d)},`dot-${f}`)},[x]),H=s.useCallback(a=>{const{cx:y,cy:E,payload:d,index:f}=a;return e.jsx("circle",{cx:y,cy:E,r:6,fill:"#60a5fa",stroke:"#fff",strokeWidth:2,style:{cursor:"pointer"},onClick:b=>x(b,d)},`active-dot-${f}`)},[x]),G=Math.ceil(r.length/L),h=r.slice(T*L,(T+1)*L);return t?pe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center px-4",style:{paddingTop:"calc(env(safe-area-inset-top, 0px) + 16px)",paddingBottom:"calc(96px + env(safe-area-inset-bottom))"},onTouchMove:a=>a.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:i,onTouchMove:a=>a.preventDefault()}),e.jsxs("div",{className:"relative glass card-dark p-5 rounded-2xl max-w-md w-full my-auto overflow-y-auto custom-scrollbar",style:{maxHeight:"calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom) - 120px)"},onClick:a=>a.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:i,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-white pr-10",children:"Трекер веса тела"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Добавить запись"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Вес (кг)"}),e.jsx("input",{type:"text",inputMode:"decimal",value:m,onChange:a=>{const y=a.target.value.replace(".",",");/^[0-9]*[,]?[0-9]*$/.test(y)&&A(y)},placeholder:"70,25",className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Дата"}),e.jsx("input",{type:"text",inputMode:"numeric",value:k,onChange:a=>{const y=Oe(a.target.value,k);u(y)},placeholder:"8.12.2025",maxLength:10,className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:g,disabled:!m||!k||W,className:"btn-glass btn-glass-sm btn-glass-primary disabled:opacity-50",children:W?"...":"Добавить"})})]}),c&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Текущий"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[c.current.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Мин"}),e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[c.min.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Макс"}),e.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[c.max.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Изменение"}),e.jsxs("p",{className:`text-lg font-bold ${c.change>0?"text-red-400":c.change<0?"text-green-400":"text-gray-400"}`,children:[c.change>0?"+":"",c.change.toFixed(2).replace(".",",")," кг"]})]})]}),n.length>1&&e.jsxs("div",{className:"relative",onClick:U,ref:K,children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsx("div",{style:{minWidth:`${Math.max(n.length*50,100)}px`,height:"192px"},children:e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(be,{data:n,margin:{top:15,right:20,left:-20,bottom:5},children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(ke,{dataKey:"date",tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1}),e.jsx(je,{domain:["dataMin - 2","dataMax + 2"],tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1,tickFormatter:a=>Number(a).toFixed(2).replace(".",",")}),e.jsx(Ne,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:M,activeDot:H,isAnimationActive:!1})]})})})}),P&&e.jsxs("div",{className:"absolute pointer-events-none w-36 text-center",style:{left:`${P.x}px`,top:`${P.y}px`,transform:"translate(-50%, calc(-100% - 12px))",background:"rgba(255,255,255,0.98)",border:"1px solid rgba(0,0,0,0.08)",borderRadius:"8px",padding:"8px 12px",color:"#111827",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",zIndex:20},children:[e.jsx("p",{className:"text-sm text-gray-600 truncate",children:P.date}),e.jsxs("p",{className:"text-sm font-medium truncate",children:[e.jsx("span",{className:"text-gray-500",children:"Вес : "}),e.jsxs("span",{className:"text-green-600",children:[P.weight.toFixed(2).replace(".",",")," кг"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-300 font-medium",children:["История (",r.length,")"]}),G>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>q(a=>Math.max(0,a-1)),disabled:T===0,className:"w-7 h-7 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:hover:bg-white/10 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})})}),e.jsxs("span",{className:"text-xs text-gray-400 min-w-[40px] text-center",children:[T+1," / ",G]}),e.jsx("button",{type:"button",onClick:()=>q(a=>Math.min(G-1,a+1)),disabled:T>=G-1,className:"w-7 h-7 rounded-lg bg-white/10 hover:bg-white/20 disabled:opacity-30 disabled:hover:bg-white/10 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})})]})]}),o?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):r.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Пока нет записей. Добавьте свой первый вес выше."}):e.jsx("div",{className:"space-y-1",children:h.map(a=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-medium",children:[Number(a.weight).toFixed(2).replace(".",",")," кг"]}),e.jsx("span",{className:"text-sm text-gray-400",children:Ae(new Date(a.recorded_at).toISOString().slice(0,10))})]}),e.jsx("button",{type:"button",onClick:()=>B(a.id),disabled:j===a.id,className:"p-1 text-gray-500 hover:text-red-400 transition-colors disabled:opacity-50",children:j===a.id?e.jsx("span",{className:"w-4 h-4 border border-white/30 border-t-white rounded-full animate-spin inline-block"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},a.id))})]})]})]}),e.jsx(ce,{open:_,onOpenChange:D,title:"Удалить запись о весе?",description:"Это действие необратимо.",confirmText:"Удалить",cancelText:"Отмена",variant:"danger",onConfirm:()=>{N&&C(N)}})]}),document.body):null}function $e({isOpen:t,onClose:i,isLoadingWorkoutsForDeletion:r,isLoadingTemplatesForDeletion:o,openDeleteWorkoutsDialog:n,openDeleteTemplatesDialog:c}){if(!t)return null;const m=r||o;return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{m||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),m&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:n,disabled:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:c,disabled:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{m||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}function Me({isOpen:t,onClose:i,workoutDateGroups:r,selectedWorkoutDates:o,isDeletingWorkouts:n,areAllWorkoutDatesSelected:c,toggleWorkoutDateSelection:m,selectAllWorkoutDates:k,clearWorkoutSelection:W,handleDeleteSelectedWorkouts:j}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:k,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${c?"bg-green-500 border-green-400":"border-white/40"}`,children:c&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:W,disabled:o.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(_=>{const N=o.includes(_.date);return e.jsxs("button",{type:"button",onClick:()=>m(_.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${N?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:_.date}),e.jsx("div",{className:"text-xs text-gray-400",children:_.count===1?"1 тренировка":`${_.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${N?"bg-green-500 border-green-400":"border-white/40"}`,children:N&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},_.date)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:j,disabled:o.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Re({isOpen:t,onClose:i,templatesForDeletion:r,selectedTemplateIds:o,isDeletingTemplates:n,areAllTemplatesSelected:c,toggleTemplateSelection:m,selectAllTemplates:k,clearTemplateSelection:W,handleDeleteSelectedTemplates:j}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||i()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:k,disabled:r.length===0||n,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${c?"bg-green-500 border-green-400":"border-white/40"}`,children:c&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:W,disabled:o.length===0||n,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[r.map(_=>{const N=o.includes(_.id);return e.jsxs("button",{type:"button",onClick:()=>m(_.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${N?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:_.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${N?"bg-green-500 border-green-400":"border-white/40"}`,children:N&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},_.id)}),r.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:j,disabled:o.length===0||n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:n?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{n||i()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Ie({isImportingWorkouts:t,isImportingTemplates:i,handleStartImportWorkouts:r,handleStartImportTemplates:o,isExporting:n,isExportingTemplates:c,handleExportWorkouts:m,handleExportTemplates:k,isDeleting:W,startCleanDataFlow:j,startDeleteAccountFlow:_}){const[N,A]=s.useState(!1),u=s.useRef(null);return s.useEffect(()=>{const D=g=>{u.current&&!u.current.contains(g.target)&&A(!1)};if(N)return document.addEventListener("click",D),()=>document.removeEventListener("click",D)},[N]),e.jsxs("div",{className:"relative",ref:u,children:[e.jsx("button",{onClick:()=>A(!N),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),N&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{A(!1),r()},disabled:t,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:t?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{A(!1),o()},disabled:i,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:i?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{A(!1),await m()},disabled:n,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:n?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{A(!1),await k()},disabled:c,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:c?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{A(!1),j()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{A(!1),_()},disabled:W,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:W?"Удаление...":"Удалить аккаунт"})]})]})}function Pe({isOpen:t,timerStepInput:i,setTimerStepInput:r,saveStatus:o,saveTimerStep:n,theme:c,handleThemeChange:m}){return t?e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Настройки"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Шаг таймера отдыха (секунды)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Значение, на которое изменяется таймер при нажатии +/-"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:i,onChange:k=>r(k.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:n,disabled:o==="saving",className:"btn-glass btn-glass-primary flex items-center justify-center gap-2 !py-2 !px-4 min-w-[104px]",children:[o==="saving"&&e.jsx("span",{"aria-label":"Сохранение...",className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),o==="success"&&e.jsx("svg",{"aria-label":"Сохранено",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),o==="idle"&&"Сохранить"]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Тема оформления"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("dark"),className:`btn-glass ${c==="dark"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),"Тёмная"]})}),e.jsx("button",{type:"button",onClick:()=>m("light"),className:`btn-glass ${c==="light"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),"Светлая"]})}),e.jsx("button",{type:"button",onClick:()=>m("auto"),className:`btn-glass ${c==="auto"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Авто"]})})]})]})]}):null}function Fe({isOpen:t,pendingTemplatesDuplicates:i,isImportingTemplates:r,templatesImportAction:o,onClose:n,handleImportTemplatesOnlyNew:c,handleImportTemplatesOverwrite:m}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||n()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[i.map((k,W)=>{var j;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((j=k.template)==null?void 0:j.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",k.existingName||"Без названия","»"]})]},k.existingId+"-"+W)}),i.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),r?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:o==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:c,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:n,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Be(t){if(!t||typeof t!="string")return t;const i=t.split("-");if(i.length===3){const[r,o,n]=i;if(r&&o&&n)return`${n}.${o}.${r}`}return t}function ze({isOpen:t,pendingWorkoutsImport:i,pendingWorkoutsFileName:r,pendingWorkoutsNewDatesSummary:o,isImportingWorkouts:n,importAction:c,onClose:m,handleConfirmImportWorkoutsOnly:k,handleImportOnlyNewWorkouts:W,handleExportThenImportWorkouts:j}){return!t||!i?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||m()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${r||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),o.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:o.map(_=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:Be(_.date)})},_.date))})]}),n?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:c==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":c==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[o.length>0&&e.jsx("button",{type:"button",onClick:W,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:k,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:j,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}const Ze=()=>{const{user:t,signOut:i}=me(),r=he(),[o,n]=s.useState(!1),[c,m]=s.useState(!1),[k,W]=s.useState(""),[j,_]=s.useState(null),[N,A]=s.useState(!1),u=_e({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email}),D=Ee({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email,setToastVariant:u.setToastVariant,setImportSuccessMessage:u.setImportSuccessMessage,setIsImportSuccessOpen:u.setIsImportSuccessOpen}),g=Te({userId:t==null?void 0:t.id,setToastVariant:u.setToastVariant,setImportSuccessMessage:u.setImportSuccessMessage,setIsImportSuccessOpen:u.setIsImportSuccessOpen}),C=Ce({userId:t==null?void 0:t.id}),B=fe();s.useEffect(()=>{C.isWeightTrackerOpen&&t&&C.loadBodyWeights()},[C.isWeightTrackerOpen,t]);const P=s.useMemo(()=>{var x;if(!t)return"";const p=(x=t.user_metadata)==null?void 0:x.nickname;if(typeof p=="string"&&p.trim().length>0)return p.trim();const I=t.email||"";return I.endsWith("@gymlog.app")?I.replace(/@gymlog\.app$/,""):I},[t]),z=s.useMemo(()=>{const p=(t==null?void 0:t.email)||"";if(!p||typeof p!="string")return null;const[I,x]=p.split("@");if(!I||!x)return null;const U=Math.max(1,Math.ceil(I.length/2)),M=I.slice(0,U),H=I.slice(U);return{email:p,localPart:I,domain:x,visiblePart:M,hiddenPart:H}},[t==null?void 0:t.email]),T=async()=>{try{await i(),r("/login",{replace:!0})}catch(p){console.error("Error logging out:",p)}},q=()=>{!t||!t.email||(W(""),_(null),m(!0))},L=()=>{t&&g.setIsCleanDataDialogOpen(!0)},K=async()=>{if(!(!t||!t.email)){if(k.trim()!==t.email)throw _("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");_(null),n(!0);try{await ve(),alert("Ваш аккаунт и все данные были успешно удалены."),await i(),r("/login",{replace:!0})}catch(p){console.error("Error deleting account:",p),alert(`Не удалось удалить аккаунт: ${p.message}`)}finally{n(!1)}}};return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative profile-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsx(Ie,{isImportingWorkouts:u.isImportingWorkouts,isImportingTemplates:D.isImportingTemplates,handleStartImportWorkouts:u.handleStartImportWorkouts,handleStartImportTemplates:D.handleStartImportTemplates,isExporting:u.isExporting,isExportingTemplates:D.isExportingTemplates,handleExportWorkouts:u.handleExportWorkouts,handleExportTemplates:D.handleExportTemplates,isDeleting:o,startCleanDataFlow:L,startDeleteAccountFlow:q})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:t&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),z?e.jsxs("span",{className:"font-semibold",children:[z.visiblePart,z.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>A(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:N?e.jsx("span",{children:z.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,z.hiddenPart.length))})}),"@",z.domain]}):e.jsx("span",{className:"font-semibold",children:P})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>r("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Узнать прогресс"]}),e.jsxs("button",{onClick:()=>C.setIsWeightTrackerOpen(!0),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})}),"Трекер веса тела"]}),e.jsxs("button",{onClick:()=>B.setIsSettingsOpen(!B.isSettingsOpen),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Настройки",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${B.isSettingsOpen?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("button",{onClick:T,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"})]}),e.jsx(Pe,{isOpen:B.isSettingsOpen,timerStepInput:B.timerStepInput,setTimerStepInput:B.setTimerStepInput,saveStatus:B.saveStatus,saveTimerStep:B.saveTimerStep,theme:B.theme,handleThemeChange:B.handleThemeChange}),e.jsx("input",{ref:u.workoutsFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:u.handleWorkoutsFileChange}),e.jsx("input",{ref:D.templatesFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:D.handleTemplatesFileChange}),e.jsx(ce,{open:c,onOpenChange:p=>{m(p),p||(W(""),_(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:k.trim().length===0,onConfirm:K,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.email})]}),e.jsx("input",{type:"email",value:k,onChange:p=>{W(p.target.value),j&&_(null)},placeholder:(t==null?void 0:t.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),j&&e.jsx("p",{className:"text-xs text-red-400",children:j})]})}),e.jsx($e,{isOpen:g.isCleanDataDialogOpen,onClose:()=>g.setIsCleanDataDialogOpen(!1),isLoadingWorkoutsForDeletion:g.isLoadingWorkoutsForDeletion,isLoadingTemplatesForDeletion:g.isLoadingTemplatesForDeletion,openDeleteWorkoutsDialog:g.openDeleteWorkoutsDialog,openDeleteTemplatesDialog:g.openDeleteTemplatesDialog}),e.jsx(Me,{isOpen:g.isDeleteWorkoutsDialogOpen,onClose:g.closeDeleteWorkoutsDialog,workoutDateGroups:g.workoutDateGroups,selectedWorkoutDates:g.selectedWorkoutDates,isDeletingWorkouts:g.isDeletingWorkouts,areAllWorkoutDatesSelected:g.areAllWorkoutDatesSelected,toggleWorkoutDateSelection:g.toggleWorkoutDateSelection,selectAllWorkoutDates:g.selectAllWorkoutDates,clearWorkoutSelection:g.clearWorkoutSelection,handleDeleteSelectedWorkouts:g.handleDeleteSelectedWorkouts}),e.jsx(Re,{isOpen:g.isDeleteTemplatesDialogOpen,onClose:g.closeDeleteTemplatesDialog,templatesForDeletion:g.templatesForDeletion,selectedTemplateIds:g.selectedTemplateIds,isDeletingTemplates:g.isDeletingTemplates,areAllTemplatesSelected:g.areAllTemplatesSelected,toggleTemplateSelection:g.toggleTemplateSelection,selectAllTemplates:g.selectAllTemplates,clearTemplateSelection:g.clearTemplateSelection,handleDeleteSelectedTemplates:g.handleDeleteSelectedTemplates}),e.jsx(ge,{open:u.isImportSuccessOpen,onOpenChange:p=>{p||u.closeImportSuccessToast()},onClose:u.closeImportSuccessToast,message:u.importSuccessMessage||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:u.toastVariant}),e.jsx(Fe,{isOpen:D.isTemplatesImportDialogOpen,pendingTemplatesDuplicates:D.pendingTemplatesDuplicates,isImportingTemplates:D.isImportingTemplates,templatesImportAction:D.templatesImportAction,onClose:D.closeTemplatesImportDialog,handleImportTemplatesOnlyNew:D.handleImportTemplatesOnlyNew,handleImportTemplatesOverwrite:D.handleImportTemplatesOverwrite}),e.jsx(ze,{isOpen:u.isWorkoutsImportDialogOpen,pendingWorkoutsImport:u.pendingWorkoutsImport,pendingWorkoutsFileName:u.pendingWorkoutsFileName,pendingWorkoutsNewDatesSummary:u.pendingWorkoutsNewDatesSummary,isImportingWorkouts:u.isImportingWorkouts,importAction:u.importAction,onClose:u.closeWorkoutsImportDialog,handleConfirmImportWorkoutsOnly:u.handleConfirmImportWorkoutsOnly,handleImportOnlyNewWorkouts:u.handleImportOnlyNewWorkouts,handleExportThenImportWorkouts:u.handleExportThenImportWorkouts}),e.jsx(Le,{isOpen:C.isWeightTrackerOpen,onClose:()=>C.setIsWeightTrackerOpen(!1),bodyWeights:C.bodyWeights,loadingWeights:C.loadingWeights,weightChartData:C.weightChartData,weightStats:C.weightStats,newWeight:C.newWeight,newWeightDate:C.newWeightDate,savingWeight:C.savingWeight,deletingWeightId:C.deletingWeightId,isDeleteWeightConfirmOpen:C.isDeleteWeightConfirmOpen,weightToDelete:C.weightToDelete,setNewWeight:C.setNewWeight,setNewWeightDate:C.setNewWeightDate,setIsDeleteWeightConfirmOpen:C.setIsDeleteWeightConfirmOpen,handleAddWeight:C.handleAddWeight,handleDeleteWeight:C.handleDeleteWeight,handleOpenDeleteWeightConfirm:C.handleOpenDeleteWeightConfirm})]})};export{Ze as default};
