import{s as re,j as e,u as me}from"./index-BgIe2abQ.js";import{r as s,c as pe,e as he}from"./vendor-BVca5W6X.js";import{C as ce}from"./confirm-dialog-Dim5dJ6T.js";import{T as ge}from"./template-saved-dialog-C1RC-7PY.js";import{u as xe}from"./usePageState-6XNG0ilq.js";import{u as fe}from"./use-profile-settings-_EsJTNvx.js";import{R as be,L as we,C as ye,X as ke,Y as je,a as Ne}from"./charts-33RH-A39.js";import"./supabase-CWpvgLJU.js";import"./use-modal-scroll-lock-DlG-D3y9.js";async function ve(){const t=re,{error:o}=await t.rpc("delete_user_account");if(o)throw o}const oe="body-weights-data",De=600*1e3;function Ce({userId:t}){const o=re,n=s.useRef(!1),[a,r]=s.useState(!1),[l,m]=xe({key:t?`${oe}-${t}`:oe,initialState:[],ttl:De}),[b,D]=s.useState(l),[w,C]=s.useState(!1),[y,E]=s.useState(""),[c,k]=s.useState(()=>{const x=new Date,W=String(x.getDate()).padStart(2,"0"),T=String(x.getMonth()+1).padStart(2,"0"),$=x.getFullYear();return`${W}.${T}.${$}`}),[h,j]=s.useState(!1),[B,z]=s.useState(null),[U,O]=s.useState(!1),[G,p]=s.useState(null);s.useEffect(()=>{l.length>0&&b.length===0&&(D(l),n.current=!0)},[]);const M=s.useCallback(async(x=!1)=>{if(t){if(!x&&n.current&&l.length>0){D(l);return}if(!x&&l.length>0){D(l),n.current=!0;return}C(!0);try{const{data:W,error:T}=await o.from("user_body_weights").select("*").eq("user_id",t).order("recorded_at",{ascending:!1}).limit(100);if(T)throw T;const $=W||[];D($),m($),n.current=!0}catch(W){console.error("Error loading body weights:",W)}finally{C(!1)}}},[t,o,l,m]),d=s.useCallback(x=>{const W=x.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);if(!W)return null;const[,T,$,u]=W,N=parseInt(T,10),_=parseInt($,10),v=parseInt(u,10);if(_<1||_>12||N<1||N>31||v<1900||v>2100)return null;const J=new Date(v,_,0).getDate();if(N>J)return null;const V=new Date(v,_-1,N),f=new Date;if(f.setHours(23,59,59,999),V>f)return null;const i=String(N).padStart(2,"0"),A=String(_).padStart(2,"0");return`${v}-${A}-${i}`},[]),F=s.useCallback(()=>{const x=new Date,W=String(x.getDate()).padStart(2,"0"),T=String(x.getMonth()+1).padStart(2,"0"),$=x.getFullYear();return`${W}.${T}.${$}`},[]),g=s.useCallback(async()=>{if(!t||!y||h)return;const x=parseFloat(y.replace(",","."));if(isNaN(x)||x<=0||x>500){alert("Введите корректный вес (от 0.1 до 500 кг)");return}const W=d(c);if(!W){alert("Введите корректную дату в формате д.мм.гггг (не в будущем)");return}j(!0);try{const{data:T,error:$}=await o.from("user_body_weights").upsert({user_id:t,weight:x,recorded_at:W},{onConflict:"user_id,recorded_at"}).select().single();if($)throw $;const u=(()=>{const N=b.filter(_=>_.recorded_at!==W);return[T,...N].sort((_,v)=>new Date(v.recorded_at).getTime()-new Date(_.recorded_at).getTime())})();D(u),m(u),E(""),k(F())}catch(T){console.error("Error saving weight:",T),alert("Не удалось сохранить вес")}finally{j(!1)}},[t,y,c,h,o,d,F,b,m]),H=s.useCallback(async x=>{if(!(!t||B)){z(x);try{const{error:W}=await o.from("user_body_weights").delete().eq("id",x);if(W)throw W;const T=b.filter($=>$.id!==x);D(T),m(T),O(!1),p(null)}catch(W){console.error("Error deleting weight:",W),alert("Не удалось удалить запись")}finally{z(null)}}},[t,B,o,b,m]),R=s.useCallback(x=>{p(x),O(!0)},[]),q=s.useMemo(()=>[...b].sort((x,W)=>new Date(x.recorded_at).getTime()-new Date(W.recorded_at).getTime()).slice(-30).map(x=>({date:new Date(x.recorded_at).toLocaleDateString("ru",{day:"numeric",month:"short"}),weight:Number(x.weight),fullDate:x.recorded_at})),[b]),K=s.useMemo(()=>{if(b.length===0)return null;const x=b.map(N=>Number(N.weight)),W=x[0],T=Math.min(...x),$=Math.max(...x),u=b.length>1?W-x[x.length-1]:0;return{current:W,min:T,max:$,change:u}},[b]);return{isWeightTrackerOpen:a,bodyWeights:b,loadingWeights:w,newWeight:y,newWeightDate:c,savingWeight:h,deletingWeightId:B,isDeleteWeightConfirmOpen:U,weightToDelete:G,weightChartData:q,weightStats:K,setIsWeightTrackerOpen:r,setNewWeight:E,setNewWeightDate:k,setIsDeleteWeightConfirmOpen:O,loadBodyWeights:M,handleAddWeight:g,handleDeleteWeight:H,handleOpenDeleteWeightConfirm:R}}const We=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function le(t){if(typeof t!="string")return null;const o=t.trim();return We.includes(o)?o:null}function _e({userId:t,userEmail:o}){const n=re,[a,r]=s.useState(!1),[l,m]=s.useState(!1),[b,D]=s.useState(!1),[w,C]=s.useState(null),[y,E]=s.useState(null),[c,k]=s.useState([]),[h,j]=s.useState([]),[B,z]=s.useState("none"),[U,O]=s.useState(!1),[G,p]=s.useState(null),[M,d]=s.useState("success"),F=s.useRef(null),g=s.useCallback(async u=>{if(!t)return;const N=Array.isArray(u.workouts)?u.workouts:[];if(N.length===0){d("error"),p("В файле нет тренировок для импорта."),O(!0);return}const{data:_,error:v}=await n.from("workouts").select("id, workout_date").eq("user_id",t);if(v)throw v;const J=new Set;N.forEach(i=>{const A=typeof i.date=="string"&&i.date?i.date:typeof i.workout_date=="string"&&i.workout_date?i.workout_date:"";A&&J.add(A)});const f=(_||[]).filter(i=>J.has(i.workout_date)).map(i=>i.id);if(f.length>0){const{data:i,error:A}=await n.from("workout_exercises").select("id, workout_id").in("workout_id",f);if(A)throw A;const Y=(i||[]).map(S=>S.id);if(Y.length>0){const{error:S}=await n.from("workout_sets").delete().in("workout_exercise_id",Y);if(S)throw S}if(f.length>0){const{error:S}=await n.from("workout_exercises").delete().in("workout_id",f);if(S)throw S;const{error:I}=await n.from("workouts").delete().in("id",f);if(I)throw I}}for(const i of N){const A=typeof i.name=="string"&&i.name.trim().length>0?i.name.trim():"Импортированная тренировка",Y=typeof i.date=="string"&&i.date?i.date:new Date().toISOString().slice(0,10),{data:S,error:I}=await n.from("workouts").insert({user_id:t,name:A,icon:le(i.icon),workout_date:Y,is_cardio:!!i.isCardio,template_id:null}).select().single();if(I||!S)throw I||new Error("Не удалось создать тренировку при импорте.");const Q=Array.isArray(i.exercises)?i.exercises:[];if(Q.length===0)continue;const ae=Q.map((P,ee)=>({workout_id:S.id,name:typeof P.name=="string"?P.name:"",position:typeof P.position=="number"?P.position:ee+1,reps:typeof P.reps=="string"?P.reps:"",rest_seconds:typeof P.restSeconds=="number"?P.restSeconds:typeof P.rest_seconds=="number"?P.rest_seconds:150,sets:typeof P.setsPlanned=="number"?P.setsPlanned:Array.isArray(P.sets)?P.sets.length:1})),{data:L,error:X}=await n.from("workout_exercises").insert(ae).select();if(X||!L)throw X||new Error("Не удалось создать упражнения при импорте.");const se=[],de=[...Q].sort((P,ee)=>{const te=typeof P.position=="number"?P.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne}),ue=[...L].sort((P,ee)=>{const te=typeof P.position=="number"?P.position:0,ne=typeof ee.position=="number"?ee.position:0;return te-ne});if(de.forEach((P,ee)=>{const te=ue[ee];if(!te)return;(Array.isArray(P.sets)?P.sets:[]).forEach(Z=>{se.push({workout_exercise_id:te.id,set_index:typeof Z.index=="number"?Z.index:1,weight:typeof Z.weight=="number"?Z.weight:null,reps:Z.reps==null?null:String(Z.reps),is_done:!!Z.isDone,updated_at:typeof Z.updatedAt=="string"&&Z.updatedAt?Z.updatedAt:new Date().toISOString()})})}),se.length>0){const{error:P}=await n.from("workout_sets").insert(se);if(P)throw P}}},[t,n]),H=s.useCallback(async()=>{if(t){r(!0);try{const{data:u,error:N}=await n.from("workouts").select(`
          id,
          name,
          icon,
          workout_date,
          is_cardio,
          template_id,
          workout_exercises (
            id,
            name,
            position,
            reps,
            rest_seconds,
            sets,
            workout_sets (
              id,
              set_index,
              weight,
              reps,
              is_done,
              updated_at
            )
          )
        `).eq("user_id",t).order("workout_date",{ascending:!1});if(N){console.error("Error exporting workouts:",N),alert("Не удалось загрузить данные тренировок для экспорта.");return}const _=(u||[]).map(Y=>({id:Y.id,name:Y.name,icon:le(Y.icon),date:Y.workout_date,isCardio:!!Y.is_cardio,templateId:Y.template_id,exercises:(Y.workout_exercises||[]).map(S=>({id:S.id,name:S.name,position:S.position,reps:S.reps,restSeconds:S.rest_seconds,setsPlanned:S.sets,sets:(S.workout_sets||[]).map(I=>({id:I.id,index:I.set_index,weight:I.weight,reps:I.reps,isDone:I.is_done,updatedAt:I.updated_at}))}))})),v={exportedAt:new Date().toISOString(),user:{id:t,email:o},workouts:_},J=JSON.stringify(v,null,2),V=new Blob([J],{type:"application/json;charset=utf-8;"}),f=URL.createObjectURL(V),i=document.createElement("a"),A=new Date().toISOString().slice(0,10);i.href=f,i.download=`gymlog-workouts-${A}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(f)}catch(u){console.error("Unexpected error while exporting workouts:",u),alert("Произошла непредвиденная ошибка при экспорте данных.")}finally{r(!1)}}},[t,o,n]),R=s.useCallback(()=>{!t||l||F.current&&(F.current.value="",F.current.click())},[t,l]),q=s.useCallback(async u=>{const N=u.target.files&&u.target.files[0];if(N)try{k([]),j([]);const _=await N.text();let v;try{v=JSON.parse(_)}catch{d("error"),p("Файл не является корректным JSON."),O(!0);return}if(!v||!Array.isArray(v.workouts)){d("error"),p("Файл не похож на экспорт тренировок из GymLog."),O(!0);return}if(!t)return;const J=Array.isArray(v.workouts)?v.workouts:[],V=new Set;J.forEach(L=>{const X=typeof L.date=="string"&&L.date?L.date:typeof L.workout_date=="string"&&L.workout_date?L.workout_date:"";X&&V.add(X)});const{data:f,error:i}=await n.from("workouts").select("workout_date").eq("user_id",t);if(i){console.error("Error checking existing workouts before import:",i),d("error"),p("Не удалось проверить существующие тренировки перед импортом."),O(!0);return}const A=new Set((f||[]).map(L=>L.workout_date)),Y=A.size>0,S=new Map;J.forEach(L=>{const X=typeof L.date=="string"&&L.date?L.date:typeof L.workout_date=="string"&&L.workout_date?L.workout_date:"";X&&S.set(X,(S.get(X)||0)+1)});const I=[],Q=[];V.forEach(L=>{A.has(L)?I.push(L):Q.push(L)});const ae=I.length>0;if(!Y||!ae){d("success"),m(!0);try{await g(v),p("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),O(!0)}catch(L){console.error("Error importing workouts:",L),alert("Не удалось импортировать тренировки: "+((L==null?void 0:L.message)||String(L)))}finally{m(!1)}return}if(Q.length===0){d("error"),p("Все тренировки из файла уже есть в вашем календаре. Новых тренировок нет."),O(!0);return}if(C(v),E(N.name),Q.length>0){const L=Q.map(X=>({date:X,count:S.get(X)||0})).sort((X,se)=>se.date.localeCompare(X.date));k(Q),j(L)}else k([]),j([]);D(!0)}catch(_){console.error("Error reading workouts import file:",_),alert("Не удалось прочитать файл тренировок.")}finally{u.target.value=""}},[t,n,g]),K=s.useCallback(async()=>{if(w){z("import"),m(!0);try{await g(w),C(null),E(null),k([]),j([]),D(!1),d("success"),p("Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),O(!0)}catch(u){console.error("Error importing workouts:",u),alert("Не удалось импортировать тренировки: "+((u==null?void 0:u.message)||String(u)))}finally{m(!1),z("none")}}},[w,g]),x=s.useCallback(async()=>{if(!w)return;const u=Array.isArray(w.workouts)?w.workouts:[];if(u.length===0){d("error"),p("В файле нет тренировок для импорта."),O(!0);return}const N=new Set(c);if(N.size===0){d("error"),p("В файле нет новых тренировок с датами, которых ещё нет в вашем календаре."),O(!0);return}const _=u.filter(v=>{const J=typeof v.date=="string"&&v.date?v.date:typeof v.workout_date=="string"&&v.workout_date?v.workout_date:"";return!!J&&N.has(J)});if(_.length===0){d("error"),p("Не удалось определить новые тренировки для импорта. Проверьте файл."),O(!0);return}z("onlyNew"),m(!0);try{await g({workouts:_}),C(null),E(null),k([]),j([]),D(!1),d("success"),p("Импорт новых тренировок завершён. Откройте календарь, чтобы посмотреть тренировки."),O(!0)}catch(v){console.error("Error importing only new workouts:",v),d("error"),p("Не удалось импортировать новые тренировки. Попробуйте ещё раз."),O(!0)}finally{m(!1),z("none")}},[w,c,g]),W=s.useCallback(async()=>{if(w){z("exportThenImport"),m(!0);try{await H(),await g(w),C(null),E(null),D(!1),d("success"),p("Текущие тренировки сохранены, импорт завершён. Откройте календарь, чтобы посмотреть тренировки."),O(!0)}catch(u){console.error("Error exporting and importing workouts:",u),d("error"),p("Не удалось выполнить экспорт и импорт тренировок. Попробуйте ещё раз."),O(!0)}finally{m(!1),z("none")}}},[w,H,g]),T=s.useCallback(()=>{D(!1),C(null),E(null),k([]),j([])},[]),$=s.useCallback(()=>{O(!1),p(null)},[]);return{isExporting:a,isImportingWorkouts:l,isWorkoutsImportDialogOpen:b,pendingWorkoutsImport:w,pendingWorkoutsFileName:y,pendingWorkoutsNewDates:c,pendingWorkoutsNewDatesSummary:h,importAction:B,isImportSuccessOpen:U,importSuccessMessage:G,toastVariant:M,workoutsFileInputRef:F,handleExportWorkouts:H,handleStartImportWorkouts:R,handleWorkoutsFileChange:q,handleConfirmImportWorkoutsOnly:K,handleImportOnlyNewWorkouts:x,handleExportThenImportWorkouts:W,closeWorkoutsImportDialog:T,closeImportSuccessToast:$,setIsImportSuccessOpen:O,setImportSuccessMessage:p,setToastVariant:d}}const Se=["upper","lower","push","pull","legs","arms","shoulders","chest","back","core","cardio","full"];function ie(t){if(typeof t!="string")return null;const o=t.trim();return Se.includes(o)?o:null}function Ee({userId:t,userEmail:o,setToastVariant:n,setImportSuccessMessage:a,setIsImportSuccessOpen:r}){const l=re,[m,b]=s.useState(!1),[D,w]=s.useState(!1),[C,y]=s.useState(!1),[E,c]=s.useState([]),[k,h]=s.useState([]),[j,B]=s.useState("none"),z=s.useRef(null),U=s.useCallback(async g=>{if(!t)return;const H=Array.isArray(g.templates)?g.templates:[];if(H.length===0){n("error"),a("В файле нет шаблонов для импорта."),r(!0);return}for(const R of H){const q=typeof R.name=="string"&&R.name.trim().length>0?R.name.trim():"Импортированный шаблон",{data:K,error:x}=await l.from("workout_templates").insert({user_id:t,name:q,icon:ie(R.icon)}).select().single();if(x||!K)throw x||new Error("Не удалось создать шаблон при импорте.");const W=Array.isArray(R.exercises)?R.exercises:[];if(W.length===0)continue;const T=W.map((u,N)=>({template_id:K.id,name:typeof u.name=="string"?u.name:"",sets:typeof u.sets=="number"?u.sets:1,reps:typeof u.reps=="string"?u.reps:"",rest_seconds:typeof u.restSeconds=="number"?u.restSeconds:typeof u.rest_seconds=="number"?u.rest_seconds:150,position:typeof u.position=="number"?u.position:N+1})),{error:$}=await l.from("template_exercises").insert(T);if($)throw $}},[t,l,n,a,r]),O=s.useCallback(async()=>{if(t){b(!0);try{const{data:g,error:H}=await l.from("workout_templates").select(`
          id,
          name,
          icon,
          created_at,
          template_exercises (
            id,
            name,
            sets,
            reps,
            rest_seconds,
            position
          )
        `).eq("user_id",t).order("created_at",{ascending:!1});if(H){console.error("Error exporting templates:",H),alert("Не удалось загрузить шаблоны для экспорта.");return}const R=(g||[]).map(u=>({id:u.id,name:u.name,icon:ie(u.icon),createdAt:u.created_at,exercises:(u.template_exercises||[]).map(N=>({id:N.id,name:N.name,sets:N.sets,reps:N.reps,restSeconds:N.rest_seconds,position:N.position}))})),q={exportedAt:new Date().toISOString(),user:{id:t,email:o},templates:R},K=JSON.stringify(q,null,2),x=new Blob([K],{type:"application/json;charset=utf-8;"}),W=URL.createObjectURL(x),T=document.createElement("a"),$=new Date().toISOString().slice(0,10);T.href=W,T.download=`gymlog-templates-${$}.json`,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(W)}catch(g){console.error("Unexpected error while exporting templates:",g),alert("Произошла непредвиденная ошибка при экспорте шаблонов.")}finally{b(!1)}}},[t,o,l]),G=s.useCallback(()=>{!t||D||z.current&&(z.current.value="",z.current.click())},[t,D]),p=s.useCallback(async g=>{const H=g.target.files&&g.target.files[0];if(H)try{const R=await H.text();let q;try{q=JSON.parse(R)}catch{n("error"),a("Файл не является корректным JSON."),r(!0);return}if(!q||!Array.isArray(q.templates)){n("error"),a("Файл не похож на экспорт шаблонов из GymLog."),r(!0);return}if(!t)return;const K=Array.isArray(q.templates)?q.templates:[];if(K.length===0){n("error"),a("В файле нет шаблонов для импорта."),r(!0);return}const{data:x,error:W}=await l.from("workout_templates").select("id, name").eq("user_id",t);if(W){console.error("Error checking existing templates before import:",W),n("error"),a("Не удалось проверить существующие шаблоны перед импортом."),r(!0);return}const T=_=>typeof _=="string"?_.trim().toLowerCase():"",$=new Map;(x||[]).forEach(_=>{const v=T(_.name);v&&($.has(v)||$.set(v,{id:_.id,name:_.name||""}))});const u=[],N=[];if(K.forEach(_=>{const v=T(_==null?void 0:_.name);if(!v||!$.has(v))u.push(_);else{const J=$.get(v);N.push({existingId:J.id,existingName:J.name||"",template:_})}}),u.length===0&&N.length>0){n("error"),a("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),r(!0);return}if(N.length===0){w(!0);try{await U({templates:K}),n("success"),a("Импорт шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),r(!0)}catch(_){console.error("Error importing templates:",_),n("error"),a("Не удалось импортировать шаблоны. Попробуйте ещё раз."),r(!0)}finally{w(!1)}return}c(u),h(N),y(!0)}catch(R){console.error("Error importing templates:",R),n("error"),a("Не удалось импортировать шаблоны. Попробуйте ещё раз."),r(!0)}finally{w(!1),g.target.value=""}},[t,l,U,n,a,r]),M=s.useCallback(async()=>{if(E.length===0){y(!1),h([]),c([]),n("error"),a("Все шаблоны из файла уже есть в вашем аккаунте. Новых шаблонов нет."),r(!0);return}B("onlyNew"),w(!0);try{await U({templates:E}),c([]),h([]),y(!1),n("success"),a("Импорт новых шаблонов завершён. Откройте страницу «Шаблоны», чтобы посмотреть их."),r(!0)}catch(g){console.error("Error importing only new templates:",g),n("error"),a("Не удалось импортировать новые шаблоны. Попробуйте ещё раз."),r(!0)}finally{w(!1),B("none")}},[E,U,n,a,r]),d=s.useCallback(async()=>{if(k.length===0&&E.length===0){y(!1);return}B("overwrite"),w(!0);try{const g=Array.from(new Set(k.map(R=>R.existingId)));if(g.length>0){const{error:R}=await l.from("template_exercises").delete().in("template_id",g);if(R)throw R;const{error:q}=await l.from("workout_templates").delete().in("id",g);if(q)throw q}const H=[...E,...k.map(R=>R.template)];await U({templates:H}),c([]),h([]),y(!1),n("success"),a("Шаблоны успешно импортированы. Совпадающие шаблоны были перезаписаны."),r(!0)}catch(g){console.error("Error overwriting templates:",g),alert("Не удалось импортировать шаблоны с перезаписью: "+((g==null?void 0:g.message)||String(g)))}finally{w(!1),B("none")}},[k,E,l,U,n,a,r]),F=s.useCallback(()=>{y(!1),c([]),h([])},[]);return{isExportingTemplates:m,handleExportTemplates:O,isImportingTemplates:D,isTemplatesImportDialogOpen:C,pendingTemplatesNew:E,pendingTemplatesDuplicates:k,templatesImportAction:j,templatesFileInputRef:z,handleStartImportTemplates:G,handleTemplatesFileChange:p,handleImportTemplatesOnlyNew:M,handleImportTemplatesOverwrite:d,closeTemplatesImportDialog:F}}function Te({userId:t,setToastVariant:o,setImportSuccessMessage:n,setIsImportSuccessOpen:a}){const r=re,[l,m]=s.useState(!1),[b,D]=s.useState(!1),[w,C]=s.useState(!1),[y,E]=s.useState([]),[c,k]=s.useState([]),[h,j]=s.useState(!1),[B,z]=s.useState(!1),[U,O]=s.useState(!1),[G,p]=s.useState([]),[M,d]=s.useState([]),[F,g]=s.useState(!1),H=y.length>0&&c.length===y.length,R=G.length>0&&M.length===G.length,q=s.useCallback(async()=>{if(!(!t||w)){C(!0),k([]);try{const{data:f,error:i}=await r.from("workouts").select("id, workout_date").eq("user_id",t).order("workout_date",{ascending:!1});if(i){console.error("Error loading workouts for deletion:",i),alert("Не удалось загрузить список тренировок для удаления.");return}const A=new Map;(f||[]).forEach(S=>{const I=S.workout_date,Q=S.id;!I||!Q||(A.has(I)||A.set(I,[]),A.get(I).push(Q))});const Y=Array.from(A.entries()).map(([S,I])=>({date:S,workoutIds:I,count:I.length})).sort((S,I)=>I.date.localeCompare(S.date));if(Y.length===0){o("error"),n("У вас нет тренировок для удаления."),a(!0);return}E(Y),m(!1),D(!0)}catch(f){console.error("Unexpected error while loading workouts for deletion:",f),alert("Произошла ошибка при загрузке тренировок для удаления.")}finally{C(!1)}}},[t,w,r,o,n,a]),K=s.useCallback(async()=>{if(!(!t||U)){O(!0),d([]);try{const{data:f,error:i}=await r.from("workout_templates").select("id, name").eq("user_id",t).order("created_at",{ascending:!1});if(i){console.error("Error loading templates for deletion:",i),alert("Не удалось загрузить список шаблонов для удаления.");return}const A=(f||[]).map(Y=>({id:Y.id,name:Y.name||"Без названия"}));if(A.length===0){o("error"),n("У вас нет шаблонов для удаления."),a(!0);return}p(A),m(!1),z(!0)}catch(f){console.error("Unexpected error while loading templates for deletion:",f),alert("Произошла ошибка при загрузке шаблонов для удаления.")}finally{O(!1)}}},[t,U,r,o,n,a]),x=s.useCallback(f=>{k(i=>i.includes(f)?i.filter(A=>A!==f):[...i,f])},[]),W=s.useCallback(()=>{if(y.length===0)return;const f=c.length===y.length;k(f?[]:y.map(i=>i.date))},[y,c.length]),T=s.useCallback(()=>{k([])},[]),$=s.useCallback(f=>{d(i=>i.includes(f)?i.filter(A=>A!==f):[...i,f])},[]),u=s.useCallback(()=>{if(G.length===0)return;const f=M.length===G.length;d(f?[]:G.map(i=>i.id))},[G,M.length]),N=s.useCallback(()=>{d([])},[]),_=s.useCallback(async()=>{if(!t||c.length===0)return;const f=y.filter(i=>c.includes(i.date)).flatMap(i=>i.workoutIds);if(f.length!==0){j(!0);try{const{data:i,error:A}=await r.from("workout_exercises").select("id, workout_id").in("workout_id",f);if(A)throw A;const Y=(i||[]).map(S=>S.id);if(Y.length>0){const{error:S}=await r.from("workout_sets").delete().in("workout_exercise_id",Y);if(S)throw S}if(f.length>0){const{error:S}=await r.from("workout_exercises").delete().in("workout_id",f);if(S)throw S;const{error:I}=await r.from("workouts").delete().in("id",f);if(I)throw I}D(!1),E([]),k([]),o("success"),n("Выбранные тренировки успешно удалены."),a(!0)}catch(i){console.error("Error deleting workouts:",i),o("error"),n("Не удалось удалить выбранные тренировки."),a(!0)}finally{j(!1)}}},[t,c,y,r,o,n,a]),v=s.useCallback(async()=>{if(t&&M.length!==0){g(!0);try{const f=M;if(f.length>0){const{error:i}=await r.from("template_exercises").delete().in("template_id",f);if(i)throw i;const{error:A}=await r.from("workout_templates").delete().in("id",f);if(A)throw A}z(!1),p([]),d([]),o("success"),n("Выбранные шаблоны тренировок успешно удалены."),a(!0)}catch(f){console.error("Error deleting templates:",f),o("error"),n("Не удалось удалить выбранные шаблоны тренировок."),a(!0)}finally{g(!1)}}},[t,M,r,o,n,a]),J=s.useCallback(()=>{h||D(!1)},[h]),V=s.useCallback(()=>{F||z(!1)},[F]);return{isCleanDataDialogOpen:l,setIsCleanDataDialogOpen:m,isDeleteWorkoutsDialogOpen:b,isLoadingWorkoutsForDeletion:w,workoutDateGroups:y,selectedWorkoutDates:c,isDeletingWorkouts:h,areAllWorkoutDatesSelected:H,isDeleteTemplatesDialogOpen:B,isLoadingTemplatesForDeletion:U,templatesForDeletion:G,selectedTemplateIds:M,isDeletingTemplates:F,areAllTemplatesSelected:R,openDeleteWorkoutsDialog:q,toggleWorkoutDateSelection:x,selectAllWorkoutDates:W,clearWorkoutSelection:T,handleDeleteSelectedWorkouts:_,closeDeleteWorkoutsDialog:J,openDeleteTemplatesDialog:K,toggleTemplateSelection:$,selectAllTemplates:u,clearTemplateSelection:N,handleDeleteSelectedTemplates:v,closeDeleteTemplatesDialog:V}}function Ae(t){if(!t||typeof t!="string")return t;const o=t.split("-");if(o.length===3){const[n,a,r]=o;if(n&&a&&r)return`${r}.${a}.${n}`}return t}function Oe(t,o){const n=t.replace(/[^0-9.]/g,""),a=n.split(".");let r=a[0]||"",l=a[1]||"",m=a[2]||"";r=r.slice(0,2),l=l.slice(0,2),m=m.slice(0,4);const b=n.length>o.replace(/[^0-9.]/g,"").length;return a.length===1&&r.length===2&&b?`${r}.`:a.length===2&&l.length===2&&b?`${r}.${l}.`:a.length===1?r:a.length===2?`${r}.${l}`:`${r}.${l}.${m}`}function Le({isOpen:t,onClose:o,bodyWeights:n,loadingWeights:a,weightChartData:r,weightStats:l,newWeight:m,newWeightDate:b,savingWeight:D,deletingWeightId:w,isDeleteWeightConfirmOpen:C,weightToDelete:y,setNewWeight:E,setNewWeightDate:c,setIsDeleteWeightConfirmOpen:k,handleAddWeight:h,handleDeleteWeight:j,handleOpenDeleteWeightConfirm:B}){const[z,U]=s.useState(null),O=s.useCallback((p,M)=>{var d;(d=p==null?void 0:p.stopPropagation)==null||d.call(p),M&&U({date:M.date,weight:M.weight})},[]),G=s.useCallback(()=>{U(null)},[]);return t?pe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-start justify-center pt-8 px-4",style:{paddingBottom:"calc(96px + env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:o}),e.jsxs("div",{className:"relative glass card-dark p-5 rounded-2xl max-w-md w-full my-auto",style:{maxHeight:"calc(100dvh - 120px - env(safe-area-inset-bottom))"},onClick:p=>p.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:o,className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition-colors flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-white pr-10",children:"Трекер веса тела"}),e.jsxs("div",{className:"mt-4 space-y-4 overflow-y-auto custom-scrollbar",style:{maxHeight:"calc(100dvh - 200px - env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"space-y-3 p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-sm text-gray-300 font-medium",children:"Добавить запись"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Вес (кг)"}),e.jsx("input",{type:"text",inputMode:"decimal",value:m,onChange:p=>{const M=p.target.value.replace(".",",");/^[0-9]*[,]?[0-9]*$/.test(M)&&E(M)},placeholder:"70,25",className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Дата"}),e.jsx("input",{type:"text",inputMode:"numeric",value:b,onChange:p=>{const M=Oe(p.target.value,b);c(M)},placeholder:"8.12.2025",maxLength:10,className:"w-full h-10 px-3 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:h,disabled:!m||!b||D,className:"btn-glass btn-glass-sm btn-glass-primary disabled:opacity-50",children:D?"...":"Добавить"})})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Текущий"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:[l.current.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Мин"}),e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[l.min.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Макс"}),e.jsxs("p",{className:"text-lg font-bold text-orange-400",children:[l.max.toFixed(2).replace(".",",")," кг"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Изменение"}),e.jsxs("p",{className:`text-lg font-bold ${l.change>0?"text-red-400":l.change<0?"text-green-400":"text-gray-400"}`,children:[l.change>0?"+":"",l.change.toFixed(2).replace(".",",")," кг"]})]})]}),r.length>1&&e.jsxs("div",{className:"relative",onClick:G,children:[e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsx("div",{style:{minWidth:`${Math.max(r.length*50,100)}px`,height:"192px"},children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(we,{data:r,margin:{top:15,right:20,left:-20,bottom:5},children:[e.jsx(ye,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(ke,{dataKey:"date",tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1}),e.jsx(je,{domain:["dataMin - 2","dataMax + 2"],tick:{fill:"#9ca3af",fontSize:10},axisLine:{stroke:"rgba(255,255,255,0.2)"},tickLine:!1,tickFormatter:p=>Number(p).toFixed(2).replace(".",",")}),e.jsx(Ne,{type:"monotone",dataKey:"weight",stroke:"#3b82f6",strokeWidth:2,dot:({cx:p,cy:M,payload:d,index:F})=>e.jsx("circle",{cx:p,cy:M,r:4,fill:"#3b82f6",stroke:"none",style:{cursor:"pointer"},onClick:g=>O(g,d)},`dot-${F}`),activeDot:({cx:p,cy:M,payload:d,index:F})=>e.jsx("circle",{cx:p,cy:M,r:6,fill:"#60a5fa",stroke:"#fff",strokeWidth:2,style:{cursor:"pointer"},onClick:g=>O(g,d)},`active-dot-${F}`)})]})})})}),z&&e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none",style:{background:"rgba(24,24,27,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",padding:"8px 12px",color:"#fff",zIndex:10},children:[e.jsx("p",{className:"text-sm text-gray-300",children:z.date}),e.jsxs("p",{className:"text-sm font-medium",children:[e.jsx("span",{className:"text-gray-400",children:"Вес : "}),e.jsxs("span",{className:"text-green-400",children:[z.weight.toFixed(2).replace(".",",")," кг"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-300 font-medium",children:["История (",n.length,")"]}),a?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})}):n.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Пока нет записей. Добавьте свой первый вес выше."}):e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1 custom-scrollbar pr-1",children:n.slice(0,20).map(p=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-medium",children:[Number(p.weight).toFixed(2).replace(".",",")," кг"]}),e.jsx("span",{className:"text-sm text-gray-400",children:Ae(new Date(p.recorded_at).toISOString().slice(0,10))})]}),e.jsx("button",{type:"button",onClick:()=>B(p.id),disabled:w===p.id,className:"p-1 text-gray-500 hover:text-red-400 transition-colors disabled:opacity-50",children:w===p.id?e.jsx("span",{className:"w-4 h-4 border border-white/30 border-t-white rounded-full animate-spin inline-block"}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},p.id))})]})]})]}),e.jsx(ce,{open:C,onOpenChange:k,title:"Удалить запись о весе?",description:"Это действие необратимо.",confirmText:"Удалить",cancelText:"Отмена",variant:"danger",onConfirm:()=>{y&&j(y)}})]}),document.body):null}function $e({isOpen:t,onClose:o,isLoadingWorkoutsForDeletion:n,isLoadingTemplatesForDeletion:a,openDeleteWorkoutsDialog:r,openDeleteTemplatesDialog:l}){if(!t)return null;const m=n||a;return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{m||o()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Очистить данные"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите, какие данные вы хотите удалить."}),m&&e.jsx("p",{className:"text-xs text-gray-400",children:"Загружаем данные..."}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:r,disabled:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить тренировки"}),e.jsx("button",{type:"button",onClick:l,disabled:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary disabled:opacity-50",children:"Удалить шаблоны тренировок"}),e.jsx("button",{type:"button",onClick:()=>{m||o()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}function Me({isOpen:t,onClose:o,workoutDateGroups:n,selectedWorkoutDates:a,isDeletingWorkouts:r,areAllWorkoutDatesSelected:l,toggleWorkoutDateSelection:m,selectAllWorkoutDates:b,clearWorkoutSelection:D,handleDeleteSelectedWorkouts:w}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||o()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить тренировки"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите даты тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:b,disabled:n.length===0||r,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${l?"bg-green-500 border-green-400":"border-white/40"}`,children:l&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:D,disabled:a.length===0||r,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[n.map(C=>{const y=a.includes(C.date);return e.jsxs("button",{type:"button",onClick:()=>m(C.date),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${y?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:C.date}),e.jsx("div",{className:"text-xs text-gray-400",children:C.count===1?"1 тренировка":`${C.count} тренировок`})]}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${y?"bg-green-500 border-green-400":"border-white/40"}`,children:y&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},C.date)}),n.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Тренировки для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:w,disabled:a.length===0||r,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:r?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{r||o()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Ie({isOpen:t,onClose:o,templatesForDeletion:n,selectedTemplateIds:a,isDeletingTemplates:r,areAllTemplatesSelected:l,toggleTemplateSelection:m,selectAllTemplates:b,clearTemplateSelection:D,handleDeleteSelectedTemplates:w}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||o()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Удалить шаблоны тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:"Выберите шаблоны тренировок, которые хотите удалить. Это действие необратимо."}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-300",children:[e.jsxs("button",{type:"button",onClick:b,disabled:n.length===0||r,className:"inline-flex items-center gap-2 disabled:opacity-40",children:[e.jsx("div",{className:`w-4 h-4 rounded-md border flex items-center justify-center ${l?"bg-green-500 border-green-400":"border-white/40"}`,children:l&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{children:"Выбрать все"})]}),e.jsx("button",{type:"button",onClick:D,disabled:a.length===0||r,className:"text-xs text-gray-400 hover:text-gray-200 disabled:opacity-40",children:"Отменить выбранное"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[n.map(C=>{const y=a.includes(C.id);return e.jsxs("button",{type:"button",onClick:()=>m(C.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-md border text-left transition-colors ${y?"bg-white/10 border-green-400":"bg-transparent border-white/10 hover:bg-white/5"}`,children:[e.jsx("div",{className:"text-sm font-medium text-white",children:C.name}),e.jsx("div",{className:`w-5 h-5 rounded-md border flex items-center justify-center ${y?"bg-green-500 border-green-400":"border-white/40"}`,children:y&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-7.25 7.25a1 1 0 01-1.414 0l-3.25-3.25a1 1 0 111.414-1.414L8.5 11.836l6.543-6.543a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},C.id)}),n.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Шаблоны для удаления не найдены."})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:w,disabled:a.length===0||r,className:"btn-glass btn-glass-full btn-glass-md btn-glass-primary disabled:opacity-50",children:r?"Удаляем выбранные...":"Удалить выбранные"}),e.jsx("button",{type:"button",onClick:()=>{r||o()},className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Fe({isImportingWorkouts:t,isImportingTemplates:o,handleStartImportWorkouts:n,handleStartImportTemplates:a,isExporting:r,isExportingTemplates:l,handleExportWorkouts:m,handleExportTemplates:b,isDeleting:D,startCleanDataFlow:w,startDeleteAccountFlow:C}){const[y,E]=s.useState(!1),c=s.useRef(null);return s.useEffect(()=>{const k=h=>{c.current&&!c.current.contains(h.target)&&E(!1)};if(y)return document.addEventListener("click",k),()=>document.removeEventListener("click",k)},[y]),e.jsxs("div",{className:"relative",ref:c,children:[e.jsx("button",{onClick:()=>E(!y),className:"p-2 text-white hover:text-gray-300 transition-colors","aria-label":"Меню",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-1 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 1-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),y&&e.jsxs("div",{className:"absolute right-0 mt-2 menu-popover space-y-0.5",children:[e.jsx("div",{className:"px-4 pt-2 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Импорт"}),e.jsx("button",{onClick:()=>{E(!1),n()},disabled:t,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:t?"Импорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:()=>{E(!1),a()},disabled:o,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:o?"Импорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Экспорт"}),e.jsx("button",{onClick:async()=>{E(!1),await m()},disabled:r,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:r?"Экспорт тренировок...":"Тренировки"}),e.jsx("button",{onClick:async()=>{E(!1),await b()},disabled:l,className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 disabled:opacity-50 transition-colors rounded-lg",children:l?"Экспорт шаблонов...":"Шаблоны"}),e.jsx("div",{className:"px-4 pt-1 pb-0 text-[11px] font-semibold uppercase tracking-wide text-gray-400 text-center whitespace-nowrap",children:"Данные и аккаунт"}),e.jsx("button",{onClick:()=>{E(!1),w()},className:"w-full text-left px-4 py-1.5 text-sm text-white hover:bg-white/5 transition-colors rounded-lg",children:"Очистить данные"}),e.jsx("button",{onClick:()=>{E(!1),C()},disabled:D,className:"w-full text-left px-4 py-1.5 text-sm text-red-400 hover:bg-red-500/10 disabled:opacity-50 transition-colors rounded-lg",children:D?"Удаление...":"Удалить аккаунт"})]})]})}function Re({isOpen:t,timerStepInput:o,setTimerStepInput:n,saveStatus:a,saveTimerStep:r,theme:l,handleThemeChange:m}){return t?e.jsxs("div",{className:"glass card-dark rounded-lg p-4 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Настройки"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Шаг таймера отдыха (секунды)"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Значение, на которое изменяется таймер при нажатии +/-"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[e.jsx("input",{type:"number",min:"1",max:"300",value:o,onChange:b=>n(b.target.value),className:"w-24 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("button",{type:"button",onClick:r,disabled:a==="saving",className:"btn-glass btn-glass-primary flex items-center justify-center gap-2 !py-2 !px-4 min-w-[104px]",children:[a==="saving"&&e.jsx("span",{"aria-label":"Сохранение...",className:"h-5 w-5 inline-block border-2 border-white/70 border-t-transparent rounded-full animate-spin"}),a==="success"&&e.jsx("svg",{"aria-label":"Сохранено",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),a==="idle"&&"Сохранить"]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4 space-y-2",children:[e.jsx("label",{className:"block text-sm text-gray-300",children:"Тема оформления"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("dark"),className:`btn-glass ${l==="dark"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}),"Тёмная"]})}),e.jsx("button",{type:"button",onClick:()=>m("light"),className:`btn-glass ${l==="light"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),"Светлая"]})}),e.jsx("button",{type:"button",onClick:()=>m("auto"),className:`btn-glass ${l==="auto"?"btn-glass-primary":"btn-glass-secondary"} w-full !py-2 !px-3 font-medium transition-all duration-200 ease-out`,children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Авто"]})})]})]})]}):null}function Pe({isOpen:t,pendingTemplatesDuplicates:o,isImportingTemplates:n,templatesImportAction:a,onClose:r,handleImportTemplatesOnlyNew:l,handleImportTemplatesOverwrite:m}){return t?e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{n||r()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт шаблонов"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("p",{children:"В файле найдены шаблоны с именами, которые уже есть в вашем аккаунте."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-400 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые шаблоны» — добавит только те, которых ещё нет."}),e.jsx("li",{children:"«Перезаписать существующие шаблоны» — удалит совпадающие и создаст их заново из файла."})]})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto rounded-md bg-black/20 p-3 space-y-2",children:[o.map((b,D)=>{var w;return e.jsxs("div",{className:"text-sm text-gray-200 border-b border-white/5 pb-1 last:border-0",children:[e.jsx("div",{className:"font-semibold",children:((w=b.template)==null?void 0:w.name)||"Без названия"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Уже есть как: «",b.existingName||"Без названия","»"]})]},b.existingId+"-"+D)}),o.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Совпадающих шаблонов не найдено."})]}),n?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:a==="overwrite"?"Перезаписываем существующие шаблоны и импортируем данные...":"Импортируем только новые шаблоны..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые шаблоны (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Перезаписать существующие шаблоны и добавить новые"}),e.jsx("button",{type:"button",onClick:r,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Отмена"})]})]})]}):null}function Be(t){if(!t||typeof t!="string")return t;const o=t.split("-");if(o.length===3){const[n,a,r]=o;if(n&&a&&r)return`${r}.${a}.${n}`}return t}function ze({isOpen:t,pendingWorkoutsImport:o,pendingWorkoutsFileName:n,pendingWorkoutsNewDatesSummary:a,isImportingWorkouts:r,importAction:l,onClose:m,handleConfirmImportWorkoutsOnly:b,handleImportOnlyNewWorkouts:D,handleExportThenImportWorkouts:w}){return!t||!o?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>{r||m()}}),e.jsxs("div",{className:"relative w-full max-w-md glass card-dark rounded-xl shadow-xl p-5 space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Импорт тренировок"}),e.jsx("p",{className:"text-sm text-gray-300",children:`Будут импортированы тренировки из файла "${n||"выбранный файл"}".`}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"Тренировки на даты, которые уже есть в календаре и присутствуют в файле, будут удалены и перезаписаны данными из файла. На другие даты тренировки останутся без изменений."}),e.jsxs("ul",{className:"list-disc list-inside text-xs text-gray-500 space-y-0.5",children:[e.jsx("li",{children:"«Импортировать только новые тренировки» — добавит тренировки только на новые даты, без изменения существующих."}),e.jsx("li",{children:"«Импортировать с перезаписью дат» — заменит тренировки на совпадающие даты и добавит новые."}),e.jsx("li",{children:"«Экспортировать текущие тренировки и импортировать с перезаписью» — сначала сохранит текущие тренировки в файл, затем выполнит импорт с перезаписью дат."})]})]}),a.length>0&&e.jsxs("div",{className:"mt-2 rounded-md bg-black/20 p-3",children:[e.jsx("p",{className:"text-xs text-gray-300",children:"Новые тренировки из файла (даты, которых ещё нет в календаре):"}),e.jsx("div",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto text-center",children:a.map(C=>e.jsx("div",{className:"text-xs text-gray-200",children:e.jsx("span",{children:Be(C.date)})},C.date))})]}),r?e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-gray-300",children:l==="exportThenImport"?"Экспортируем текущие тренировки и импортируем новые...":l==="onlyNew"?"Импортируем только новые тренировки...":"Импортируем тренировки..."})]}):e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[a.length>0&&e.jsx("button",{type:"button",onClick:D,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать только новые тренировки (без изменения существующих)"}),e.jsx("button",{type:"button",onClick:b,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Импортировать с перезаписью дат из файла"}),e.jsx("button",{type:"button",onClick:w,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary",children:"Экспортировать текущие тренировки и импортировать с перезаписью дат"}),e.jsx("button",{type:"button",onClick:m,className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary bg-white/10 hover:bg-white/5",children:"Отмена"})]})]})]})}const Ze=()=>{const{user:t,signOut:o}=me(),n=he(),[a,r]=s.useState(!1),[l,m]=s.useState(!1),[b,D]=s.useState(""),[w,C]=s.useState(null),[y,E]=s.useState(!1),c=_e({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email}),k=Ee({userId:t==null?void 0:t.id,userEmail:t==null?void 0:t.email,setToastVariant:c.setToastVariant,setImportSuccessMessage:c.setImportSuccessMessage,setIsImportSuccessOpen:c.setIsImportSuccessOpen}),h=Te({userId:t==null?void 0:t.id,setToastVariant:c.setToastVariant,setImportSuccessMessage:c.setImportSuccessMessage,setIsImportSuccessOpen:c.setIsImportSuccessOpen}),j=Ce({userId:t==null?void 0:t.id}),B=fe();s.useEffect(()=>{j.isWeightTrackerOpen&&t&&j.loadBodyWeights()},[j.isWeightTrackerOpen,t]);const z=s.useMemo(()=>{var g;if(!t)return"";const d=(g=t.user_metadata)==null?void 0:g.nickname;if(typeof d=="string"&&d.trim().length>0)return d.trim();const F=t.email||"";return F.endsWith("@gymlog.app")?F.replace(/@gymlog\.app$/,""):F},[t]),U=s.useMemo(()=>{const d=(t==null?void 0:t.email)||"";if(!d||typeof d!="string")return null;const[F,g]=d.split("@");if(!F||!g)return null;const H=Math.max(1,Math.ceil(F.length/2)),R=F.slice(0,H),q=F.slice(H);return{email:d,localPart:F,domain:g,visiblePart:R,hiddenPart:q}},[t==null?void 0:t.email]),O=async()=>{try{await o(),n("/login",{replace:!0})}catch(d){console.error("Error logging out:",d)}},G=()=>{!t||!t.email||(D(""),C(null),m(!0))},p=()=>{t&&h.setIsCleanDataDialogOpen(!0)},M=async()=>{if(!(!t||!t.email)){if(b.trim()!==t.email)throw C("Введённый e-mail не совпадает с вашим."),new Error("EMAIL_MISMATCH");C(null),r(!0);try{await ve(),alert("Ваш аккаунт и все данные были успешно удалены."),await o(),n("/login",{replace:!0})}catch(d){console.error("Error deleting account:",d),alert(`Не удалось удалить аккаунт: ${d.message}`)}finally{r(!1)}}};return e.jsxs("div",{className:"p-4 space-y-4 max-w-lg mx-auto pt-safe relative profile-page",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Профиль"}),e.jsx(Fe,{isImportingWorkouts:c.isImportingWorkouts,isImportingTemplates:k.isImportingTemplates,handleStartImportWorkouts:c.handleStartImportWorkouts,handleStartImportTemplates:k.handleStartImportTemplates,isExporting:c.isExporting,isExportingTemplates:k.isExportingTemplates,handleExportWorkouts:c.handleExportWorkouts,handleExportTemplates:k.handleExportTemplates,isDeleting:a,startCleanDataFlow:p,startDeleteAccountFlow:G})]}),e.jsx("div",{className:"p-4 glass card-dark rounded-lg shadow",children:t&&e.jsxs("p",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("span",{children:"Вы вошли как:"}),U?e.jsxs("span",{className:"font-semibold",children:[U.visiblePart,U.hiddenPart&&e.jsx("button",{type:"button",onClick:()=>E(!0),className:"inline px-0 py-0 border-b border-dashed border-white/40 hover:border-white/80 transition-colors cursor-pointer select-none bg-transparent rounded-none align-baseline",children:y?e.jsx("span",{children:U.hiddenPart}):e.jsx("span",{children:"•".repeat(Math.max(3,U.hiddenPart.length))})}),"@",U.domain]}):e.jsx("span",{className:"font-semibold",children:z})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>n("/progress"),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"Узнать прогресс"]}),e.jsxs("button",{onClick:()=>j.setIsWeightTrackerOpen(!0),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})}),"Трекер веса тела"]}),e.jsxs("button",{onClick:()=>B.setIsSettingsOpen(!B.isSettingsOpen),className:"btn-glass btn-glass-full btn-glass-md btn-glass-secondary flex items-center justify-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Настройки",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${B.isSettingsOpen?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx("button",{onClick:O,className:"btn-glass btn-glass-logout btn-glass-full btn-glass-md",children:"Выйти"})]}),e.jsx(Re,{isOpen:B.isSettingsOpen,timerStepInput:B.timerStepInput,setTimerStepInput:B.setTimerStepInput,saveStatus:B.saveStatus,saveTimerStep:B.saveTimerStep,theme:B.theme,handleThemeChange:B.handleThemeChange}),e.jsx("input",{ref:c.workoutsFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:c.handleWorkoutsFileChange}),e.jsx("input",{ref:k.templatesFileInputRef,type:"file",accept:"application/json",className:"hidden",onChange:k.handleTemplatesFileChange}),e.jsx(ce,{open:l,onOpenChange:d=>{m(d),d||(D(""),C(null))},title:"Удалить аккаунт и все данные?",description:"Это действие необратимо и удалит все ваши данные.",confirmText:"Удалить аккаунт",cancelText:"Отмена",variant:"danger",confirmDisabled:b.trim().length===0,onConfirm:M,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-300",children:["Для подтверждения введите ваш e-mail: ",e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.email})]}),e.jsx("input",{type:"email",value:b,onChange:d=>{D(d.target.value),w&&C(null)},placeholder:(t==null?void 0:t.email)||"Введите ваш e-mail",className:"mt-1 block w-full px-3 py-2 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",style:{background:"#18181b",color:"#fafafa",border:"1px solid #3f3f46"}}),w&&e.jsx("p",{className:"text-xs text-red-400",children:w})]})}),e.jsx($e,{isOpen:h.isCleanDataDialogOpen,onClose:()=>h.setIsCleanDataDialogOpen(!1),isLoadingWorkoutsForDeletion:h.isLoadingWorkoutsForDeletion,isLoadingTemplatesForDeletion:h.isLoadingTemplatesForDeletion,openDeleteWorkoutsDialog:h.openDeleteWorkoutsDialog,openDeleteTemplatesDialog:h.openDeleteTemplatesDialog}),e.jsx(Me,{isOpen:h.isDeleteWorkoutsDialogOpen,onClose:h.closeDeleteWorkoutsDialog,workoutDateGroups:h.workoutDateGroups,selectedWorkoutDates:h.selectedWorkoutDates,isDeletingWorkouts:h.isDeletingWorkouts,areAllWorkoutDatesSelected:h.areAllWorkoutDatesSelected,toggleWorkoutDateSelection:h.toggleWorkoutDateSelection,selectAllWorkoutDates:h.selectAllWorkoutDates,clearWorkoutSelection:h.clearWorkoutSelection,handleDeleteSelectedWorkouts:h.handleDeleteSelectedWorkouts}),e.jsx(Ie,{isOpen:h.isDeleteTemplatesDialogOpen,onClose:h.closeDeleteTemplatesDialog,templatesForDeletion:h.templatesForDeletion,selectedTemplateIds:h.selectedTemplateIds,isDeletingTemplates:h.isDeletingTemplates,areAllTemplatesSelected:h.areAllTemplatesSelected,toggleTemplateSelection:h.toggleTemplateSelection,selectAllTemplates:h.selectAllTemplates,clearTemplateSelection:h.clearTemplateSelection,handleDeleteSelectedTemplates:h.handleDeleteSelectedTemplates}),e.jsx(ge,{open:c.isImportSuccessOpen,onOpenChange:d=>{d||c.closeImportSuccessToast()},onClose:c.closeImportSuccessToast,message:c.importSuccessMessage||"Импорт тренировок завершён. Откройте календарь, чтобы посмотреть тренировки.",variant:c.toastVariant}),e.jsx(Pe,{isOpen:k.isTemplatesImportDialogOpen,pendingTemplatesDuplicates:k.pendingTemplatesDuplicates,isImportingTemplates:k.isImportingTemplates,templatesImportAction:k.templatesImportAction,onClose:k.closeTemplatesImportDialog,handleImportTemplatesOnlyNew:k.handleImportTemplatesOnlyNew,handleImportTemplatesOverwrite:k.handleImportTemplatesOverwrite}),e.jsx(ze,{isOpen:c.isWorkoutsImportDialogOpen,pendingWorkoutsImport:c.pendingWorkoutsImport,pendingWorkoutsFileName:c.pendingWorkoutsFileName,pendingWorkoutsNewDatesSummary:c.pendingWorkoutsNewDatesSummary,isImportingWorkouts:c.isImportingWorkouts,importAction:c.importAction,onClose:c.closeWorkoutsImportDialog,handleConfirmImportWorkoutsOnly:c.handleConfirmImportWorkoutsOnly,handleImportOnlyNewWorkouts:c.handleImportOnlyNewWorkouts,handleExportThenImportWorkouts:c.handleExportThenImportWorkouts}),e.jsx(Le,{isOpen:j.isWeightTrackerOpen,onClose:()=>j.setIsWeightTrackerOpen(!1),bodyWeights:j.bodyWeights,loadingWeights:j.loadingWeights,weightChartData:j.weightChartData,weightStats:j.weightStats,newWeight:j.newWeight,newWeightDate:j.newWeightDate,savingWeight:j.savingWeight,deletingWeightId:j.deletingWeightId,isDeleteWeightConfirmOpen:j.isDeleteWeightConfirmOpen,weightToDelete:j.weightToDelete,setNewWeight:j.setNewWeight,setNewWeightDate:j.setNewWeightDate,setIsDeleteWeightConfirmOpen:j.setIsDeleteWeightConfirmOpen,handleAddWeight:j.handleAddWeight,handleDeleteWeight:j.handleDeleteWeight,handleOpenDeleteWeightConfirm:j.handleOpenDeleteWeightConfirm})]})};export{Ze as default};
